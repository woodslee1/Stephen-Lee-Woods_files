if (self.CavalryLogger) { CavalryLogger.start_js(["aPIML"]); }

__d("FBButtonMenuCombo.react",["invariant","FBActionSelector.react","React","Tooltip","XUIButton.react","XUIButtonGroup.react"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k,l,m=c("FBActionSelector.react").Option,n=c("React").PropTypes;i=babelHelpers.inherits(o,c("React").PureComponent);j=i&&i.prototype;function o(){__p&&__p();var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=j.constructor).call.apply(p,[this].concat(s)),this.$FBButtonMenuCombo1=function(){__p&&__p();var u=[],v=[];c("React").Children.forEach(this.props.children,function(w,x){w.type.__FBButtonMenuComboItem__||h(0);if(x<this.props.numberOfButtons){var y=this.props.useImageOnlyButtons?null:w.props.label;u.push(c("React").createElement(c("XUIButton.react"),babelHelpers["extends"]({},c("Tooltip").propsFor(w.props.tooltip),{"data-testid":w.props["data-testid"],"data-tooltip-alignh":this.props.tooltipAlignH,"data-tooltip-position":this.props.tooltipPosition,disabled:this.props.disabled||w.props.disabled,image:w.props.image,key:w.props.value,label:y,onClick:function(){return this.props.onClick(w.props.value)}.bind(this),size:this.props.size})))}else v.push(c("React").createElement(m,babelHelpers["extends"]({},c("Tooltip").propsFor(w.props.tooltip),{"data-tooltip-alignh":this.props.tooltipAlignH,"data-tooltip-position":this.props.tooltipPosition,disabled:this.props.disabled||w.props.disabled,key:w.props.value,value:w.props.value}),w.props.label))}.bind(this));return{buttons:u,menuItems:v}}.bind(this),q}o.prototype.render=function(){var p=this.$FBButtonMenuCombo1(),q=p.buttons,r=p.menuItems,s=null;if(r.length>0)s=c("React").createElement(c("FBActionSelector.react"),{alignment:"right",disabled:this.props.disabled,onAction:this.props.onClick,size:this.props.size},r);return c("React").createElement(c("XUIButtonGroup.react"),{className:"uiContextualLayerParent"},q,s)};o.__FBButtonMenuCombo__=true;o.propTypes={disabled:n.bool,numberOfButtons:n.number,onClick:n.func.isRequired,size:n.oneOf(["small","medium","large","xlarge","xxlarge"]),tooltipPosition:n.oneOf(["above","below","left","right"]),tooltipAlignH:n.oneOf(["left","right","center"]),useImageOnlyButtons:n.bool};o.defaultProps={numberOfButtons:1,size:"medium"};o.Item=(l=k=function(){__p&&__p();var p,q;p=babelHelpers.inherits(r,c("React").PureComponent);q=p&&p.prototype;r.prototype.render=function(){"use strict";return null};function r(){"use strict";p.apply(this,arguments)}return r}(),k.__FBButtonMenuComboItem__=true,k.propTypes={disabled:n.bool,image:n.element,label:n.string.isRequired,tooltip:n.string,value:n.string.isRequired},l);f.exports=o}),null);
__d("ChatContentSearchContextualDialog.react",["cx","ContextualLayerAutoFlipHorizontal","LayerHideOnEscape","ReactAbstractContextualDialog","ReactLayer"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("ReactLayer").createClass(c("ReactAbstractContextualDialog").createSpec({addedBehaviors:[c("ContextualLayerAutoFlipHorizontal"),c("LayerHideOnEscape")],displayName:"StickerXUIContextualDialog",theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:47,length:16}}}));f.exports=i}),null);
__d("ChatContentSearchButton.react",["cx","fbt","BootloadOnRender.react","ChatFlyoutPlaceholder.react","ChatContentSearchContextualDialog.react","JSResource","LazyComponent.react","Link.react","ReactComponentWithPureRenderMixin","React","MercuryShareAttachmentRenderLocations","joinClasses"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=c("React").PropTypes,k=278,l=c("React").createClass({displayName:"ChatContentSearchButton",_clickGuard:false,mixins:[c("ReactComponentWithPureRenderMixin")],propTypes:{clicked:j.bool,ContextualDialogClass:j.func,flyoutAlignment:j.oneOf(["left","right"]),getQuery:j.func.isRequired,location:j.oneOf(c("MercuryShareAttachmentRenderLocations").getValues()),onLoad:j.func,onSelect:j.func.isRequired},getDefaultProps:function m(){return{flyoutAlignment:"left",location:c("MercuryShareAttachmentRenderLocations").CHAT}},getInitialState:function m(){return{query:"",shown:!!this.props.clicked}},componentDidMount:function m(){this.props.onLoad&&this.props.onLoad(this)},updateQuery:function m(){this.setState({query:this.props.getQuery()})},hideFlyout:function m(){this.setState(this.getInitialState())},render:function m(){return c("React").createElement("span",null,c("React").createElement(c("Link.react"),{className:c("joinClasses")(this.props.className,this.state.shown?"open":""),href:"#",onMouseDown:this._handleMouseDown,onClick:this._handleClick,role:"button",title:i._("Choose a gif"),ref:"link"}),this.renderLayers())},renderLayers:function m(){if(!this.state.shown)return null;var n=this.props.ContextualDialogClass||c("ChatContentSearchContextualDialog.react");return c("React").createElement(n,{alignment:this.props.flyoutAlignment,contextRef:function(){return this.refs.link}.bind(this),onBlur:this.hideFlyout,onToggle:this._handleContextualDialogToggle,shown:this.state.shown,width:k,key:"contextualDialog"},c("React").createElement(c("BootloadOnRender.react"),{component:c("React").createElement(c("LazyComponent.react"),{location:this.props.location,onEscKeyDown:this.hideFlyout,onSelect:this._handleSelect,query:this.state.query}),loader:c("JSResource")("ChatContentSearchFlyout.react").__setRef("ChatContentSearchButton.react"),placeholder:c("React").createElement(c("ChatFlyoutPlaceholder.react"),null)}))},_handleMouseDown:function m(n){this._clickGuard=this.state.shown},_handleClick:function m(n){n.stopPropagation();if(this.state.shown||this._clickGuard)return;this.setState({query:this.props.getQuery(),shown:!this.state.shown})},_handleSelect:function m(n,o){this.props.onSelect(n,o);this.hideFlyout()},_handleContextualDialogToggle:function m(n){this.setState({shown:n})}});f.exports=l}),null);
__d("MNCommerceAgentItemSuggestionMercuryAttachment.react",["ix","cx","fbt","Image.react","LeftRight.react","Link.react","LineClamp.react","MercuryShareAttachmentRenderLocations","MNCommerceAgenItemSuggestionReactShape","MNCommerceBubbleImage.react","React","ShimButton.react"],(function a(b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k,l,m=c("React").PropTypes,n=3;k=babelHelpers.inherits(o,c("React").PureComponent);l=k&&k.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=l.constructor).call.apply(p,[this].concat(s)),this.$MNCommerceAgentItemSuggestionMercuryAttachment2=function(u){u.preventDefault();this.props.onBuyClick&&this.props.onBuyClick()}.bind(this),q}o.prototype.render=function(){__p&&__p();var p=this.props.itemSuggestion,q=p.thumb_url?c("React").createElement("div",{className:"_522n"},c("React").createElement(c("MNCommerceBubbleImage.react"),{location:this.props.location,source:p.thumb_url,width:this.props.width})):null,r=null;if(p.desc)r=c("React").createElement(c("LineClamp.react"),{lines:n},p.desc);var s={};if(this.props.location===c("MercuryShareAttachmentRenderLocations").CHAT&&this.props.width)s.width=this.props.width;var t=c("React").createElement("div",{className:!p.target_url?"_522-":"",style:s},q,c("React").createElement("div",{className:"_522o"},c("React").createElement("div",{className:"_522p"},p.name),r,c("React").createElement("div",{className:"_522q"},p.merchant_name)),this.$MNCommerceAgentItemSuggestionMercuryAttachment1());if(p.target_url)return c("React").createElement(c("Link.react"),{className:"_522-",target:"_blank",href:{url:p.target_url,shimhash:p.shimhash}},t);return t};o.prototype.$MNCommerceAgentItemSuggestionMercuryAttachment1=function(){var p=this.props.itemSuggestion.total_cost;if(!p||p.amount<=0)return null;var q=void 0;if(!this.props.isPurchased)q=c("React").createElement(c("ShimButton.react"),{className:"_522s",onClick:this.$MNCommerceAgentItemSuggestionMercuryAttachment2},j._("Get"));else q=c("React").createElement("div",{className:"_1x98"},c("React").createElement(c("Image.react"),{className:"_1x99",src:h("86977")}),j._("Paid"));return c("React").createElement(c("LeftRight.react"),{className:"_522r"},j._("Total: {total cost}",[j.param("total cost",this.props.itemSuggestion.display_total_cost)]),q)};o.propTypes={isPurchased:m.bool,itemSuggestion:c("MNCommerceAgenItemSuggestionReactShape").isRequired,location:m.oneOf(c("MercuryShareAttachmentRenderLocations").getValues()),onBuyClick:m.func,width:m.number};f.exports=o}),null);
__d("P2PChooseCreditCardDialog.react",["cx","fbt","MessengerEnvironment","P2PButton.react","P2PChooseCreditCardForm.react","P2PCreditCard","P2PDialog.react","P2PDialogBody.react","P2PDialogFooter.react","P2PDialogTitle.react","P2PLoadingMask.react","P2PText.react","React"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("MessengerEnvironment").messengerui,m=c("React").PropTypes;j=babelHelpers.inherits(n,c("React").Component);k=j&&j.prototype;function n(){__p&&__p();var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.state={loading:false,selectedCreditCard:this.props.selectedCreditCard},this.handleAddDebitCardOptionClicked=function(){this.props.onAddDebitCardOptionSelected()}.bind(this),this.handleCreditCardSelected=function(t){this.setState({selectedCreditCard:t})}.bind(this),this.handleSelected=function(){this.setState({loading:true});this.props.onSelected(this.state.selectedCreditCard)}.bind(this),this.handleToggle=function(t){if(!t)this.props.onClose()}.bind(this),p}n.prototype.render=function(){var o=void 0;if(this.props.showCancelButton)o=c("React").createElement(c("P2PButton.react"),{disabled:this.props.showLoading,label:this.props.cancelButtonText,onClick:this.props.onClose,size:"medium",use:"default"});return c("React").createElement(c("P2PDialog.react"),{behaviors:this.props.behaviors,className:l?"_auz":"",onToggle:this.handleToggle,width:this.props.width},c("React").createElement(c("P2PDialogTitle.react"),null,this.props.title),c("React").createElement(c("P2PDialogBody.react"),{className:"_383d"},c("React").createElement(c("P2PText.react"),{type:"primary",className:"_au_"},this.props.text),c("React").createElement(c("P2PChooseCreditCardForm.react"),{addCardOptionText:this.props.addCardOptionText,className:"_2pi4",creditCards:this.props.creditCards,onAddDebitCardOptionSelected:this.handleAddDebitCardOptionClicked,onChange:this.handleCreditCardSelected,selectedCard:this.props.selectedCreditCard,showAddDebitCardOption:true})),c("React").createElement(c("P2PDialogFooter.react"),null,o,c("React").createElement(c("P2PButton.react"),{disabled:this.props.showLoading,label:this.props.saveButtonText,onClick:this.handleSelected,size:"medium",use:"confirm"})),c("React").createElement(c("P2PLoadingMask.react"),{visible:this.props.showLoading}))};n.propTypes={addCardOptionText:m.node,cancelButtonText:m.node,creditCards:m.arrayOf(m.instanceOf(c("P2PCreditCard"))).isRequired,onAddDebitCardOptionSelected:m.func.isRequired,onClose:m.func.isRequired,onSelected:m.func.isRequired,saveButtonText:m.node.isRequired,selectedCreditCard:m.instanceOf(c("P2PCreditCard")).isRequired,showCancelButton:m.bool,showLoading:m.bool,text:m.node,title:m.node,width:m.number};n.defaultProps={cancelButtonText:i._("Cancel"),showCancelButton:false,text:i._("You can use a debit card you've already added to Facebook or add a new one."),title:i._("Select Debit Card")};f.exports=n}),null);
__d("P2PEditCreditCardDialog.react",["cx","fbt","CreditCardFormParam","MessengerEnvironment","Link.react","React","P2PAPI","P2PAPIUtils","P2PCreditCard","P2PCreditCardForm.react","P2PLoadingMask.react","P2PLinkConstants","P2PDialog.react","P2PDialogTitle.react","P2PDialogBody.react","P2PDialogFooter.react","P2PButton.react","P2PText.react"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l="fbP2PEditCreditCardDialog_learnMoreSentenceID",m=c("React").PropTypes;j=babelHelpers.inherits(n,c("React").Component);k=j&&j.prototype;function n(){__p&&__p();var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.state={formData:{},isValid:false,loading:false,requestID:"",saveErrors:null},this.clearSaveErrors=function(){this.setState({saveErrors:null})}.bind(this),this.onSaveClick=function(t){var u={},v=c("P2PAPIUtils").genRequestID();u[c("CreditCardFormParam").CREDENTIAL_ID]=this.props.creditCard.getCredentialId();this.clearSaveErrors();this.setState({loading:true,requestID:v});c("P2PAPI").updateCreditCard(babelHelpers["extends"]({requestID:v},u,this.state.formData))}.bind(this),this.handleOnSaveSuccess=function(t){this.props.onSuccess(t)}.bind(this),this.onCancelClick=function(t){this.props.onCancel()}.bind(this),this.handleOnSaveError=function(t){this.setState({loading:false,saveErrors:t})}.bind(this),this.isSaveDisabled=function(){return!this.state.isValid||this.state.loading}.bind(this),this.isCancelDisabled=function(){return this.state.loading}.bind(this),this.handleValidation=function(t,u){this.setState({isValid:t,formData:u})}.bind(this),this.getPrefilledFormData=function(){var t={};t[c("CreditCardFormParam").CARD_NUMBER]=this.props.creditCard.getCreditCardNumberMask();t[c("CreditCardFormParam").CARD_EXPIRATION]=this.props.creditCard.getExpFormattedShort();t[c("CreditCardFormParam").ZIP]=this.props.creditCard.getZipCode();return t}.bind(this),this.handleErrorDialogOKClick=function(){this.clearSaveErrors()}.bind(this),this.onToggle=function(t){if(!t)this.props.onCancel()}.bind(this),p}n.prototype.componentWillReceiveProps=function(o){var p=o.asyncRequestState?o.asyncRequestState[this.state.requestID]:null;if(p){this.setState({requestID:""});if(p.error)this.handleOnSaveError(p.error);else this.handleOnSaveSuccess(p)}};n.prototype.render=function(){var o=void 0,p=this.props.text;if(!p)p=i._("Please update the expiration date for your card ending in {card numbers}.",[i.param("card numbers",this.props.creditCard.getCreditCardNumber())]);if(this.props.showCancelButton)o=c("React").createElement(c("P2PButton.react"),{use:"default",size:"medium",label:i._("Cancel"),disabled:this.isCancelDisabled(),onClick:this.onCancelClick});return c("React").createElement(c("P2PDialog.react"),{behaviors:this.props.behaviors,layerHideOnBlur:false,onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:this.props.width},c("React").createElement(c("P2PDialogTitle.react"),null,i._("Update Debit Card")),c("React").createElement(c("P2PDialogBody.react"),null,c("React").createElement(c("P2PText.react"),{className:"_3-96",type:"primary"},p),c("React").createElement(c("P2PCreditCardForm.react"),{onValidation:this.handleValidation,saveErrors:this.state.saveErrors,editMode:true,prefilledFormData:this.getPrefilledFormData(),cscMaxLength:this.props.creditCard.getMaxCSCLength()}),c("React").createElement(c("P2PText.react"),{className:"_3-8y",id:l,type:"secondary"},i._("Your payment info is stored securely. {Learn more about p2p link}",[i.param("Learn more about p2p link",c("React").createElement(c("Link.react"),{"aria-describedby":l,href:c("P2PLinkConstants").addDebitCardHelpURI,target:"_blank"},i._("Learn more.")))]))),c("React").createElement(c("P2PDialogFooter.react"),null,o,c("React").createElement(c("P2PButton.react"),{use:"confirm",size:"medium",label:this.props.saveButtonText,disabled:this.isSaveDisabled(),onClick:this.onSaveClick})),c("React").createElement(c("P2PLoadingMask.react"),{visible:this.state.loading}))};n.propTypes={asyncRequestState:m.object.isRequired,creditCard:m.instanceOf(c("P2PCreditCard")).isRequired,onCancel:m.func.isRequired,onSuccess:m.func.isRequired,saveButtonText:m.node,showCancelButton:m.bool};n.defaultProps={saveButtonText:i._("Save"),showCancelButton:true,width:c("MessengerEnvironment").messengerui?350:300};f.exports=n}),null);
__d("P2PMoneypennyCheckoutDialog.react",["cx","fbt","ix","MessengerEnvironment","Link.react","MNCommerceAgenItemSuggestionReactShape","P2PBigAmount.react","P2PButton.react","P2PCreditCard","P2PDialog.react","P2PDialogBody.react","P2PDialogFooter.react","P2PDialogTitle.react","P2PLoadingMask.react","P2PMoneypennyProductItemDetails.react","P2PText.react","React"],(function a(b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k,l,m=c("React").PropTypes;k=babelHelpers.inherits(n,c("React").PureComponent);l=k&&k.prototype;function n(){__p&&__p();var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=l.constructor).call.apply(o,[this].concat(r)),this.handleToggle=function(t){if(!t)this.props.onClose()}.bind(this),this.renderPaymentDetails=function(){var t=this.props.selectedCreditCard;if(!t)return null;return c("React").createElement(c("P2PText.react"),{className:"_1t0k",shade:"light",size:"small",type:"secondary"},t.getDetailsFormatted()+" \xb7 ",c("React").createElement(c("Link.react"),{className:"_1t0l",onClick:this.props.onChangeCreditCard,href:"#"},i._("Change")))}.bind(this),this.renderFooter=function(){var t=void 0,u=void 0,v=void 0;if(!this.props.selectedCreditCard){t=c("React").createElement(c("P2PText.react"),{className:"_1t0n",type:"secondary"},this.props.leftContentText);u=c("React").createElement(c("P2PButton.react"),{label:i._("Next"),onClick:this.props.onNextClicked,size:"medium",type:"primary",use:"default"})}else u=c("React").createElement(c("P2PButton.react"),{label:i._("Pay"),onClick:this.props.onPurchaseClicked,size:"medium",type:"primary",use:"confirm"});if(this.props.showCancelButton)v=c("React").createElement(c("P2PButton.react"),{use:"default",size:"medium",label:this.props.cancelButtonText,disabled:this.props.showLoading,onClick:this.props.onClose});return c("React").createElement(c("P2PDialogFooter.react"),{leftContent:t},v,u)}.bind(this),p}n.prototype.renderAmountSection=function(){return c("React").createElement("div",{className:"_1t0o"},c("React").createElement("div",{className:"_4qbr"},c("React").createElement(c("P2PBigAmount.react"),{amount:this.props.item.raw_amount,className:"_3oh-",currencyCode:this.props.item.currencyCode,size:"large"})),this.renderPaymentDetails(),c("React").createElement(c("P2PText.react"),{className:"_1wb1",shade:"light",size:"small",type:"secondary"},"We","'","ll place your order with the business when we receive your payment."))};n.prototype.render=function(){var o=void 0;if(!c("MessengerEnvironment").messengerui)o=c("React").createElement(c("P2PDialogTitle.react"),null,i._("Payment"));return c("React").createElement(c("P2PDialog.react"),{layerHideOnBlur:false,onToggle:this.handleToggle,shown:true,width:this.props.width},o,c("React").createElement(c("P2PDialogBody.react"),null,c("React").createElement("div",{className:"_b0z"},c("React").createElement(c("P2PMoneypennyProductItemDetails.react"),{item:this.props.item})),this.renderAmountSection()),this.renderFooter(),c("React").createElement(c("P2PLoadingMask.react"),{visible:this.props.showLoading}))};n.propTypes={cancelButtonText:m.node,item:c("MNCommerceAgenItemSuggestionReactShape").isRequired,leftContentText:m.node,onClose:m.func.isRequired,onChangeCreditCard:m.func.isRequired,onNextClicked:m.func.isRequired,onPurchaseClicked:m.func.isRequired,selectedCreditCard:m.instanceOf(c("P2PCreditCard")),showCancelButton:m.bool,showLoading:m.bool};n.defaultProps={cancelButtonText:i._("Cancel"),leftContentText:i._("You'll add a debit card next."),showCancelButton:false,width:360};f.exports=n}),null);
__d("P2PMoneypennyStore",["P2PActionConstants","EventEmitter","ImmutableObject","P2PDispatcher"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=void 0,k=void 0,l=void 0;function m(p,q){if(p)l[p]=new(c("ImmutableObject"))(q)}function n(p,q){if(p)l[p]={error:q}}h=babelHelpers.inherits(o,c("EventEmitter"));i=h&&h.prototype;function o(){i.constructor.call(this);l={};k=[];j=c("P2PDispatcher").register(this.onEventDispatched.bind(this))}o.prototype.onEventDispatched=function(p){var q=p.data,r=p.type;switch(r){case c("P2PActionConstants").MONEYPENNY_TRANSFER_CREATED:this.handleMoneypennyTransferCreated(q);this.emit("change");break;case c("P2PActionConstants").MONEYPENNY_TRANSFER_CREATED_ERROR:this.handleMoneypennyTransferCreatedError(q);this.emit("change");break}};o.prototype.getAsyncRequestState=function(){return l};o.prototype.handleMoneypennyTransferCreated=function(p){var q=void 0;m(p.requestID,p);q=k.filter(function(r){return r.payment_id===p.payment_id})[0];if(!q)k.push(new(c("ImmutableObject"))(p))};o.prototype.handleMoneypennyTransferCreatedError=function(p){n(p.requestID,p.error)};o.prototype.getTransferByID=function(p){return k.filter(function(q){return q.item_id===p})[0]};f.exports=new o()}),null);
__d("P2PPasswordProtectionNUXDialog.react",["cx","fbt","MessengerEnvironment","Link.react","P2PAPI","P2PErrorDialog.react","P2PLinkConstants","P2PLoadingMask.react","P2PLogger","P2PPaymentLoggerEvent","P2PPaymentLoggerEventFlow","P2PPasswordProtectionParam","P2PPasswordProtectionStatusTypes","React","P2PButton.react","P2PDialog.react","P2PDialogTitle.react","P2PDialogBody.react","P2PDialogFooter.react","P2PText.react","emptyFunction"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("React").PropTypes;j=babelHelpers.inherits(m,c("React").Component);k=j&&j.prototype;function m(){__p&&__p();var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.state={saveErrorObject:null,loading:false},this.log=function(s,t){c("P2PLogger").log(s,babelHelpers["extends"]({www_event_flow:c("P2PPaymentLoggerEventFlow").UI_FLOW_P2P_SETTINGS},t))},this.onSaveClick=function(){this.setState({loading:true,saveErrorObject:null});this.setPasswordProtection(c("P2PPasswordProtectionStatusTypes").ENABLED);this.log(c("P2PPaymentLoggerEvent").UI_ACTN_OPT_IN_PASSWORD_PROTECTION_NUX)}.bind(this),this.setPasswordProtection=function(s){var t={};t[c("P2PPasswordProtectionParam").STATUS]=s;c("P2PAPI").setPasswordProtectionSetting({formData:t,success:this.handleOnSaveSuccess,error:this.handleOnSaveError})}.bind(this),this.handleOnSaveSuccess=function(){this.setState({loading:false});this.props.onComplete()}.bind(this),this.handleOnSaveError=function(s){this.setState({loading:false,saveErrorObject:s})}.bind(this),this.isSaveButtonDisabled=function(){return this.state.loading}.bind(this),this.isCancelButtonDisabled=function(){return this.state.loading}.bind(this),this.onCancelClick=function(){this.setState({loading:true,saveErrorObject:null});this.setPasswordProtection(c("P2PPasswordProtectionStatusTypes").DISABLED);this.log(c("P2PPaymentLoggerEvent").UI_ACTN_OPT_OUT_PASSWORD_PROTECTION_NUX)}.bind(this),this.handleErrorBackClick=function(){this.setState({saveErrorObject:null})}.bind(this),this.handleErrorOKClick=function(){this.setState({saveErrorObject:null});this.props.onComplete()}.bind(this),o}m.prototype.componentWillMount=function(){this.log(c("P2PPaymentLoggerEvent").UI_ACTN_INITIATE_PASSWORD_PROTECTION_NUX)};m.prototype.render=function(){if(this.state.saveErrorObject)return c("React").createElement(c("P2PErrorDialog.react"),{allowBack:true,title:i._("Problem Saving"),onBackClick:this.handleErrorBackClick,onOKClick:this.handleErrorOKClick,error:this.state.saveErrorObject});return c("React").createElement(c("P2PDialog.react"),{className:c("MessengerEnvironment").messengerui?"_-el":"",behaviors:{LayerFadeOnShow:false},layerHideOnBlur:false,shown:true,width:this.props.width},c("React").createElement(c("P2PDialogTitle.react"),{showCloseButton:false},i._("Use Password?")),c("React").createElement(c("P2PDialogBody.react"),null,c("React").createElement(c("P2PText.react"),{className:"_5sor",type:"primary"},i._("For additional security, you can enter your Facebook password to send money. You can always update this in {link}.",[i.param("link",c("React").createElement(c("Link.react"),{href:c("P2PLinkConstants").settingsWWWURI,target:"_blank"},i._("Settings")))]))),c("React").createElement(c("P2PDialogFooter.react"),null,c("React").createElement(c("P2PButton.react"),{className:"_5sov",disabled:this.isCancelButtonDisabled(),label:i._("Not Now"),onClick:this.onCancelClick,size:"medium",use:"default"}),c("React").createElement(c("P2PButton.react"),{className:"_5sox",disabled:this.isSaveButtonDisabled(),label:i._("Use Password"),onClick:this.onSaveClick,size:"medium",use:"confirm"})),c("React").createElement(c("P2PLoadingMask.react"),{visible:this.state.loading}))};m.propTypes={onComplete:l.func};m.defaultProps={onComplete:c("emptyFunction"),width:c("MessengerEnvironment").messengerui?320:300};f.exports=m}),null);
__d("P2PSuccessDialog.react",["fbt","ix","MessengerEnvironment","Image.react","LayerSlowlyFadeOnShow","P2PConfirmationDialog.react","React","emptyFunction"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("React").PropTypes;j=babelHelpers.inherits(m,c("React").Component);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.getImage=function(){return c("React").createElement(c("Image.react"),{height:62,width:62,src:i("94361")})},o}m.prototype.render=function(){var n=this.getImage();return c("React").createElement(c("P2PConfirmationDialog.react"),{behaviors:babelHelpers["extends"]({LayerSlowlyFadeOnShow:c("LayerSlowlyFadeOnShow")},this.props.behaviors),allowBack:this.props.allowBack,buttonLabel:this.props.buttonLabel,buttonUse:this.props.buttonUse,centered:this.props.centered,image:n,onOKClick:this.props.onOKClick,onSecondaryClick:this.props.onSecondaryClick,onToggle:this.props.onToggle,showCloseButton:this.props.showCloseButton,showSecondaryButton:this.props.showSecondaryButton,secondaryButtonLabel:this.props.secondaryButtonLabel,secondaryButtonUse:this.props.secondaryButtonUse,title:this.props.title,width:this.props.width},this.props.children)};m.propTypes={allowBack:l.bool,buttonLabel:l.node,buttonUse:l.string,onOKClick:l.func,onSecondaryClick:l.func,onToggle:l.func,secondaryButtonLabel:l.node,secondaryButtonUse:l.string,showCloseButton:l.bool,showSecondaryButton:l.bool,title:l.node.isRequired,width:l.number};m.defaultProps={allowBack:false,buttonLabel:h._("OK"),buttonUse:"default",onOKClick:c("emptyFunction"),showCloseButton:false,width:c("MessengerEnvironment").messengerui?350:300};f.exports=m}),null);
__d("P2PMoneypennyCheckoutDialogContainer.react",["cx","fbt","Arbiter","CreditCardFormParam","MessengerEnvironment","MessengerPaymentProductType","MNCommerceAgenItemSuggestionReactShape","P2PAPI","P2PAPIUtils","P2PAddCreditCardDialog.react","P2PChooseCreditCardDialog.react","P2PCreditCardStore","P2PEditCreditCardDialog.react","P2PErrorDialog.react","P2PGKValues","P2PLogger","P2PMoneypennyCheckoutDialog.react","P2PMoneypennyStore","P2PPaymentLoggerEvent","P2PPaymentLoggerEventFlow","P2PPasswordProtectionNUXDialog.react","P2PPasswordProtectionStatusTypes","P2PSuccessDialog.react","P2PText.react","P2PVerifyCreditCardDialog.react","React","setImmediate"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=i._("Pay"),m={LayerFadeOnShow:false},n=360,o=c("P2PPaymentLoggerEventFlow").UI_FLOW_MONEYPENNY_CHECKOUT,p=c("React").PropTypes;j=babelHelpers.inherits(q,c("React").Component);k=j&&j.prototype;function q(s,t){k.constructor.call(this,s,t);r.call(this);var u=this.getCards();this.state={addCreditCardDialogShown:false,editCreditCardDialogShown:false,creditCards:u,creditCardAsyncRequestState:c("P2PCreditCardStore").getAsyncRequestState(),chooseCreditCardDialogShown:false,loading:false,moneypennyAsyncRequestState:c("P2PMoneypennyStore").getAsyncRequestState(),p2pPasswordProtectionNUXDialogShown:false,transferErrors:null,transferRequestID:"",selectedCreditCard:u[0],successDialogPending:false,successDialogShown:false,verifyCreditCardDialogShown:false}}q.prototype.componentWillMount=function(){this.log(c("P2PPaymentLoggerEvent").UI_ACTN_INITIATE_MONEYPENNY_ORDER,{});this.creditCardStoreSub=c("P2PCreditCardStore").addListener("change",this.onCreditCardStoreChange);this.moneypennyTransferStoreSub=c("P2PMoneypennyStore").addListener("change",this.onMoneypennyStoreChange)};q.prototype.componentWillUnmount=function(){__p&&__p();if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null}if(this.moneypennyTransferStoreSub){this.moneypennyTransferStoreSub.remove();this.moneypennyTransferStoreSub=null}if(this.passwordCancelSubscribeToken!==null){c("Arbiter").unsubscribe(this.passwordCancelSubscribeToken);this.passwordCancelSubscribeToken=null}};q.prototype.render=function(){__p&&__p();var s=this.props.item,t=c("MessengerEnvironment").messengerui,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0;if(this.getProductType()===c("MessengerPaymentProductType").MESSENGER_COMMERCE){u=i._("Please enter a debit or credit card to get {Product name}.",[i.param("Product name",s.name)]);v=i._("Add Card");x=i._("Select Card");w=i._("You can use a card you've already added to Facebook or add a new one to get {Product name}.",[i.param("Product name",this.props.item.name)]);y=i._("New Card");z=i._("You'll add a card next.")}else{u=i._("Please enter a debit card to get {Product name}. Credit cards can't be used yet.",[i.param("Product name",s.name)]);w=i._("You can use a debit card you've already added to Facebook or add a new one to get {Product name}.",[i.param("Product name",this.props.item.name)])}if(this.state.p2pPasswordProtectionNUXDialogShown)return c("React").createElement(c("P2PPasswordProtectionNUXDialog.react"),{onComplete:this.props.onClose,width:n});else if(this.state.transferErrors)return c("React").createElement(c("P2PErrorDialog.react"),{behaviors:m,error:this.state.transferErrors,onOKClick:this.handleCheckoutCancel,title:i._("Problem with your payment"),width:n});else if(this.state.verifyCreditCardDialogShown)return c("React").createElement(c("P2PVerifyCreditCardDialog.react"),{asyncRequestState:this.state.creditCardAsyncRequestState,behaviors:m,creditCard:this.state.selectedCreditCard,isPurchasing:true,purchaseName:this.props.item.name,onCancel:this.handleCheckoutCancel,onSuccess:this.purchase,saveButtonText:l,showCancelButton:t,width:n});else if(this.state.editCreditCardDialogShown)return c("React").createElement(c("P2PEditCreditCardDialog.react"),{asyncRequestState:this.state.creditCardAsyncRequestState,behaviors:m,creditCard:this.state.selectedCreditCard,onCancel:this.handleCheckoutCancel,onSuccess:this.purchase,saveButtonText:l,showCancelButton:t,text:i._("Please update the expiration date for your card ending in {card numbers} to get {Product name}.",[i.param("card numbers",this.state.selectedCreditCard.getCreditCardNumber()),i.param("Product name",this.props.item.name)]),width:n});else if(this.state.successDialogShown)return c("React").createElement(c("P2PSuccessDialog.react"),{behaviors:babelHelpers["extends"]({LayerSlowlyFadeOnShow:false},m),onOKClick:this.handleCheckoutSuccess,title:i._("Payment Sent"),width:n},c("React").createElement(c("P2PText.react"),{className:"_3-97",type:"primary"},i._("We received your payment and are placing your order with the business.")),c("React").createElement(c("P2PText.react"),{type:"primary"},i._("{Bold text that says, Tip:} You can also use {Credit card name and number} to send money to friends in your conversations.",[i.param("Bold text that says, Tip:",c("React").createElement(c("P2PText.react"),{display:"inline",type:"primary",weight:"bold"},i._("Tip:"))),i.param("Credit card name and number",this.state.selectedCreditCard.getDetailsFormatted())])));else if(this.state.chooseCreditCardDialogShown)return c("React").createElement(c("P2PChooseCreditCardDialog.react"),{addCardOptionText:y,behaviors:m,creditCards:this.state.creditCards,onAddDebitCardOptionSelected:this.handleAddDebitCardClicked,onClose:this.handleCheckoutCancel,onSelected:this.handleCreditCardSelected,saveButtonText:l,selectedCreditCard:this.state.selectedCreditCard,showCancelButton:t,showLoading:this.state.loading,text:w,title:x,width:n});else if(this.state.addCreditCardDialogShown)return c("React").createElement(c("P2PAddCreditCardDialog.react"),{behaviors:m,eventFlow:o,loggingData:{amount:s.raw_amount,object_id:s.id},onCancel:this.handleCheckoutCancel,onSuccess:this.handleAddCreditCardSuccess,productType:this.getProductType(),saveButtonText:l,showCancelButton:t,text:u,title:v,width:n});else return c("React").createElement(c("P2PMoneypennyCheckoutDialog.react"),{item:this.props.item,leftContentText:z,onChangeCreditCard:this.handleChangeCreditCardClicked,onClose:this.handleCheckoutCancel,onNextClicked:this.handleAddDebitCardClicked,onPurchaseClicked:this.purchase,selectedCreditCard:this.state.selectedCreditCard,showCancelButton:t,showLoading:this.state.loading,width:n})};q.propTypes={item:c("MNCommerceAgenItemSuggestionReactShape").isRequired,onClose:p.func.isRequired};var r=function r(){__p&&__p();this.creditCardStoreSub=null;this.moneypennyTransferStoreSub=null;this.passwordCancelSubscribeToken=null;this.passwordNUXPending=false;this.successDialogPending=false;this.getProductType=function(){return c("MessengerPaymentProductType").MESSENGER_COMMERCE};this.getCards=function(){return c("P2PCreditCardStore").getAll(this.getProductType())}.bind(this);this.log=function(s,t){c("P2PLogger").log(s,babelHelpers["extends"]({raw_amount:this.props.item.raw_amount,currency:this.props.item.total_cost.currency,object_id:this.props.item.id,www_event_flow:o},t))}.bind(this);this.onCreditCardStoreChange=function(){var s=this.getCards(),t=void 0;if(this.state.selectedCreditCard)t=c("P2PCreditCardStore").getCreditCardByCredentialID(this.state.selectedCreditCard.getCredentialId());if(!t)t=s[0];this.setState({creditCards:s,creditCardAsyncRequestState:c("P2PCreditCardStore").getAsyncRequestState(),selectedCreditCard:t})}.bind(this);this.onMoneypennyStoreChange=function(){var s=c("P2PMoneypennyStore").getAsyncRequestState(),t=s[this.state.transferRequestID];this.setState({moneypennyAsyncRequestState:s});if(t){this.setState({transferRequestID:""});if(t.error)this.handleMoneypennyTransferError(t.error);else this.handleMoneypennyTransferSuccess(t)}}.bind(this);this.handleChangeCreditCardClicked=function(){this.hideAllDialogs();if(this.state.creditCards.length>1){this.setState({chooseCreditCardDialogShown:true});this.log(c("P2PPaymentLoggerEvent").UI_ACTN_INITIATE_CHOOSE_CARD,{})}else this.setState({addCreditCardDialogShown:true})}.bind(this);this.handleAddDebitCardClicked=function(){this.hideAllDialogs();this.setState({addCreditCardDialogShown:true})}.bind(this);this.handleCreditCardSelected=function(s){this.setState({selectedCreditCard:s},function(){this.purchase()}.bind(this))}.bind(this);this.purchase=function(){__p&&__p();var s=void 0;if(!this.state.selectedCreditCard.getIsVerified()){this.log(c("P2PPaymentLoggerEvent").UI_ACTN_VERIFY_CSC,{});this.hideAllDialogs();this.setState({verifyCreditCardDialogShown:true});return}else if(this.state.selectedCreditCard.isExpired()){this.log(c("P2PPaymentLoggerEvent").UI_ACTN_EDIT_CARD,{});this.hideAllDialogs();this.setState({editCreditCardDialogShown:true});return}this.passwordCancelSubscribeToken=c("Arbiter").subscribeOnce("PasswordReauthDialogCancelClick",this.handlePasswordReauthDialogCancelClick);s=c("P2PAPIUtils").genRequestID();this.setState({loading:true,transferRequestID:s,transferErrors:null});c("P2PAPI").createMoneypennyTransfer({amount:this.props.item.raw_amount,credential_id:this.state.selectedCreditCard.getCredentialId(),item_id:this.props.item.id,external_request_id:c("P2PAPIUtils").genRequestID(),requestID:s});this.log(c("P2PPaymentLoggerEvent").UI_ACTN_CONFIRM_MONEYPENNY_ORDER,{})}.bind(this);this.handleMoneypennyTransferSuccess=function(s){this.hideAllDialogs();this.log(c("P2PPaymentLoggerEvent").UI_ACTN_MONEYPENNY_ORDER_SUCCESS,{});if(s.passwordProtection===c("P2PPasswordProtectionStatusTypes").NOT_SET)this.passwordNUXPending=true;if(this.successDialogPending){this.successDialogPending=false;this.setState({successDialogShown:true})}else this.handleCheckoutSuccess()}.bind(this);this.handleMoneypennyTransferError=function(s){this.hideAllDialogs();this.log(c("P2PPaymentLoggerEvent").UI_ACTN_MONEYPENNY_ORDER_FAIL,{});this.setState({loading:false,transferErrors:s})}.bind(this);this.handlePasswordReauthDialogCancelClick=function(){this.passwordCancelSubscribeToken=null;this.setState({loading:false});this.hideAllDialogs()}.bind(this);this.handleCheckoutSuccess=function(){this.hideAllDialogs();if(this.passwordNUXPending){this.passwordNUXPending=false;this.setState({p2pPasswordProtectionNUXDialogShown:true})}else c("setImmediate")(this.props.onClose)}.bind(this);this.handleAddCreditCardSuccess=function(s){this.successDialogPending=this.getCards().length===1;this.setState({selectedCreditCard:c("P2PCreditCardStore").getCreditCardByCredentialID(s[c("CreditCardFormParam").CREDENTIAL_ID])},function(){this.purchase()}.bind(this))}.bind(this);this.handleCheckoutCancel=function(){this.log(c("P2PPaymentLoggerEvent").UI_ACTN_MONEYPENNY_ORDER_CANCEL,{});this.props.onClose()}.bind(this);this.hideAllDialogs=function(){this.setState({addCreditCardDialogShown:false,editCreditCardDialogShown:false,chooseCreditCardDialogShown:false,successDialogShown:false,transferErrors:null,verifyCreditCardDialogShown:false,p2pPasswordProtectionNUXDialogShown:false})}.bind(this)};f.exports=q}),null);
__d("MNCommerceAgentItemSuggestionMercuryShareAttachment.react",["MercuryFallbackShareAttachment.react","MercuryShareAttachmentReactShape","MercuryShareAttachmentRenderLocations","MNCommerceAgentItemSuggestionMercuryAttachment.react","P2PActions","P2PMoneypennyCheckoutDialogContainer.react","P2PMoneypennyStore","React","ReactComponentWithPureRenderMixin","StoreAndPropBasedStateMixin"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("React").PropTypes,i=c("React").createClass({displayName:"MNCommerceAgentItemSuggestionMercuryShareAttachment",mixins:[c("ReactComponentWithPureRenderMixin"),c("StoreAndPropBasedStateMixin")(c("P2PMoneypennyStore"))],propTypes:{attachment:c("MercuryShareAttachmentReactShape"),maxWidth:h.number,location:h.oneOf(c("MercuryShareAttachmentRenderLocations").getValues())},statics:{calculateState:function j(k){var l=k.attachment&&k.attachment.target,m=!!(l&&l.payment_id);if(!m){var n=c("P2PMoneypennyStore").getTransferByID(l.id);m=!!(n&&n.payment_id)}return{isItemPurchased:m}}},_handleBuyClick:function j(){c("P2PActions").showDialog(c("P2PMoneypennyCheckoutDialogContainer.react"),{item:this._getItem(),onClose:c("P2PActions").hideDialog})},_getItem:function j(){var k=this.props.attachment;return k&&k.target},render:function j(){var k=this._getItem();if(!k)return c("React").createElement(c("MercuryFallbackShareAttachment.react"),this.props);return c("React").createElement(c("MNCommerceAgentItemSuggestionMercuryAttachment.react"),{itemSuggestion:k,isPurchased:this.state.isItemPurchased,location:this.props.location,onBuyClick:this._handleBuyClick,width:this.props.maxWidth})}});f.exports=i}),null);
__d("OzEditorStateHelpers",["ContentState","OzHelpers","DraftModifier","EditorState","UnicodeUtils"],(function a(b,c,d,e,f,g){__p&&__p();function h(s,t){var u=c("ContentState").createFromText(t),v=c("EditorState").push(s,u,"remove-range");v=c("EditorState").forceSelection(v,v.getSelection());return v}function i(s){var t=s.getCurrentContent().getBlockMap(),u=s.getSelection().getStartKey();return t.get(u)}function j(s,t){return s.getCurrentContent().getPlainText().indexOf(t)>=0}function k(s){var t=q(s,function(u){var v=u.getSelection();if(v.getStartOffset()===0)return r(u,1);var w=i(u).getText().length;return v.merge({anchorOffset:w,focusOffset:0,isBackward:true})},"backward");if(t===s.getCurrentContent())return s;return c("EditorState").push(s,t,"remove-range")}function l(s,t){var u=s.getCurrentContent(),v=i(s).getText(),w=s.getSelection().merge({anchorOffset:0,focusOffset:v.length}),x=c("DraftModifier").replaceText(u,w,t);c("OzHelpers").debug("[replaceLine]",t,v,x.getPlainText());if(x===u)return s;return c("EditorState").push(s,x,"remove-range")}function m(s,t){var u=s.getCurrentContent(),v=c("DraftModifier").insertText(u,u.getSelectionAfter(),t);if(v===u)return s;return c("EditorState").push(s,v,"insert-characters")}function n(s,t){var u=i(s).getText(),v=u.length;if(v===0)return false;t=Math.min(t,v-1);return u[t]}function o(s,t){var u=s.getSelection().merge({focusOffset:t,anchorOffset:t});return c("EditorState").forceSelection(s,u)}function p(s,t){var u=q(s,function(w){var x=w.getSelection(),y=w.getCurrentContent(),z=x.getAnchorKey(),A=x.getAnchorOffset(),B=y.getBlockForKey(z).getText().slice(A-t,A);return r(w,B?c("UnicodeUtils").strlen(B):1)},"backward");if(u===s.getCurrentContent())return s;u=u.set("selectionBefore",s.getSelection());var v=s.getSelection().isCollapsed()?"backspace-character":"remove-range";return c("EditorState").push(s,u,v)}function q(s,t,u){__p&&__p();var v=s.getSelection(),w=s.getCurrentContent(),x=v;if(v.isCollapsed()){if(u==="forward"){if(s.isSelectionAtEndOfContent())return w}else if(s.isSelectionAtStartOfContent())return w;x=t(s);if(x===v)return w}return c("DraftModifier").removeRange(w,x,u)}function r(s,t){__p&&__p();var u=s.getSelection(),v=s.getCurrentContent(),w=u.getStartKey(),x=u.getStartOffset(),y=w,z=0;if(t>x){var A=v.getKeyBefore(w);if(A==null)y=w;else{y=A;var B=v.getBlockForKey(A);z=B.getText().length}}else z=x-t;return u.merge({focusKey:y,focusOffset:z,isBackward:true})}f.exports={append:m,backspaceTimes:p,charAt:n,currentBlock:i,deleteCurrentLine:k,editorStateHas:j,forceCollapsedSelection:o,replaceContentWithText:h,replaceLine:l}}),null);
__d("OzHistory",["invariant","immutable"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").List,j=c("immutable").OrderedMap,k="oz-history",l=10,m=100;function n(){return j(JSON.parse(localStorage.getItem(k)||"{}")).map(function(s){return i(s)})}function o(s){j.isOrderedMap(s)||h(0);return localStorage.setItem(k,JSON.stringify(s))}function p(s){var t=n();if(t.has(s))return;o(t.set(s,[]).takeLast(l))}function q(s){__p&&__p();var t={},u={items:function v(){if(!t.items)t.items=n().get(s);return t.items},persist:function v(w){i.isList(w)||h(0);o(n().set(s,w));t.items=w;u.resetPos()},resetPos:function v(){t.pos=u.items().size},pos:function v(){if(!Number.isSafeInteger(t.pos))u.resetPos();return t.pos},dec:function v(){t.pos=Math.max(u.pos()-1,0)},inc:function v(){t.pos=Math.min(u.pos()+1,u.items().size)},val:function v(){return u.items().get(u.pos())}};return u}function r(s){__p&&__p();p(s);var t=q(s);return{up:function u(){t.dec();return t.val()},down:function u(){t.inc();return t.val()},push:function u(v){var w=t.items();if(!v||w.last()===v)return;t.persist(w.push(v).takeLast(m))}}}f.exports=r}),null);
__d("OzHumans",["OzHelpers"],(function a(b,c,d,e,f,g){__p&&__p();var h=6e4,i=45e3,j=-1;function k(s){return s.get("coach-mode?")}function l(s){return s.get("is-coach")}function m(s){return s.get("away?")}function n(s){return s&&!m(s)&&c("OzHelpers").serverNow()-s.get("at",0)<i}function o(s){return n(s)&&s.get("inactive-ms",0)<h}function p(s){return o(s)&&s.get("load",0)<=0&&s.get("team",j)!==j}function q(s){return o(s)&&!k(s)}function r(s){var t=s.filter(q).count(),u=s.reduce(function(v,w){return v+w.get("load",0)},0);return u/t}f.exports={inCoachMode:k,isCoach:l,isAway:m,isPresent:n,isActive:o,isIdle:p,isWorking:q,avgLoad:r}}),null);
__d("OzInboxThreads",["OzHelpers","OzConfig"],(function a(b,c,d,e,f,g){__p&&__p();var h="GRABBED",i="VIEWING",j="PAST";function k(n){return c("OzConfig").ConfigStore.data.getIn(["GK","responsivenessV2"])?Math.max(c("OzHelpers").unreadTs(n)||0,n.get("last-event-at",0)):n.get("last-event-at",0)}function l(n){var o=function o(p){return p.get("locked-at")&&p.get("locker-id")===n};return function(p,q){if(o(p)&&!o(q))return-1;else if(!o(p)&&o(q))return 1;else return c("OzHelpers").compareNums(k(p),k(q))}}var m=c("OzHelpers").memoize(function(n,o){var p=arguments.length<=2||arguments[2]===undefined?"":arguments[2],q=l(o);return n.filter(function(r){var s=c("OzHelpers").isOwner(r,o),t=c("OzHelpers").isLocker(r,o),u=c("OzHelpers").isSubscriber(r,o),v=c("OzHelpers").wasOwner(r,o),w=c("OzHelpers").hasOpenIntents(r);switch(p){case h:return(s||r.get("ui-reassign")&&v)&&(r.get("ready")||w||t);case i:return u;case j:return v||s&&!r.get("ready")&&!w;default:return s||u}}).sort(q)},function(n,o){var p=arguments.length<=2||arguments[2]===undefined?"":arguments[2];return n.hashCode()+o+p},3);f.exports={getInboxThreads:m,OZ_GRABBED_TAB:h,OZ_VIEWING_TAB:i,OZ_PAST_TAB:j}}),null);
__d("OzLocationSearchSource",["WebAsyncSearchSource"],(function a(b,c,d,e,f,g){var h={allow_places:true,include_likes:false,include_subtext:true,include_address:1,limit:5,map_height:null,map_width:null,render_map:false,use_searchable_entries:true,use_unicorn:true},i=new(c("WebAsyncSearchSource"))({bootstrapRequests:[{uri:"/ajax/places/typeahead",data:h}],getAllForEmptyQuery:true,queryRequests:[{uri:"/ajax/places/typeahead",data:babelHelpers["extends"]({},h,{hide_geo:true})}]});i.search("",function(j){});f.exports=i}),null);
__d("OzBugNub.react",["cx","fbt","Link.react","OzImmutablePureRenderMixin","React","Tooltip","URI"],(function a(b,c,d,e,f,g,h,i){"use strict";var j=1031744366845008,k="Error:\n\nExpected Result:\n\nSteps taken before error occurred:\n",l=c("React").createClass({displayName:"MessengerBugNub",mixins:[c("OzImmutablePureRenderMixin")],render:function m(){var n=new(c("URI"))("/ajax/bugs/report").setQueryData({config_id:j,defaultText:k});return c("React").createElement("div",{className:"_gml"},c("React").createElement(c("Link.react"),babelHelpers["extends"]({href:"#",ajaxify:n,className:"_gmm",rel:"dialog"},c("Tooltip").propsFor(i._("Report a bug"))),c("React").createElement("span",{className:"_gmn"})))}});f.exports=l}),null);
__d("OzDialogContainer.react",["OzStores","React","Reflux"],(function a(b,c,d,e,f,g){var h=c("OzStores").DialogStore,i=c("React").createClass({displayName:"OzDialogContainer",mixins:[c("Reflux").connect(h,"dialog")],render:function j(){var k=this.state.dialog.dialogClass;if(k){var l=this.state.dialog.dialogProps||{};return c("React").createElement(k,babelHelpers["extends"]({ref:"dialog"},l,{key:"dialog"}))}return null}});f.exports=i}),null);
__d("OzExtensionCheck.react",["cx","MessengerDialogHeader.react","MessengerDialogTitle.react","OzActions","React","ReloadPage","ShimButton.react","SUIAtlasTheme","SUINotice.react","XUIDialog.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k,l,m=c("React").PropTypes;i=babelHelpers.inherits(n,c("React").Component);j=i&&i.prototype;n.prototype.render=function(){"use strict";return c("React").createElement(c("XUIDialog.react"),{width:544,shown:true,layerHideOnBlur:false,className:"_4ebx"},c("React").createElement("div",{className:"_4eby _2c9g _1-6z"},c("React").createElement(c("MessengerDialogHeader.react"),null,c("React").createElement(c("MessengerDialogTitle.react"),null,"The Oz Chrome Extension is missing")),c("React").createElement(c("SUINotice.react"),{theme:c("SUIAtlasTheme"),type:"error"},c("React").createElement("div",{className:"_4d80"},"Toto, the oz chrome extension that helps you manage your tabs, and record what was done for each task in the background is missing!",c("React").createElement("strong",null,c("React").createElement(c("ShimButton.react"),{form:"link",onClick:this.props.onInstall}," ","Click here to install it."))))))};function n(){"use strict";i.apply(this,arguments)}n.propTypes={onInstall:m.func.isRequired};k=babelHelpers.inherits(o,c("React").Component);l=k&&k.prototype;function o(){var p,q;"use strict";for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=l.constructor).call.apply(p,[this].concat(s)),this.$OzExtensionCheck1=function(){window.chrome.webstore.install(undefined,function(u){return c("ReloadPage").now()})},q}o.prototype.componentDidMount=function(){"use strict";var p=!!document.querySelector("#toto-installed");if(p)return;c("OzActions").showDialog(n,{onInstall:this.$OzExtensionCheck1})};o.prototype.render=function(){"use strict";return null};f.exports=o}),null);
__d("OzButton.react",["cx","joinClasses","promiseFinally","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("React").PropTypes,j=c("React").createClass({displayName:"OzButton",propTypes:{disabled:i.bool,onClick:i.func,primary:i.bool,tight:i.bool,type:i.oneOf(["button","submit","reset"]),use:i.oneOf(["default","warning","danger"])},getDefaultProps:function k(){return{disabled:false,primary:false,tight:false,type:"button",use:"default"}},getInitialState:function k(){return{loading:false}},render:function k(){var l=this.props,m=l.children,n=l.className,o=l.disabled,p=l.onClick,q=l.primary,r=l.tight,s=l.type,t=l.use,u=babelHelpers.objectWithoutProperties(l,["children","className","disabled","onClick","primary","tight","type","use"]),v=this.state.loading,w=c("joinClasses")(n,"_325k"+(v?" _3e2u":"")+(q?" _325m":"")+(r?" _4wku":"")+(t==="default"?" _325o":"")+(t==="warning"?" _325p":"")+(t==="danger"?" _325q":"")+(o?" _ysb":"")+(!o&&!v?" _4wkv":"")+" _1-hv");return c("React").createElement("button",babelHelpers["extends"]({className:w,disabled:o,onClick:this._handleClick,type:s},u),c("React").createElement("span",{className:"_325r"},m))},_handleClick:function k(l){__p&&__p();var m=this.props,n=m.disabled,o=m.loading,p=m.onClick;if(n||o){l.preventDefault();return}if(!p)return;if(p.length>1){this.setState({loading:true});p(l,this._done);return}var q=p(l);if(q&&q.then){this.setState({loading:true});c("promiseFinally")(q,this._done)}},_done:function k(){if(this.isMounted())this.setState({loading:false})}});f.exports=j}),null);
__d("OzFailed.react",["cx","immutable","OzButton.react","React","ReloadPage"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").Iterable,l=c("React").PropTypes;i=babelHelpers.inherits(m,c("React").Component);j=i&&i.prototype;m.prototype.render=function(){"use strict";return c("React").createElement("div",{className:"_30r7"},c("React").createElement("div",{className:"_4rg-"},c("React").createElement("div",null,"Oz couldn't load the following resources:",c("React").createElement("ul",null,this.props.problems.map(function(n,o){return c("React").createElement("li",{key:o},n)})),"Please wait a few seconds, then refresh. If this problem persists for more than a minute or so, contact the oncall."),c("React").createElement("div",{className:"_4rg_"},c("React").createElement(c("OzButton.react"),{primary:true,onClick:c("ReloadPage").now},"Refresh"))))};function m(){"use strict";i.apply(this,arguments)}m.propTypes={problems:l.instanceOf(k)};f.exports=m}),null);
__d("OzReps",["OzHelpers"],(function a(b,c,d,e,f,g){__p&&__p();var h=1e3*60*60*8;function i(l){return!l||c("OzHelpers").serverNow()-l.get("updated-at",0)>h}function j(l){var m=l.get("stats");return i(m)?0:m.get("closed-intents",0)}function k(l,m){var n=l.get("team");return m.reduce(function(o,p){return o+(p.get("team")===n?j(p):0)},0)}f.exports={closedIntentCount:j,teamClosedIntentCount:k}}),null);
__d("OzTriSwitch.react",["cx","React","joinClasses"],(function a(b,c,d,e,f,g,h){__p&&__p();function i(k){var l=k.className,m=k.value,n=k.onClick,o=k.label,p=k.animated,q=babelHelpers.objectWithoutProperties(k,["className","value","onClick","label","animated"]);return c("React").createElement("div",babelHelpers["extends"]({},q,{className:c("joinClasses")(l,"_56de"+(q.reverseColors?" _3tyl":"")+(p?" _56df":"")+(m==="on"?" _56dg":"")+(m==="off"?" _56dh":"")+(m==="neutral"?" _56di":"")),onClick:function(r){function n(s){return r.apply(this,arguments)}n.toString=function(){return r.toString()};return n}(function(r){return n(j[m])}),role:"checkbox","aria-checked":m==="on",tabIndex:"0"}),c("React").createElement("div",{className:"_56dj",tabIndex:"0"},c("React").createElement("div",{className:"_56dk"})),o?c("React").createElement("span",{className:"_56dn"},o):null)}var j={on:"off",off:"neutral",neutral:"on"};i.toBoolean=function(k){if(k==="neutral")return undefined;if(k==="on")return true;if(k==="off")return false;throw new Error("OzTriSwitch: unknown state "+k)};i.fromBoolean=function(k){return k==null?"neutral":k?"on":"off"};f.exports=i}),null);
__d("OzSwitch.react",["OzImmutablePureRenderMixin","OzTriSwitch.react","React"],(function a(b,c,d,e,f,g){"use strict";var h=c("React").PropTypes,i=c("React").createClass({displayName:"OzSwitch",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{isAnimated:h.bool.isRequired,isOn:h.bool.isRequired,label:h.node.isRequired,onToggle:h.func.isRequired,reverseColors:h.bool},getDefaultProps:function j(){return{isAnimated:false}},render:function j(){var k=this.props,l=k.className,m=k.isAnimated,n=k.isOn,o=k.label,p=k.onToggle;return c("React").createElement(c("OzTriSwitch.react"),{animated:m,className:l,reverseColors:!!this.props.reverseColors,label:o,onClick:function q(){return p(!n)},value:c("OzTriSwitch.react").fromBoolean(n)})}});f.exports=i}),null);
__d("OzReactMetrics",[],(function a(b,c,d,e,f,g){__p&&__p();var h={},i=function i(){return{mountCount:0,mountAvgMs:0,mountTotalMs:0,updateCount:0,updateAvgMs:0,updateTotalMs:0}},j=function j(l,m){if(!h[l])h[l]=i();h[l].mountCount+=1;h[l].mountTotalMs+=m;h[l].mountAvgMs=h[l].mountTotalMs/h[l].mountCount},k=function k(l,m){if(!h[l])h[l]=i();h[l].updateCount+=1;h[l].updateTotalMs+=m;h[l].updateAvgMs=h[l].updateTotalMs/h[l].updateCount};f.exports={metrics:h,updateMount:j,updateUpdate:k}}),null);
__d("OzWrapper.react",["React","OzReactMetrics"],(function a(b,c,d,e,f,g){__p&&__p();function h(i){__p&&__p();var j,k;j=babelHelpers.inherits(l,c("React").Component);k=j&&j.prototype;l.prototype.componentWillMount=function(){"use strict";this.$Comp1=Date.now()};l.prototype.componentDidMount=function(){"use strict";var m=Date.now()-this.$Comp1;c("OzReactMetrics").updateMount(i.displayName,m)};l.prototype.componentWillUpdate=function(){"use strict";this.$Comp2=Date.now()};l.prototype.componentDidUpdate=function(){"use strict";var m=Date.now()-this.$Comp2;c("OzReactMetrics").updateUpdate(i.displayName,m)};l.prototype.render=function(){"use strict";return c("React").createElement(i,babelHelpers["extends"]({},this.props,this.state))};function l(){"use strict";j.apply(this,arguments)}return l}f.exports=h}),null);
__d("OzHeader.react",["cx","OzHelpers","immutable","Layout.react","MessengerButtonReact.bs","OzButton.react","OzConfig","OzHumans","OzReps","OzStores","OzSwitch.react","React","OzWrapper.react","Reflux","ReactRouter","Tooltip"],(function a(b,c,d,e,f,g,h){var i=c("MessengerButtonReact.bs").jsComponent,j=c("immutable").Map,k=c("OzStores").RepStore,l=c("OzStores").HumanStore,m=c("ReactRouter").Link,n=c("React").PropTypes,o=c("React").createClass({displayName:"OzHeader",mixins:[c("Reflux").connect(l,"humans"),c("Reflux").connect(k,"reps"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{coachMode:n.bool.isRequired,rev:n.number.isRequired,version:n.string.isRequired,onAway:n.func.isRequired,onCoachModeToggle:n.func.isRequired,params:n.object.isRequired},contextTypes:{uid:n.string.isRequired,router:n.object.isRequired},render:function q(){var r="/inbox/"+(this.props.params.threadid||""),s=this.state.humans.getIn([this.context.uid,"load"],0),t="Inbox"+(s?" ("+s+")":""),u=this.state.config.get("GK",j());return c("React").createElement(c("Layout.react"),{className:"_2d86"},c("React").createElement("div",{className:"_2d87"},c("React").createElement(m,{to:"/",className:"_2d88"}),this._renderItem(t,r),this._renderItem("Merchants","/merchants"),this._renderItem("Feedback","/feedback"),this._renderItem("Top","/top"),u.get("supervisor")&&this._renderItem("Trainers","/trainers"),u.get("allThreads")&&this._renderItem("All Threads","/all")),c("React").createElement("div",{className:"_j6m"},c("React").createElement(p,{humans:this.state.humans,reps:this.state.reps,uid:this.context.uid})),c("React").createElement(i,{label:"Away",className:"_4s9f",type:"primary",onClick:this.props.onAway}),u.get("supervisor")?c("React").createElement(c("OzSwitch.react"),{className:"_b8c",isAnimated:true,isOn:this.props.coachMode,label:"Coach Mode",onToggle:this.props.onCoachModeToggle}):null)},_renderItem:function q(r,s){return c("React").createElement(m,{activeClassName:"active",className:"_33os",to:s},c("React").createElement("span",null,r))}}),p=c("OzHelpers").pure(function(q){var r=q.reps,s=q.humans,t=q.uid,u=r.get(t,j()),v=c("OzReps").closedIntentCount(u),w=c("OzReps").teamClosedIntentCount(u,r),x=Math.round(c("OzHumans").avgLoad(s)),y=isFinite(x)?x:"N/A",z=s.filter(c("OzHumans").isWorking).count();return c("React").createElement("div",null,c("React").createElement("span",babelHelpers["extends"]({className:"_3fs"},c("Tooltip").propsFor("Your closed intents")),v),c("React").createElement("span",{className:"_4s9g"},"closed by you")," ",c("React").createElement("span",babelHelpers["extends"]({className:"_3fs"},c("Tooltip").propsFor("Closed intents for your entire team")),w),c("React").createElement("span",{className:"_4s9g"},"closed by team"),c("React").createElement("span",{className:"_3fs"},y),c("React").createElement("span",{className:"_4s9g"},"average load"),c("React").createElement("span",{className:"_3fs"},z),c("React").createElement("span",{className:"_4s9g"},z===1?"trainer":"trainers"))});f.exports=c("OzWrapper.react")(o)}),null);
__d("OzLoading.react",["cx","MessengerFlexArea.react","MessengerSpinner.react","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k,l,m=c("React").PropTypes;i=babelHelpers.inherits(n,c("React").Component);j=i&&i.prototype;n.prototype.render=function(){"use strict";return c("React").createElement("div",{className:"_30r7"},c("React").createElement(c("MessengerSpinner.react"),{color:this.props.color}),c("React").createElement("div",{className:"_4rg-",style:{marginLeft:"10px"}},this.props.message))};function n(){"use strict";i.apply(this,arguments)}n.propTypes={message:m.node,color:m.oneOf(["grey","blue"])};n.defaultProps={color:"blue"};n.Inline=(l=k=function(){__p&&__p();var o,p;o=babelHelpers.inherits(q,c("React").Component);p=o&&o.prototype;q.prototype.render=function(){"use strict";var r=this.props,s=r.loading,t=babelHelpers.objectWithoutProperties(r,["loading"]);if(!s)return null;return c("React").createElement("div",{className:"_nkb"},c("React").createElement(n,t))};function q(){"use strict";o.apply(this,arguments)}return q}(),k.propTypes={loading:m.bool.isRequired},l);n.Flex=function(){__p&&__p();var o,p;o=babelHelpers.inherits(q,c("React").Component);p=o&&o.prototype;q.prototype.render=function(){"use strict";return c("React").createElement(c("MessengerFlexArea.react"),null,c("React").createElement(n,this.props))};function q(){"use strict";o.apply(this,arguments)}return q}();f.exports=n}),null);
__d("OzDate.react",["cx","formatDate","immutable","joinClasses","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("React").PropTypes,l=c("immutable").fromJS([{start:0,end:7*24*36e5,format:"D g:ia"},{start:7*24*36e5,end:365*24*36e5,format:"M jS, g:ia"},{start:365*24*36e5,end:Infinity,format:"m/d/Y g:ia"}]);i=babelHelpers.inherits(m,c("React").Component);j=i&&i.prototype;m.formatTimestamp=function(n){"use strict";if(n<Date.now()+24*36e5)return c("formatDate")(new Date(n),{today:"g:ia",thisYear:"M jS, g:ia",older:"m/d/Y g:ia"});else return c("formatDate")(new Date(n),l.find(function(o){return n>Date.now()+o.get("start")&&n<Date.now()+o.get("end")}).get("format"))};m.prototype.render=function(){"use strict";var n=this.constructor.formatTimestamp(this.props.timestamp);return c("React").createElement("time",{className:c("joinClasses")("_2s4p",this.props.className)},n)};function m(){"use strict";i.apply(this,arguments)}m.propTypes={timestamp:k.number.isRequired};f.exports=m}),null);
__d("OzDraggable.react",["cx","Draggable","joinClasses","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("React").PropTypes,j=c("React").createClass({displayName:"OzDraggable",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{getHandle:i.func},componentDidMount:function k(){this._draggable=new(c("Draggable"))(this.refs.root).setUseAbsolute(true).setGutter(15);this._updateHandle()},componentDidUpdate:function k(){this._updateHandle()},_updateHandle:function k(){if(this._handle)this._draggable.removeHandle(this._handle);this._handle=(this.props.getHandle||function(){return this.refs.root}.bind(this))();this._draggable.addHandle(this._handle)},render:function k(){var l=this.props,m=l.children,n=l.className,o=babelHelpers.objectWithoutProperties(l,["children","className"]);return c("React").createElement("div",{className:"_5k4j"},c("React").createElement("div",babelHelpers["extends"]({className:c("joinClasses")("_2c1d",n),ref:"root"},o),m))},componentWillUnmount:function k(){this._draggable&&this._draggable.destroy()}});f.exports=j}),null);
__d("OzDraggableModal.react",["cx","joinClasses","OzDraggable.react","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j;i=babelHelpers.inherits(k,c("React").PureComponent);j=i&&i.prototype;k.prototype.render=function(){"use strict";var l=this.props,m=l.children,n=l.className,o=babelHelpers.objectWithoutProperties(l,["children","className"]);return c("React").createElement(c("OzDraggable.react"),babelHelpers["extends"]({className:c("joinClasses")("_5d80",n)},o),m)};function k(){"use strict";i.apply(this,arguments)}f.exports=k}),null);
__d("OzUserImage.react",["cx","joinClasses","Image.react","immutable","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){var i=c("immutable").Map,j=c("React").PropTypes,k=c("React").createClass({displayName:"OzUserImage",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{photo:j.object},render:function l(){var m=c("joinClasses")(this.props.className,"_3c52 _3c53"),n=function n(p){return c("React").createElement(c("Image.react"),{className:m,src:p})},o=this.props.photo||i();return o.getIn(["data","url"])&&n(o.getIn(["data","url"]))||o.get("data")&&n(o.get("mime_type")+","+o.get("data"))||c("React").createElement("span",{className:c("joinClasses")(m,"_3ejm")})}});f.exports=k}),null);
__d("OzSearch.react",["cx","OzAPI","OzHelpers","Image.react","immutable","Keys","OzActions","OzDate.react","OzDraggableModal.react","OzStores","OzUserImage.react","ReactComponentWithPureRenderMixin","React","Reflux","ShimButton.react","XUITextInput.react","OzConfig","debounce"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k,l,m,n=c("immutable").List,o=c("immutable").Map,p=c("React").PropTypes,q=c("OzStores").ActiveThreadStore,r=c("OzStores").ThreadStore,s="Messages",t="Side Bar",u="Users",v="Calendars",w="All",x=[s,t,u,v,w],y=(m={},m[s]="messages",m[t]="side-bar",m[u]="users",m[v]="calendar-event",m[w]="all",m),z=c("React").createClass({displayName:"OzSearch",mixins:[c("ReactComponentWithPureRenderMixin"),c("Reflux").connect(q,"activeThread"),c("Reflux").connect(r,"threads"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],contextTypes:{router:p.object.isRequired},componentWillMount:function L(){this._handleTyping=c("debounce")(this._handleTyping,300,this,true);this.setState({calendarGK:this.state.config.get("GK",o()).get("calendar")})},componentDidMount:function L(){document.addEventListener("keydown",this._handleKBShortcuts);this._unlisten=function(){document.removeEventListener("keydown",this._handleKBShortcuts)}.bind(this);this._focusSearch()},getInitialState:function L(){return{currentTab:s,results:n([]),selected:-1,shown:false,text:"",calendarGK:false}},componentWillUnmount:function L(){this._unlisten()},render:function L(){var M=this.state,N=M.shown,O=M.currentTab,P=M.results,Q=M.selected,R=M.threads;if(!N)return null;else return c("React").createElement(c("OzDraggableModal.react"),{className:"_cxg"},c("React").createElement(c("XUITextInput.react"),{className:"_cxh",placeholder:"Search...",ref:"searchBar",onChange:function(S){return this._handleTyping(S.target.value)}.bind(this)}),c("React").createElement("div",{className:"_cxi"},c("React").createElement(C,{tabs:x,currentTab:O,onClickTab:this._handleChangeTab,calendarGK:this.state.calendarGK}),c("React").createElement(D,{onClick:this._handleSelectResult,results:P,selected:Q,threads:R,calendarGK:this.state.calendarGK})))},_search:function L(){var M=this.state,N=M.text,O=M.currentTab,P=M.activeThread,Q={text:N,type:y[O]};if(O===t||O===s)Q["user-id"]=P.get("threadID");c("OzAPI").search(Q).then(function(R){this.setState({results:R,selected:0})}.bind(this)).done()},_handleTyping:function L(M){this.setState({text:M},this._search)},_handleChangeTab:function L(M){var N=this.state.text;this.setState({currentTab:M},function(O){N.length&&this._search()}.bind(this))},_handleSelectResult:function L(M){__p&&__p();switch(M.get("_type")){case"user":this._handleSelectResultUser(M);break;case"event":switch(M.getIn(["_source","type"])){case"message":case"message-from-page":this._handleSelectResultMessage(M);break;case"send-email":case"receive-email":this._handleSelectResultEmail(M);break;case"calendar-event":this._handleSelectResultCalendarEvent(M);break;default:}break;default:}this.setState({shown:false})},_handleSelectResultUser:function L(M){var N=M.getIn(["_source","user-id"]);this.context.router.push("/inbox/"+N)},_handleSelectResultMessage:function L(M){var N=M.getIn(["_source","user-id"]),O=M.getIn(["_source","timestamp"]);this.context.router.push("/inbox/"+N);this._createTransitionListener(N,O)},_createTransitionListener:function L(M,N){this._transitionListenerId=window.setInterval(function(O){var P=this.context.router.isActive("/inbox/"+M);if(P){c("OzActions").scrollThreadToTimestamp(N);window.clearInterval(this._transitionListenerId)}}.bind(this),100)},_handleSelectResultEmail:function L(M){var N=M.getIn(["_source","user-id"]),O=M.getIn(["_source","intent-id"]);this.context.router.push("/inbox/"+N+"/intent/"+O)},_handleSelectResultCalendarEvent:function L(M){var N=M.getIn(["_source","user-id"]);this.context.router.push("/inbox/"+N)},_toggleShown:function L(){this.setState({shown:!this.state.shown})},_focusSearch:function L(){this.refs.searchBar&&this.refs.searchBar.focusInput()},_handleKBShortcuts:function L(M){__p&&__p();var N=this.state,O=N.results,P=N.selected,Q=N.shown,R=N.calendarGK;if(K(M)||M.which===c("Keys").ESC&&Q){M.preventDefault();this._toggleShown();!Q&&this._focusSearch()}else if(Q)switch(M.which){case c("Keys").DOWN:M.preventDefault();this.setState({selected:Math.min(P+1,B(O,R).count()-1)});break;case c("Keys").UP:M.preventDefault();this.setState({selected:Math.max(P-1,0)});break;case c("Keys").RETURN:M.preventDefault();P&&this._handleSelectResult(B(O,R).get(P));break;case c("Keys").TAB:M.preventDefault();var S=x.indexOf(this.state.currentTab),T=x.length;if(M.getModifierState("Shift")){S=(S-1+T)%T;if(!R&&S===3)S--}else{S++;if(!R&&S===3)S++;S%=T}this._handleChangeTab(x[S]);break}}}),A=function A(L){return function(M){var N=M.get("_type");switch(N){case"user":return true;case"event":var O=M.getIn(["_source","type"]);if(O=="calendar-event"&&!L)return false;return O=="message"||O=="message-from-page"||O=="send-email"||O=="receive-email"||O=="calendar-event";default:return false}}},B=function B(L,M){return L.filter(A(M)).sortBy(function(N){return N.getIn(["_source","timestamp"])}).reverse()};i=babelHelpers.inherits(C,c("React").PureComponent);j=i&&i.prototype;C.prototype.render=function(){"use strict";var L=this.props,M=L.tabs,N=L.currentTab,O=L.onClickTab;return c("React").createElement("div",{className:"_cxj"},n(M).map(function(P){if(!this.props.calendarGK&&P===v)return null;else return c("React").createElement(c("ShimButton.react"),{className:(P===N?"_cxk":"")+" _cxl",key:P,onClick:function Q(R){return O(P)}},P)}.bind(this)).toSeq())};function C(){"use strict";i.apply(this,arguments)}C.propTypes={tabs:p.arrayOf(p.string).isRequired,currentTab:p.string.isRequired,onClickTab:p.func.isRequired,calendarGK:p.bool.isRequired};k=babelHelpers.inherits(D,c("React").PureComponent);l=k&&k.prototype;D.prototype.render=function(){"use strict";__p&&__p();var L=this.props,M=L.onClick,N=L.results,O=L.selected,P=L.threads;return c("React").createElement("div",{className:"_cxm"},B(N,this.props.calendarGK).map(function(Q,R){__p&&__p();switch(Q.get("_type")){case"user":return c("React").createElement(F,{result:Q,selected:O==R,threads:P,onClick:M});case"event":switch(Q.getIn(["_source","type"])){case"message-from-page":if(Q.getIn(["_source","data","attachments"]))return c("React").createElement(H,{result:Q,selected:O==R,threads:P,onClick:M});case"message":return c("React").createElement(G,{result:Q,selected:O==R,threads:P,onClick:M});case"send-email":case"receive-email":return c("React").createElement(I,{result:Q,selected:O==R,threads:P,onClick:M});case"calendar-event":return c("React").createElement(J,{result:Q,selected:O==R,threads:P,onClick:M});default:return null}default:return null}}))};function D(){"use strict";k.apply(this,arguments)}D.propTypes={onClick:p.func,results:p.instanceOf(n),selected:p.number,threads:p.instanceOf(o).isRequired,calendarGK:p.bool.isRequired};var E=c("OzHelpers").pure(function(L){var M=L.image,N=L.text,O=L.selected,P=L.onClick,Q=L.timestamp;return c("React").createElement(c("ShimButton.react"),{className:"_cxn",id:O?"selected":null,onClick:P},M,c("React").createElement("div",{className:"_4fwg"},c("React").createElement("div",{className:"_4fwh"},c("React").createElement("div",{className:"_4fwi"},N)),Q?c("React").createElement(c("OzDate.react"),{className:"_4fwj",timestamp:Q}):c("React").createElement("div",{className:"_4fwk"})))}),F=c("OzHelpers").pure(function(L){var M=L.result,N=L.onClick,O=L.selected,P=L.threads,Q=M.getIn(["_source","user-id"]),R=M.getIn(["_source","user-name"]),S=P.get(Q);if(!S)c("OzAPI").thread(Q);return c("React").createElement(E,{onClick:function T(U){return N(M)},selected:O,image:S?c("React").createElement(c("OzUserImage.react"),{photo:c("OzHelpers").photo(S),className:"_cxp"}):null,text:R})}),G=c("OzHelpers").pure(function(L){var M=L.result,N=L.onClick,O=L.selected,P=L.threads,Q=M.getIn(["_source","user-id"]),R=M.getIn(["_source","data","text"]),S=M.getIn(["_source","type"])==="message",T=P.get(Q);if(S&&!T)c("OzAPI").thread(Q);var U=S?T?c("React").createElement(c("OzUserImage.react"),{photo:c("OzHelpers").photo(T),className:"_cxp"}):null:c("React").createElement(c("Image.react"),{src:"/images/oz/icons/OzMessengerLogo.png",className:"_cxp"});return c("React").createElement(E,{onClick:function V(W){return N(M)},selected:O,image:U,text:R,timestamp:M.getIn(["_source","timestamp"])})}),H=c("OzHelpers").pure(function(L){var M=L.result,N=L.onClick,O=L.selected,P=L.threads,Q=M.getIn(["_source","data","attachments",0,"metadata"]),R=Q.get("name"),S=Q.get("desc"),T=Q.get("thumb_url");return c("React").createElement(E,{onClick:function U(V){return N(M)},selected:O,image:c("React").createElement(c("Image.react"),{src:T,className:"_cxp"}),text:R+" - "+S,timestamp:M.getIn(["_source","timestamp"])})}),I=c("OzHelpers").pure(function(L){var M=L.result,N=L.onClick,O=L.selected,P=L.threads,Q=M.getIn(["_source","data"]),R=Q.get("to"),S=Q.get("subject"),T=(R?"To: "+R.toJS().join(", ")+" - ":"")+S,U=c("React").createElement(c("Image.react"),{src:"/images/nux_icon_gmail.gif",className:"_cxr _cxp"});return c("React").createElement(E,{onClick:function V(W){return N(M)},selected:O,image:U,text:T,timestamp:M.getIn(["_source","timestamp"])})}),J=c("OzHelpers").pure(function(L){var M=L.result,N=L.onClick,O=L.selected,P=L.threads,Q=M.getIn(["_source","user-id"]),R=P.get(Q),S=M.getIn(["_source","data"]),T=new Date(S.get("start")),U=T.toLocaleString("en-US",{timeZoneName:"short"}),V=R?c("React").createElement(c("OzUserImage.react"),{photo:c("OzHelpers").photo(R),className:"_cxp"}):null;return c("React").createElement(E,{onClick:function W(X){return N(M)},selected:O,image:V,text:c("React").createElement("div",null,c("React").createElement("div",{className:"_5u4o"},S.get("title")),c("React").createElement("div",{className:"_5u4p"},U))})});function K(L){return L.getModifierState("Control")&&L.which==83}f.exports=z}),null);
__d("OzSkywalkerBanner.react",["cx","OzHelpers","OzStores","OzImmutablePureRenderMixin","React","Reflux","ReloadPage","ShimButton.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("OzStores").SkywalkerStore,j=c("React").createClass({displayName:"OzSkywalkerBanner",mixins:[c("Reflux").connect(i,"skywalker"),c("OzImmutablePureRenderMixin")],componentDidUpdate:function k(l,m){var n=this.state.skywalker;if(n.get("isStalled")&&n.get("last-receive-ts")){window.clearTimeout(this._timer);this._timer=window.setTimeout(this.forceUpdate.bind(this),1e3)}},componentWillUnmount:function k(){window.clearTimeout(this._timer)},render:function k(){var l=this.state.skywalker,m=l.get("last-receive-ts"),n=m?"in "+Math.round((c("OzHelpers").serverNow()-m)/1e3)+" seconds":"since you opened Oz";return c("React").createElement("div",{className:"_hsr"+(l.get("isStalled")?" _hss":"")},c("React").createElement("span",null,"We haven't received a message from Skywalker ",n,"."," ",c("React").createElement(c("ShimButton.react"),{form:"link",onClick:c("ReloadPage").now},"Refresh!")," ","or terrible things will happen."))}});f.exports=j}),null);
__d("OzSuggestions",["OzHelpers","immutable","OzConstants"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("OzConstants").ATTS,i=c("immutable").List,j=c("immutable").Map;f.exports={toServer:function m(n,o){return n.set("type",h.SUGG).update("data",function(p){return j({name:p.get("title"),description:p.get("description")||"","merchant-name":this.findMerchantName(p.get("merchant"),o),"thumb-url":p.get("images",i()).find(c("OzHelpers").validateURL)||null,"thumb-urls":p.get("images",i()).filter(c("OzHelpers").validateURL),"target-url":p.get("url"),"expiration-time":p.get("expiration-time"),currency:"USD",amount:p.has("price")?k(p.get("price")):null})}.bind(this))},findMerchantName:function m(n,o){var p=o&&n&&o.find(function(q){return(q.get("name-dba")||"").toLowerCase()===n.toLowerCase()});if(p){c("OzHelpers").info("[sugg] found merchant",n,p);return p.get("name-dba")}return null}};function k(m){return Math.round(100*parseFloat(l(m,"$"),10))}function l(m,n){if(!m||!m.startsWith(n))return m;return m.substr(n.length)}}),null);
__d("OzTwilio",["cx","OzHelpers","immutable","Keys","MessengerButtonReact.bs","OzNotify","OzActions","OzConfig","OzDraggableModal.react","OzImmutablePureRenderMixin","React","Reflux","StarsInput.react"],(function a(b,c,d,e,f,aa,ba){__p&&__p();var g,h,i,j,k,l,m,n,o=c("MessengerButtonReact.bs").jsComponent,p=c("immutable").Record,q=c("immutable").Set,r=c("immutable").List,s=c("React").PropTypes,t=c("OzActions").twilio;function u(){__p&&__p();var S=window.Twilio.Device,T=function T(U,V){return function(){c("OzHelpers").info("[twilio] "+U,x.data.toJS());V.apply(undefined,arguments)}};t.setup.listen(function(U){S.setup(U,{rtc:c("OzConfig").getInStaticConfig(["GK","webRTC"]),debug:true})});t.hangUp.listen(function(U){S.disconnectAll();t.endCall()});t.startCall.listen(T("start-call",S.connect));S.ready(t.ready);S.error(function(U){var V=U.message;c("OzNotify").error("VOIP is having issues. "+(V?V:"")+". Please contact the wit oncall");c("OzHelpers").error("[twilio] had an error",U);t.endCall()});S.connect(T("connect",t.connect));S.disconnect(T("disconnect",t.endCall));S.cancel(T("cancel",t.endCall));S.incoming(T("incoming",t.incoming))}u();g=babelHelpers.inherits(v,p({"intent-id":null,tid:null,extension:null}));h=g&&g.prototype;function v(){"use strict";g.apply(this,arguments)}i=babelHelpers.inherits(w,p({from:null,meta:new v(),muted:false,status:"pending",to:null,wasIncoming:null,rating:null,sentDigits:null,sentDigitsBuffer:r(),sentDigitsIntervalId:null}));j=i&&i.prototype;function w(){"use strict";i.apply(this,arguments)}var x=c("Reflux").createStore({init:function S(){this.data=new w();this.listenToMany(t)},getInitialState:function S(){return this.data},onChangeTo:function S(T){this._u(function(U){return U.set("to",T)})},onDialAgain:function S(){this._conn=null;this._u(function(T){return new w({status:"dial",meta:T.get("meta"),from:T.get("from"),to:H(T.get("to"))})})},onConnect:function S(T){this._conn=T},onEndCall:function S(){this._conn=null;this._u(function(T){return T.merge({status:"ended"})})},onIncoming:function S(T){this._conn=T;this._u(function(U){return U.mergeDeep({status:"incoming",to:T.parameters.From,wasIncoming:true})})},onIncomingAccept:function S(){if(this._conn){this._conn.accept();this._u(function(T){return T.merge({status:"in-call"})})}},onIncomingReject:function S(){if(this._conn){this._conn.reject();this._conn=null}this.onEndCall()},onMute:function S(){if(this._conn){this._conn.mute(true);this._u(function(T){return T.set("muted",true)})}},onReady:function S(){this._u(function(T){return new w({status:"ready"})})},_sendDigitsFromBuffer:function S(){__p&&__p();var T=this.data.get("sentDigitsBuffer");if(!T.isEmpty()){this._conn.sendDigits(T.first());this._u(function(V){return V.update("sentDigitsBuffer",function(W){return W.shift()})})}else{var U=this.data.get("sentDigitsIntervalId");clearInterval(U);this._u(function(V){return V.set("sentDigitsIntervalId",null)})}},onSendDigits:function S(T){__p&&__p();if(this._conn){this._u(function(U){return U.update("sentDigits",function(V){return(V||"")+T})});this._u(function(U){return U.update("sentDigitsBuffer",function(V){return V.concat(r(T.split("")))})});if(!Number.isInteger(this.data.get("sentDigitsIntervalId")))this._u(function(U){return U.set("sentDigitsIntervalId",setInterval(this._sendDigitsFromBuffer,1e3))}.bind(this))}},onStartCall:function S(){this._u(function(T){return T.set("status","in-call")})},onUnmute:function S(){if(this._conn){this._conn.mute(false);this._u(function(T){return T.set("muted",false)})}},onUseIntent:function S(T){if(this.data.get("status")!=="ready"){c("OzNotify").error("End your call before starting another one");return}this._u(function(U){return new w({status:"dial",from:T.get("phone-number"),to:U.get("to"),meta:new v({tid:T.get("user-id"),"intent-id":T.get("id"),extension:T.get("phone-extension")})})})},onUpdateIncomingInfo:function S(T){this._u(function(U){return U.merge({meta:new v({tid:T.get("user-id"),"intent-id":T.get("intent-id"),extension:T.get("phone-extension")}),from:T.get("to"),to:T.get("from")})})},onUpdateRating:function S(T){this._u(function(U){return U.set("rating",T)})},_u:function S(T){this.data=T(this.data);this.trigger(this.data)}}),y=c("React").createClass({displayName:"OzTwilio",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(x,"store"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],contextTypes:{router:s.object.isRequired},componentDidMount:function S(){var T=window.setInterval(function(U){this.state.store.get("status")==="in-call"&&c("OzActions").isActive()}.bind(this),5e3);this._cleanup=function(U){return window.clearInterval(T)}},componentDidUpdate:function S(T,U){var V=U.store.get("status"),W=this.state.store.get("status");if(V==="in-call"&&W==="ended")this.setState({paused:true})},componentWillUnmount:function S(){this._cleanup()},render:function S(){var T=this.state,U=T.store,V=T.startedAt,W=T.paused;return c("React").createElement("span",{className:"_221-"},z(U)&&c("React").createElement(A,{startedAt:V,paused:W,onCallStart:this._handleStartCall,onDialAgain:t.dialAgain,onHangUp:this._handleHangUp,onIncomingAccept:this._handleIncomingAccept,onIncomingReject:t.incomingReject,onMute:t.mute,onRatingChange:this._handleRatingChange,onReady:t.ready,onSendDigits:t.sendDigits,onThreadClick:this._handleThreadClick,onToChange:t.changeTo,onUnmute:t.unmute,store:U}))},_handleThreadClick:function S(T){this.context.router.push("/inbox/"+T)},_handleStartCall:function S(){var T=this.state.store;this._startDurationTimer();t.startCall(babelHelpers["extends"]({},T.get("meta").toJS(),{from:T.get("from"),to:H(T.get("to")),page:this.state.config.get("PAGE_ID"),type:"outgoing"}))},_handleIncomingAccept:function S(){this._startDurationTimer();t.incomingAccept()},_startDurationTimer:function S(){this.setState({startedAt:Date.now()});this.setState({paused:false})},_handleHangUp:function S(){t.hangUp();this.setState({paused:true})},_handleRatingChange:function S(T){c("OzHelpers").info("[twilio] rating="+T,this.state.store.toJS());t.updateRating(T)}});function z(S){return q(["dial","in-call","incoming","ended"]).has(S.get("status"))}k=babelHelpers.inherits(A,c("React").Component);l=k&&k.prototype;A.prototype.render=function(){"use strict";return c("React").createElement(c("OzDraggableModal.react"),{className:"_2221",getHandle:function(S){return this.refs.header.refs.header}.bind(this)},c("React").createElement(C,{store:this.props.store,ref:"header"}),c("React").createElement(D,this.props))};function A(){"use strict";k.apply(this,arguments)}m=babelHelpers.inherits(B,c("React").Component);n=m&&m.prototype;function B(){var S,T;"use strict";for(var U=arguments.length,V=Array(U),W=0;W<U;W++)V[W]=arguments[W];return T=(S=n.constructor).call.apply(S,[this].concat(V)),this.state={elapsed:Date.now()-this.props.startedAt},this.$DurationTimer2=function(){this.setState({elapsed:Date.now()-this.props.startedAt})}.bind(this),T}B.prototype.componentDidMount=function(){"use strict";if(!this.props.paused)this.$DurationTimer1=setInterval(this.$DurationTimer2,1e3)};B.prototype.componentWillUnmount=function(){"use strict";clearInterval(this.$DurationTimer1)};B.prototype.componentWillReceiveProps=function(S){"use strict";if(S.paused==this.props.paused)return;S.paused?clearInterval(this.$DurationTimer1):this.$DurationTimer1=setInterval(this.$DurationTimer2,1e3)};B.prototype.render=function(){"use strict";return c("React").createElement("div",{className:"_1su8"},G(this.state.elapsed))};var C=c("OzHelpers").pure(function(S){var T=S.store,U=T.get("status"),V=T.get("wasIncoming")?"Incoming":"Outgoing";return c("React").createElement("h2",{className:"_1su5",ref:"header"},U==="ended"&&V+" Call End"||V+" Phone Call")}),D=c("OzHelpers").pure(function(S){switch(S.store.get("status")){case"dial":return c("React").createElement(E,S);case"in-call":return c("React").createElement(J,S);case"incoming":return c("React").createElement(O,S);case"ended":return c("React").createElement(P,S);default:c("OzHelpers").debug("[twilio] unknown status",S);return null}}),E=c("OzHelpers").pure(function(S){var T=S.store,U=S.onToChange,V=S.onCallStart,W=S.onReady;return c("React").createElement("div",{className:"_3hon"},c("React").createElement(R,{placeholder:"Type a phone number...",value:T.get("to"),onChange:function X(Y){return U(Y.target.value)},onKeyDown:function X(Y){return Y.which===c("Keys").RETURN?F(T)&&V():null}}),c("React").createElement("div",{className:"_1su6"},I(T)),c("React").createElement("div",{className:"_1su7"},c("React").createElement(o,{onClick:W,type:"secondary",label:"Cancel"}),c("React").createElement(o,{disabled:!F(T),onClick:V,type:"primary",label:"Call"})))});function F(S){return S.get("from")&&S.get("to")&&S.get("to").length>=10}var G=function G(S){var T=6e4,U=Math.floor(S/T);S%=T;var V=Math.floor(S/1e3);if(U<10)U="0"+U;if(V<10)V="0"+V;return U+":"+V},H=function H(S){return S.trim().replace(" ","-").replace(/(.)\+/g,"$1-")},I=function I(S){var T=S.getIn(["meta","extension"]);return"My Number: "+c("OzHelpers").parsePhoneNumber(S.get("from"))+" ext. "+T},J=c("OzHelpers").pure(function(S){var T=S.startedAt,U=S.paused,V=S.onHangUp,W=S.onMute,X=S.onSendDigits,Y=S.onThreadClick,Z=S.onUnmute,$=S.store;return c("React").createElement("div",{className:"_2225"},c("React").createElement(B,{startedAt:T,paused:U}),c("React").createElement("div",{className:"_1su9"},c("OzHelpers").parsePhoneNumber($.get("to"))),c("React").createElement(K,{sentDigits:$.get("sentDigits"),onSendDigits:X}),c("React").createElement("div",{className:"_1su6"},$.get("from")?I($):"Searching for our number..."),c("React").createElement("div",{className:"_1su7"},c("React").createElement(N,{tid:$.getIn(["meta","tid"]),onThreadClick:Y}),$.get("muted")?c("React").createElement(o,{onClick:Z,type:"secondary",use:"danger",label:"Unmute"}):c("React").createElement(o,{onClick:W,type:"secondary",use:"default",label:"Mute"}),c("React").createElement(o,{onClick:V,type:"primary",label:"End Call"})))}),K=c("OzHelpers").pure(function(S){var T=S.onSendDigits,U=S.sentDigits;return c("React").createElement("div",null,c("React").createElement(R,{placeholder:"Type numbers using keyboard",value:"",onChange:function V(W){var X=M(W.target.value);X&&T(X)}}),c("React").createElement("div",{className:"_538o"},U))}),L=q(["1","2","3","4","5","6","7","8","9","0","#","*"]);function M(S){return S.split("").filter(function(T){return L.has(T)}).join("")}var N=c("OzHelpers").pure(function(S){var T=S.onThreadClick,U=S.tid;return U?c("React").createElement(o,{onClick:function V(){return T(U)},type:"secondary",label:"Go to Thread"}):null}),O=c("OzHelpers").pure(function(S){var T=S.store,U=S.onIncomingAccept,V=S.onIncomingReject;return c("React").createElement("div",{className:"_2226"},c("React").createElement("div",{className:"_1su9"},c("OzHelpers").parsePhoneNumber(T.get("to"))),c("React").createElement("div",{className:"_1su6"},I(T)),c("React").createElement("div",{className:"_1su7"},c("React").createElement(o,{onClick:V,type:"secondary",label:"Ignore"}),c("React").createElement(o,{onClick:U,type:"primary",label:"Answer"})))}),P=c("OzHelpers").pure(function(S){var T=S.startedAt,U=S.paused,V=S.store,W=S.onHideDialog,X=S.onRatingChange,Y=S.onDialAgain,Z=S.onReady;return c("React").createElement("div",{className:"_5gaw"},c("React").createElement(B,{startedAt:T,paused:U}),c("React").createElement("div",{className:"_1su9"},c("OzHelpers").parsePhoneNumber(V.get("to"))),c("React").createElement("div",{className:"_1su6"},I(V)),c("React").createElement(Q,{rating:V.get("rating"),onRatingChange:X}),c("React").createElement("div",{className:"_1su7"},c("React").createElement(o,{onClick:Y,type:"secondary",label:"New Call"}),c("React").createElement(o,{onClick:Z,type:"primary",label:"Close"})))}),Q=c("OzHelpers").pure(function(S){var T=S.rating,U=S.onRatingChange;return c("React").createElement("div",{className:"_5rvp"},T?c("React").createElement("h3",{className:"_5rvu"},"Thank you for rating!"):c("React").createElement("span",null,c("React").createElement("h3",{className:"_5rvu"},"How would you rate your experience?"),c("React").createElement(c("StarsInput.react"),{large:true,count:0,onClick:U})))}),R=c("OzHelpers").pure(function(S){return c("React").createElement("input",babelHelpers["extends"]({},S,{className:"_1-i0 _2224"}))});f.exports=y}),null);
__d("Oz.react",["cx","OzAPI","OzHelpers","immutable","Layout.react","OzActions","OzBugNub.react","OzConfig","OzDialogContainer.react","OzExtensionCheck.react","OzHeader.react","OzLoading.react","OzFailed.react","OzNotify","OzSearch.react","OzSkywalkerBanner.react","OzStores","OzSuggestions","OzTwilio","OzImmutablePureRenderMixin","React","OzWrapper.react","Reflux","Run","ShimButton.react","XUIDialog.react","XUINotice.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("OzNotify").Component,j=c("OzStores").ActiveThreadStore,k=c("OzStores").MerchantStore,l=c("OzStores").LoadingStore,m=c("OzStores").RepStore,n=c("OzStores").RequirementStore,o=c("OzStores").ThreadStore,p=c("OzStores").WitIntentStore,q=c("React").PropTypes,r=c("immutable").Map,s=2e4,t=6e4,u=5e3,v=100,w=1e3*60*60,x=c("React").createClass({displayName:"OzWrapper",mixins:[c("Reflux").connect(l,"loading")],propTypes:{rev:q.number.isRequired,uid:q.string.isRequired,version:q.string.isRequired,skipToto:q.bool,onUnmount:q.func.isRequired},render:function F(){var G=this.state.loading.valueSeq().some(function(H){return H.get("state")!=="loaded"&&!H.get("skip")});if(G)return c("React").createElement(y,null);return c("React").createElement(z,this.props)}}),y=c("React").createClass({displayName:"AppLoading",mixins:[c("Reflux").connect(c("OzConfig").ConfigStore,"config"),c("Reflux").connect(l,"loading")],render:function F(){return c("React").createElement("div",null,c("React").createElement(i,null),this._renderBody(),c("React").createElement(c("OzBugNub.react"),null))},_renderBody:function F(){var G=this.state.loading,H=G.entrySeq().filter(function(J){var K=J[0],L=J[1];return L.get("state")==="failed"&&!L.get("skip")}).map(function(J){var K=J[0],L=J[1];return K});if(!H.isEmpty())return c("React").createElement(c("OzFailed.react"),{problems:H});var I="Hello "+this.state.config.get("publicName")+"! Oz is connecting...";return c("React").createElement(c("OzLoading.react"),{message:I})}}),z=c("React").createClass({displayName:"Oz",mixins:[c("Reflux").connect(k,"merchants"),c("Reflux").connect(m,"reps"),c("Reflux").connect(p,"witIntents"),c("Reflux").connect(n,"requirements"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{rev:q.number.isRequired,uid:q.string.isRequired,version:q.string.isRequired,skipToto:q.bool,onUnmount:q.func.isRequired},childContextTypes:{uid:q.string.isRequired,merchants:q.instanceOf(r).isRequired,reps:q.instanceOf(r).isRequired,witIntents:q.instanceOf(r).isRequired},getChildContext:function F(){return{uid:this.props.uid,merchants:this.state.merchants,reps:this.state.reps,witIntents:this.state.witIntents}},getInitialState:function F(){return{almostInactive:false,away:false,coachMode:false,fellAsleep:false,inactive:false}},componentDidMount:function F(){__p&&__p();window.addEventListener("message",this._handleMessage);window.postMessage({type:"consolemounted"},"*");this.lastPulseAt=Date.now();var G=c("OzActions").sendPulse.listen(this._handlePulse),H=setInterval(c("OzActions").sendPulse,u);this.lastActiveAt=Date.now();this._isActive=function(L){return c("OzActions").isActive()};window.addEventListener("mousemove",this._isActive);window.addEventListener("keydown",this._isActive);var I=c("OzActions").isActive.listen(function(){this.lastActiveAt=Date.now();if(this.state.almostInactive||this.state.inactive)this.setState({almostInactive:false,inactive:false})}.bind(this));this.lastAwakeAt=Date.now();var J=setInterval(function(L){var M=Date.now();if(M-this.lastAwakeAt>w)this.setState({fellAsleep:true});this.lastAwakeAt=M}.bind(this),v);c("OzActions").updateThreads.preEmit=C.bind(null,this.props.uid);var K=c("OzActions").isInactive.listen(function(L){if(Date.now()-this.lastActiveAt>u)this.setState({almostInactive:false,inactive:true})}.bind(this));this._cleanup=function(){window.removeEventListener("message",this._handleMessage);G();clearInterval(H);clearInterval(J);window.removeEventListener("mousemove",this._isActive);I();K()}.bind(this)},componentWillUnmount:function F(){this._cleanup()},render:function F(){return c("React").createElement(c("Layout.react"),{className:"_3_ps _li",onKeyPress:this._handleKeyPress},c("React").createElement(i,null),!this.props.skipToto&&c("React").createElement(c("OzExtensionCheck.react"),null),this.state.away?c("React").createElement(A,{onClick:this._handleAway,text:"You're currently away.",className:"_1tir"}):this.state.almostInactive?c("React").createElement(B,{lastActiveAt:this.lastActiveAt,onZero:this._handleZero}):this.state.fellAsleep&&!this.state.config.get("devMode")?c("React").createElement(A,{text:"Looks like your computer has gone to sleep. Please refresh the page."}):this.state.inactive?c("React").createElement(A,{text:"You're currently inactive.",className:"_4da6"}):null,c("React").createElement(c("OzSkywalkerBanner.react"),null),c("React").createElement(c("OzHeader.react"),{away:this.state.away,coachMode:!!this.state.coachMode,onAway:this._handleAway,onCoachModeToggle:this._handleCoachModeToggle,rev:this.props.rev,version:this.props.version,reps:this.state.reps,params:this.props.params}),c("React").cloneElement(this.props.children,{witIntents:this.state.witIntents,requirements:this.state.requirements,merchants:this.state.merchants,reps:this.state.reps}),c("React").createElement(c("OzBugNub.react"),null),c("React").createElement(c("OzDialogContainer.react"),null),c("React").createElement(c("OzSearch.react"),null),c("React").createElement(c("OzTwilio"),null))},_handleKeyPress:function F(){c("OzActions").isActive()},_handlePulse:function F(){var G=Date.now(),H=Math.round((G-this.lastPulseAt)/1e3),I=this._buildPulse();c("OzAPI").sendPulse(H,I);E(j.data,o.data);this.lastPulseAt=G;if(!this.state.almostInactive&&!this.state.inactive&&I.get("inactive-ms")>=t-s)this.setState({almostInactive:true})},_handleMessage:function F(G){__p&&__p();if(G.source!==window)return;if(!G.data)return;switch(G.data.type){case"active":c("OzActions").isActive();break;case"recordactivity":var H=j.data,I=G.data.data,J=H.get("threadID");c("OzHelpers").debug("[oz-ext] received activity",I);if(!J){c("OzHelpers").debug("[oz-ext] skipping event, no threadID");return}c("OzAPI").recordActivity(J,I);break;case"bubble":c("OzHelpers").debug("[toto] got bubble",G.data);c("OzActions").addBubble(c("OzSuggestions").toServer(c("immutable").fromJS(G.data),this.state.merchants));break;case"autopilot-data":c("OzHelpers").debug("[toto] got autopilot",G.data);if(G.data)c("OzActions").addAutopilot(c("immutable").fromJS(G.data));break}},_handleAway:function F(G){c("OzAPI").away(!this.state.away).done(function(H){this.setState({away:!!H})}.bind(this))},_handleCoachModeToggle:function F(G){c("OzAPI").coachMode(G).done(function(){this.setState({coachMode:G})}.bind(this))},_handleZero:function F(){this.setState({almostInactive:false,inactive:true})},_buildPulse:function F(G){return D(this.props.uid,j.data,o.data,this.lastActiveAt,this.state.away||G||false,this.state.coachMode)}});function A(F){var G=F.onClick,H=F.text,I=F.className;return c("React").createElement(c("XUIDialog.react"),{width:544,shown:true,layerHideOnBlur:false},c("React").createElement("div",{className:"_1tip"},c("React").createElement("div",{className:I}),c("React").createElement("div",{className:"_1tis"},H),G?c("React").createElement(c("ShimButton.react"),{className:"_1tit _57lt _30yy",form:"link",onClick:G},"I'm back :)"):null))}var B=c("React").createClass({displayName:"OzCountdownDialog",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{lastActiveAt:q.number.isRequired,onZero:q.func.isRequired},getInitialState:function F(){return{countdown:Math.floor((t-(Date.now()-this.props.lastActiveAt))/1e3)}},componentDidMount:function F(){this._interval=setInterval(function(){this.setState({countdown:Math.max(this.state.countdown-1,0)})}.bind(this),1e3)},componentDidUpdate:function F(){if(this.state.countdown===0){clearInterval(this._interval);this.props.onZero()}},componentWillUnmount:function F(){clearInterval(this._interval)},render:function F(){return c("React").createElement(c("XUIDialog.react"),{width:544,shown:true,layerHideOnBlur:false},c("React").createElement("div",{className:"_1tip"},c("React").createElement("div",{className:"_4da6"}),c("React").createElement(c("XUINotice.react"),{use:"warn"},"You'll be inactive (and your threads will be reassigned) in approximately ",this.state.countdown," seconds...")))}});function C(F,G){__p&&__p();var H=o.data;if(H.isEmpty())return;G.filter(function(I){return(c("OzHelpers").isOwner(I,F)||c("OzHelpers").isSubscriber(I,F))&&(I.get("ready")||c("OzHelpers").isUnread(I)||c("OzHelpers").hasPaid(I)||c("OzHelpers").hasReminder(I))}).forEach(function(I){var J=c("OzHelpers").isUnread(I)&&c("OzHelpers").shortDesc(c("OzHelpers").lastUserMessage(I))||c("OzHelpers").hasPaid(I)&&"Payment received."||c("OzHelpers").hasReminder(I)&&"Reminder triggered.";if(!J)return;var K=c("OzHelpers").threadID(I),L=H.getIn([K,"last-event-at"]);if(I.get("last-event-at")===L)return;var M=c("OzHelpers").photo(I),N=M?M.getIn(["data","url"])||M.get("mime_type")+","+M.get("data"):null;c("OzAPI").notifyExtension({action:"show",title:c("OzHelpers").getName(I),desc:J,picture:N,id:c("OzHelpers").threadID(I)})})}function D(F,G,H,I,J,K){__p&&__p();var L=G.get("threadID"),M=L&&H.get(L),N=r();if(L)N=N.merge({tid:L});if(M)N=N.merge({"intent-id":G.get("activeIntent"),"owner-id":M.getIn(["owner","id"]),"user-name":M.getIn(["user-vcard","name"])});if(Number.isFinite(I))N=N.set("inactive-ms",Date.now()-I);N=N.set("load",H.toSeq().filter(function(M){return c("OzHelpers").isOwner(M,F)&&M.get("ready")}).count());N=N.set("away?",J);N=N.set("coach-mode?",K);return N}function E(F,G){var H=F.get("threadID"),I=H&&G.get(H),J=r();if(I)J=J.merge({tid:H,"intent-id":F.get("activeIntent"),"user-vcard":I.get("user-vcard")});window.postMessage({type:"consolepulse",data:J.toJS()},"*")}f.exports=c("OzWrapper.react")(x)}),null);
__d("OzLastEvent.react",["cx","OzHelpers","OzConstants","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){var i=c("OzConstants").AUTHOR_TYPES,j=c("React").PropTypes,k=c("React").createClass({displayName:"OzLastEvent",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{name:j.string.isRequired,lastEvent:j.object.isRequired},render:function l(){var m=this.props.lastEvent,n=c("OzHelpers").authorType(m)===i.USER?this.props.name.split(" ")[0].substr(0,10):"M",o=m.get("text"),p=c("OzHelpers").shortDesc(m)||"did something",q=o&&n+": "+o||n+" "+p;return c("React").createElement("div",{className:"_4-_6 _4-_7",title:q},this._renderText(n,p))},_renderText:function l(m,n){return c("React").createElement("span",null,c("React").createElement("span",{className:"_3ikz"},m,": "),n)}});f.exports=k}),null);
__d("OzStrings",[],(function a(b,c,d,e,f,g){f.exports={NOTREADY_BUTTON:"I'm waiting",IS_NOTREADY:"Currently waiting",READY_BUTTON:"The user is waiting for us!",USER_FILTER_ALL:"All users",USER_FILTER_PUBLIC:"Public only",USER_FILTER_EMPLOYEE:"Employee only",READY_FILTER_ALL:"All threads",READY_FILTER_ATTENTION:"Needs attention",READY_FILTER_WAITING:"I'm waiting"}}),null);
__d("OzThreadLabels.react",["cx","OzHelpers","OzAPI","ContextualLayerAutoFlip","ContextualLayerUpdateOnScroll","joinClasses","immutable","ReactLayeredComponentMixin_DEPRECATED","OzImmutablePureRenderMixin","React","XUICloseButton.react","XUIContextualDialog.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("immutable").OrderedMap,k=c("immutable").List,l=c("React").PropTypes,m=c("React").createClass({displayName:"Label",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{noColor:l.bool,removable:l.bool,shade:l.oneOf(["dark","light"]),thread:l.instanceOf(i).isRequired},getDefaultProps:function A(){return{shade:"dark"}},render:function A(){if(!this.props.shown)return null;return c("React").createElement("div",{className:c("joinClasses")("_2yqb"+(this.props.noColor?" _2yqc":"")+" _2yqd",this.props.className)},this.props.text,this.props.removable&&this.props.onRemove?c("React").createElement(c("XUICloseButton.react"),{className:"_2yqe",onClick:this.props.onRemove,shade:this.props.shade}):c("React").createElement("div",{className:"_4ypj"}))}});function n(A){return c("React").createElement(m,babelHelpers["extends"]({},A,{className:"_2yqi",text:"REMINDER",shown:!c("OzHelpers").urgentReminders(A.thread).isEmpty()}))}function o(A){return c("React").createElement(m,babelHelpers["extends"]({},A,{className:"_2yqj",text:"PAID",shown:!c("OzHelpers").paidReminders(A.thread).isEmpty()}))}function p(A){var B=c("OzHelpers").minAge(A.thread);return c("React").createElement(m,babelHelpers["extends"]({},A,{className:"_2yqm",text:B<18&&"UNDER 18"||B<21&&"UNDER 21",shown:B<21}))}function q(A){return c("React").createElement(m,babelHelpers["extends"]({},A,{className:"_2yql",text:"ENGAGE",shown:c("OzHelpers").hasEngage(A.thread)}))}var r=j({OzVIPLabel:["vip","_2yqf"],OzUrgentLabel:["urgent","_2yqg"],OzAbuserLabel:["abuser","_2yqh"],OzEscalatedLabel:["escalated","_1jce"]}),s=j({OzEmployeeLabel:["employee","_2yqk"]}),t=r.merge(s).map(function(A){var B=A[0],C=A[1];return B}).toSet();function u(A,B,C){return function(D){return c("React").createElement(m,babelHelpers["extends"]({},D,{className:B,text:z(A),shown:c("OzHelpers").hasTag(D.thread,A),onRemove:function E(){return c("OzAPI").deleteTag(c("OzHelpers").threadID(D.thread),A)}}))}}var v=r.map(function(A){return u.apply(undefined,A)}),w=s.map(function(A){return u.apply(undefined,A)});function x(A){var B=A.className,C=A.removable,D=A.addable,E=babelHelpers.objectWithoutProperties(A,["className","removable","addable"]);return c("React").createElement("div",{className:B},w.map(function(F,G){return c("React").createElement(F,babelHelpers["extends"]({key:G},E))}).valueSeq(),c("React").createElement(n,E),v.map(function(F,G){return c("React").createElement(F,babelHelpers["extends"]({key:G,removable:C},E))}).valueSeq(),(E.thread.get("tags")||k()).filterNot(function(F){return t.has(F)}).sort().map(function(F){var G=u(F,"_tch");return G(babelHelpers["extends"]({key:F,removable:C},E))}),c("React").createElement(q,E),c("React").createElement(o,E),D?c("React").createElement(y,{thread:E.thread}):null)}var y=c("React").createClass({displayName:"OzAddLabel",mixins:[c("OzImmutablePureRenderMixin"),c("ReactLayeredComponentMixin_DEPRECATED")],propTypes:{thread:l.instanceOf(i).isRequired},getInitialState:function A(){return{shown:false}},render:function A(){return c("React").createElement("span",{ref:"add"},this._tags().isEmpty()?null:c("React").createElement("button",{className:"_1-hv _2yqb _2yqn _2yqo",onClick:function(){return this.setState({shown:true})}.bind(this)},"+"))},renderLayers:function A(){__p&&__p();var B=this.state.shown;if(!B)return null;var C=this.props.thread;return{contextualDialog:c("React").createElement(c("XUIContextualDialog.react"),{behaviors:{ContextualLayerAutoFlip:c("ContextualLayerAutoFlip"),ContextualLayerUpdateOnScroll:c("ContextualLayerUpdateOnScroll")},position:"below",shown:B,contextRef:function(){return this.refs.add}.bind(this),onBlur:function(D){return this.setState({shown:false})}.bind(this)},c("React").createElement("div",{className:"_2yqp"},this._tags().map(function(D){var E=D[0],F=D[1];return c("React").createElement("button",{key:E,className:c("joinClasses")(F,"_1-hv _2yqq"),onClick:function(){this.setState({shown:false});c("OzAPI").createTag(c("OzHelpers").threadID(C),E)}.bind(this)},z(E))}.bind(this))))}},_tags:function A(){return r.filterNot(function(B){var C=B[0],D=B[1];return c("OzHelpers").hasTag(this.props.thread,C)}.bind(this)).valueSeq()}});function z(A){return A.split("m_experiment_").join("").toUpperCase()}f.exports={OzLabelList:x,OzUnderageLabel:p}}),null);
__d("OzAllRow.react",["cx","OzStrings","OzHelpers","immutable","OzButton.react","OzConfig","OzConstants","OzDate.react","OzLastEvent.react","OzThreadLabels.react","OzUserImage.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("immutable").List,k=c("OzConstants").AUTHOR_TYPES,l=c("React").PropTypes,m=c("OzThreadLabels.react").OzLabelList,n=c("OzHelpers").pure(function(w){var x=w.thread,y=w.witIntents,z=babelHelpers.objectWithoutProperties(w,["thread","witIntents"]);return c("React").createElement("div",{className:"_-66"},c("React").createElement(t,{width:"220px"},c("React").createElement(o,{thread:x})),c("React").createElement(t,{marginLeft:"10px",width:"250px"},c("React").createElement(p,{thread:x,witIntents:y})),c("React").createElement(t,{marginLeft:"10px",width:"350px"},c("React").createElement(q,{thread:x})),c("React").createElement(t,{marginLeft:"10px",width:"150px"},c("React").createElement(r,{thread:x})),c("React").createElement(t,{margineft:"10px",flex:"1",alignItems:"right"},c("React").createElement(s,babelHelpers["extends"]({thread:x},z))))}),o=c("OzHelpers").pure(function(w){var x=w.thread;return c("React").createElement("div",{className:"_-67"},c("React").createElement(c("OzUserImage.react"),{photo:c("OzHelpers").photo(x)}),c("React").createElement("div",{className:"_-68"},c("React").createElement("h1",{className:"_-69"},c("OzHelpers").getName(x)),c("React").createElement(m,{className:"_-6a",thread:x})))}),p=c("OzHelpers").pure(function(w){var x=w.thread,y=w.witIntents,z=c("OzHelpers").openIntents(x).toSeq().map(function(B){return y.getIn([B.get("wit-intent-uuid"),"name"])}).filter(function(B){return B}).map(function(B){return"Intent: "+B}),A=c("OzHelpers").urgentReminders(x).toSeq().map(function(B){return B.getIn(["body","description"])}).filter(function(B){return B}).map(function(B){return"Reminder: "+B});return c("React").createElement("div",{className:"_-6q"},c("React").createElement("div",{className:"_-6r"},z.concat(A).map(function(B,C){return c("React").createElement("div",{key:C,className:"_4-_7 _-6s"},B)})))}),q=c("OzHelpers").pure(function(w){var x=w.thread;return c("React").createElement("div",{className:"_-6u"},u(x).map(function(y){return c("React").createElement("div",{key:c("OzHelpers").msgID(y),className:"_-6v"+(c("OzHelpers").authorType(y)!==k.USER?" _-6w":"")},c("React").createElement("span",{className:"_4-_7 _-6x"},c("React").createElement(c("OzDate.react"),{timestamp:y.get("timestamp")})),c("React").createElement(c("OzLastEvent.react"),{key:c("OzHelpers").msgID(y),name:c("OzHelpers").getName(x),lastEvent:y}))}))}),r=c("OzHelpers").pure(function(w){var x=w.thread,y=x.getIn(["owner","name"])||"No owner",z=x.getIn(["last-owner","name"]);return c("React").createElement("div",{className:"_-6y"},c("React").createElement("div",{className:"_-6z"},y),z?c("React").createElement("div",{className:"_-6-"},"Last owner: ",z):null)}),s=c("React").createClass({displayName:"Actions",mixins:[c("OzImmutablePureRenderMixin")],contextTypes:{uid:l.string.isRequired},propTypes:{thread:l.instanceOf(i).isRequired,onThreadNotReady:l.func.isRequired,onThreadReady:l.func.isRequired,onThreadRelease:l.func.isRequired,onThreadView:l.func.isRequired},render:function w(){return c("React").createElement("div",{className:"_-6_"},v(babelHelpers["extends"]({},this.props,{uid:this.context.uid})).map(function(x){var y=x.body,z=x.f;return c("React").createElement(c("OzButton.react"),{key:y,onClick:function(A,B){return z(this.props.thread,B,A)}.bind(this)},y)}.bind(this)))}}),t=c("OzHelpers").pure(function(w){var x=w.children,y=babelHelpers.objectWithoutProperties(w,["children"]);return c("React").createElement("div",{className:"_-70",style:y},x)});function u(w){var x=c("OzHelpers").lastEvents(w).groupBy(c("OzHelpers").authorType);return j([x.get(k.USER),x.get(k.TRAINER),x.get(k.BOT)]).toSeq().filter(function(y){return y}).map(function(y){return y.last()}).sortBy(function(y){return y.get("timestamp")})}function v(w){__p&&__p();var x=w.onThreadNotReady,y=w.onThreadReady,z=w.onThreadRelease,A=w.onThreadView,B=w.thread,C=w.uid,D=B,E=c("OzConfig").getInStaticConfig(["GK","supervisor"]),F=[];if(E&&c("OzHelpers").hasOwner(D))F.push({body:"Release",f:z});if(D.get("ready"))F.push({body:c("OzStrings").NOTREADY_BUTTON,f:x});else if(E)F.push({body:c("OzStrings").READY_BUTTON,f:y});if(D.getIn(["owner","id"])!==C&&!c("OzHelpers").isSubscriber(D,C))F.push({body:"View",f:A});return F}f.exports=n}),null);
__d("OzAll.react",["cx","OzStrings","OzAPI","OzHelpers","immutable","MessengerFlexScrollableArea.react","OzActions","OzAllRow.react","OzLoading.react","OzStores","promiseFinally","OzImmutablePureRenderMixin","React","Reflux","XUIButton.react","XUIRadioButtonGroup.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("OzLoading.react").Flex,k=c("OzLoading.react").Inline,l=c("OzStores").QueueFilterStore,m=c("OzStores").ThreadStore,n=c("React").PropTypes,o=c("React").createClass({displayName:"OzAll",mixins:[c("Reflux").connect(l,"filters"),c("Reflux").connect(m,"threads")],contextTypes:{router:n.object.isRequired},getInitialState:function C(){return{clientLimit:y}},componentWillMount:function C(){if(this.state.threads.size<y)this._fetchThreads()},componentDidUpdate:function C(D,E){var F=E.filters.get("all"),G=this.state.filters.get("all");if(!c("immutable").is(F,G))this._fetchThreads()},render:function C(){var D=this._getFilters(),E=D[0],F=D[1],G=this._threads();return c("React").createElement("div",{className:"_3l5z"},c("React").createElement(q,{showTags:E,hideTags:F,onChange:this._handleFilterChange}),c("React").createElement(p,{threads:G,loading:!!w[A(E,F)],clientLimit:this.state.clientLimit,onScrollBottom:this._handleScrollBottom,onThreadNotReady:this._handleThreadNotReady,onThreadReady:this._handleThreadReady,onThreadRelease:this._handleThreadRelease,onThreadView:this._handleThreadView,witIntents:this.props.witIntents}))},_getFilters:function C(){var D=this.state.filters.get("all");return[D.get("showTags"),D.get("hideTags")]},_fetchThreads:function C(){B(this._getFilters())},_threads:function C(){return t(s(this.state.threads),this._getFilters())},_handleFilterChange:function C(D){c("OzActions").updateQueueFilters(i({all:i(D)}));this.setState({clientLimit:y})},_handleScrollBottom:function C(){var D=this.state.clientLimit,E=this._threads(),F=D+y;this.setState({clientLimit:F});E.slice(D,F).size||this._fetchThreads()},_handleThreadNotReady:function C(D,E){c("OzAPI").notready(c("OzHelpers").threadID(D)).done(E,E)},_handleThreadReady:function C(D,E){c("OzAPI").ready(c("OzHelpers").threadID(D)).done(E,E)},_handleThreadRelease:function C(D,E){c("OzAPI").release(c("OzHelpers").threadID(D)).done(E,E)},_handleThreadView:function C(D,E,F){var G=c("OzHelpers").threadID(D),H=c("OzHelpers").hasCmdOrCtrl(F);c("OzAPI").view(G).done(function(I){E();H||this.context.router.push("/inbox/"+G)}.bind(this),E)}}),p=c("React").createClass({displayName:"ThreadList",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{clientLimit:n.number.isRequired,loading:n.bool.isRequired,onScrollBottom:n.func.isRequired,onThreadNotReady:n.func.isRequired,onThreadReady:n.func.isRequired,onThreadRelease:n.func.isRequired,onThreadView:n.func.isRequired,threads:n.instanceOf(i).isRequired,witIntents:n.instanceOf(i).isRequired},render:function C(){var D=this.props,E=D.loading,F=D.threads,G=D.clientLimit;if(E&&!F.count())return c("React").createElement(j,null);return c("React").createElement(c("MessengerFlexScrollableArea.react"),{ref:"scrollable",onScroll:this._handleScroll},c("React").createElement("div",{className:"_3l5-"},F.take(G).map(function(H){return c("React").createElement(c("OzAllRow.react"),{key:c("OzHelpers").threadID(H),thread:H,witIntents:this.props.witIntents,onThreadNotReady:this.props.onThreadNotReady,onThreadReady:this.props.onThreadReady,onThreadRelease:this.props.onThreadRelease,onThreadView:this.props.onThreadView})}.bind(this)).valueSeq()),c("React").createElement(k,{loading:E}))},_handleScroll:function C(){var D=this.refs.scrollable;D&&D.isScrolledToBottom()&&this.props.onScrollBottom()}}),q=c("OzHelpers").pure(function(C){var D,E,F=C.showTags,G=C.hideTags,H=C.onChange,I=function I(J){var K=J.tagName,L=J.value,M=v({tagName:K,value:L,showTags:F,hideTags:G});H(M)};return c("React").createElement("div",{className:"_3l5_"},c("React").createElement(r,{tagName:"employee",value:u("employee",F,G),onChange:I,buttons:(D={},D[u.NEUTRAL]=c("OzStrings").USER_FILTER_ALL,D[u.OFF]=c("OzStrings").USER_FILTER_PUBLIC,D[u.ON]=c("OzStrings").USER_FILTER_EMPLOYEE,D)}),c("React").createElement(r,{tagName:"ready",value:u("ready",F,G),onChange:I,buttons:(E={},E[u.NEUTRAL]=c("OzStrings").READY_FILTER_ALL,E[u.OFF]=c("OzStrings").READY_FILTER_ATTENTION,E[u.ON]=c("OzStrings").READY_FILTER_WAITING,E)}))}),r=c("OzHelpers").pure(function(C){var D=C.tagName,E=C.value,F=C.buttons,G=C.onChange;return c("React").createElement("div",{key:D,className:"_3l60"},c("React").createElement(c("XUIRadioButtonGroup.react"),{selectedValue:E,selectedUse:"confirm",onValueChange:function H(E){G({tagName:D,value:E})}},Object.keys(F).map(function(H){return c("React").createElement(c("XUIButton.react"),{key:H,value:H,label:F[H]})})))});function s(C){return C.sortBy(function(D){return-D.get("last-event-at")})}function t(C,D){var E=D[0],F=D[1];return C.filter(function(G){var H=true;if(E.size)H=c("OzHelpers").hasAllTags(G,E);if(F.size)H=!c("OzHelpers").hasSomeTag(G,F);return H})}var u=function u(C,D,E){return D.has(C)?u.ON:E.has(C)?u.OFF:u.NEUTRAL};u.ON="on";u.OFF="off";u.NEUTRAL="neutral";function v(C){__p&&__p();var D=C.tagName,E=C.value,F=C.showTags,G=C.hideTags,H,I;switch(E){case u.ON:H=F.add(D);I=G.remove(D);break;case u.OFF:H=F.remove(D);I=G.add(D);break;default:H=F.remove(D);I=G.remove(D);break}return{showTags:H,hideTags:I}}var w={},x={},y=20,z=2*y;function A(C,D){var E=C.toJS().join("-"),F=D.toJS().join("-");return"show["+E+"]hide["+F+"]"}function B(C){__p&&__p();var D=C[0],E=C[1],F=A(D,E),G=w[F];c("OzHelpers").debug("[oz-all] fetchThreads",F);if(G){c("OzHelpers").debug("[oz-all] abort fetchthreads : loading",F);return}var H=x[F]||0;w[F]=true;c("promiseFinally")(c("OzAPI").allThreads(D,E,H,z),function(I){return w[F]=false}).done(function(I){return x[F]=H+z})}f.exports=o}),null);
__d("OzExpirationCountdown.react",["cx","relativeTimeString.atlas","OzDate.react","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("React").PropTypes,l=30*1e3;i=babelHelpers.inherits(m,c("React").Component);j=i&&i.prototype;function m(){__p&&__p();var n,o;"use strict";for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.$OzExpirationCountdown2=function(){this.forceUpdate();if(this.isExpired()){clearInterval(this.$OzExpirationCountdown1);this.$OzExpirationCountdown1=null}}.bind(this),this.remainingTime=function(){return this.props.endTime-Date.now()}.bind(this),this.isExpired=function(){return this.props.endTime<=Date.now()}.bind(this),o}m.prototype.componentDidMount=function(){"use strict";this.$OzExpirationCountdown1=setInterval(this.$OzExpirationCountdown2,l)};m.prototype.componentWillReceiveProps=function(){"use strict";this.$OzExpirationCountdown1=this.$OzExpirationCountdown1||setInterval(this.$OzExpirationCountdown2,l)};m.prototype.componentWillUnmount=function(){"use strict";clearInterval(this.$OzExpirationCountdown1)};m.prototype.render=function(){"use strict";var n=this.props.endTime,o=this.isExpired()&&c("React").createElement("span",null,"Expired ",c("React").createElement(c("OzDate.react"),{timestamp:n}))||this.remainingTime()<=60*1e3&&"Expires in less than a minute"||"Expires in "+c("relativeTimeString.atlas")(n,true),p="_3d53"+(this.isExpired()?" _3d54":"")+(!this.isExpired()?" _3d55":"");return c("React").createElement("span",{className:p},o)};m.propTypes={endTime:k.number.isRequired};f.exports=m}),null);
__d("OzMessage.react",["cx","getURLRanges","OzHelpers","formatDate","Image.react","immutable","Link.react","MNCommerceAgentItemSuggestionMercuryShareAttachment.react","MNCommercePromotionMercuryShareAttachment.react","OzExpirationCountdown.react","OzImmutablePureRenderMixin","React","OzWrapper.react","TextWithEntities.react","XStickerAssetController"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("immutable").List,k=c("React").PropTypes,l=c("React").createClass({displayName:"OzMessage",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{message:k.instanceOf(i).isRequired},render:function M(){__p&&__p();var N=this.props.message,O=N.get("attachments")||j(),P=j([N.get("text")&&K(N.get("text"))]).concat(O.map(function(Q){var R=x(Q)&&y(Q)||s(Q)&&t(Q)||E(Q)&&G(F(Q))||D(Q)&&G(Q.get("uri"))||B(Q)&&C(Q)||z(Q)&&A(Q)||u(Q)&&v(Q)||q(Q)&&r(Q)||m(Q)&&p(o(Q.get("metadata")))||n(Q)&&p(c("OzHelpers").uiSuggestion(Q.get("suggestion")))||H(Q)&&I(Q.getIn(["xma","link"]))||Q.get("uri")&&I(Q.get("uri"));if(R)return R;else{c("OzHelpers").error("could not render attachment",Q.toJS(),N.toJS());return L("Oops. We could not render this attachment.")}})).filter(function(Q){return!!Q}).map(function(Q,R){return c("React").createElement("span",{key:R,className:"_15_n"},Q)});if(P.size)return c("React").createElement("span",null,P);else{c("OzHelpers").error("no text or attachments",N.toJS());return L("Oops. We did not get text or attachments.")}}}),m=function m(M){return M.hasIn(["metadata","target_url"])},n=function n(M){return M.has("suggestion")},o=function o(M){if(!i.isMap(M.get("total_cost"))&&M.has("raw_amount"))M=M.set("total_cost",i({amount:+M.get("raw_amount")}));return M.update("target_url",c("OzHelpers").shimURI).toJS()};function p(M){return c("React").createElement("div",{className:"_53qw"},M.expiration_time?c("React").createElement("div",{className:"_4jjz"},c("React").createElement(c("OzExpirationCountdown.react"),{endTime:M.expiration_time*1e3})):null,c("React").createElement("div",{className:"_4jj-"},c("React").createElement(c("MNCommerceAgentItemSuggestionMercuryShareAttachment.react"),{attachment:{target:M}})))}var q=function q(M){return M.get("mime_type")==="oz/business-message"};function r(M){var N=M.get("xma").setIn(["target","call_to_actions"],[]).toJS();return c("React").createElement("div",{className:"_53qw"},c("React").createElement("div",{className:"_4jj-"},c("React").createElement(c("MNCommercePromotionMercuryShareAttachment.react"),{attachment:N})))}var s=function s(M){return M.get("mime_type")==="oz/event"};function t(M){var N=M.get("metadata"),O=function O(Q){return Q?c("formatDate")(Q,"M jS, g:ia"):"[no time]"},P=N.getIn(["place","name"])||N.get("description")||"[no location]";return c("React").createElement("a",{className:"_3is9",href:N.get("url"),target:"_blank"},c("React").createElement("img",{alt:P,className:"_3isa",src:N.get("image_url")}),c("React").createElement("div",{className:"_3isb"},c("React").createElement("div",{className:"_3isc"},N.get("title")||"[no invitation title]"),c("React").createElement("div",null,O(N.get("start"))," \u2014 ",O(N.get("end"))),c("React").createElement("div",null,P)))}var u=function u(M){var N=M.get("metadata");return N&&N.get("location")&&N.get("url")&&N.get("image_url")};function v(M){return G(M.getIn(["metadata","image_url"]),M.getIn(["metadata","url"]))}var w=function w(M){var N=M.get("uri"),O=M.get("sticker_id");if(O)N=c("XStickerAssetController").getURIBuilder().setInt("sticker_id",O).getURI().toString();return N},x=function x(M){return(M.get("sticker_id")||c("OzHelpers").isStickerType(M.get("mime_type")))&&w(M)};function y(M){return c("React").createElement(c("Image.react"),{className:"__vl",src:w(M)})}var z=function z(M){return/video/.test(M.get("mime_type"))&&M.get("uri")};function A(M){return c("React").createElement("video",{controls:true,height:"300",width:"300"},c("React").createElement("source",{src:M.get("uri"),type:M.get("mime_type")}))}var B=function B(M){return/audio/.test(M.get("mime_type"))&&M.get("uri")};function C(M){return c("React").createElement("audio",{className:"_1d86",controls:true},c("React").createElement("source",{src:M.get("uri"),type:M.get("mime_type")}))}var D=function D(M){var N=/blob:/.test(M.get("uri")),O=/\.(jpg|gif|png)/.test(M.get("uri"));return M.get("uri")&&(c("OzHelpers").isImageType(M.get("mime_type"))||N||O)},E=function E(M){return/base64/.test(M.get("mime_type"))&&M.get("data")},F=function F(M){return M.get("mime_type")+","+M.get("data")};function G(M,N){return c("React").createElement("a",{href:N||M,target:"_blank",className:"_4y6l",style:{backgroundImage:"url('"+M+"')"}})}var H=function H(M){return!!M.getIn(["xma","link"])};function I(M){return c("React").createElement("div",{className:"_4y6k"},c("React").createElement("a",{href:M,target:"_blank"},"Attachment Link"))}function J(M,N){return c("React").createElement(c("Link.react"),{target:"_blank",href:c("OzHelpers").shimURI(N.entity.url)},M)}function K(M){return c("React").createElement(c("TextWithEntities.react"),{className:"_4y6k",text:M,interpolator:J,ranges:c("getURLRanges")(M),renderEmoticons:true,renderEmoji:true})}function L(M){return c("React").createElement("div",{className:"_4y6k _5kng"},M)}f.exports=c("OzWrapper.react")(l)}),null);
__d("OzSearchSource",["AbstractSearchSource"],(function a(b,c,d,e,f,g){__p&&__p();var h,i;h=babelHelpers.inherits(j,c("AbstractSearchSource"));i=h&&h.prototype;function j(k){"use strict";i.constructor.call(this);this.$OzSearchSource1=k}j.prototype.bootstrap=function(){"use strict";return this.$OzSearchSource1({})};j.prototype.suggest=function(k){"use strict";return this.$OzSearchSource1(k)};j.prototype.searchImpl=function(k,l){"use strict";return this.$OzSearchSource1({query:k}).then(function(m){return l(m,k)},function(m){return l([],k)})};f.exports=j}),null);
__d("OzFeedbackDashboard.react",["cx","Promise","OzAPI","OzHelpers","immutable","OzButton.react","OzConfig","OzMessage.react","OzSearchSource","OzImmutablePureRenderMixin","React","Reflux","SearchableDropdownInput.contrib","SearchableEntry","Stars.react","joinClasses"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("React").PropTypes,k=c("React").createClass({displayName:"OzFeedbackDashboard",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],contextTypes:{uid:j.string.isRequired,router:j.object.isRequired},getInitialState:function D(){return{messages:i(),authorID:this.context.uid}},componentWillMount:function D(){this._searchSource=new(c("OzSearchSource"))(function(E){var F=(E.query||"").toLowerCase();return new(c("Promise"))(function(G){return G(this.props.reps.valueSeq().map(u).concat([u("autoresponse-bot"),u("survey-bot")]).sortBy(function(H){return H.getTitle()}).filter(function(H){return(H.getTitle()||"").toLowerCase().indexOf(F)>-1}).toJS())}.bind(this))}.bind(this))},componentDidMount:function D(){this._fetchFeedback()},render:function D(){return c("React").createElement("div",{className:"_60f"},this.state.config.getIn(["GK","supervisor"])?c("React").createElement(l,{reps:this.props.reps,authorID:this.state.authorID,searchSource:this._searchSource,onSelect:function(E){return this.setState({messages:i(),activeMessage:null,authorID:E.getUniqueID()},this._fetchFeedback)}.bind(this)}):null,c("React").createElement(m,{messages:this.state.messages}),c("React").createElement(r,{messages:this.state.messages,reps:this.props.reps,activeMessage:this.state.activeMessage||this.state.messages.first(),onMessageClick:function(E){return this.setState({activeMessage:E})}.bind(this),onSeeThreadClick:function(E){return this.context.router.push("/inbox/"+E)}.bind(this)}))},_fetchFeedback:function D(){c("OzAPI").authorFeedback(this.state.authorID).done(function(E){E=E.sortBy(function(F){return-F.get("timestamp")});this.isMounted()&&this.setState({messages:E})}.bind(this))}}),l=c("OzHelpers").pure(function(D){var E=D.reps,F=D.authorID,G=D.searchSource,H=D.onSelect;return c("React").createElement("div",{className:"_5p66"},c("React").createElement("div",{className:"_wa_"},c("React").createElement(c("SearchableDropdownInput.contrib"),{value:u(E.get(F)||F),onSelect:H,placeholder:"Pick a rep",emptySearchResultsText:"No Rep found",searchSource:G})))}),m=c("OzHelpers").pure(function(D){var E=D.messages;return c("React").createElement("div",null,c("React").createElement(o,{messages:E,days:"-7",span:"7"}),c("React").createElement(o,{messages:E,days:"-14",span:"7"}),c("React").createElement(o,{messages:E,days:"-21",span:"7"}),c("React").createElement(o,{messages:E,days:"-30",span:"30"}),c("React").createElement(o,{messages:E,days:"-60",span:"30"}))}),n=c("OzHelpers").pure(function(D){var E=D.day,F=D.span;return c("React").createElement("div",{className:"_24xm"},E+F==0?"LAST "+-E+" DAYS":"FROM "+(E+F)+" TO "+E+" DAYS")}),o=c("OzHelpers").pure(function(D){var E=D.messages,F=D.days,G=D.span,H=parseInt(F,10),I=parseInt(G,10),J=C(E,H,H+I);return c("React").createElement("div",{className:"_wb0"},c("React").createElement(n,{day:H,span:I}),c("React").createElement("div",{className:"_wb2"},c("React").createElement(p,{label:"TONE"},z(J)),c("React").createElement(p,{label:"RESPONSIVENESS"},y(J)),c("React").createElement(p,{label:"EXECUTION"},x(J)),c("React").createElement(p,{label:"CONSOLE"},A(J)),c("React").createElement(q,null,B(J))),c("React").createElement("div",{className:"_3gch"},c("React").createElement(p,{label:"FEEDBACK GIVEN"},J.size)))}),p=c("OzHelpers").pure(function(D){var E=D.label,F=D.children,G=D.variation,H=D.className;return c("React").createElement("div",{className:c("joinClasses")(H,"_wb3")},c("React").createElement("span",{className:"_wb4"},F),c("React").createElement("span",{className:"_wb5"},E))}),q=c("OzHelpers").pure(function(D){var E=D.children;return c("React").createElement(p,{label:"POLICY",className:(E===0?"_wb6":"")+(E>0?" _wb7":"")},E)}),r=c("OzHelpers").pure(function(D){var E=D.messages,F=D.reps,G=D.activeMessage,H=D.onMessageClick,I=D.onSeeThreadClick,J=G&&G.get("reviews"),K=G&&G.get("user-id");return c("React").createElement("div",{className:"_wb8"},c("React").createElement("div",{className:"_wbc"},c("React").createElement("div",{className:"_4fj7"},E.map(function(L){return c("React").createElement("div",{className:"_wbf"+(L===G?" _wbg":""),key:c("OzHelpers").msgID(L),onClick:function M(N){return H(L)},role:"presentation"},c("React").createElement(c("OzMessage.react"),{message:L}))}).valueSeq())),c("React").createElement("div",{className:"_wbh"},c("React").createElement("div",{className:"_wbe"},J?J.map(function(L){return c("React").createElement(s,{key:L.get("id"),rep:F.get(L.get("reviewer-id")),review:L})}).valueSeq():null)),c("React").createElement("div",{className:"_wbi"},K?c("React").createElement(c("OzButton.react"),{onClick:function L(M){return I(K)}},"See Thread"):null))}),s=c("OzHelpers").pure(function(D){var E=D.review,F=D.rep;return c("React").createElement("div",{className:"_wbj"},c("React").createElement("div",{className:"_wbk"},c("React").createElement("h2",{className:"_wbl"},F&&F.get("name")),E.has("tone")?c("React").createElement(t,{label:"Tone"},c("React").createElement(c("Stars.react"),{count:E.get("tone"),max:3,size:"large"})):null,E.has("responsiveness")?c("React").createElement(t,{label:"Responsiveness"},c("React").createElement(c("Stars.react"),{count:E.get("responsiveness"),max:3,size:"large"})):null,E.has("execution")?c("React").createElement(t,{label:"Execution"},c("React").createElement(c("Stars.react"),{count:E.get("execution"),max:3,size:"large"})):null,E.has("followed-policy")?c("React").createElement(t,{label:"Followed Policy?"},c("React").createElement("div",{className:"_wbm"},E.get("followed-policy")?"YES":"NO")):null,E.has("console-proficiency")?c("React").createElement(t,{label:"Console"},c("React").createElement(c("Stars.react"),{count:E.get("console-proficiency"),max:3,size:"large"})):null),c("React").createElement("div",{className:"_wbn"},E.get("body")))}),t=c("OzHelpers").pure(function(D){var E=D.label,F=D.children;return c("React").createElement("div",{className:"_wbo"},F,c("React").createElement("div",{className:"_wbp"},E))});function u(D){var E=function E(F){return new(c("SearchableEntry"))(F)};return D?D.get?E({title:D.get("name"),uniqueID:D.get("fbid")}):E({title:D,uniqueID:D}):null}function v(D,E){return function(F){var G=F.valueSeq().flatMap(function(K){return K.get("reviews")}).filter(function(K){return K&&K.has(D)}),H=G.reduce(function(K,L){var I=K[0],J=K[1];return[I+E,J+L.get(D)]},[0,0]),I=H[0],J=H[1];return I?Math.round(J/I*100)+"%":" "}}function w(D){return function(E){var F=E.valueSeq().flatMap(function(H){return H.get("reviews")}).filter(function(H){return H&&H.has(D)}),G=F.reduce(function(G,H){return G+!H.get(D)},0);return G?G:""}}var x=v("execution",3),y=v("responsiveness",3),z=v("tone",3),A=v("console-proficiency",3),B=w("followed-policy");function C(D,E,F){var G=new Date().getDate(),H=+new Date(Date.now()).setDate(G+E),I=+new Date(Date.now()).setDate(G+F);return D.filter(function(J){var K=+J.get("timestamp");return K>=H&&K<=I})}f.exports=k}),null);
__d("OzInboxThreadRow.react",["cx","OzHelpers","immutable","OzConfig","OzLastEvent.react","OzThreadLabels.react","OzUserImage.react","OzImmutablePureRenderMixin","React","OzWrapper.react","Reflux","Sound","Timestamp.react","Tooltip"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("OzThreadLabels.react").OzLabelList,k=c("React").PropTypes,l=1e3,m=c("React").createClass({displayName:"OzInboxThreadRow",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{thread:k.object.isRequired,locker:k.object.isRequired,selected:k.bool.isRequired,onClick:k.func.isRequired,onUnview:k.func.isRequired,witIntents:k.instanceOf(i).isRequired},contextTypes:{uid:k.string.isRequired},getInitialState:function r(){return{flashing:false,unread:false}},componentWillReceiveProps:function r(s){__p&&__p();var t=s.thread,u=s.selected;if(this.state.config.getIn(["GK","responsiveness"])){if(n(this.props.thread,t)){o(t);this.setState({unread:true,flashing:true});window.clearTimeout(this._flashingTimeout);this._flashingTimeout=window.setTimeout(function(v){return this.setState({flashing:false})}.bind(this),l)}if(u)this.setState({unread:false})}},componentWillUnmount:function r(){window.clearTimeout(this._flashingTimeout)},render:function r(){var s=this.props,t=s.thread,u=s.locker,v=s.selected,w=s.subscribed,x=s.owned,y=s.onUnview,z=c("OzHelpers").getName(t),A=c("OzHelpers").photo(t),B=c("OzHelpers").lastEvents(t).last(),C=!x&&t.get("ui-reassign"),D=c("OzHelpers").hasPaid(t),E=c("OzHelpers").hasReminder(t),F=t.get("locked"),G=F?"Thread locked by "+u.get("name")+"\n       at "+new Date(t.get("locked-at")).toLocaleString():"",H=x&&(t.get("ready")||D||E)&&!F,I=null,J=B&&B.get("timestamp");if(!x){var K=t.get("ui-reassign")?"Reassigned to":"Grabbed by";I=K+" "+c("OzHelpers").nameOrId(t.get("owner"))}var L=this.state.config.getIn(["GK","responsiveness"]),M=this.state.config.getIn(["GK","responsivenessV2"]),N=M?c("OzHelpers").isUnread(t)&&!v:this.state.unread;return c("React").createElement("div",{className:"_2ic2"+(L&&N?" _2ic4":"")+(L&&this.state.flashing?" _5lan":"")+(H?" _2ic3":"")+(E?" _2ic5":"")+(D?" _2ic6":"")+(v?" _2ic7":"")+(C?" _2q4a":""),onClick:this._handleClick,role:"presentation"},c("React").createElement("div",{className:"_2ic8"},c("React").createElement(c("OzUserImage.react"),{photo:A}),w?c("React").createElement("button",{className:"_1-hv _2ic9",onClick:function O(P){return y(t)}}):null),c("React").createElement("div",{className:"_2ica"},!x?c("React").createElement(p,{name:I}):null,c("React").createElement("h1",{className:"_4-_7 _2ice"},z),c("React").createElement(q,{thread:t,witIntents:this.props.witIntents}),c("React").createElement("div",{className:"_2icb"},B?c("React").createElement(c("OzLastEvent.react"),{lastEvent:B,name:z}):null),c("React").createElement("div",{className:"_3lxn"},c("React").createElement(j,{className:"_2icc",thread:t}))),c("React").createElement("div",{className:"_6f"},J?c("React").createElement("div",{className:"_2icf"},c("React").createElement(c("Timestamp.react"),{autoUpdate:true,shorten:true,time:J/1e3})):null,c("React").createElement("div",babelHelpers["extends"]({className:F?"_1hw":""},c("Tooltip").propsFor(G)))))},_handleClick:function r(){this.props.onClick(this.props.thread)}});function n(r,s){return(c("OzHelpers").unreadTs(r)||0)<(c("OzHelpers").unreadTs(s)||0)}c("Sound").init(["audio/ogg","audio/mpeg"]);function o(r){var s=c("OzHelpers").unreadTs(r);c("OzHelpers").debug("[inboxThreadRow] sound for tid "+c("OzHelpers").threadID(r)+", ts "+s);var t=c("OzConfig").ConfigStore.data.getIn(["resources","sound","notifyUnread"],i()).toObject(),u=t.ogg,v=t.mp3;if(s&&(u||v))c("Sound").play([u,v],s,false);else c("OzHelpers").warn("[inboxThreadRow] sounds not loaded")}function p(r){var s=r.name,t=r.lastEvent,u=t&&t.get("timestamp");return c("React").createElement("div",{className:"_2icd"},c("React").createElement("h1",{className:"_4-_7 _2ice"},s),u?c("React").createElement("div",{className:"_2icf"},c("React").createElement(c("Timestamp.react"),{autoUpdate:true,shorten:true,time:u/1e3})):null)}function q(r){var s=r.thread,t=r.witIntents,u=c("OzHelpers").openIntents(s).first(),v=u&&t.getIn([u.get("wit-intent-uuid"),"name"]);return v?c("React").createElement("div",{className:"_2icg"},v):c("React").createElement("span",null)}f.exports=c("OzWrapper.react")(m)}),null);
__d("OzInboxThreadList.react",["cx","OzHelpers","joinClasses","OzInboxThreadRow.react","immutable","OzLoading.react","OzImmutablePureRenderMixin","React","OzWrapper.react"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("immutable").Map,j=c("immutable").OrderedMap,k=c("React").PropTypes,l=c("OzLoading.react").Inline,m=c("React").createClass({displayName:"OzInboxThreadList",mixins:[c("OzImmutablePureRenderMixin")],contextTypes:{uid:k.string.isRequired},propTypes:{loading:k.bool.isRequired,onThreadClick:k.func.isRequired,onUnview:k.func.isRequired,threadGroups:k.instanceOf(j).isRequired,witIntents:k.instanceOf(i).isRequired,className:k.string,selectedThread:k.string},render:function o(){var p=this.props.threadGroups.some(function(q){return q.count()});return c("React").createElement("div",{className:c("joinClasses")("_36ob",this.props.className)},p?c("React").createElement(l,{key:"l",loading:this.props.loading}):c("React").createElement(n,null),p?this.props.threadGroups.map(this._renderRows).valueSeq():null)},_renderRows:function o(p,q){var r=p.map(function(s){return c("React").createElement(c("OzInboxThreadRow.react"),{key:c("OzHelpers").threadID(s),thread:s,locker:this.props.reps.get(s.get("locker-id"),i()),owned:c("OzHelpers").isOwner(s,this.context.uid),selected:c("OzHelpers").threadID(s)===this.props.selectedThread,subscribed:c("OzHelpers").isSubscriber(s,this.context.uid),onClick:this.props.onThreadClick,onUnview:this.props.onUnview,witIntents:this.props.witIntents})}.bind(this)).valueSeq();return c("React").createElement("span",{className:"_36oc",key:q},r)}});function n(){return c("React").createElement("div",{className:"_725"},"You do not own any threads at the moment.",c("React").createElement("br",null))}f.exports=c("OzWrapper.react")(m)}),null);
__d("OzTabHeader.react",["cx","React"],(function a(b,c,d,e,f,g,h){function i(j){var k=j.tabs,l=j.onChange,m=j.active;return c("React").createElement("div",{className:"_2j6l"},k.map(function(n){var o=n[0],p=n[1];return c("React").createElement("button",{key:p,role:"button",className:"_1-hv _2j6m"+(p===m?" _2j6n":""),onClick:function q(r){return l([o,p])}},o)}))}f.exports=i}),null);
__d("OzInbox.react",["cx","OzAPI","OzHelpers","DataTransfer","immutable","OzActions","OzInboxThreadList.react","OzInboxThreads","OzStores","OzTabHeader.react","ReactComponentWithPureRenderMixin","React","OzWrapper.react","Reflux","promiseFinally"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").Map,l=c("immutable").OrderedMap,m=c("immutable").List,n=c("OzStores").HandledEventsStore,o=c("OzStores").HumanStore,p=c("OzStores").ThreadStore,q=c("React").PropTypes,r=c("OzInboxThreads").OZ_GRABBED_TAB,s=c("OzInboxThreads").OZ_VIEWING_TAB,t=c("OzInboxThreads").OZ_PAST_TAB,u=5e3,v=3e4,w=120*1e3,x=r,y=c("React").createClass({displayName:"OzInbox",mixins:[c("ReactComponentWithPureRenderMixin"),c("Reflux").connect(p,"threads"),c("Reflux").connect(o,"humans"),c("Reflux").connect(n,"handledEvents")],contextTypes:{uid:q.string.isRequired,router:q.object.isRequired},getInitialState:function D(){return{activeTab:null,loading:false}},componentDidMount:function D(){__p&&__p();this._fetchThreads();var E=window.setInterval(function(G){this._fetchThreads()}.bind(this),v),F=window.setInterval(function(){var G=this.threads(this._getActiveTab());if(G.some(function(H){return H.get("ui-reassign")}))c("OzActions").clearReassignState()}.bind(this),u);this._cleanup=function(){x=this._getActiveTab();window.clearInterval(F);window.clearInterval(E)}.bind(this)},componentDidUpdate:function D(E,F){var G=this.props.params.threadid;if(!G){var H=this.threads(),I=c("OzStores").ActiveThreadStore.data.get("oldThreadID"),J=H.get(I)||H.first();if(J){c("OzHelpers").info("[ozinbox] search for best thread, found:",J);this.context.router.push("/inbox/"+c("OzHelpers").threadID(J))}}},componentWillUnmount:function D(){this._cleanup()},render:function D(){var E=this._getActiveTab(),F=this.threads(E),G=this.state.humans.getIn([this.context.uid,"load"],0),H=function H(I){return I.preventDefault()};return c("React").createElement("div",{className:"_4b5_",onDragStart:H,onDragEnd:H,onDragOver:H,onDrop:function I(J){H(J);var K=new(c("DataTransfer"))(J.nativeEvent.dataTransfer);c("OzActions").updateComposer({files:K.getFiles()})}},c("React").createElement(z,{threadGroups:B(F,this.context.uid,E),reps:this.props.reps,loading:this.state.loading,activeCount:G,activeTab:E,selectedThread:this.props.params.threadid,onTabChange:this._handleTabChange,onUnview:this._handleUnview,onThreadClick:this._handleThreadClick,witIntents:this.props.witIntents}),this._renderDetails())},_getActiveTab:function D(){var E=this.state.threads.get(this.props.params.threadid);return this.state.activeTab||E&&c("OzHelpers").isOwner(E,this.context.uid)&&r||E&&c("OzHelpers").isSubscriber(E,this.context.uid)&&s||x||r},_handleUnview:function D(E){this._callAPIAndShift("unview",E)},_handleThreadClick:function D(E){c("OzHelpers").info("[inbox/handleThreadClick] clicked on thread",c("OzHelpers").threadID(E));var F=c("OzHelpers").nextTaskForThread(E);this.context.router.push(c("OzHelpers").threadPath({threadid:c("OzHelpers").threadID(E),intentid:F&&F.get("intent-id"),taskid:F&&F.get("id")}))},_handleTabChange:function D(E){var F=E[0],G=E[1];this.setState({activeTab:G})},_callAPIAndShift:function D(E,F){var G=A(this.threads(r),F),H=function(F){c("OzHelpers").info("[inbox/callAPIAndShift] shifting to thread",c("OzHelpers").threadID(F));this.context.router.push("/inbox/"+c("OzHelpers").threadID(F))}.bind(this),I=c("OzAPI")[E](c("OzHelpers").threadID(F));G&&H(G);I.done(null,function(J){c("OzHelpers").error("[inbox] could not shift",J);H(F)})},_renderDetails:function D(){var E=this.props.params.threadid;if(!E&&this.threads().isEmpty())return this._renderFinished();var F=c("OzHelpers").fullThreadData(this.state.threads,this.state.handledEvents,E);if(!F||!this.props.children)return null;return c("React").cloneElement(this.props.children,{thread:F,witIntents:this.props.witIntents,requirements:this.props.requirements,merchants:this.props.merchants,humans:this.state.humans,reps:this.props.reps})},_renderFinished:function D(){return c("React").createElement("div",{className:"_57l3"},c("React").createElement("div",{className:"_57l8"},c("React").createElement("div",{className:"_57lo"}),c("React").createElement("h2",null,"Congrats! You've made a lot of people happy"),c("React").createElement("p",null,"Sit tight, new messages should be coming soon!")))},_fetchThreads:function D(){var E=this.state.loading;if(E)return;this.setState({loading:true});c("promiseFinally")(c("OzAPI").myThreads(),function(F){return this.isMounted()&&this.setState({loading:false})}.bind(this)).done()},threads:function D(E){return c("OzInboxThreads").getInboxThreads(this.state.threads,this.context.uid,E)}});i=babelHelpers.inherits(z,c("React").PureComponent);j=i&&i.prototype;z.prototype.render=function(){"use strict";var D=this.props,E=D.activeTab,F=D.onTabChange,G=D.activeCount,H=babelHelpers.objectWithoutProperties(D,["activeTab","onTabChange","activeCount"]),I=G?"Open ("+G+")":"Open";return c("React").createElement("div",{className:"_4b61"},c("React").createElement("div",{className:"_4cwh"},c("React").createElement(c("OzTabHeader.react"),{active:E,tabs:[[I,r],["Viewing",s],["Closed",t]],onChange:F})),c("React").createElement("div",{className:"_3_cz"},c("React").createElement("div",{className:"_4fj7"},c("React").createElement(c("OzInboxThreadList.react"),babelHelpers["extends"]({className:E===r?"_2sav":""},H)))))};function z(){"use strict";i.apply(this,arguments)}z.propTypes=babelHelpers["extends"]({activeTab:q.oneOf([r,s,t]).isRequired,onTabChange:q.func.isRequired},c("OzInboxThreadList.react").propTypes);function A(D,E){var F=c("OzHelpers").threadID(E),G=D.toList(),H=G.findIndex(function(K){return c("OzHelpers").threadID(K)===F}),I=H-1,J=H+1;if(J<G.count())return G.get(J);else if(I>=0)return G.get(I)}function B(D,E,F){var G;switch(F){case r:return C(D,E,F);default:return l((G={},G[F]=D,G))}}function C(D,E,F){__p&&__p();var G="Needs Attention",H="Up For Grabs",I="Waiting",J=function J(K){var L=c("OzHelpers").isOwner(K,E),M=K.get("ready")||c("OzHelpers").hasPaid(K)||c("OzHelpers").hasReminder(K),N=c("OzHelpers").isLocker(K,E),O=c("OzHelpers").hasOpenIntents(K);return L&&(N||M&&O)?G:M?H:I};return l().withMutations(function(K){K.set(G,[]);K.set(H,[]);K.set(I,[]);D.forEach(function(L){return K.update(J(L),function(M){M.push(L);return M})})}).map(function(K){return m(K)})}f.exports=c("OzWrapper.react")(y)}),null);
__d("StickerContextualDialog.react",["cx","ContextualLayerAutoFlipHorizontal","ReactAbstractContextualDialog","ReactLayer"],(function a(b,c,d,e,f,g,h){"use strict";var i=7,j=c("ReactLayer").createClass(c("ReactAbstractContextualDialog").createSpec({addedBehaviors:[c("ContextualLayerAutoFlipHorizontal")],displayName:"StickerXUIContextualDialog",theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:i,length:16}}}));j.WIDTH={NORMAL:312,WIDE:400};f.exports=j}),null);
__d("ChatStickerButton.react",["cx","fbt","BootloadedComponent.react","JSResource","Link.react","React","StickerContextualDialog.react","StickersActions","StickersStateStore","XUISpinner.react","emptyFunction","joinClasses"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("React").PropTypes,m=278;j=babelHelpers.inherits(n,c("React").PureComponent);k=j&&j.prototype;function n(o){__p&&__p();k.constructor.call(this,o);this.$ChatStickerButton1=false;this.renderLayers=function(){if(!this.state.shown)return null;var p=this.props.ContextualDialogClass;return c("React").createElement(p,{alignment:this.props.flyoutAlignment,className:"_5e-r",contextRef:function(){return this.refs.link}.bind(this),onBeforeHide:this.$ChatStickerButton5,onBlur:this.$ChatStickerButton3,position:"above",shown:this.state.shown,width:this.props.flyoutWidth,key:"contextualDialog"},c("React").createElement(c("BootloadedComponent.react"),{bootloadPlaceholder:c("React").createElement("div",{style:{padding:"30px",textAlign:"center"}},c("React").createElement(c("XUISpinner.react"),{size:"large"})),bootloadLoader:c("JSResource")("StickersFlyout.react").__setRef("ChatStickerButton.react"),className:this.props.flyoutClassName,onShown:function(q){if(this.props.onFlyoutShown)this.props.onFlyoutShown(q)}.bind(this),onHidden:function(){if(this.props.onFlyoutHidden)this.props.onFlyoutHidden()}.bind(this),onEscKeyDown:this.$ChatStickerButton3,onStickerSelect:this.$ChatStickerButton6,onEmoticonSelect:this.$ChatStickerButton7,shown:this.state.shown}))}.bind(this);this.$ChatStickerButton4=function(){this.$ChatStickerButton1=this.state.shown}.bind(this);this.showFlyout=function(p){p&&p.stopPropagation();if(this.$ChatStickerButton1||this.props.disabled){this.$ChatStickerButton1=false;return}c("StickersActions").showStickerFlyout(this.props.threadID)}.bind(this);this.$ChatStickerButton5=function(){if(this.state.shown)this.$ChatStickerButton3()}.bind(this);this.$ChatStickerButton3=function(){c("StickersActions").hideStickerFlyout()};this.$ChatStickerButton6=function(p){this.props.onStickerSelect(p)}.bind(this);this.$ChatStickerButton7=function(p){this.$ChatStickerButton3();this.props.onEmoticonSelect(p)}.bind(this);this.state={shown:!!o.clicked}}n.prototype.componentDidMount=function(){__p&&__p();this.props.onLoad&&this.props.onLoad(this);this.$ChatStickerButton2=c("StickersStateStore").addListener(function(){__p&&__p();var o=c("StickersStateStore").getState();if(o.get("showFlyout")&&o.get("threadID")===this.props.threadID){if(this.$ChatStickerButton1||this.props.disabled){this.$ChatStickerButton1=false;return}this.setState({shown:true})}else{var p=this.props.getInput&&this.props.getInput();p&&p.focus&&p.focus();this.setState({shown:false})}}.bind(this))};n.prototype.componentWillUnmount=function(){if(this.state.shown)this.$ChatStickerButton3();this.$ChatStickerButton2&&this.$ChatStickerButton2.remove()};n.prototype.render=function(){return c("React").createElement("span",null,c("React").createElement(c("Link.react"),{className:c("joinClasses")(this.props.className,this.state.shown?"open":""),href:"#",onClick:this.showFlyout,onMouseDown:this.$ChatStickerButton4,role:"button",title:i._("Choose a sticker"),ref:"link"}),this.renderLayers())};n.propTypes={className:l.string,clicked:l.bool,ContextualDialogClass:l.func.isRequired,disabled:l.bool,flyoutClassName:l.string,flyoutWidth:l.number,getInput:l.func,onLoad:l.func,onStickerSelect:l.func.isRequired,onEmoticonSelect:l.func.isRequired,onFlyoutShown:l.func,onFlyoutHidden:l.func,threadID:l.string};n.defaultProps={clicked:false,ContextualDialogClass:c("StickerContextualDialog.react"),disabled:false,flyoutWidth:m,onStickerSelect:c("emptyFunction"),onEmoticonSelect:c("emptyFunction")};f.exports=n}),null);
__d("PhotocropConstraintConstants",[],(function a(b,c,d,e,f,g){var h={BOUNDARY:"boundary",SQUARE:"square",WIDE:"wide"};h.getAspectRatioForType=function(i){switch(i){case h.SQUARE:return 1;case h.WIDE:return 16/9;default:return null}};f.exports=h}),null);
__d("PhotocropConstraint",["Vector","PhotocropConstraintConstants","clamp"],(function a(b,c,d,e,f,g){__p&&__p();var h,i,j,k;function l(p){"use strict";this.photocrop=p;this.pos=null}l.prototype.onMouseMove=function(p,q,r){"use strict";var s=p.sub(this.pos);if(q)this.onResize(s,r);else this.onMove(s);this.pos=this.pos.add(s)};l.prototype.onMouseDown=function(p){"use strict";this.pos=p};l.prototype.onResize=function(p,q){"use strict"};l.prototype.onMove=function(p){"use strict";var q=this.photocrop.box,r=this.photocrop.wrapper.offsetWidth,s=this.photocrop.wrapper.offsetHeight;p.x=c("clamp")(p.x,-q.l,r-q.r);p.y=c("clamp")(p.y,-q.t,s-q.b);this.photocrop.box=q.add(p)};h=babelHelpers.inherits(m,l);i=h&&h.prototype;m.prototype.onResize=function(p,q){"use strict";__p&&__p();var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight;switch(q){case"ne":t.r+=p.x=c("clamp")(p.x,t.l+r-t.r,u-t.r);t.t+=p.y=c("clamp")(p.y,-t.t,t.b-s-t.t);break;case"nw":t.l+=p.x=c("clamp")(p.x,-t.l,t.r-r-t.l);t.t+=p.y=c("clamp")(p.y,-t.t,t.b-s-t.t);break;case"se":t.r+=p.x=c("clamp")(p.x,t.l+r-t.r,u-t.r);t.b+=p.y=c("clamp")(p.y,t.t+s-t.b,v-t.b);break;case"sw":t.l+=p.x=c("clamp")(p.x,-t.l,t.r-r-t.l);t.b+=p.y=c("clamp")(p.y,t.t+s-t.b,v-t.b);break}};function m(){"use strict";h.apply(this,arguments)}j=babelHelpers.inherits(n,l);k=j&&j.prototype;n.prototype.setRatio=function(p){"use strict";this.ratio=p;return this};n.prototype.onMouseDown=function(p){"use strict";k.onMouseDown.call(this,p);var q=this.photocrop.box,r=q.r-q.l,s=q.b-q.t;this.displacement=new(c("Vector"))(r,s)};n.prototype.$AspectRatioConstraint1=function(p,q,r,s,t,u){"use strict";__p&&__p();var v,w,x,y,z;v=this.displacement.x/this.displacement.y;w=y=c("clamp")(q,p,r);x=z=c("clamp")(t,s,u);if(v>this.ratio){x=c("clamp")(w/this.ratio,s,u);w=x*this.ratio}else{w=c("clamp")(x*this.ratio,p,r);x=w/this.ratio}return new(c("Vector"))(w,x)};n.prototype.onResize=function(p,q){"use strict";__p&&__p();var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight,w;switch(q){case"ne":this.displacement=this.displacement.add(p.x,-p.y);w=this.$AspectRatioConstraint1(r,this.displacement.x,u-t.l,s,this.displacement.y,t.b);t.r=t.l+w.x;t.t=t.b-w.y;break;case"nw":this.displacement=this.displacement.add(-p.x,-p.y);w=this.$AspectRatioConstraint1(r,this.displacement.x,t.r,s,this.displacement.y,t.b);t.l=t.r-w.x;t.t=t.b-w.y;break;case"se":this.displacement=this.displacement.add(p.x,p.y);w=this.$AspectRatioConstraint1(r,this.displacement.x,u-t.l,s,this.displacement.y,v-t.t);t.r=t.l+w.x;t.b=t.t+w.y;break;case"sw":this.displacement=this.displacement.add(-p.x,p.y);w=this.$AspectRatioConstraint1(r,this.displacement.x,t.r,s,this.displacement.y,v-t.t);t.l=t.r-w.x;t.b=t.t+w.y;break}};function n(){"use strict";j.apply(this,arguments)}function o(p,q){var r;switch(q){case c("PhotocropConstraintConstants").BOUNDARY:r=new m(p);break;case c("PhotocropConstraintConstants").WIDE:case c("PhotocropConstraintConstants").SQUARE:r=new n(p).setRatio(c("PhotocropConstraintConstants").getAspectRatioForType(q));break;default:throw Error("unsupported PhotocropConstraint type")}return r}f.exports=o}),null);
__d("Photocrop2",["ArbiterMixin","PhotocropConstraintConstants","CSS","DOM","Event","PhotosConst","Rect","Style","Vector","mixin","PhotocropConstraint"],(function a(b,c,d,e,f,g){__p&&__p();var h,i;h=babelHelpers.inherits(j,c("mixin")(c("ArbiterMixin")));i=h&&h.prototype;function j(k,l,m){"use strict";__p&&__p();i.constructor.call(this);this.photo=k;var n=this.getPhotoDimensions();if(m)this.imageDimensions=new(c("Vector"))(m.x,m.y);else this.imageDimensions=new(c("Vector"))(n.x,n.y);l.height=l.height||c("PhotosConst").PIC_NORMAL_FBX_SIZE;l.width=l.width||c("PhotosConst").PIC_NORMAL_FBX_SIZE;Object.assign(this,{target:this.photo.parentNode,create_target:false,target_parent:this.photo.parentNode,min_width:c("PhotosConst").PIC_NORMAL_FBX_SIZE,min_height:c("PhotosConst").PIC_NORMAL_FBX_SIZE,center_x:(n.x||l.width)/2,center_y:(n.y||l.height)/2,constraint_type:c("PhotocropConstraintConstants").BOUNDARY},l);this._unscaledMinHeight=this.min_height;this._unscaledMinWidth=this.min_width;this._unscaledHeight=this.height;this._unscaledWidth=this.width;this.setInitialDimensionsAndPos();if(this.create_target){this.target=c("DOM").create("div");c("CSS").addClass(this.target,"stageCropper");this.target_parent.appendChild(this.target)}c("CSS").addClass(this.target,"photocrop");["bg","wrapper","viewport"].forEach(function(o){this[o]=c("DOM").create("div");c("CSS").addClass(this[o],o)}.bind(this));this.highlight=c("DOM").create("img");c("CSS").addClass(this.highlight,"highlight");this.setHighlightSource();c("CSS").addClass(this.wrapper,"photocropWrapper");this.target.appendChild(this.bg);this.target.appendChild(this.wrapper);this.wrapper.appendChild(this.highlight);this.wrapper.appendChild(this.viewport);["ne","nw","sw","se"].forEach(function(o){var p=c("DOM").create("div");c("CSS").addClass(p,o);p.setAttribute("data-cropcorner",o);this.viewport.appendChild(p);c("CSS").addClass(p,"profilePicViewportGrabby")}.bind(this));c("Event").listen(this.viewport,{mousedown:this.mousedown.bind(this),dragstart:c("Event").kill,selectstart:c("Event").kill,click:c("Event").stop});c("Event").listen(document,{mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)});c("Event").listen(window,{resize:this.adjustForResize.bind(this)});this.realignToPictureSize();this.redraw()}j.prototype.setInitialDimensionsAndPos=function(){"use strict";__p&&__p();this._constraint=c("PhotocropConstraint")(this,this.constraint_type);var k=c("PhotocropConstraintConstants").getAspectRatioForType(this.constraint_type),l=this.getPhotoDimensions();if(k){this._unscaledMinHeight=this._unscaledMinWidth/k;this._unscaledHeight=this._unscaledWidth/k}this.setNewRatio();var m=Math.min(this.width,l.x),n=Math.min(this.height,l.y);this.min_width=Math.min(this.min_width,l.x);this.min_height=Math.min(this.min_height,l.y);if(k)if(l.x/l.y>k){n=Math.min(n,l.y);m=n*k;this.min_width=this.min_height*k}else{m=Math.min(m,l.x);n=m/k;this.min_height=this.min_width/k}var o=this.center_x-m/2,p=this.center_y-n/2;this.box=new(c("Rect"))(p,o+m,p+n,o)};j.prototype.getPhotoDimensions=function(){"use strict";return new(c("Vector"))(Math.round(parseFloat(c("Style").get(this.photo,"width"))),Math.round(parseFloat(c("Style").get(this.photo,"height"))))};j.prototype.getPhotoPosition=function(){"use strict";return new(c("Vector"))(this.photo.offsetLeft,this.photo.offsetTop)};j.prototype.setHighlightSource=function(){"use strict";this.highlight.src=this.photo.src};j.prototype.setConstraintType=function(k){"use strict";this.constraint_type=k;this.setInitialDimensionsAndPos();this.adjustForResize()};j.prototype.adjustForResize=function(){"use strict";var k=this.ratio,l=this.setNewRatio(),m=l/k;this.box.t*=m;this.box.l*=m;this.box.b*=m;this.box.r*=m;this.redraw();this.realignToPictureSize()};j.prototype.setNewRatio=function(){"use strict";this.ratio=this.getPhotoDimensions().x/this.imageDimensions.x;this.min_width=this.ratio*this._unscaledMinWidth;this.min_height=this.ratio*this._unscaledMinHeight;this.width=Math.max(1,this.ratio)*this._unscaledWidth;this.height=Math.max(1,this.ratio)*this._unscaledHeight;return this.ratio};j.prototype.realignToPictureSize=function(){"use strict";__p&&__p();var k=this.photo;if(!k)return;var l=this.getPhotoDimensions(),m=this.getPhotoPosition();[this.bg,this.wrapper].forEach(function(n){n.style.width=l.x+"px";n.style.height=l.y+"px";n.style.top=m.y+"px";n.style.left=m.x+"px"})};j.prototype.redraw=function(){"use strict";var k=[this.box.t,this.box.r,this.box.b,this.box.l],l=this.getPhotoDimensions();this.highlight.style.width=l.x+"px";this.highlight.style.height=l.y+"px";this.highlight.style.clip="rect("+k.join("px ")+"px)";this.viewport.style.top=this.box.t+"px";this.viewport.style.left=this.box.l+"px";this.viewport.style.height=this.box.b-this.box.t+"px";this.viewport.style.width=this.box.r-this.box.l+"px"};j.prototype.done=function(k){"use strict";__p&&__p();this.freezeViewport=true;if(!k){[this.bg,this.wrapper].forEach(c("DOM").remove);if(this.create_target){c("DOM").remove(this.target);this.target=null}else c("CSS").removeClass(this.target,"photocrop")}var l=Math.round(this.box.l*(1/this.ratio)),m=Math.round(this.box.t*(1/this.ratio)),n=Math.round(this.box.r*(1/this.ratio)),o=Math.round(this.box.b*(1/this.ratio));this.inform("done",k);return{x:Math.max(l,0),y:Math.max(m,0),width:n-Math.max(l,0),height:o-Math.max(m,0)}};j.prototype.reset=function(){"use strict";this.freezeViewport=false};j.prototype.mousedown=function(k){"use strict";if(this.freezeViewport)return;this.mouseTarget=k.getTarget();this._constraint.onMouseDown(c("Vector").getEventPosition(k));c("CSS").addClass(document.body,"draggingMode");return false};j.prototype.mousemove=function(k){"use strict";if(!this.mouseTarget)return;this._constraint.onMouseMove(c("Vector").getEventPosition(k),this.mouseTarget!==this.viewport,this.mouseTarget.getAttribute("data-cropcorner"));this.redraw();return false};j.prototype.mouseup=function(k){"use strict";this.mouseTarget=null;c("CSS").removeClass(document.body,"draggingMode")};f.exports=j}),null);
__d("OzPhotoCropper.react",["cx","OzHelpers","BasicVector","Photocrop2","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;function l(){__p&&__p();var m,n;"use strict";for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.state={imageSize:null},this.finalizeCrop=function(r){var s=this.refs.canvas,t=this.$OzPhotoCropper2.done(r),u=t.x,v=t.y,w=t.height,x=t.width;s.width=x;s.height=w;s.getContext("2d").drawImage(this.$OzPhotoCropper1,Math.max(0,u),Math.max(0,v),x,w,0,0,x,w);return c("OzHelpers").blobFromDataURI(s.toDataURL())}.bind(this),n}l.prototype.componentDidMount=function(){"use strict";this.$OzPhotoCropper1=new Image();this.$OzPhotoCropper1.src=this.props.src;this.$OzPhotoCropper1.onload=function(m){var n=new(c("BasicVector"))(this.$OzPhotoCropper1.width,this.$OzPhotoCropper1.height);this.setState({imageSize:n});this.$OzPhotoCropper2=new(c("Photocrop2"))(this.refs.img,{},n)}.bind(this)};l.prototype.componentWillUnmount=function(){"use strict";this.$OzPhotoCropper1=null};l.prototype.render=function(){"use strict";return c("React").createElement("div",{className:"_3x2x"},c("React").createElement("canvas",{ref:"canvas",style:{display:"none"}}),c("React").createElement("img",{src:this.props.src,ref:"img",className:"_3x2y"}))};l.propTypes={src:k.string.isRequired};f.exports=l}),null);
__d("OzAttachmentCropper.react",["OzHelpers","DialogFitHeight","immutable","OzPhotoCropper.react","OzImmutablePureRenderMixin","React","XUIButton.react","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react"],(function a(b,c,d,e,f,g){var h=c("immutable").Map,i=c("immutable").OrderedMap,j=c("React").PropTypes,k=c("React").createClass({displayName:"OzAttachmentCropper",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{attachment:j.instanceOf(h).isRequired,onSave:j.func.isRequired,onClose:j.func.isRequired},_handleSubmit:function l(){var m=this.props,n=m.attachment,o=m.onSave,p=this.refs.photoCropper.finalizeCrop();o(n.set("ui-blob",p))},render:function l(){return c("React").createElement(c("XUIDialog.react"),{behaviors:{DialogFitHeight:c("DialogFitHeight")},onToggle:this.props.onClose,shown:true,width:900},c("React").createElement(c("XUIDialogTitle.react"),null,c("React").createElement("span",null,"Crop tool")),c("React").createElement(c("XUIDialogBody.react"),null,c("React").createElement(c("OzPhotoCropper.react"),{src:c("OzHelpers").blobURI(this.props.attachment.get("ui-blob")),ref:"photoCropper"})),c("React").createElement(c("XUIDialogFooter.react"),null,c("React").createElement(c("XUIButton.react"),{onClick:this._handleSubmit,label:"Crop"})))}});f.exports=k}),null);
__d("OzAttachmentOverlay.react",["cx","joinClasses","OzLoading.react","OzImmutablePureRenderMixin","React","XUICloseButton.react","XUIEditButton.react"],(function a(b,c,d,e,f,g,h){var i=c("React").PropTypes,j=c("React").createClass({displayName:"OzAttachmentOverlay",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onClick:i.func,onEdit:i.func,onRemove:i.func,loading:i.bool,className:i.string,children:i.any},render:function k(){var l=this.props,m=l.onClick,n=l.onEdit,o=l.onRemove,p=l.loading;return c("React").createElement("div",{className:c("joinClasses")(this.props.className,"_18wc")},p?c("React").createElement(c("OzLoading.react"),null):null,c("React").createElement("div",{className:"_4xe8",onClick:m,role:"presentation"},n?c("React").createElement(c("XUIEditButton.react"),{className:"_1yll",type:"button",size:"medium",title:"Add Image",onClick:this._handleEdit}):null,o?c("React").createElement(c("XUICloseButton.react"),{type:"button",className:"_1ylm",size:"medium",shade:"dark",onClick:this._handleRemove}):null),this.props.children)},_handleEdit:function k(l){l.stopPropagation();this.props.onEdit&&this.props.onEdit()},_handleRemove:function k(l){l.stopPropagation();this.props.onRemove&&this.props.onRemove()}});f.exports=j}),null);
__d("OzBubbleImageSelector.react",["cx","Image.react","immutable","OzAttachmentOverlay.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("immutable").List,j=c("React").PropTypes,k=c("React").createClass({displayName:"OzBubbleImageSelector",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onImageAdd:j.func.isRequired,onImageSelect:j.func.isRequired,selectedURI:j.string,thumbURIs:j.instanceOf(i).isRequired},render:function m(){var n=this.props,o=n.onImageSelect,p=n.selectedURI,q=n.thumbURIs;return c("React").createElement("div",{className:"_1-i2"},q.map(function(r,s){return c("React").createElement(l,{index:s,isSelected:r===p,key:s,onSelect:o,uri:r})}),this._renderAddButton())},_renderAddButton:function m(){return c("React").createElement("button",{type:"button",className:"_1-hv _1-i4",onClick:this.props.onImageAdd},"+")}}),l=c("React").createClass({displayName:"Thumbnail",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{index:j.number.isRequired,isSelected:j.bool.isRequired,uri:j.string.isRequired},render:function m(){return c("React").createElement(c("OzAttachmentOverlay.react"),{className:this.props.isSelected?"_4-8e":"",onClick:this._handleSelect},c("React").createElement(c("Image.react"),{src:this.props.uri,className:"_1-i3",alt:"image thumb"}))},_handleSelect:function m(){this.props.onSelect(this.props.uri)}});f.exports=k}),null);
__d("OzFormPreview.react",["cx","OzHelpers","joinClasses","React","Tooltip"],(function a(b,c,d,e,f,g,h){var i=c("OzHelpers").pure(function(k){var l=k.children;return c("React").createElement("div",{className:"_5bwr"},l)}),j=c("OzHelpers").pure(function(k){var l=k.label,m=k.tip,n=k.children,o=k.className;if(!n)return null;return c("React").createElement("div",{className:c("joinClasses")("_5bws _5bwt",o)},c("React").createElement("div",{className:"_5bwv"},l),c("React").createElement("div",babelHelpers["extends"]({className:"_5bx2"},c("Tooltip").propsFor(m)),n))});i.Row=j;f.exports=i}),null);
__d("OzBubblePreview.react",["cx","OzAPI","OzHelpers","formatDate","AdsCurrencyFormatter","immutable","OzConfig","OzFormPreview.react","OzStores","OzActions","OzConstants","OzImmutablePureRenderMixin","React","Reflux","ShimButton.react","TextWithHighlights.atlas","XUIContextualDialog.react"],(function a(aa,b,ba,ca,c,da,ea){__p&&__p();var d=b("OzConstants").ATTS,e=b("immutable").Map,f=b("immutable").List,g=b("React").PropTypes,h=b("OzFormPreview.react").Row,i=b("OzStores").AutopilotStore,j=b("React").createClass({displayName:"OzBubblePreview",mixins:[b("OzImmutablePureRenderMixin")],propTypes:{bubble:g.instanceOf(e).isRequired,highlight:g.string,meta:g.instanceOf(e),source:g.string},render:function Q(){return F(this.props)?b("React").createElement(o,this.props):b("React").createElement(k,this.props)}}),k=b("OzHelpers").pure(function(Q){var R=Q.bubble,S=Q.highlight,T=null;if(Number.isSafeInteger(R.get("amount")))T=b("AdsCurrencyFormatter").formatCurrencyFullFormat(R.get("currency"),R.get("amount"));return b("React").createElement(A,{thumbURL:R.get("thumb-url")},b("React").createElement(C,{text:R.get("name"),highlight:S}),b("React").createElement(D,null,b("React").createElement(E,{color:"grey",highlight:S},R.get("description")||"No Description")),b("React").createElement(D,null,b("React").createElement(E,null,R.get("merchant-name")||"No Merchant")),b("React").createElement(D,null,b("React").createElement(E,{color:"blue",weight:"bold"},T)))}),l="__overviewTab",m="__hoursTab",n="__moreInfoTab",o=b("React").createClass({displayName:"PlacesPreview",mixins:[b("OzImmutablePureRenderMixin"),b("Reflux").connect(i,"autopilot"),b("Reflux").connect(b("OzConfig").ConfigStore,"config")],propTypes:{bubble:g.instanceOf(e).isRequired,meta:g.instanceOf(e).isRequired,highlight:g.string},getInitialState:function Q(){return{shown:false,activeTab:l}},_makeOpentableRequest:function Q(R,S){if(!this.state.config.getIn(["GK","openTableAPI"])){var T=M(R);if(T){var U=q(R,S);if(!U)b("OzAPI").requestAutopilot(T.toJS())}}},componentWillMount:function Q(){this._makeOpentableRequest(this.props.meta,this.state.autopilot);window.clearTimeout(this.timeout)},componentWillReceiveProps:function Q(R){var S=R.meta;if(N(S)!==N(this.props.meta))this._makeOpentableRequest(S,this.state.autopilot)},_handleToggle:function Q(R){window.clearTimeout(this.timeout);var S=function(T){return this.setState({shown:R,activeTab:l})}.bind(this);R?S():this.timeout=window.setTimeout(S,100)},render:function Q(){var R=this.props,S=R.bubble,T=R.meta,U=R.highlight,V=this.state,W=V.shown,X=V.activeTab,Y=V.autopilot,Z=V.config;return b("React").createElement("div",{ref:"root",tabIndex:"0",onMouseEnter:function($){return this._handleToggle(true)}.bind(this),onMouseLeave:function($){return this._handleToggle(false)}.bind(this)},b("React").createElement(A,{thumbURL:S.get("thumb-url")},b("React").createElement(C,{text:S.get("name"),highlight:U}),b("React").createElement(p,{rating:T.get("rating")}),b("React").createElement(D,null,b("React").createElement(E,null,T.get("cuisine")),"\xa0",b("React").createElement(E,null,T.get("price"))),b("React").createElement(D,null,b("React").createElement(r,{meta:T,autopilot:Y}))),b("React").createElement(s,babelHelpers["extends"]({activeTab:X,contextRef:function($){return this.refs.root}.bind(this),onTabChange:this._handleTabChange,shown:W,onToggle:this._handleToggle,autopilot:Y,config:Z},this.props)))},_handleTabChange:function Q(R){this.setState({activeTab:R})}}),p=b("OzHelpers").pure(function(Q){var R=Q.rating;return R?b("React").createElement(D,null,b("React").createElement(E,{weight:"500"},R.get("value"),"/",R.get("scale"))," ",b("React").createElement(E,{color:"grey"},R.get("rating-count")?"("+R.get("rating-count")+" reviews)":null)):null}),q=function q(Q,R){var S=M(Q);if(S)if(b("OzConfig").getInStaticConfig(["GK","openTableAPI"]))return S.getIn(["data","times"]);else return R.get(S.getIn(["data","id"]));return null},r=b("OzHelpers").pure(function(Q){var R=Q.meta,S=Q.autopilot,T=M(R);if(!T)return b("React").createElement(E,null,"No OT info");var U=q(R,S);if(!U)return b("React").createElement(E,null,"Checking OT...");if(U.size===0)return b("React").createElement(E,{color:"red"},"No Tables Available!");return b("React").createElement(E,null,"Table at ",K(R,U))}),s=b("OzHelpers").pure(function(Q){var R=Q.activeTab,S=Q.contextRef,T=Q.meta,U=Q.onTabChange,V=Q.onToggle,W=Q.shown,X=babelHelpers.objectWithoutProperties(Q,["activeTab","contextRef","meta","onTabChange","onToggle","shown"]);return b("React").createElement(b("XUIContextualDialog.react"),{contextRef:S,hoverHideDelay:0,position:"above",shown:W,hasActionableContext:true},b("React").createElement("div",{className:"_53qb",onMouseEnter:function Y(Z){return V(true)},onMouseLeave:function Y(Z){return V(false)}},b("React").createElement("div",{className:"_c38"},b("React").createElement(t,babelHelpers["extends"]({meta:T},X)),b("React").createElement(z,{tabs:[["Overview",l],["Hours",m],["More Info",n]],active:R,onChange:U})),b("React").createElement(u,babelHelpers["extends"]({activeTab:R,meta:T},X))))}),t=b("OzHelpers").pure(function(Q){var R=Q.bubble,S=Q.meta,T=Q.highlight;return b("React").createElement("div",{className:"_53qc"},b("React").createElement(B,{url:R.get("thumb-url")}),b("React").createElement("div",{className:"_53qd"},b("React").createElement(C,{text:R.get("name"),highlight:T}),b("React").createElement(p,{rating:S.get("rating")}),b("React").createElement(D,null,b("React").createElement(E,null,S.get("cuisine"))),b("React").createElement(D,null,b("React").createElement(E,null,S.get("price")))))}),u=b("OzHelpers").pure(function(Q){var R=Q.activeTab,S=babelHelpers.objectWithoutProperties(Q,["activeTab"]);return b("React").createElement("div",{className:"_53qe"},R===l&&b("React").createElement(v,S)||R===m&&b("React").createElement(x,S)||R===n&&b("React").createElement(y,S)||null)}),v=b("OzHelpers").pure(function(Q){var R=Q.bubble,S=Q.highlight,T=Q.meta,U=Q.autopilot,V=Q.config,W=(T.getIn(["address","street"],"")+"\n     "+T.getIn(["address","city"],"")+"\n    ").trim();return b("React").createElement(b("OzFormPreview.react"),null,b("React").createElement(h,{label:"Address"},W),b("React").createElement(h,{label:"Phone"},w(R,T)),b("React").createElement(h,{label:"Website"},b("React").createElement("a",{href:R.get("target-url"),target:"_blank",rel:"noopener noreferrer"},"Link")),b("React").createElement(h,{label:"OpenTable"},H(R,T,U)),V.getIn(["GK","yelpLink"])?b("React").createElement(h,{label:"Yelp"},b("React").createElement("a",{href:T.get("yelp-url"),target:"_blank",rel:"noopener noreferrer"},"Link")):null,b("React").createElement(h,{label:"Description"},R.get("description")))}),w=function w(Q,R){var S=R.get("phone");return S?b("React").createElement(E,{weight:"bold"},b("OzHelpers").parsePhoneNumber(S)):null},x=b("OzHelpers").pure(function(Q){var R=Q.meta;return b("React").createElement(b("OzFormPreview.react"),null,J(R.get("hours")||f()).map(function(S,T){return b("React").createElement(h,{key:T,label:T},S)}).valueSeq())}),y=b("OzHelpers").pure(function(Q){__p&&__p();var R,S=Q.bubble,T=Q.meta,U=T.get("payment"),V=T.get("infos");if(U&&U.size||V&&V.size){var R=function(){var W=function W(X){return X[0].toUpperCase()+X.slice(1).toLowerCase()};return{v:b("React").createElement(b("OzFormPreview.react"),null,V.map(function(X,Y){return b("React").createElement(h,{label:W(Y),key:Y},X)}).toList(),U?b("React").createElement(h,{label:"Payments"},U.map(W).toJS().join(", ")):null)}}();if(typeof R==="object")return R.v}else return b("React").createElement("div",null,"No additional info for this place...")}),z=b("OzHelpers").pure(function(Q){var R=Q.tabs,S=Q.onChange,T=Q.active;return b("React").createElement("div",{className:"_c39"},R.map(function(U){var V=U[0],W=U[1],X=W===T?{weight:"bold",color:"blue"}:{color:"grey"};return b("React").createElement("button",{key:W,role:"button",className:"_1-hv",onClick:function Y(Z){return S(W)}},b("React").createElement(E,X,V))}))}),A=b("OzHelpers").pure(function(Q){var R=Q.children,S=Q.thumbURL;return b("React").createElement("div",{className:"_1q15 _5rxk"},b("React").createElement(B,{url:S}),b("React").createElement("div",{className:"_1q17"},R))}),B=b("OzHelpers").pure(function(Q){var R=Q.url;return R?b("React").createElement("div",{className:"_1q16",style:{backgroundImage:"url('"+R+"')"}}):null}),C=b("OzHelpers").pure(function(Q){var R=Q.text,S=Q.highlight;return b("React").createElement(D,null,b("React").createElement(E,{weight:"bold",highlight:S},R||"No Title"))}),D=b("OzHelpers").pure(function(Q){var R=Q.children;return b("React").createElement("div",{className:"_4-_7 _5rxl"},R)}),E=b("OzHelpers").pure(function(Q){var R=Q.children,S=Q.color,T=Q.highlight,U=Q.size,V=Q.weight,W=V===undefined?"normal":V;return R?b("React").createElement("span",{className:"_5rxm"+(U==="large"?" _5rxn":"")+(S==="blue"?" _5ryf":"")+(S==="grey"?" _5ryk":"")+(S==="red"?" _5emd":"")+(S==="green"?" _5emf":""),style:{fontWeight:W}},T?b("React").createElement(b("TextWithHighlights.atlas"),{text:R,highlight:T}):R):null});function F(Q){var R=Q.meta,S=Q.source;return S==="places"&&R}function G(Q,R,S){b("OzActions").selectAIPick(e({type:d.OPENTABLEQR,bubble:Q,meta:R,"ui-body":S.count()>1?"Here are available times for today: "+P(S):"The only available time for today is "+P(S),quickreplies:O(S)}))}function H(Q,R,S){__p&&__p();var T,U=R.get("open-table");if(U){var V,T=function(){var W=q(R,S);if(W)if(W.size===0)V=b("React").createElement(E,{color:"red"},"No tables available!");else V=b("React").createElement(E,null,"Tables available at "+P(W));return{v:b("React").createElement("div",null,b("React").createElement("a",{href:U.get("url"),target:"_blank",rel:"noopener noreferrer"},"Link (",U.get("area"),")"),b("React").createElement("br",null),V,W&&W.size?b("React").createElement("span",null,b("React").createElement("br",null),b("React").createElement(b("ShimButton.react"),{form:"link",onClick:function X(){return G(Q,R,W)}},"Suggest via quickreplies")):null)}}();if(typeof T==="object")return T.v}return null}var I=f(["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"]);function J(Q){__p&&__p();var R=function R(){var W=new Date(b("OzHelpers").serverNow());W.setHours(0,0,0,0);W.setDate(W.getDate()-W.getDay()+1);return+W},S=R(),T=function T(W){return new Date(S+W*60*1e3)},U=function U(W){return b("formatDate")(W,"h:i A",{skipPatternLocalization:true})},V=function V(W){return W.map(U).join(" - ")};return Q.map(function(W){return W.map(T)}).groupBy(function(W){return W.get("start").getDay()}).mapKeys(function(W){return I.get(W)}).map(function(W){return W.map(V).join(", ")})}function K(Q,R){var S=function S(U){var V=U.split(":"),W=V[0],X=V[1];return parseInt(X,10)+parseInt(W,10)*60},T=S(Q.getIn(["open-table","availability","data","hour"]));return L(R.map(function(U){return U.get("hour")}).minBy(function(U){return Math.abs(T-S(U))}))}function L(Q){var R=Q.split(":"),S=R[0],T=R[1];S=parseInt(S,10);if(S===0)return"12:"+T+"AM";else if(S<12)return Q+"AM";else if(S===12)return Q+"PM";else return S-12+":"+T+"PM"}function M(Q){return Q.getIn(["open-table","availability"])}function N(Q){return Q.getIn(["open-table","availability","data","id"])}function O(Q){var R=Q.count()>1?"None of these times work for me":"This time doesn't work for me";return Q.map(function(S){return L(S.get("hour"))}).push(R)}function P(Q){return Q.map(function(R){return L(R.get("hour"))}).toJS().join(", ")}c.exports=j}),null);
__d("OzMerchantDialog.react",["cx","OzHelpers","immutable","Layout.react","MessengerDialog.react","MessengerDialogHeader.react","MessengerDialogTitle.react","OzActions","React","ReactDOM","XUIDatePicker.react","XUIError.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("Layout.react").Column,l=c("Layout.react").FillColumn,m=c("React").PropTypes,n=c("immutable").Map,o=c("immutable").Set,p=o(["name-dba","name-legal","website","phone","address","page-id","country","type","owner-name"]),q=n({country:"US"});i=babelHelpers.inherits(r,c("React").Component);j=i&&i.prototype;function r(t){"use strict";j.constructor.call(this,t);s.call(this);var u=t.initialMerchant,v=q.filterNot(function(w,x){return u.get(x)});this.state={inputs:v,errors:n()}}r.prototype.componentDidMount=function(){"use strict";var t=c("ReactDOM").findDOMNode(this.refs["name-dba"]);t&&t.focus()};r.prototype.render=function(){"use strict";return c("React").createElement(c("MessengerDialog.react"),{className:"_18w8",onToggle:this.$OzMerchantDialog1,ref:"dialog",type:"default",width:544},c("React").createElement(c("MessengerDialogHeader.react"),null,c("React").createElement(c("MessengerDialogTitle.react"),null,this.props.title)),this.$OzMerchantDialog2(),c("React").createElement("div",null,this.$OzMerchantDialog3("Save",this.$OzMerchantDialog4),this.$OzMerchantDialog3("Cancel",c("OzActions").hideDialog)))};r.propTypes={onMerchant:m.func.isRequired,title:m.string,initialMerchant:m.instanceOf(n)};r.defaultProps={title:"Create a merchant",initialMerchant:n()};var s=function s(){__p&&__p();this.$OzMerchantDialog3=function(t,u){return c("React").createElement("button",{onClick:u,className:"_bx0 _3e2t _30yy"},t)};this.$OzMerchantDialog2=function(){return c("React").createElement("div",{className:"_374d _18w9"},this.$OzMerchantDialog5("name-dba","Name *"),this.$OzMerchantDialog5("name-legal","Legal Name"),this.$OzMerchantDialog5("website","Website"),this.$OzMerchantDialog5("phone","Phone"),this.$OzMerchantDialog5("address","Address"),this.$OzMerchantDialog5("page-id","Facebook Page Id"),this.$OzMerchantDialog5("country","Country *"),this.$OzMerchantDialog5("type","Business Type"),this.$OzMerchantDialog5("owner-name","Owner Name"),this.$OzMerchantDialog6("owner-birth-date","Owner Birth Date"))}.bind(this);this.$OzMerchantDialog5=function(t,u){var v=this.props.initialMerchant,w=this.state,x=w.inputs,y=w.errors;return c("React").createElement(c("Layout.react"),{key:t},c("React").createElement(k,{className:"mrm _bx1"},u),c("React").createElement(l,null,c("React").createElement(c("XUIError.react"),{xuiError:y.get(t)||null},c("React").createElement("input",{ref:t,type:"text",className:"_7q5 _bx2",defaultValue:v.get(t),value:x.get(t),onChange:function(z){this.setState({inputs:x.set(t,z.target.value),errors:n()})}.bind(this)}))))}.bind(this);this.$OzMerchantDialog6=function(t,u){var v={},w=this.props.initialMerchant,x=w.get("owner-birth-date");if(x)v.initialTime=x;return c("React").createElement(c("Layout.react"),{key:t},c("React").createElement(k,{className:"mrm _bx1"},u),c("React").createElement(k,null,c("React").createElement(c("XUIDatePicker.react"),babelHelpers["extends"]({ref:t,shouldSetDefaultDate:false},v))))}.bind(this);this.$OzMerchantDialog4=function(){var t=this.$OzMerchantDialog7();if(t){t.id=this.props.initialMerchant.get("id");this.props.onMerchant(t)}}.bind(this);this.$OzMerchantDialog1=function(t){if(!t)c("OzActions").hideDialog()};this.$OzMerchantDialog7=function(){__p&&__p();var t=n(),u=this.props.initialMerchant,v=function(y){var z=this.state.inputs.get(y,undefined);if(z===undefined)return u.get(y);return z||null}.bind(this);t=n(p.map(function(y){return[y,v(y)]})).set("id",u.get("id"));var w=this.refs["owner-birth-date"].state.selectTime;t=t.set("owner-birth-date",w);t=c("OzHelpers").normalizeMerchant(t);var x=c("OzHelpers").validateMerchant(t);this.setState({errors:x});if(!x.isEmpty())return null;return t}.bind(this)};f.exports=r}),null);
__d("OzSetPicURLDialog.react",["cx","getURLRanges","OzHelpers","Image.react","Keys","MessengerDialog.react","MessengerDialogHeader.react","MessengerDialogTitle.react","OzImmutablePureRenderMixin","React","ReactDOM"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("React").PropTypes,j=c("React").createClass({displayName:"OzSetPicURLDialog",mixins:[c("OzImmutablePureRenderMixin")],PropTypes:{onURL:i.func.isRequired,onEscape:i.func},componentDidMount:function k(){var l=c("ReactDOM").findDOMNode(this.refs.url);l&&l.focus()},getInitialState:function k(){return{errors:[],url:""}},render:function k(){return c("React").createElement(c("MessengerDialog.react"),{className:"_18w8",onToggle:this._handleToggle,ref:"dialog",type:"default",width:544},c("React").createElement(c("MessengerDialogHeader.react"),null,c("React").createElement(c("MessengerDialogTitle.react"),null,"Enter a URL for your picture")),this._renderImage(),this._renderErrors(),c("React").createElement("div",{className:"_374d _18w9"},c("React").createElement("input",{onChange:this._handleChange,onKeyDown:this._handleKeyDown,ref:"url",type:"text",className:"_7q5",placeholder:"URL to picture"})),c("React").createElement("div",{className:"_18wa"},"Press Enter when you're done."))},_renderImage:function k(){var l=this.state.url,m=this.state.errors||[];if(m.length>0||!l||l.length===0)return null;return c("React").createElement(c("Image.react"),{className:"_24p-",src:l})},_renderErrors:function k(){var l=this.state.errors;if(!l||l.length===0)return null;return c("React").createElement("div",{key:"errors",className:"_1yln"},l.map(function(m){var n=m[0],o=m[1];return c("React").createElement("div",{key:n,className:"_1ylp"},o)}))},_handleChange:function k(l){if(l.target.value.length&&!c("getURLRanges")(l.target.value).length){this.setState({errors:[["invalid_url","You must provide a valid uri"]]});return}var m=l.target.value.length?c("getURLRanges")(l.target.value)[0].entity.url:"";this.setState({errors:[],url:m})},_handleKeyDown:function k(l){__p&&__p();if(l.keyCode===c("Keys").ESC){var m=this.props.onEscape;if(m)m(l);return}var n=this.state.errors||[];if(n.length===0&&l.keyCode===c("Keys").RETURN){l.preventDefault();var o=l.target.value.length?c("getURLRanges")(l.target.value)[0].entity.url:"";this.props.onURL(o)}return},_handleToggle:function k(){c("OzHelpers").debug("[OzSetPicURLDialog] toggled",arguments)}});f.exports=j}),null);
__d("OzBubbleEditor.react",["cx","Promise","OzAPI","getURLRanges","OzHelpers","OzNotify","AdsCurrencyInput_DEPRECATED.react","immutable","Keys","OzActions","OzBubbleImageSelector.react","OzBubblePreview.react","OzConfig","OzMerchantDialog.react","OzSearchSource","OzSetPicURLDialog.react","OzImmutablePureRenderMixin","React","Reflux","SearchableDropdownInput.contrib","SearchableEntry","ShimButton.react","XUICloseButton.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").List,j=c("immutable").Map,k=c("React").PropTypes,l=["thumb-url"],m=["thumb-urls"],n=q("No Merchant"),o=69,p=c("React").createClass({displayName:"OzBubbleEditor",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{merchants:k.instanceOf(j).isRequired,seedBubble:k.instanceOf(j).isRequired,onSave:k.func.isRequired,onClose:k.func.isRequired},getInitialState:function u(){return{newData:j()}},componentWillMount:function u(){this._searchSource=new(c("OzSearchSource"))(function(v){var w=v.query||"",x=this.props.merchants.valueSeq().filter(function(y){return y.get("name-dba").toLowerCase().indexOf(w.toLowerCase())>-1}).map(function(y){return q(y.get("name-dba"))}).take(15).toArray();return c("Promise").resolve(this._data().get("merchant-name")?[n].concat(x):x)}.bind(this))},componentDidMount:function u(){this.focus("Title")},focus:function u(v){this.refs[v]&&this.refs[v].focus&&this.refs[v].focus()},render:function u(){return c("React").createElement("div",{className:"_1-ht"},c("React").createElement("div",{className:"_2zfj"},this._renderSection("Preview",this._renderPreview)),c("React").createElement("form",{className:"_2zfk",onKeyDown:function(v){v.keyCode===c("Keys").ESC&&this.props.onClose(this._bubble())}.bind(this),onSubmit:function(v){v.stopPropagation();v.preventDefault();this._handleSubmit()}.bind(this)},c("React").createElement(c("XUICloseButton.react"),{className:"_1-hu",shade:"dark",size:"medium",onClick:function(v){return this.props.onClose(this._bubble())}.bind(this)}),this._renderSection("Image",this._renderImage),this._renderSection("Title",this._renderInput.bind(this,["name"])),this._renderSection("Description",this._renderDescription),this._renderSection("URL",this._renderInput.bind(this,["target-url"])),this._renderSection("Merchant",this._renderMerchant),this._renderSection("Price",this._renderPrice),this._renderSubmit()))},_bubble:function u(){return this.props.seedBubble.set("data",this._data()).deleteIn(["data","thumb-urls"])},_data:function u(){var v=this.state.newData.updateIn(m,function(w){var x=this.props.seedBubble.getIn(["data"].concat(m));return(x||i()).concat(w)}.bind(this));return this.props.seedBubble.get("data").merge(v)},_handleSubmit:function u(){__p&&__p();var v=this._bubble(),w=v.get("data"),x=[[w.get("name"),"Please enter a title."],[w.get("expires-in")||!w.get("expiration-time"),"Since this bubble is old, please re-enter the expiration time."],[c("OzHelpers").validateURL(w.get("target-url")),'Please enter a valid url. Usually, you need to add "www."'],[c("OzHelpers").validateURL(w.get("thumb-url"))||!w.get("thumb-url"),"Please enter a valid url for your image."],[w.get("merchant-name")||!w.get("amount"),"You need to specify a merchant if you've listed a price."],[w.get("amount")||!w.get("expires-in"),"You need to list a price if you've set an expiration time."]].filter(function(y){var z=y[0],A=y[1];return!z}).map(function(y){var z=y[0],A=y[1];return A});if(x.length){c("OzNotify").error(x[0]);return}this.props.onSave(v.updateIn(["data","target-url"],function(y){return c("getURLRanges")(y)[0].entity.url}))},_handleCreateMerchant:function u(){c("OzActions").showDialog(c("OzMerchantDialog.react"),{onMerchant:function(v){c("OzAPI").createMerchant(v);var w=this.state.newData.set("merchant-name",v.get("name-dba"));this.setState({newData:w});c("OzActions").hideDialog()}.bind(this)})},_handleAddImage:function u(){c("OzActions").showDialog(c("OzSetPicURLDialog.react"),{onEscape:function(v){c("OzActions").hideDialog();this.focus("Title")}.bind(this),onURL:function(v){c("OzActions").hideDialog();this.setState(function(w){return{newData:t(w.newData,v)}});this.focus("Title")}.bind(this)})},_handleSelectImage:function u(v){this.setState(function(w){return{newData:w.newData.setIn(l,v)}})},_renderSubmit:function u(){return c("React").createElement("button",{type:"submit",className:"_1-hv _1-hw"},"DONE")},_renderSection:function u(v,w){return c("React").createElement("div",{className:"_1-hx"},c("React").createElement("div",{className:"_1-hz",onClick:function(x){return this.focus(v)}.bind(this),role:"presentation"},v),c("React").createElement("div",{className:"_1-h-"},w(v)))},_renderPrice:function u(v){var w=this._data(),x=w.get("currency"),y=w.get("amount");return c("React").createElement("div",{className:"_1-h_"},c("React").createElement(c("AdsCurrencyInput_DEPRECATED.react"),{placeholder:"(optional)",currency:x||"USD",value:Number.isSafeInteger(y)?y:null,onDataUpdate:function(y){this.setState({newData:w.set("amount",y)})}.bind(this),eventType:"change"}),this._renderExpiration())},_renderExpiration:function u(){if(!this.state.config.getIn(["GK","expirationDate"]))return null;return c("React").createElement("div",{className:"_51w3"},c("React").createElement("div",{className:"_1-hz"},"Expiration Time:"),c("React").createElement(s,{expiresIn:this._data().get("expires-in"),onChange:function(v){return this.setState({newData:this.state.newData.set("expires-in",v)})}.bind(this)}))},_renderInput:function u(v,w){var x=this.state.newData;return c("React").createElement("input",{ref:w,type:"text",className:"_1-i0 _1-i1",value:this._data().getIn(v),onChange:function(y){return this.setState({newData:x.setIn(v,y.target.value)})}.bind(this)})},_renderImage:function u(){var v=this._data(),w=v.getIn(l),x=r(v,w);return c("React").createElement(c("OzBubbleImageSelector.react"),{onImageAdd:this._handleAddImage,onImageSelect:this._handleSelectImage,selectedURI:w,thumbURIs:x})},_renderMerchant:function u(){var v=this._data(),w=v.get("merchant-name"),x=w?q(w):null;return c("React").createElement("div",{className:"_1-i5"},c("React").createElement("div",{className:"_1-i6"},c("React").createElement(c("SearchableDropdownInput.contrib"),{divClassName:"_1-i7",value:x,onSelect:function(y){var z=y.getUniqueID()===n.getUniqueID()?null:y.getTitle(),A=this.state.newData.set("merchant-name",z);this.setState({newData:A})}.bind(this),emptySearchResultsText:"No merchants found. Click + to add",placeholder:"Pick a Merchant (optional)",searchSource:this._searchSource})),c("React").createElement(c("ShimButton.react"),{className:"_1-hv _4nd4 _1-i8",onClick:this._handleCreateMerchant}))},_renderPreview:function u(){return c("React").createElement(c("OzBubblePreview.react"),{bubble:this._data()})},_renderDescription:function u(){var v=this._data(),w=v.get("description"),x=w&&w.length>o;return c("React").createElement("div",null,c("React").createElement("input",{ref:"description",type:"text",className:"_1-i0 _1-i1",value:w,onChange:function(y){return this.setState({newData:v.set("description",y.target.value)})}.bind(this)}),c("React").createElement("text",{className:x?"_353q":""},o-(w?w.length:0)+" characters left"))}});function q(u){return new(c("SearchableEntry"))({title:u,uniqueID:u})}function r(u,v){return u.getIn(m,i()).toOrderedSet().add(v).toList().filter(function(w){return w})}var s=c("OzHelpers").pure(function(u){var v=u.expiresIn,w=u.onChange,x="_1-i0 _3owv",y=v||j({hours:0,minutes:0}),z=function z(C){return Math.max(+C,0)},A=function A(C){return w(y.merge(j(C)))},B=function B(C,D){return y.get(D)===1?C:C+"s"};return c("React").createElement("div",{className:"_51wb"},c("React").createElement("label",{className:"_1-hz"},c("React").createElement("input",{className:x,onChange:function w(C){return A({hours:z(C.target.value)})},type:"number",value:v?v.get("hours"):null}),B("hour","hours")),c("React").createElement("label",{className:"_1-hz"},c("React").createElement("input",{className:x,onChange:function w(C){return A({minutes:z(C.target.value)})},type:"number",value:v?v.get("minutes"):null}),B("minute","minutes")))});function t(u,v){return u.withMutations(function(u){u.updateIn(m,i(),function(w){return w.push(v)});u.setIn(l,v)})}f.exports=p}),null);
__d("OzComposerAI.react",["cx","ContextualLayerAutoFlip","ContextualLayerUpdateOnScroll","OzHelpers","joinClasses","immutable","Image.react","LayerHideOnBlur","MessengerSpinner.react","OzBubblePreview.react","OzConfig","OzConstants","OzImmutablePureRenderMixin","React","Reflux","ShimButton.react","TextWithHighlights.atlas","MessengerButtonReact.bs","formatDate","XUIContextualDialog.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("MessengerButtonReact.bs").jsComponent,j=c("immutable").Map,k=c("immutable").List,l=c("OzConstants").ATTS,m=c("React").PropTypes,n=c("React").createClass({displayName:"OzComposerAIList",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{filter:m.string,items:m.instanceOf(k).isRequired,onItemClick:m.func.isRequired},getInitialState:function C(){return{}},render:function C(){var D=this.props,E=D.items,F=D.filter,G=D.onItemClick,H={filter:F,onItemClick:G};return!E.isEmpty()&&c("React").createElement("div",{className:"_4285"},E.map(function(I,J){return k.isList(I)?c("React").createElement("div",{key:J,className:"_2961"},I.map(function(K,L){return c("React").createElement(t,babelHelpers["extends"]({key:L,column:L,line:J,item:K},H))})):c("React").createElement(o,babelHelpers["extends"]({key:J,line:J,item:I,onToggleDebug:function(K){return this.setState({debugLine:this.state.debugLine===J?null:J})}.bind(this),debugShown:this.state.debugLine===J},H))}.bind(this)).reverse())}}),o=c("React").createClass({displayName:"ItemRow",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{onToggleDebug:m.func.isRequired,debugShown:m.bool.isRequired},componentDidMount:function C(){if(this.props.item.get("id")&&this.props.item.get("at"))this._timeout=window.setTimeout(function(D){return this._timeout!==null&&this.forceUpdate()}.bind(this),B(this.props.item))},componentWillUnmount:function C(){window.clearTimeout(this._timeout);this._timeout=null},render:function C(){var D=this.props,E=D.item,F=D.line,G=D.onItemClick,H=D.filter,I=j({line:F,column:0}),J=E.get("id"),K=E.get("at"),L=this.state.config.get("debugAI");return c("React").createElement("div",{className:"_2962",onClick:function M(N){N.preventDefault();G(I)},role:"presentation"},A(E)?c("React").createElement(s,{label:"AUTO-SENDING",at:K}):null,c("React").createElement("div",{className:"_58jk",ref:"root"},c("React").createElement("div",{className:"_2964"},c("React").createElement(v,{item:E,filter:H})),c("React").createElement("span",{className:"_58jl"},z(E)?c("React").createElement(i,{type:"secondary",label:"EXECUTING NOW..."}):A(E)?c("React").createElement(i,{type:"secondary",label:"STOP"}):J&&K?c("formatDate")(K/1e3,"g:ia M j"):"\u2318"+E.get("shortcut",F+1),L&&c("React").createElement(r,babelHelpers["extends"]({contextRef:function(M){return this.refs.root}.bind(this)},this.props)))))}});function p(C,D,E,F,G){var H='<span style="color: brown">',I='<span style="color: navy">',J='<span style="color: navy">',K=D||"";if(E)K=K+H+E.replace(/[\": ]/g,"")+"</span>: ";if(F)K=K+(F[0]=='"'?J:I)+F+"</span>";return K+(G||"")}function q(C){var D=/^( *)(\"[\w]+\": )?(\"[^\"]*\"|[\w.+-]*)?([,[{])?$/gm,E={__html:JSON.stringify(C,null,3).replace(/&/g,"&amp;").replace(/\\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(D,p)};return c("React").createElement("div",{dangerouslySetInnerHTML:E})}var r=c("React").createClass({displayName:"DebugInfo",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onToggleDebug:m.func.isRequired,debugShown:m.bool.isRequired},_handleToggleDebugInfo:function C(event){this.props.onToggleDebug();event.stopPropagation()},render:function C(){var D=this.props,E=D.contextRef,F=D.item,G=D.debugShown,H=F.get("source"),I=F.get("debug");return c("React").createElement("span",null,H?" "+H:"",I?" ":"",I&&c("React").createElement("span",null,c("React").createElement(c("ShimButton.react"),{className:"_5ufb",form:"link",onClick:this._handleToggleDebugInfo}),c("React").createElement(c("XUIContextualDialog.react"),{behaviors:{ContextualLayerAutoFlip:c("ContextualLayerAutoFlip"),ContextualLayerUpdateOnScroll:c("ContextualLayerUpdateOnScroll"),LayerHideOnBlur:c("LayerHideOnBlur")},contextRef:E,hoverHideDelay:0,onBlur:this.props.onToggleDebug,position:"right",shown:G,hasActionableContext:true},c("React").createElement("div",{className:"_5ufd"},q(I.toJS())))))}}),s=c("React").createClass({displayName:"TimeProgress",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{at:m.number.isRequired,label:m.string},componentDidMount:function C(){this._start=Date.now();var D=window.setInterval(function(E){return this.forceUpdate()}.bind(this));this.unlisten=function(E){return window.clearInterval(D,1e3)}},componentWillUnmount:function C(){this.unlisten()},render:function C(){var D=this.props,E=D.at,F=D.label,G=x(this._start,Date.now(),E);return c("React").createElement("div",{className:"_58jn"},c("React").createElement("div",{className:"_16bc",style:{width:G+"%"}}),c("React").createElement("div",{className:"_16bd"},F))}}),t=c("React").createClass({displayName:"ItemColumn",mixins:[c("OzImmutablePureRenderMixin")],componentDidMount:function C(){if(this.props.item.get("id")&&this.props.item.get("at"))this._timeout=window.setTimeout(function(D){return this._timeout!==null&&this.forceUpdate()}.bind(this),B(this.props.item))},componentWillUnmount:function C(){window.clearTimeout(this._timeout);this._timeout=null},render:function C(){var D=this.props,E=D.column,F=D.filter,G=D.item,H=D.line,I=D.onItemClick,J=j({line:H,column:E}),K=G.get("at");return c("React").createElement("div",{className:"_2966",onClick:function L(M){M.preventDefault();I(J)},role:"presentation"},A(G)?c("React").createElement(s,{label:"AUTO-SENDING",at:K}):null,c("React").createElement("div",{className:"_34mx"},z(G)?c("React").createElement(i,{type:"secondary",label:"EXECUTING NOW..."}):A(G)?c("React").createElement(i,{type:"secondary",label:"STOP"}):c("React").createElement("span",null,G.get("id")&&K?c("formatDate")(K/1e3,"g:ia M j"):"")),c("React").createElement(v,{className:"_34mz",item:G,filter:F}))}}),u=c("OzHelpers").pure(function(C){var D=C.images;return c("React").createElement("div",null,D.map(function(E,F){return c("React").createElement(c("Image.react"),{key:F,className:"_1q16",src:E.get("url"),alt:E.get("filename")})}))}),v=c("OzHelpers").pure(function(C){var D=C.filter,E=C.item,F=C.className;switch(E.get("type")){case l.COMMAND:return c("React").createElement(w,{command:E,highlight:D});case l.SURVEY:case"send":case l.TEMPLATE:var G=E.get("ui-body")&&'"'+E.get("ui-body")+'"',H=E.getIn(["data","images"]);return c("React").createElement("div",{className:F},G?c("React").createElement(c("TextWithHighlights.atlas"),{text:G,highlight:D}):null,H?c("React").createElement(u,{images:H}):null);case"suggest":case l.SUGG:return c("React").createElement(c("OzBubblePreview.react"),{bubble:E.get("data"),highlight:D,meta:E.get("meta"),source:E.get("source")});default:c("OzHelpers").debug("[composerai] could not render item",E);return null}}),w=c("OzHelpers").pure(function(C){var D=C.command,E=C.highlight;return c("React").createElement("div",{className:"_2_he"},c("React").createElement("i",{className:c("joinClasses")("_2_hf",D.get("iconCl"))}),c("React").createElement(c("TextWithHighlights.atlas"),{text:D.get("text"),highlight:E}))});function x(C,D,E){var F=D-C,G=E-C;return F>=0&&G>0?Math.min(100,Math.round(F/G*100)):100}var y=1e4;function z(C){return C.get("id")&&C.get("at")&&c("OzHelpers").serverNow()>C.get("at")}function A(C){return C.get("id")&&C.get("at")&&c("OzHelpers").serverNow()+y>C.get("at")}function B(C){var D=500;return A(C)?C.get("at")-c("OzHelpers").serverNow()+D:C.get("at")-y-c("OzHelpers").serverNow()+D}f.exports={OzComposerAIList:n}}),null);
__d("OzListEditor.react",["cx","OzHelpers","joinClasses","immutable","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").List,j=c("immutable").Map,k=c("React").PropTypes,l=c("React").createClass({displayName:"OzListEditor",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{autofocus:k.bool,list:k.instanceOf(i).isRequired,onClose:k.func,onEdit:k.func.isRequired},componentDidMount:function o(){if(this.props.autofocus)this._focus(0)},componentDidUpdate:function o(p){var q=p.list,r=this.props.list.count();q.count()<r&&this._focus(r-1)},_focus:function o(p){this.refs[p]&&this.refs[p].focus()},render:function o(){var p=this.props,q=p.list,r=p.onEdit,s=p.className,t=babelHelpers.objectWithoutProperties(p,["list","onEdit","className"]);return c("React").createElement("div",{className:c("joinClasses")(s,"_42e_")},q.map(function(u,v){return c("React").createElement("div",{key:u.get("key"),className:"_42f5"},c("React").createElement("input",{type:"text",ref:v,className:"_42f6 _1-i0",value:u.get("text"),onBlur:function(w){return this._handleItemBlur(u.get("text"),v,w)}.bind(this),onChange:function(w){return this._handleItemChange(u.get("text"),v,w)}.bind(this),onKeyDown:function(w){return this._handleBackspace(u.get("text"),v,w)}.bind(this)}))}.bind(this)),c("React").createElement("div",{key:"plus",className:"_42f5"},c("React").createElement("button",{ref:"plus",className:"_42f7 _1-hv _30yy",type:"button",onMouseDown:function u(v){return v.preventDefault()},onClick:this._handlePlusClick,onKeyDown:function(u){return this._handleBackspace(null,q.count(),u)}.bind(this)},"+")))},_setText:function o(p,q){this.props.onEdit(this.props.list.setIn([p,"text"],q))},_handlePlusClick:function o(){var p=this.props,q=p.list,r=p.onEdit,s=m(q),t=s===null?q.push(n()):q["delete"](s).push(q.get(s));r(t)},_handleItemBlur:function o(p,q,r){var s=this.props,t=s.list,u=s.onEdit;p.trim()?this._setText(q,p.trim()):t.count()>1&&u(t["delete"](q))},_handleItemChange:function o(p,q,r){this._setText(q,r.target.value)},_handleBackspace:function o(p,q,r){var s=this.props,t=s.list,u=s.onClose;if(r.key==="Backspace"&&!p){r.preventDefault();q>0?this._focus(q-1):t.count()===1?u&&u():this._focus(q+1)}}});function m(o){var p=o.findEntry(function(q){return!q.get("text","").trim()});return p?p[0]:null}function n(){return j({key:c("OzHelpers").uniqId(),text:""})}f.exports=l}),null);
__d("OzTokenizer.react",["cx","Promise","OzHelpers","immutable","OzSearchSource","OzImmutablePureRenderMixin","React","SearchableEntry","XUITokenizer.react","XUITokenizerToken.react","TypeaheadViewItem","TypeaheadViewPropTypes"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("immutable").List,k=c("React").PropTypes,l=c("React").createClass({displayName:"OzTokenizer",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{allTokens:k.instanceOf(j).isRequired,onCreateToken:k.func.isRequired,onDeleteToken:k.func.isRequired,chosenTokens:k.instanceOf(j).isRequired,resultRank:k.func.isRequired,resultFilter:k.func.isRequired,placeholder:k.string.isRequired,autofocus:k.bool,maxTokenTitleLength:k.number.isRequired,dropUp:k.bool,timeline:k.bool},getDefaultProps:function p(){return{allTokens:j(),chosenTokens:j(),resultRank:function q(r){return 0},resultFilter:function q(r,s){return true},maxTokenTitleLength:Number.MAX_SAFE_INTEGER,timeline:false}},getInitialState:function p(){return{q:""}},componentWillMount:function p(){var q=this.props,r=q.allTokens,s=q.chosenTokens,t=q.resultFilter,u=q.resultRank,v=q.maxTokenTitleLength;this._searchSource=new(c("OzSearchSource"))(function(w){var x=w.query;return c("Promise").resolve(m(x,r,s,t,u,v))})},componentDidMount:function p(){if(this.props.autofocus)this.refs.tokenizer.focusInput()},_onAddEntryAttempt:function p(q){var r=this.props,s=r.onCreateToken,t=r.maxTokenTitleLength;if(q.getTitle().length>t)return;this.setState({q:""});s(o(q))},_onDeleteEntryAttempt:function p(q){var r=this.props.onDeleteToken;r(o(q))},_onQueryStringChange:function p(q){var r=q.target.value;if(r.length<=this.props.maxTokenTitleLength)this.setState({q:q.target.value})},render:function p(){var q=this.props,r=q.chosenTokens,s=q.placeholder,t=q.timeline;return c("React").createElement("div",{className:"_2-e2"},c("React").createElement(c("XUITokenizer.react"),{className:"_2-e3"+(t?" _11_w":""),placeholder:s,entries:r.map(n).toJS(),presenter:this._tokenPresenter(),queryString:this.state.q,searchSource:this._searchSource,onRemoveEntryAttempt:this._onDeleteEntryAttempt,onAddEntryAttempt:this._onAddEntryAttempt,onQueryStringChange:this._onQueryStringChange,ref:"tokenizer"}))},_tokenPresenter:function p(){var q=this.props.dropUp,r=c("OzHelpers").pure(function(u){return c("React").createElement(c("XUITokenizerToken.react"),babelHelpers["extends"]({},u,{className:"_2-e5"}))}),s=c("React").createClass({displayName:"OzTypeaheadViewItem",mixins:[c("TypeaheadViewItem").Mixin],propTypes:c("TypeaheadViewItem").propTypes,render:function u(){var v=this.props.highlighted;return c("React").createElement("li",{className:"_2-e7"+(v?" _2-e8":""),"aria-selected":this.props.highlighted,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight,role:this.props.role},this.props.entry.getTitle())}}),t=c("React").createClass({displayName:"OzTypeaheadView",mixins:[c("OzImmutablePureRenderMixin")],propTypes:c("TypeaheadViewPropTypes"),_renderItem:function u(v){var w=v===this.props.highlightedEntry;return c("React").createElement(s,{key:v.getUniqueID(),entry:v,highlighted:w,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight})},render:function u(){var v="_2-e9"+(q?" _2-ea":"")+(!this.props.entries.length?" _599s":"");return c("React").createElement("ul",{className:v,id:this.props.controlleeID,role:this.props.role},this.props.entries.map(this._renderItem))}});return{ViewRenderer:t,TokenRenderer:r,useLayer:false}}});function m(){var p=arguments.length<=0||arguments[0]===undefined?"":arguments[0],q=arguments[1],r=arguments[2],s=arguments[3],t=arguments[4],u=arguments[5];if(!p)return[];var v=q.filter(function(w){return!r.includes(w)}).filter(function(w){return w.get("name").length<=u}).filter(function(w){return s(w,p)}).sortBy(t).map(n).take(10).toList();return v.filter(function(w){return w.getUniqueID()==p}).count()==0?v.push(n(i({name:p,id:p}))).toJS():v.toJS()}function n(p){return new(c("SearchableEntry"))({title:p.get("name"),uniqueID:p.get("id")})}function o(p){return i({id:p.getUniqueID(),name:p.getTitle()})}f.exports=l}),null);
__d("OzTextTokenizer.react",["immutable","OzTokenizer.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("immutable").List,i=c("React").PropTypes,j=c("React").createClass({displayName:"OzTextTokenizer",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{allTokens:i.instanceOf(h).isRequired,onChange:i.func.isRequired,chosenTokens:i.instanceOf(h).isRequired,placeholder:i.string.isRequired,autofocus:i.bool,maxTokenLength:i.number},getDefaultProps:function k(){return{allTokens:h(),chosenTokens:h()}},_commitChangedTokens:function k(l){var m=this.props.onChange;this.setState({q:""});m(l)},_onAddEntryAttempt:function k(l){var m=this.props.chosenTokens;this._commitChangedTokens(m.push(l))},_onDeleteEntryAttempt:function k(l){var m=this.props.chosenTokens,n=m.indexOf(l);this._commitChangedTokens(n>=0?m["delete"](n):m)},render:function k(){var l=this.props,m=l.allTokens,n=l.chosenTokens,o=l.placeholder,p=l.maxTokenLength,q=l.autofocus;return c("React").createElement(c("OzTokenizer.react"),{placeholder:o,allTokens:m,chosenTokens:n,onDeleteToken:this._onDeleteEntryAttempt,onCreateToken:this._onAddEntryAttempt,resultFilter:function r(s,t){return s.get("name").toLowerCase().indexOf(t.toLowerCase())==0},maxTokenTitleLength:p,dropUp:true,autofocus:q})}});f.exports=j}),null);
__d("OzQuickRepliesComposer.react",["cx","immutable","OzTextTokenizer.react","React","XUICloseButton.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").Map,l=c("immutable").List,m=c("React").PropTypes,n=l(["Yes","No","Maybe later","7:00am","7:30am","8:00am","8:30am","9:00am","11:00am","11:30am","12:00pm","12:30pm","1:00pm","1:30pm","2:00pm","5:00pm","5:30pm","6:00pm","6:30pm","7:00pm","7:30pm","8:00pm","8:30pm","9:00pm","Italian","Japanese","Steakhouse","American","French","Chinese","Thai","Burmese","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday","San Francisco","Menlo Park","Los Angeles","New York","London","Paris","Berlin"]);i=babelHelpers.inherits(o,c("React").Component);j=i&&i.prototype;function o(){var p,q;"use strict";for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=j.constructor).call.apply(p,[this].concat(s)),this.$OzQuickRepliesComposer1=function(u){var v=this.props,w=v.attachment,x=v.onEdit;x(w.set("data",u))}.bind(this),q}o.prototype.render=function(){"use strict";var p=this.props,q=p.attachment,r=p.onRemove;return c("React").createElement("div",{className:"_46s3"},c("React").createElement("div",{className:"_46s4"},c("React").createElement("div",{className:"_46s5"},"Quick Replies"),c("React").createElement(c("XUICloseButton.react"),{onClick:r})),c("React").createElement(c("OzTextTokenizer.react"),{allTokens:n.map(function(s){return k({id:s,name:s})}),onChange:this.$OzQuickRepliesComposer1,chosenTokens:q.get("data")||l(),placeholder:"Add quick replies...",autofocus:true,maxTokenLength:20}))};o.propTypes={attachment:m.instanceOf(k).isRequired,onEdit:m.func.isRequired,onRemove:m.func.isRequired};f.exports=o}),null);
__d("OzComposerAttachments.react",["cx","OzHelpers","Image.react","immutable","MNCommerceAgentItemSuggestionMercuryAttachment.react","OzAttachmentOverlay.react","OzConstants","OzListEditor.react","OzQuickRepliesComposer.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").OrderedMap,j=c("immutable").Map,k=c("immutable").List,l=c("OzConstants").ATTS,m=c("React").PropTypes,n=c("React").createClass({displayName:"OzComposerAttachments",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{attachments:m.instanceOf(i).isRequired,onAttachmentCrop:m.func.isRequired,onBubbleEdit:m.func.isRequired,onQuickRepliesEdit:m.func.isRequired,onRemove:m.func.isRequired},render:function q(){var r=this.props,s=r.attachments,t=r.onAttachmentCrop,u=r.onBubbleEdit,v=r.onQuickRepliesEdit,w=r.onRemove;if(s.isEmpty())return null;return c("React").createElement("div",{className:"_18wb"},s.map(function(x,y){return c("React").createElement(o,{key:y,id:y,attachment:x,onRemove:w,onBubbleEdit:u,onAttachmentCrop:t,onQuickRepliesEdit:v})}).valueSeq())}}),o=c("React").createClass({displayName:"Attachment",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{attachment:m.instanceOf(j).isRequired,id:m.number.isRequired,onAttachmentCrop:m.func.isRequired,onBubbleEdit:m.func.isRequired,onQuickRepliesEdit:m.func.isRequired,onRemove:m.func.isRequired},render:function q(){__p&&__p();var r=this.props,s=r.attachment,t=r.id,u=r.onAttachmentCrop,v=r.onBubbleEdit,w=r.onQuickRepliesEdit,x=r.onRemove;switch(s.get("type")){case l.IMAGE:return c("React").createElement(c("OzAttachmentOverlay.react"),{key:t,onEdit:function y(z){return u(s,t)},onRemove:function y(z){return x(s,t)},loading:s.get("loading")},p(s));case l.SUGG:return c("React").createElement(c("OzAttachmentOverlay.react"),{key:t,onRemove:function y(z){return x(s,t)},onEdit:function y(z){return v(s,t)}},c("React").createElement(c("MNCommerceAgentItemSuggestionMercuryAttachment.react"),{itemSuggestion:c("OzHelpers").uiSuggestion(s.get("data"))}));case l.QUICK_REPLIES:return c("React").createElement(c("OzQuickRepliesComposer.react"),{attachment:s,onEdit:w,onRemove:function y(z){return x(s,t)}});default:return c("React").createElement(c("OzAttachmentOverlay.react"),{key:t},c("React").createElement("span",null,JSON.stringify(s)))}}});function p(q){var r=q.get("ui-blob");if(r&&!c("OzHelpers").isImageType(r.type))return c("React").createElement("p",{className:"_4gpv"},r.name);else{var s=q.get("url")||c("OzHelpers").blobURI(r);return c("React").createElement(c("Image.react"),{className:"_4xee",onClick:function t(u){return window.open(s)},src:s})}}f.exports=n}),null);
__d("OzConfirmDialog.react",["cx","joinClasses","MessengerDialog.react","MessengerDialogBody.react","MessengerDialogButton.react","MessengerDialogFooter.react","MessengerDialogHeader.react","OzActions","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").PureComponent);j=i&&i.prototype;l.prototype.render=function(){"use strict";var n=this.props,o=n.body,p=n.className,q=n.confirmLabel,r=n.cancelLabel,s=n.header,t=n.onCancel,u=n.onConfirm,v=n.width,w=babelHelpers.objectWithoutProperties(n,["body","className","confirmLabel","cancelLabel","header","onCancel","onConfirm","width"]);return c("React").createElement(c("MessengerDialog.react"),babelHelpers["extends"]({className:c("joinClasses")("_1vdh",p),onToggle:m(t),width:v||500},w),c("React").createElement(c("MessengerDialogHeader.react"),null,s),c("React").createElement(c("MessengerDialogBody.react"),{className:"_1vdi"},o),c("React").createElement(c("MessengerDialogFooter.react"),null,c("React").createElement(c("MessengerDialogButton.react"),{label:r||"Cancel",onClick:m(t),type:"secondary",use:"default"}),c("React").createElement(c("MessengerDialogButton.react"),{className:"autofocus",label:q||"OK",onClick:m(u),ref:"confirm",type:"primary",use:"default"})))};function l(){"use strict";i.apply(this,arguments)}l.propTypes={body:k.node.isRequired,confirmLabel:k.string,cancelLabel:k.string,header:k.string.isRequired,onConfirm:k.func.isRequired,onCancel:k.func,width:k.number};function m(n){return function(o){c("OzActions").hideDialog();n&&n()}}f.exports=l}),null);
__d("OzSendLater.react",["cx","OzHelpers","LayerHideOnBlur","MessengerButtonReact.bs","OzDateTimePicker.react","OzImmutablePureRenderMixin","React","Tooltip","XUIContextualDialog.react"],(function a(b,c,d,e,f,g,h){var i=c("MessengerButtonReact.bs").jsComponent,j=c("React").PropTypes,k=c("React").createClass({displayName:"OzSendLater",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{numScheduled:j.number.isRequired,onSendLater:j.func.isRequired,onTimeChange:j.func.isRequired,onToggle:j.func.isRequired,shown:j.bool.isRequired,timestamp:j.number,timezone:j.string,disabled:j.bool},render:function l(){var m=this.props,n=m.shown,o=m.disabled,p=m.numScheduled,q=m.onSendLater,r=m.onToggle,s=m.timestamp,t=m.timezone;return c("React").createElement("span",{className:"_40yd"},c("React").createElement("button",babelHelpers["extends"]({ref:"btn",disabled:o,onClick:function u(v){return r(true)}},o?c("Tooltip").propsFor("We can not schedule this message; images are not supported yet"):null,{className:"_1-hv _40ye _30yy"}),c("React").createElement("i",{className:"_40yf"}),p?c("React").createElement("div",{className:"_2ism"},p):null),c("React").createElement(c("XUIContextualDialog.react"),{autoFocus:false,position:"above",contextRef:function(u){return this.refs.btn}.bind(this),className:"_40yg",shown:n,onToggle:r,behaviors:{LayerHideOnBlur:c("LayerHideOnBlur")}},c("React").createElement("div",{className:"_40yg"},c("React").createElement(c("OzDateTimePicker.react"),babelHelpers["extends"]({className:"_40yh",timestamp:s||c("OzHelpers").serverNow(),timezone:t,onChange:this._handleTimeChange},c("OzHelpers").dateRestraints())),c("React").createElement(i,{onClick:q,label:"Send Later",type:"primary"}))))},_handleTimeChange:function l(m){this.props.onTimeChange(m)}});f.exports=k}),null);
__d("OzTypingDots.react",["cx","immutable","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").Range,l=c("React").PropTypes,m=3;i=babelHelpers.inherits(n,c("React").PureComponent);j=i&&i.prototype;n.prototype.render=function(){"use strict";var p=this.props,q=p.bouncing,r=p.disabled,s=p.onClick,t=this.props.numDots||m,u="_32p1"+(q&&!r?" _32p2":"")+(r?" _32p3":"")+" _30yy";return c("React").createElement("div",{className:u,onClick:s,role:"presentation"},c("React").createElement("div",{className:"_32p4"},k(0,t).map(function(v){return c("React").createElement(o,{index:v,key:v})})))};function n(){"use strict";i.apply(this,arguments)}n.propTypes={bouncing:l.bool,disabled:l.bool,numDots:l.number,onClick:l.func};function o(p){var q=p.index,r=100*q;return c("React").createElement("div",{className:"_32p5",style:{animationDelay:r+"ms"}})}f.exports=n}),null);
__d("OzUpdateDateTime.react",["immutable","OzHelpers","React"],(function a(b,c,d,e,f,g){__p&&__p();var h,i,j=c("immutable").Map,k=c("React").PropTypes;h=babelHelpers.inherits(l,c("React").Component);i=h&&h.prototype;l.prototype.componentDidMount=function(){"use strict";var m=setInterval(function(){this.forceUpdate()}.bind(this),6e4);this.setState({timer:m})};l.prototype.componentWillUnmount=function(){"use strict";if(this.state.timer)clearInterval(this.state.timer)};l.prototype.render=function(){"use strict";var m=new Date(c("OzHelpers").serverNow()+this.props.timezoneOffset);return c("React").createElement("span",null,m.toLocaleString(this.props.locale,this.props.options.set("timeZone","UTC").toJS()))};function l(){"use strict";h.apply(this,arguments)}l.propTypes={timezoneOffset:k.number.isRequired,locale:k.string.isRequired,options:k.instanceOf(j).isRequired};f.exports=l}),null);
__d("OzComposer.react",["cx","fbt","invariant","Promise","OzAPI","OzEditorStateHelpers","formatDate","getDefaultKeyBinding","getEntityMatcher","getVisibleValueForContentState","OzHelpers","insertEmoticonIntoEditorState","OzNotify","promiseFinally","ChatContentSearchButton.react","ChatStickerButton.react","CompositeDraftDecorator","DraftEditor.react","DraftModifier","EditorState","EmoticonsList","EmoticonSpan.react","FileInput.react","immutable","KeyBindingUtil","Keys","MessengerContextualDialog.react","MercuryConfig","OzActions","OzAttachmentCropper.react","OzBubbleEditor.react","OzComposerAI.react","OzComposerAttachments.react","OzConfig","OzConfirmDialog.react","OzConstants","OzHistory","OzSendLater.react","OzTypingDots.react","OzStores","OzSuggestions","OzUpdateDateTime.react","React","OzWrapper.react","Reflux","SelectionState","Timestamp.react"],(function aa(ba,a,ca,da,b,ea,fa,c,d){__p&&__p();var e=a("OzHistory")("composer-history"),f=a("immutable").Map,g=a("immutable").OrderedMap,h=a("immutable").List,i=a("React").PropTypes,j=a("OzComposerAI.react").OzComposerAIList,k=a("OzConstants").ATTS,l=a("OzConstants").TOKENS,m=a("OzStores").ActiveThreadStore,n=a("OzStores").BubbleStore,o=8*1024*1024,p={CREATE_BUBBLE:"CREATE_BUBBLE",CREATE_REMINDER:"CREATE_REMINDER",CREATE_INTENT:"CREATE_INTENT",CLOSE_INTENT:"CLOSE_INTENT",CLOSE_REMINDER:"CLOSE_REMINDER",ADD_QUICK_REPLIES:"ADD_QUICK_REPLIES"},q=15*60*1e3,ga=4*60*1e3,ha=a("React").createClass({displayName:"OzComposer",mixins:[a("Reflux").connect(n,"bubbles"),a("Reflux").connect(m,"activeThread"),a("Reflux").connect(a("OzConfig").ConfigStore,"config")],propTypes:{thread:i.instanceOf(f).isRequired,merchants:i.instanceOf(f).isRequired,onResize:i.func},contextTypes:{router:i.object.isRequired,uid:i.string.isRequired},getInitialState:function N(){return t(this.props.thread)},componentDidMount:function N(){this._unlistenComposer=a("OzActions").updateComposer.listen(this._onUpdateComposer);this._unlistenAISelect=a("OzActions").selectAIPick.listen(this._handleAISelect);this._cleanup=function(){this._unlistenComposer();this._unlistenAISelect()}.bind(this);this._oldHeight=this.refs.root.offsetHeight},componentWillReceiveProps:function N(O){if(a("OzHelpers").threadID(O.thread)!==a("OzHelpers").threadID(this.props.thread)){u(this.tid(),this.state);this.setState(t(O.thread))}},componentDidUpdate:function N(O,P){window.setTimeout(function(R){var S=this.refs.root&&this.refs.root.offsetHeight;if(S!==this._oldHeight)this.props.onResize&&this.props.onResize();this._oldHeight=S}.bind(this));var Q=a("OzHelpers").threadID(O.thread);Q===this.tid()?ka(this.tid(),P,this.state):a("OzAPI").notTyping(Q)},componentWillUnmount:function N(){u(this.tid(),this.state);this._cleanup();a("OzAPI").notTyping(this.tid())},getValue:function N(){return a("getVisibleValueForContentState")(this.e().getCurrentContent())},focusInput:function N(){this.refs.input.focus()},render:function N(){return a("React").createElement("div",{ref:"root",className:"_5751 _19ib"},this._renderWidgets(),a("React").createElement("div",{className:"_5754"},this._renderSettings(),a("React").createElement("div",{className:"_19id"},this._renderTextEditor()),this._renderActions()))},_renderTextEditor:function N(){return a("React").createElement(a("DraftEditor.react"),{ref:"input",editorState:this.e(),keyBindingFn:this._toKeyCommand,handleKeyCommand:this._handleKeyCommand,handleBeforeInput:this._handleBeforeInput,onChange:this._handleChange,onDownArrow:this._handleDownArrow,onUpArrow:this._handleUpArrow,onTab:this._handleTab,handleReturn:this._handleReturn,onFocus:this._handleFocus,handlePastedFiles:this._handleFiles,handleDroppedFiles:function(O,P){this._handleFiles(P)}.bind(this),placeholder:this.state.sendTyping?c._("Type a message... (\u2318\u21a9 to send)"):c._("Sneakily type a message... (\u2318\u21a9 to exit sneaky mode and send)"),spellCheck:true,textAlignment:"left"})},_handleFocus:function N(){this.setState({isAIOpen:true})},_onUpdateComposer:function N(O){var P=O.text,Q=O.files;P&&this._handleChange(a("OzEditorStateHelpers").append(this.e(),P));Q&&this._handleFiles(Q);this.refs.input.focus()},_validateSend:function N(){var O=this.state.attachments;return new(a("Promise"))(function(P,Q){var R=[[E(this.e().getCurrentContent()).length>0,"You have not filled in all the missing information."],[O.some(function(S){return S.get("loading")}),"Your attachments are still loading. Please wait and send in a bit"],[x(O)&&!this.getValue().trim()&&!O.find(function(S){return S.get("type")===k.SUGG}),"You need to type a message or create a bubble if you want to send quick replies"],[!a("OzHelpers").isOwner(this.t(),this.context.uid),"You do not own this thread. Assign yourself to send messages"]].find(function(S){var T=S[0],U=S[1];return T});R?Q(R[1]):P()}.bind(this))},_sendWith:function N(O,P){__p&&__p();this._validateSend().done(function(Q){__p&&__p();var R=a("OzHelpers").threadID(this.t()),S=this.getValue().trim(),T=this.state.attachments.groupBy(function($){return $.get("type")}),U=D(this.t(),this.state),V=T.get(k.IMAGE,h()).map(function($){return $["delete"]("ui-blob")}).toList(),W=ma(this.state.attachments),X=W&&{"generic-metadata":W},Y=function Y(){return S||!V.isEmpty()?O(babelHelpers["extends"]({tid:R,images:V,text:S,aiusage:U},X)):a("Promise").resolve()},Z=function Z(){return T.get(k.SUGG,h()).reduce(function($,Ga){return a("promiseFinally")($,function(Q){return P(babelHelpers["extends"]({tid:R,suggestion:Ga.get("data"),aiusage:U},X))})},a("Promise").resolve())};a("promiseFinally")(Y(),Z);a("OzAPI").notifyExtension({action:"discard",id:R});this._toHistory();this.setState(babelHelpers["extends"]({},r(this.t()),{editorState:a("OzEditorStateHelpers").replaceContentWithText(this.e(),""),seedBubble:this.state.seedBubble,isAIOpen:this.state.isAIOpen}))}.bind(this),a("OzNotify").error)},_handleMessageSend:function N(){y("send",[z(this.t()),A(this.t(),this.state.activeThread),B(this.getValue().trim())],function(O){return this._sendWith(a("OzAPI").sendMessage,a("OzAPI").suggest)}.bind(this))},_handleSendLater:function N(){__p&&__p();var O=this.state.schedule.timestamp;this.setState({sendTyping:false});if(!O){a("OzNotify").error("You need to pick a time to send later");return}if(O<a("OzHelpers").serverNow()-ga){a("OzNotify").error("This time is in the past. Is the timezone correct?");return}y("schedule",[A(this.t(),this.state.activeThread),B(this.getValue().trim())],function(P){this._sendWith(function(Q){return a("OzAPI").scheduleMessage(babelHelpers["extends"]({},Q,{at:O}))},function(Q){return a("OzAPI").scheduleSuggest(babelHelpers["extends"]({},Q,{at:O}))});this.setState({sendTyping:true})}.bind(this))},_handleReturn:function N(O){if(a("OzHelpers").hasCmdOrCtrl(O)){setTimeout(this._handleMessageSend);return true}return false},_handleFiles:function N(O){__p&&__p();var P=O;if(P.some(function(S){return S.size>=o})){a("OzNotify").error("The file you are trying to add is too large.");return false}if(!P.length)return false;var Q=this.state.attachments.merge(P.map(function(S,T){return[T,f({type:k.IMAGE,"ui-blob":S,loading:true})]}));this.setState({attachments:Q});var R=function R(S){return P.reduce(function(S,T,U){return S["delete"](U)},S)};a("Promise").all(P.map(function(S){return a("OzAPI").upload(f({type:S.type,blob:S}))})).done(function(S){S.every(function(T){return T.get("id")})||d(0);this.setState({attachments:v(R(this.state.attachments),S.map(function(T,U){return T.set("ui-blob",P[U])}))})}.bind(this),function(S){this.setState({attachments:R(this.state.attachments)})}.bind(this));return true},_nonTextSend:function N(O){var P=y("send",[z(this.t()),A(this.t(),this.state.activeThread)],O);return this._validateSend().then(P,a("OzNotify").error)},_handleStickerSelect:function N(O){this._nonTextSend(function(P){a("OzAPI").sendMessage({tid:a("OzHelpers").threadID(this.t()),"sticker-id":O,aiusage:D(this.t(),this.state)})}.bind(this))},_handleContentSearchSelect:function N(O,P){if(O.platformFBID.toString()===a("MercuryConfig").MessengerAppID){this._handleStickerSelect(O.resultID.toString());return}this._nonTextSend(function(Q){a("OzAPI").upload(f({type:"image/url","attribution-app-id":O.platformFBID,"image-url":O.source.url})).done(function(R){return a("OzAPI").sendMessage({tid:a("OzHelpers").threadID(this.t()),images:[R],aiusage:D(this.t(),this.state)})}.bind(this))}.bind(this))},_handleEmoticonSelect:function N(O){var P=a("EmoticonsList").symbols[O];P&&this._handleChange(a("insertEmoticonIntoEditorState")(P,this.state.editorState))},_handleAttRemove:function N(O){this.setState({attachments:this.state.attachments["delete"](O.get("id"))})},_handleBubbleEdit:function N(O){this.setState({seedBubble:O})},_handleBubbleEditorSave:function N(O){this.setState({seedBubble:null,attachments:v(this.state.attachments,[O])},function(P){return this.refs.input.focus()}.bind(this))},_handleBubbleEditorClose:function N(O){var P={seedBubble:null},Q=O.get("id");if(Q)P.attachments=this.state.attachments["delete"](Q);this.setState(P,function(R){return this.refs.input.focus()}.bind(this))},_handleAttachmentCrop:function N(O){this.setState({cropAttachment:O})},_handleAttCropperSave:function N(O){var P=this.state.attachments["delete"](O.get("id"));this.setState({cropAttachment:null,attachments:P},function(Q){this._handleFiles([O.get("ui-blob")]);this.refs.input.focus()}.bind(this))},_handleAttCropperClose:function N(O){this.setState({cropAttachment:null},function(P){return this.refs.input.focus()}.bind(this))},_handleQuickRepliesEdit:function N(O){this.setState({attachments:v(this.state.attachments,[O])})},_handleTypingDotsClick:function N(){this.setState({sendTyping:!this.state.sendTyping})},_renderWidgets:function N(){if(this.state.seedBubble)return a("React").createElement(a("OzBubbleEditor.react"),{merchants:this.props.merchants,seedBubble:this.state.seedBubble,onSave:this._handleBubbleEditorSave,onClose:this._handleBubbleEditorClose});if(this.state.cropAttachment)return a("React").createElement(a("OzAttachmentCropper.react"),{attachment:this.state.cropAttachment,onSave:this._handleAttCropperSave,onClose:this._handleAttCropperClose});return a("React").createElement("div",null,a("React").createElement(j,{filter:this.getValue(),items:this._AIItems(),onItemClick:this._handleAIItemClick}),a("React").createElement(a("OzComposerAttachments.react"),{attachments:this.state.attachments,onRemove:this._handleAttRemove,onBubbleEdit:this._handleBubbleEdit,onAttachmentCrop:this._handleAttachmentCrop,onQuickRepliesEdit:this._handleQuickRepliesEdit}))},_renderSettings:function N(){return a("React").createElement("div",{className:"_41s9"},a("React").createElement(a("OzTypingDots.react"),{disabled:!this.state.sendTyping,onClick:this._handleTypingDotsClick}))},_renderActions:function N(){return a("React").createElement("div",{className:"_575c"},a("React").createElement(a("ChatStickerButton.react"),{className:"_30yy _1v3y",flyoutAlignment:"right",flyoutClassName:"_293j",onStickerSelect:this._handleStickerSelect,onEmoticonSelect:this._handleEmoticonSelect}),a("React").createElement(a("FileInput.react"),{ref:"fileInput",display:"inline-block",containerClassName:"_30yy _41sr",accept:"*/*",multiple:true,onChange:function(O){this._handleFiles([].slice.apply(O.target.files));this.refs.fileInput.getFileInput().clear()}.bind(this)},a("React").createElement("a",{title:"add images",className:"_2e01 _30yy"})),a("React").createElement(a("ChatContentSearchButton.react"),{className:"_yht _30yy _592k",ref:"chatContentSearch",ContextualDialogClass:a("MessengerContextualDialog.react"),flyoutAlignment:"right",flyoutClassName:"_293j",flyoutWidth:285,onStickerSelect:this._handleStickerSelect,getInput:function(){return this.refs.input}.bind(this),getQuery:this.getValue,onSelect:this._handleContentSearchSelect}),a("React").createElement(a("OzSendLater.react"),babelHelpers["extends"]({},this.state.schedule,{numScheduled:this.props.thread.get("events")?this.props.thread.get("events").count():0,onTimeChange:this._handleScheduleTimeChange,onToggle:this._handleScheduleToggle,onSendLater:this._handleSendLater})))},_handleChange:function N(O){this.setState({editorState:O})},_handleDownArrow:function N(O){if(a("OzHelpers").hasCmdOrCtrl(O)&&this.e().isSelectionAtStartOfContent()){this._fromHistory("down");O.preventDefault();return true}},_handleUpArrow:function N(O){if(a("OzHelpers").hasCmdOrCtrl(O)&&this.e().isSelectionAtStartOfContent()){this._fromHistory("up");O.preventDefault();return true}},_handleTab:function N(O){__p&&__p();var P=F(this.e());if(P){this.setState({editorState:a("EditorState").forceSelection(this.e(),P)});O.preventDefault();return true}var Q=C(this._AIItems(),f({line:0,column:0}));if(Q){this._handleAISelect(Q);O.preventDefault();return true}},_toKeyCommand:function N(O){var P=function(){var R=O.keyCode-a("Keys").ZERO;if(this.state.isAIOpen&&R<=this._AIItems().size)return"SELECT-AI-ITEM-"+(R-1)}.bind(this),Q=function(O){return oa(O)&&!x(this.state.attachments)&&this.state.config.getIn(["GK","quickReplies"])}.bind(this);return na(O)&&p.CREATE_BUBBLE||Q(O)&&p.ADD_QUICK_REPLIES||qa(O)&&P()||pa(O)&&"PREFERRED-NAME"||a("getDefaultKeyBinding")(O)},_handleKeyCommand:function N(O,P){__p&&__p();switch(O){case"SELECT-AI-ITEM-0":case"SELECT-AI-ITEM-1":case"SELECT-AI-ITEM-2":case"SELECT-AI-ITEM-3":case"SELECT-AI-ITEM-4":case"SELECT-AI-ITEM-5":case"SELECT-AI-ITEM-6":case"SELECT-AI-ITEM-7":case"SELECT-AI-ITEM-8":case"SELECT-AI-ITEM-9":this._handleAIItemClick(f({line:+O.slice(-1),column:0}));return true;case"PREFERRED-NAME":this._handleChange(a("EditorState").push(P,a("DraftModifier").replaceText(P.getCurrentContent(),P.getSelection(),a("OzHelpers").preferredName(this.t()))));return true;case p.CREATE_BUBBLE:this.setState({seedBubble:la()});return true;case p.ADD_QUICK_REPLIES:this.setState({attachments:v(this.state.attachments,[w()])});return true}return false},_AIItems:function N(O){return va(this.state.isAIOpen,this.props.thread,this.state.attachments,this.state.bubbles,this.props.merchants,this.getValue())},_handleAISelect:function N(O){__p&&__p();this.setState({lastAIPick:O,lastAIGuesses:this.t().get("guesses"),sendTyping:G(O)?false:this.state.sendTyping},function(){__p&&__p();var P=O.get("id");if(G(O)){a("OzAPI").deleteScheduled(a("OzHelpers").threadID(this.t()),P);this._handleScheduleTimeChange({timestamp:O.get("at"),timezone:a("OzHelpers").timezone(this.t())})}switch(O.get("type")){case k.COMMAND:if(!G(O))switch(O.get("action")){case p.CREATE_REMINDER:this._handleCreateReminder(O);break;case p.CLOSE_REMINDER:this._handleCloseReminder(O);break;case p.CREATE_INTENT:this._handleCreateIntent(O);break;case p.CLOSE_INTENT:this._handleCloseIntent(O);break;default:this._handleKeyCommand(O.get("action"))}break;case k.SURVEY:case"send":case k.TEMPLATE:var Q=O.get("f"),R=Q&&Q()||O.get("ui-body"),S=O.getIn(["data","images"]),T=a("OzEditorStateHelpers").replaceLine(this.e(),R+" "),U=F(T);if(R)this._handleChange(U?a("EditorState").forceSelection(T,U):T);if(S)this.setState({attachments:v(this.state.attachments,S.toArray())});break;case"suggest":case k.SUGG:this.setState({seedBubble:O});break;case k.OPENTABLEQR:this.setState({attachments:v(this.state.attachments,[f({data:O.get("bubble")["delete"]("thumb-urls"),meta:O.get("meta"),source:"places",type:k.SUGG}),w(O.get("quickreplies"))])});var V=a("OzEditorStateHelpers").replaceLine(this.e(),O.get("ui-body"));this._handleChange(V);break}}.bind(this));this.focusInput()},_handleAIItemClick:function N(O){this._handleAISelect(C(this._AIItems(),O))},_handleCreateReminder:function N(O){a("OzAPI").createReminder(this.tid(),f({body:O.get("body"),"scheduled-time":O.get("scheduled-time")}))},_handleCloseReminder:function N(O){a("OzAPI").closeReminder(this.tid(),O.get("id")||O.get("reminder-id"),false)},_handleCreateIntent:function N(O){a("OzAPI").createIntent(this.tid(),f({"wit-intent-uuid":O.get("wit-intent-uuid"),name:O.get("name"),metadata:O.get("metadata"),params:O.get("params"),actions:O.get("actions"),notes:O.get("notes"),requirements:O.get("requirements")})).done(function(P){a("OzHelpers").info("[composer/handleCreateIntent] created for:",a("OzHelpers").threadID(P));this.context.router.push(a("OzHelpers").threadPath({threadid:a("OzHelpers").threadID(P),intentid:P.getIn(["intents",-1,"id"])}))}.bind(this))},_handleCloseIntent:function N(O){a("OzAPI").closeIntent(this.tid(),O.get("id"))},_toHistory:function N(){var O=this.state.attachments,P=O.filter(function(R){return R.get("type")===k.SUGG}),Q=this.getValue();e.push(JSON.stringify({bubbles:P,text:Q}))},_fromHistory:function N(O){var P=a("OzHelpers").safeParse(e[O]()),Q=P.bubbles,R=P.text;R&&this._handleChange(a("OzEditorStateHelpers").replaceContentWithText(this.e(),R));Q&&this.setState({attachments:g(Q).mapEntries(function(S){return a("immutable").fromJS(S)}).mapKeys(function(S){return+S})})},_handleScheduleToggle:function N(O){var P=this.state.schedule,Q=P.timestamp||a("OzHelpers").serverNow();P.shown===O?null:this.setState({schedule:babelHelpers["extends"]({},P,{shown:O,timestamp:Q})})},_handleScheduleTimeChange:function N(O){this.setState({schedule:babelHelpers["extends"]({},this.state.schedule,O)})},e:function N(){return this.state.editorState},t:function N(){return this.props.thread},tid:function N(){return a("OzHelpers").threadID(this.t())}});function ia(){var N=new(a("CompositeDraftDecorator"))([{strategy:function O(P,Q){E(P.getText()).map(function(R){return Q.apply(undefined,R)})},component:ua},{strategy:a("getEntityMatcher")(function(O){return O.getType()==="EMOTICON"}),component:a("EmoticonSpan.react")}]);return a("EditorState").createEmpty(N)}function ja(N){return{shown:false,timestamp:null,timezone:a("OzHelpers").timezone(N)}}function r(N){return{attachments:g(),editorState:ia(),sendTyping:true,seedBubble:null,isAIOpen:false,lastAIPick:null,lastAIGuesses:null,schedule:ja(N)}}var s={};function t(N){return s[a("OzHelpers").threadID(N)]||r(N)}function u(N,O){var P=babelHelpers["extends"]({},O);delete P.bubbles;delete P.activeThread;delete P.config;P.isAIOpen=false;s[N]=P}function ka(N,O,P){var Q=O.editorState.getCurrentContent().getPlainText(),R=P.editorState.getCurrentContent().getPlainText();Q!==R&&a("OzHelpers").debug("[composer] changed from",Q,R);if(P.sendTyping){var S=[Q,R].map(function(V){return!!V.length}),T=S[0],U=S[1];!T&&U&&a("OzAPI").typing(N);T&&!U&&a("OzAPI").notTyping(N)}O.sendTyping&&!P.sendTyping&&a("OzAPI").notTyping(N)}function v(N,O){g.isOrderedMap(N)||d(0);Array.isArray(O)||d(0);return N.withMutations(function(P){return O.reduce(function(P,Q){Q=Q.set("id",Q.get("id")||Q.hashCode());return P.set(Q.get("id"),Q)},P)})}function la(){return a("immutable").fromJS({data:{currency:"USD"},type:k.SUGG})}function w(N){return a("immutable").fromJS({type:k.QUICK_REPLIES,data:N?N.map(function(O){return f({id:O,name:O})}):h()})}function x(N){return N.find(function(O){return O.get("type")===k.QUICK_REPLIES})}function ma(N){var O=f(x(N)).get("data",h()).map(function(P){return P.get("name","").trim()}).filter(function(P){return!!P});return O.isEmpty()?null:{agent_quick_replies:O.toArray()}}function y(N,O,P){var Q=h(O).filter(function(R){return!!R});Q.isEmpty()?P():a("OzActions").showDialog(a("OzConfirmDialog.react"),{body:Q.size===1?Q.first():a("React").createElement("ul",null,Q.map(function(R,S){return a("React").createElement("li",{key:S},R)})),confirmLabel:a("OzHelpers").toTitleCase(N),header:"Are you sure you want to "+N+" this message?",onConfirm:P})}function z(N){var O=f({hour:"numeric",minute:"numeric"}),P=N.getIn(["location","timezone-offset"]),Q=a("OzHelpers").preferredName(N),R=a("OzHelpers").lastPresence(N);if(P&&!a("OzHelpers").isDaytime(P)&&R&&a("OzHelpers").serverNow()-R>q)return a("React").createElement("span",null,"It's\xa0",a("React").createElement("strong",null,a("React").createElement(a("OzUpdateDateTime.react"),{locale:"en-US",options:O,timezoneOffset:P||0})),"\xa0at ",Q,"'s last known location and they haven't interacted with us since"," ",a("React").createElement("strong",null,a("React").createElement(a("Timestamp.react"),{autoUpdate:true,time:R/1e3})),".")}function A(N,O){var P=O.get("activeIntent"),Q=P&&N.get("intents").find(function(R){return R.get("id")===P});if(!Q||Q.get("state")!=="open")return"You should create an intent or select an open one so the AI can learn from what you're sending."}function B(N){var O=h([[/ +/g,function(P){return P.length>1},"a bunch of spaces in a row"],[/^ | $/gm,function(P){return true},"whitespace at the beginning or end of a line"]]).map(function(P){var Q=P[0],R=P[1],S=P[2];return h(N.match(Q)).some(R)&&S}).filter(function(P){return!!P});if(!O.isEmpty())return a("React").createElement("div",null,"Your text contains some weird formatting:",a("React").createElement("ul",null,O.map(function(P,Q){return a("React").createElement("li",{key:Q},P)})))}function na(N){return a("OzHelpers").hasCmdOrCtrl(N)&&N.which===66}function oa(N){return a("OzHelpers").hasCmdOrCtrl(N)&&N.which===191}function pa(N){return N.getModifierState("Control")&&N.which===78}function C(N,O){var P=N.get(O.get("line"));return h.isList(P)?P.get(O.get("column")):P}function qa(N){return a("KeyBindingUtil").hasCommandModifier(N)&&N.keyCode>=a("Keys").ZERO+1&&N.keyCode<=a("Keys").ZERO+9}function D(N,O){var P=O.lastAIPick,Q=O.lastAIGuesses,R=Q||N.get("guesses"),S=a("OzHelpers").openIntents(N).map(function(T){return T.filter(a("OzHelpers").keysIn("name","wit-intent-uuid"))});a("OzHelpers").debug("building ai usage",a("OzHelpers").threadID(N));return f({gold:P,guesses:R,intents:S})}var ra=/(@\[[^\]]+\])/g;function E(N){var O=void 0,P=[];while(O=ra.exec(N))P.push([O.index,O.index+O[0].length]);return P}function sa(N){return"@["+N+"]"}function F(N){var O=N.getCurrentContent().getBlockMap().toSeq().map(function(P){return[P,E(P.getText())[0]]}).find(function(R){var S=R[0],Q=R[1];return!!Q},null,[]),P=O[0],Q=O[1];return P&&Q?ta.apply(undefined,[P.getKey()].concat(Q)):null}function ta(N,O,P){return new(a("SelectionState"))({anchorKey:N,focusKey:N,anchorOffset:O,focusOffset:P,hasFocus:true,isBackward:false})}var ua=a("OzHelpers").pure(function(N){var O=N.offsetKey,P=N.children;return a("React").createElement("span",{"data-offset-key":O,className:"_a5n"},P)});function va(N,O,P,Q,R,S){var T=xa(O,R,S),U=wa(O,T,P,R,Q,S),V=U.groupBy(function(Y){return Y.get("ui-scheduled")?"scheduled":Y.get("type")===k.SUGG?k.SUGG:"rest"}),W=V.get("rest",h()).push(V.get(k.SUGG)).filter(function(Y){return!!Y}),X=V.get("scheduled",h());if(!N)return X.isEmpty()?h():h().push(X);else if(X.isEmpty())return W;else return W.push(X)}function wa(N,O,P,Q,R,S){var T=O.filter(function(W){return W.get("type")==k.SUGG}).take(25),U=O.filter(function(W){return W.get("type")!=k.SUGG}).concat(Fa(N,S)).take(5),V=T.concat(U);return Ca(R,S).takeLast(1).concat(V).concat(Aa(P,S)).concat(ya(N,Q,S))}function xa(N,O,P){__p&&__p();return(N.get("guesses")||h()).flatMap(function(Q){return Q.get("items")||[Q].map(function(R){return R.merge(f({position:Q.get("position"),confidence:Q.get("confidence"),"class":Q.get("class")}))})}).map(function(Q){switch(Q.get("type")){case k.TEMPLATE:var R=K(N,Q.get("body"));return G(Q)||M(R,P)?Q.set("ui-body",R):null;case"bubble":return G(Q)||L(Q.get("data"),P)?a("OzSuggestions").toServer(Q,O):null;case"close-intent":return I(N,Q);case"create-intent":return H(N,Q);case"close-reminder":return J(N,Q);case"reminder":var S=Q.getIn(["body","description"]),T=Q.get("scheduled-time"),U=a("formatDate")(T/1e3,"g:ia M j");return f({type:k.COMMAND,action:p.CREATE_REMINDER,text:"Create Reminder for "+U+': "'+S+'"',iconCl:"_3e_w",body:Q.get("body"),"scheduled-time":T})}}).filter(function(Q){return!!Q})}function G(N){return!!(N.get("id")&&N.get("at"))}function ya(N,O,P){__p&&__p();return(N.get("events")||h()).concat(N.get("scheduled")||h()).toSeq().map(function(Q){__p&&__p();switch(Q.get("type")){case"send":return Q.set("ui-body",Q.getIn(["data","text"]));case"suggest":return Q.set("type",k.SUGG).set("data",Q.getIn(["data","suggestion"])).updateIn(["data","merchant-name"],function(Q){return a("OzSuggestions").findMerchantName(Q,O)});case"create-intent":return H(N,Q.get("data")).set("id",Q.get("id"));case"close-intent":return I(N,Q.get("data")).set("id",Q.get("id"));case"close-reminder":return J(N,Q.get("data")).merge({id:Q.get("id"),at:Q.get("at")});case"create-reminder":return za(N,Q.get("data")).set("id",Q.get("id"));case k.SURVEY:case k.TEMPLATE:return Q.set("ui-body",K(N,Q.getIn(["data","body"])));case"bubble":return a("OzSuggestions").toServer(Q.get("data"),O).setIn(["data","amount"],+Q.getIn(["data","data","price"])).set("id",Q.get("id"));case"send-calendar":return Q.set("type",k.SUGG).set("data",f({name:Q.getIn(["data","title"]),description:a("OzHelpers").toLocaleDate(Q.getIn(["data","start"])),"merchant-name":"Invite bubble"}));default:a("OzHelpers").debug("[oz-scheduled], unk scheduled",Q)}}).filter(function(Q){return!!Q}).map(function(Q){return Q.set("ui-scheduled",true)}).sortBy(function(Q){return Q.get("at")})}function H(N,O){var P=O.get("name");return O.set("type",k.COMMAND).set("action",p.CREATE_INTENT).set("text","Create intent "+P).set("iconCl","_3e_w")}function I(N,O){var P=O.get("id"),Q=N.get("intents").findLast(function(S){return S.get("id")===P}),R=Q?Q.get("alias")||Q.get("name"):O.get("source");return O.set("type",k.COMMAND).set("action",p.CLOSE_INTENT).set("text","Close intent "+R).set("iconCl","_3e_w")}function J(N,O){var P=O.get("id")||O.get("reminder-id"),Q=N.get("reminders").findLast(function(S){return S.get("id")===P}),R=Q?Q.getIn(["body","description"]):O.get("source");return O.set("type",k.COMMAND).set("action",p.CLOSE_REMINDER).set("text","Close reminder "+R).set("iconCl","_3e_w")}function za(N,O){var P=O.getIn(["body","description"]);return O.set("type",k.COMMAND).set("action",p.CREATE_REMINDER).set("text","Create reminder "+P).set("iconCl","_3e_w")}function Aa(N,O){return a("immutable").fromJS([{type:k.COMMAND,action:p.CREATE_BUBBLE,text:"Create Bubble",iconCl:"_3e_w",shortcut:"B"},!x(N)&&Ba()]).filter(function(P){return P&&M(P.get("text"),O)})}function Ba(){if(a("OzConfig").getInStaticConfig(["GK","quickReplies"]))return{type:k.COMMAND,action:p.ADD_QUICK_REPLIES,text:"Add Quick Replies",iconCl:"_3e_w",shortcut:"/"}}function Ca(N,O){var P=N.filter(function(Q){return L(Q,O)});return(P.isEmpty()?N:P).toList()}function K(N,K){if(typeof K==="string")return K;return K&&K.map(function(O){if(typeof O==="string")return O;return Ea(N,O)}).toJS().join("")}function Da(N){var O=N.get("index");return sa(N.get("type")+(O?" "+O:""))}function Ea(N,O){if(O.get("type")===l.USER_FIRST_NAME)return a("OzHelpers").preferredName(N);return Da(O)}function L(N,O){var P=N.get("data",f());return M(P.get("name","")+"\n     "+P.get("description","")+"\n     "+P.get("target-url",""),O)}function M(N,O){return N&&N.toLowerCase().indexOf((O||"").toLowerCase())>-1}function Fa(N,O){__p&&__p();var P=function P(S){return K(N,S[Math.floor(S.length*Math.random())])},Q="\ud83d\udc64",R=h([K(N,a("immutable").fromJS([{type:l.USER_FIRST_NAME}])),[Q+" Who are you?",function(){return P(["My name is M! I'm your personal assistant in Messenger.","My name is M! I'm your personal assistant. I can help you with things like making reservations, finding the perfect gift or planning your next vacation.","My name is M! I'm your personal assistant in Messenger. I'm here to help you do things better and faster.","My name is M! I'm here to help make your life easier."])}],[Q+" What can you do for me?",function(){return P(["I can help you with lots of things, like figuring out where to go to dinner, finding a great gift for someone, or planning your weekend. Just ask!","I can help you with lots of things. Just ask and I'll let you know if it's something I can't do.","In general, I can help you with anything that's not illegal. Just ask and I'll let you know if there's something I can't do."])}],["Sent the wrong info",function(){return"Sorry! It looks like I sent you the wrong info. @[Right info]"}],[Q+" How did you pick this?",function(){return"I look at a variety of things and try to find the info that's best for you. Would you like me to send you some other options?"}],[Q+" What does M stand for?",function(){return P(["M is just my name! ","Just M!","I'm just M, like Messenger."])}],[Q+" Do you have a partnership with X?",function(){return"No, I just try to find the best info for you. Do you want me to send you some other options?"}],["Storing contact info",function(){return P(["Thanks! I'll remember this for next time."])}],["Don't have an opinion",function(){return"I don't have an opinion about that, but...@[point to resources]"}],["Not my area of expertise",function(){return"I'm not a @[lawyer, financial adviser, etc.] so I can't give you @[legal, financial, etc.] advice, but I can do some research for you. "}],[Q+" What's your favorite sticker?",function(){return P(["I can't pick a favorite!","They're all great!","I love all of the stickers equally!"])}],["General redirect",function(){return"I'm not really sure how to answer that, but can I help you with something else?"}],["Bugs redirect",function(){return"You can actually report things like this right from Facebook. Here's how: https://www.facebook.com/help/326603310765065/ "}],["Facebook support redirect",function(){return P(["I'm not an expert, so I'd recommend checking out the Help Center: www.facebook.com/help (http://www.facebook.com/)","I'm not an expert in that, so I'd recommend going here: www.facebook.com/help (http://www.facebook.com/)"])}],[Q+" What languages do you support?",function(){return"Right now I can only chat in English. Sorry for the inconvenience!"}],["Trolling (abusing M/the agents)",function(){return P(["Is there anything I can help you with?","Unfortunately I won't be able to chat with you if you say things like that."])}],["Generic don't support message",function(){return P(["Unfortunately I can't do that. Is there anything else I can help you with?","Unfortunately I can't help you with that. @[Sorry for the inconvenience.] Is there anything else I can do for you?","Unfortunately I can't support this type of request. Is there anything else I can help you with?"])}],[Q+" What are you? Are you human?",function(){return P(["I'm M! I use artificial intelligence, but people help train me to so I'll get better and better over time.","I'm M! I use artificial intelligence, but people help train me."])}],[Q+" What gender are you?",function(){return"I don't have a gender. I'm just M."}],[Q+" How old are you?",function(){return"I don't have an age. Maybe 42?"}],[Q+" Who made you? Where did you come from?",function(){return P(["I was designed by the Messenger Team.","I was created by the Messenger Team."])}],[Q+" What do you look like?",function(){return"That's me in the picture next to this message."}],[Q+" Can you talk or just type?",function(){return"I can send you messages here in Messenger. "}],[Q+" Where do you live?",function(){return"Right here in Messenger."}],[Q+" Can you call/message/email my friend?",function(){return"Unfortunately I can't do that. Is there anything else I can help you with?"}],["Medical redirect",function(){return"Unfortunately I can't support this type of request right now. Is there anything else I can help you with?"}],"I'm a little busier than usual right now. I want to give you my full attention, so I'll get back to you as soon as I can. In the meantime, feel free to send me any extra info about your request.","I'm on it!",["You're welcome.",function(){return P(["You're welcome.","You're welcome! Let me know if there's anything else I can help you with.","You're welcome! Let me know if you need anything else.","You're welcome! Let me know if I can help you with anything else."])}],["Anything else",function(){return P(["Let me know if there's anything else I can help you with.","Let me know if I can help with anything else.","Great! Let me know if there's anything else I can help you with.","Let me know if there's anything else I can help you with today."])}],"How does this look?",["I'm on it",function(){return P(["Sure, I'm on it!","I'll look into that for you.","I'll look into that for you!","I'll do some research."])}],"How can I help you today?","How about this?","Is this what you're looking for?","I'll take care of it!","What email should I use for the invite?","Where should I send the invite?","When would you like to dine and how many people will be joining you?",["Save phone number",P(["Would you like me to save your phone number for future requests?","What phone number would you like me to use for the reservation?"])],"Do you have a price range in mind?","Here are some options:"]).map(function(S){return Array.isArray(S)?f({"ui-body":S[0],type:k.TEMPLATE,f:S[1]}):f({"ui-body":S,type:k.TEMPLATE})}).filter(function(S){return M(S.get("ui-body"),O)});return R}b.exports=a("OzWrapper.react")(ha)}),null);
__d("OzCheckboxInput.react",["cx","invariant","AbstractCheckboxInput.react","OzImmutablePureRenderMixin","React","joinClasses"],(function a(b,c,d,e,f,g,h,i){var j=c("React").createClass({displayName:"OzCheckboxInput",mixins:[c("OzImmutablePureRenderMixin")],render:function k(){return c("React").createElement(c("AbstractCheckboxInput.react"),babelHelpers["extends"]({},this.props,{className:c("joinClasses")(this.props.className,"_55sg _4k1t"),onChange:this._handleChange}))},_handleChange:function k(l){var m=l.target;m instanceof HTMLInputElement||i(0);this.props.onChange&&this.props.onChange(m.checked)}});f.exports=j}),null);
__d("OzMessageFeedbackDialog.react",["cx","invariant","ContextualLayerAutoFlip","ContextualLayerUpdateOnScroll","InputLabel.react","OzButton.react","OzCheckboxInput.react","React","StarsInput.react","XUIContextualDialog.react","XUIContextualDialogBody.react"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("React").PropTypes,m=["Poor","Average","Great"];j=babelHelpers.inherits(n,c("React").Component);k=j&&j.prototype;function n(){__p&&__p();var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.$OzMessageFeedbackDialog1=function(){var t=this.props.onFollowedPolicyChange;t&&t(true)}.bind(this),this.$OzMessageFeedbackDialog2=function(){var t=this.props.onFollowedPolicyChange;t&&t(false)}.bind(this),this.$OzMessageFeedbackDialog3=function(t){t.target instanceof HTMLTextAreaElement||i(0);this.props.onFeedbackChange(t.target.value)}.bind(this),p}n.prototype.render=function(){return c("React").createElement(c("XUIContextualDialog.react"),{behaviors:{ContextualLayerAutoFlip:c("ContextualLayerAutoFlip"),ContextualLayerUpdateOnScroll:c("ContextualLayerUpdateOnScroll")},contextRef:this.props.contextRef,shown:true},c("React").createElement(c("XUIContextualDialogBody.react"),{className:"_5dx"},c("React").createElement("div",{className:"_5333"},c("React").createElement("div",{className:"_5334"},c("React").createElement("div",null,c("React").createElement("h3",null,"Tone"),c("React").createElement(c("StarsInput.react"),{count:this.props.toneRating,large:true,allowMultipleSubmissions:true,onClick:this.props.onToneRatingChange,starLabels:m}),c("React").createElement("h3",null,"Execution"),c("React").createElement(c("StarsInput.react"),{count:this.props.executionRating,large:true,allowMultipleSubmissions:true,onClick:this.props.onExecutionRatingChange,starLabels:m}))),c("React").createElement("div",{className:"_5335"},c("React").createElement("div",null,c("React").createElement("h3",null,"Responsiveness"),c("React").createElement(c("StarsInput.react"),{count:this.props.responsivenessRating,large:true,allowMultipleSubmissions:true,onClick:this.props.onResponsivenessRatingChange,starLabels:m}),c("React").createElement("h3",null,"Console"),c("React").createElement(c("StarsInput.react"),{count:this.props.consoleRating,large:true,allowMultipleSubmissions:true,onClick:this.props.onConsoleRatingChange,starLabels:m})))),c("React").createElement("div",null,c("React").createElement("h3",null,"Followed Policy"),c("React").createElement("div",null,c("React").createElement(c("InputLabel.react"),{label:"Yes"},c("React").createElement(c("OzCheckboxInput.react"),{checked:this.props.followedPolicy===true,onChange:this.$OzMessageFeedbackDialog1})),c("React").createElement(c("InputLabel.react"),{label:"No"},c("React").createElement(c("OzCheckboxInput.react"),{checked:this.props.followedPolicy===false,onChange:this.$OzMessageFeedbackDialog2}))),c("React").createElement("h3",null,"Message"),c("React").createElement("div",{className:"_5336"},c("React").createElement("textarea",{maxLength:"2500",value:this.props.feedback,onChange:this.$OzMessageFeedbackDialog3,placeholder:"Give more details here"}))),c("React").createElement("div",{className:"_5dy"},c("React").createElement(c("OzButton.react"),{onClick:this.props.onClose},"Cancel"),c("React").createElement(c("OzButton.react"),{className:"_5dz",onClick:this.props.onSave,primary:true},"Save"))))};n.propTypes={contextRef:l.func.isRequired,executionRating:l.oneOf([0,1,2,3]),followedPolicy:l.bool,onClose:l.func,onExecutionRatingChange:l.func,onFollowedPolicyChange:l.func,onResponsivenessRatingChange:l.func,onConsoleRatingChange:l.func,onSave:l.func,onToneRatingChange:l.func,responsivenessRating:l.oneOf([0,1,2,3]),consoleRating:l.oneOf([0,1,2,3]),toneRating:l.oneOf([0,1,2,3])};f.exports=n}),null);
__d("OzMessageFeedback.react",["cx","joinClasses","immutable","ReactLayeredComponentMixin_DEPRECATED","OzMessageFeedbackDialog.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").Map,l=c("React").PropTypes,m="feedback_dialog",n="no_dialog",o=c("React").createClass({displayName:"OzMessageFeedback",mixins:[c("ReactLayeredComponentMixin_DEPRECATED"),c("OzImmutablePureRenderMixin")],propTypes:{message:l.instanceOf(k).isRequired,onSave:l.func.isRequired},getInitialState:function s(){return babelHelpers["extends"]({currentDialog:n},q(this.props.message))},componentWillReceiveProps:function s(t){if(t.message!==this.props.message)this.setState(q(t.message))},render:function s(){var t=this.state.currentDialog,u=r(this.state);return c("React").createElement("div",{className:"_2bxa _2bxb"+(u?" _2bxc":"")+(t!==n?" _2bxd":"")},c("React").createElement(p,{className:"_2bxf",onClick:function(v){return this.setState({currentDialog:m})}.bind(this),isActive:u||t===m,ref:"flag"}))},renderLayers:function s(){switch(this.state.currentDialog){case m:return{contextualDialog:this._renderFeedbackDialog()};default:return null}},_renderFeedbackDialog:function s(){return c("React").createElement(c("OzMessageFeedbackDialog.react"),{contextRef:function(){return this.refs.flag}.bind(this),executionRating:this.state.executionRating,followedPolicy:this.state.followedPolicy,onClose:this._handleDialogClose,onExecutionRatingChange:function(t){this.setState({executionRating:t})}.bind(this),onFollowedPolicyChange:function(t){this.setState({followedPolicy:t})}.bind(this),onResponsivenessRatingChange:function(t){this.setState({responsivenessRating:t})}.bind(this),onSave:this._handleFeedbackSave,onToneRatingChange:function(t){this.setState({toneRating:t})}.bind(this),onConsoleRatingChange:function(t){this.setState({consoleRating:t})}.bind(this),responsivenessRating:this.state.responsivenessRating,toneRating:this.state.toneRating,consoleRating:this.state.consoleRating,feedback:this.state.feedback,onFeedbackChange:function(t){this.setState({feedback:t})}.bind(this)})},_handleFeedbackSave:function s(){this.props.onSave(k({execution:this.state.executionRating,"followed-policy":this.state.followedPolicy,mid:this.props.message.get("mid"),"offline-threading-id":this.props.message.get("offline-threading-id"),responsiveness:this.state.responsivenessRating,tone:this.state.toneRating,feedback:this.state.feedback,"console-proficiency":this.state.consoleRating}));this._handleDialogClose()},_handleDialogClose:function s(){this.setState({currentDialog:n})}});i=babelHelpers.inherits(p,c("React").Component);j=i&&i.prototype;p.prototype.render=function(){"use strict";var s=this.props,t=s.className,u=s.onClick,v=s.isActive;return c("React").createElement("button",{role:"button",className:c("joinClasses")("_1-hv _2bxi"+(v?" _2bxj":""),t),onClick:u})};function p(){"use strict";i.apply(this,arguments)}function q(s){return{executionRating:s.get("execution"),feedback:s.get("feedback"),followedPolicy:s.get("followed-policy"),responsivenessRating:s.get("responsiveness"),toneRating:s.get("tone"),consoleRating:s.get("console-proficiency")}}function r(s){return!!(s.executionRating||s.followedPolicy!==undefined||s.responsivenessRating||s.toneRating||s.consoleRating)}f.exports=o}),null);
__d("OzMessageQuickReplies.react",["cx","ContextualLayerAutoFlip","ContextualLayerUpdateOnScroll","React","XUICloseButton.react","immutable","XUIContextualDialog.react","XUIContextualDialogBody.react","ReactLayeredComponentMixin_DEPRECATED","OzImmutablePureRenderMixin"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("React").PropTypes,j=c("immutable").Map,k=c("immutable").List,l=c("React").createClass({displayName:"OzMessageQuickReplies",mixins:[c("ReactLayeredComponentMixin_DEPRECATED"),c("OzImmutablePureRenderMixin")],propTypes:{message:i.instanceOf(j).isRequired},getInitialState:function n(){return babelHelpers["extends"]({displayDialog:false},m(this.props.message))},render:function n(){return c("React").createElement("div",{className:"_g8_"},c("React").createElement("button",{className:"_1-hv _g90 _g91",onClick:function(o){return this.setState({displayDialog:!this.state.displayDialog})}.bind(this),ref:"flag"}))},renderLayers:function n(){if(this.state.displayDialog)return{contextualDialog:this._renderQRDialog()};else return null},_renderQRDialog:function n(){return c("React").createElement(c("XUIContextualDialog.react"),{behaviors:{ContextualLayerAutoFlip:c("ContextualLayerAutoFlip"),ContextualLayerUpdateOnScroll:c("ContextualLayerUpdateOnScroll")},contextRef:function(){return this.refs.flag}.bind(this),shown:true},c("React").createElement(c("XUIContextualDialogBody.react"),null,c("React").createElement("div",{className:"_g92"},c("React").createElement("div",{className:"_g93"},c("React").createElement("ul",null,this.state.quickReplies.map(function(o){return c("React").createElement("li",{key:o},o)}))),c("React").createElement(c("XUICloseButton.react"),{onClick:function(o){return this.setState({displayDialog:false})}.bind(this)}))))}});function m(n){return{quickReplies:n.getIn(["generic-metadata","agent_quick_replies"],k())}}f.exports=l}),null);
__d("OzInboxMessage.react",["cx","OzAPI","OzHelpers","immutable","OzActions","OzConfig","OzConstants","OzMessage.react","OzMessageFeedback.react","OzMessageQuickReplies.react","OzImmutablePureRenderMixin","React","Reflux"],(function a(b,c,d,e,f,g,h){var i=c("immutable").Map,j=c("OzConstants").AUTHOR_TYPES,k=c("React").PropTypes,l=c("React").createClass({displayName:"OzInboxMessage",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{authorType:k.oneOf(c("OzHelpers").values(j)),isActive:k.bool.isRequired,message:k.instanceOf(i).isRequired,threadID:k.string.isRequired},render:function m(){var n=this.props,o=n.message,p=n.authorType,q=n.threadID,r=n.isActive,s=!!o.get("author"),t=c("OzConfig").ConfigStore.data.getIn(["GK","displayQR"])&&!!o.getIn(["generic-metadata","agent_quick_replies"]),u=this.state.config;return c("React").createElement("div",{className:"clearfix _4y6j"+(r?" _4qv0":"")+(p===j.TRAINER?" _2ij4":"")+(p===j.BOT?" _2ij5":"")+(p===j.USER?" _2p0":"")+(u.getIn(["GK","supervisor"])?" _1w52":"")},c("React").createElement("div",{className:"_2pf"},c("React").createElement(c("OzMessage.react"),{message:o}),p===j.USER?c("React").createElement("button",{onClick:function v(){return c("OzActions").intentCreator.toggle(o.get("mid"))},className:"_1-hv _30yy _4nd4 _ftb"}):null),t?c("React").createElement(c("OzMessageQuickReplies.react"),{message:o}):null,s?c("React").createElement(c("OzMessageFeedback.react"),{message:o,onSave:function v(w){return c("OzAPI").updateMessage(q,w)}}):null)}});f.exports=l}),null);
__d("OzInboxMessageGroup.react",["cx","OzHelpers","immutable","OzConfig","OzConstants","OzDate.react","OzInboxMessage.react","OzUserImage.react","OzImmutablePureRenderMixin","React","Reflux","Tooltip"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("React").PropTypes,k=c("OzConstants").AUTHOR_TYPES,l=c("React").createClass({displayName:"OzInboxMessageGroup",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{activeMsgID:j.string,authorID:j.string,authorType:j.oneOf(c("OzHelpers").values(k)),execTime:j.number,intentID:j.number,messages:j.array.isRequired,repNames:j.instanceOf(i).isRequired,thread:j.object.isRequired,timestamp:j.number.isRequired},scrollMessageIntoViewIfNeeded:function n(o){var p=this.refs[o];p?p.scrollIntoViewIfNeeded():c("OzHelpers").error("[inboxgroup] message id "+o+" not in group")},render:function n(){return c("React").createElement("div",{className:"_528w"},this._renderGroup())},_renderGroup:function n(){var o=this.props.authorType,p=k.BOT,q=k.TRAINER,r=k.USER;switch(o){case q:case p:return c("React").createElement("div",{className:(o===p?"_4m3p":"")+(o===q?" _4m3r":"")},this._renderMessages(),this._renderBottomMeta());case r:return c("React").createElement("div",{className:"_4m3u"},c("React").createElement("div",{className:"_2wyu"},this._renderPhoto()),c("React").createElement("div",{className:"_2wyv"},this._renderMessages(),this._renderBottomMeta()));default:c("OzHelpers").error("got unk author type",this.props);return null}},_renderPhoto:function n(){var o=c("OzHelpers").photo(this.props.thread),p=c("OzHelpers").getName(this.props.thread),q=c("OzHelpers").lastPresence(this.props.thread),r=c("OzDate.react").formatTimestamp(q);return c("React").createElement("div",{className:"_528y"},c("React").createElement("span",c("Tooltip").propsFor("Seen by "+p+" at "+r,"left"),c("React").createElement(c("OzUserImage.react"),{photo:o})))},_renderSeen:function n(){return c("React").createElement("div",{className:"_40ue"},this._renderPhoto())},_renderMessages:function n(){var o=this.props,p=o.messages,q=o.authorType,r=o.thread,s=o.activeMsgID;return c("React").createElement("div",{className:"_528z"},p.map(function(t){return c("React").createElement("div",{key:c("OzHelpers").msgID(t),ref:c("OzHelpers").msgID(t)},c("React").createElement(c("OzInboxMessage.react"),{authorType:q,isActive:c("OzHelpers").msgID(t)===s,message:t,threadID:c("OzHelpers").threadID(r)}),t.get("ui-seen")?this._renderSeen():null)}.bind(this)))},_renderBottomMeta:function n(){var o=this.props,p=o.authorID,q=o.execTime,r=o.intentID,s=o.repNames,t=o.thread,u=o.timestamp;return c("React").createElement("div",{className:"_4m3v"},c("React").createElement("div",null,c("React").createElement("span",{className:"_4m3w"},s.get(p)||p||null),c("React").createElement(c("OzDate.react"),{className:"_4m3x",timestamp:u})),this.state.config.getIn(["GK","responsivenessExecTime"])&&r!=null&&q!=null&&c("React").createElement("div",{className:"_5sme"},c("React").createElement("span",c("Tooltip").propsFor(m(c("OzHelpers").intentById(t,r)),"below"),"I")," ","+ ",c("OzHelpers").durationStr(q)))}});function m(){var n=arguments.length<=0||arguments[0]===undefined?i():arguments[0],o=n.get("name"),p=n.get("alias");return p&&o?p+" ("+o+")":p||o||"[unknown intent]"}f.exports=l}),null);
__d("OzInboxMessageList.react",["cx","OzHelpers","immutable","OzConstants","OzInboxMessageGroup.react","OzLoading.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").Map,l=c("React").PropTypes,m=c("OzLoading.react").Inline,n=20;i=babelHelpers.inherits(o,c("React").Component);j=i&&i.prototype;function o(){__p&&__p();var u,v;"use strict";for(var w=arguments.length,x=Array(w),y=0;y<w;y++)x[y]=arguments[y];return v=(u=j.constructor).call.apply(u,[this].concat(x)),this.scrollToMessage=function(z){return k(this.refs).find(function(A){return A.props.messages.some(function(B){return c("OzHelpers").msgID(B)===z})}).scrollMessageIntoViewIfNeeded(z)}.bind(this),this.$OzGroupList1=function(z,A){var B=this.props.thread,C=z[0],D=z[z.length-1],E=C.get("sender"),F=C.get("author"),G=C.get("timestamp"),H=D.get("timestamp"),I=D.get("intent-id"),J=D.get("executional-time"),K=E+G;return c("React").createElement(c("OzInboxMessageGroup.react"),{authorID:F,authorType:c("OzHelpers").authorType(C),activeMsgID:this.props.activeMsgID,execTime:J,intentID:I,key:K,messages:z,ref:K,repNames:this.props.repNames,thread:B,timestamp:H})}.bind(this),v}o.prototype.shouldComponentUpdate=function(u,v){"use strict";return!(this.props.activeMsgID===u.activeMsgID&&c("immutable").is(this.props.thread,u.thread)&&c("immutable").is(this.props.repNames,u.repNames)&&c("immutable").is(this.props.messages,u.messages))};o.prototype.render=function(){"use strict";var u=this.props.messages.reduceRight(r.bind(null,this.props.thread),{groupsList:[],nextTimestamp:null}).groupsList.map(this.$OzGroupList1);return c("React").createElement("frag",null,u)};o.propTypes={activeMsgID:l.string,messages:l.instanceOf(k).isRequired,repNames:l.instanceOf(k).isRequired,thread:l.instanceOf(k).isRequired};var p=c("React").createClass({displayName:"OzInboxMessageList",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{activeMsgID:l.string,clientLimit:l.number.isRequired,loading:l.bool.isRequired,messages:l.instanceOf(k).isRequired,onScrollTop:l.func.isRequired,repNames:l.instanceOf(k).isRequired,thread:l.instanceOf(k).isRequired},componentDidMount:function u(){c("OzHelpers").scrollToBottom(this.refs.scrollable)},componentWillUpdate:function u(){this._wasScrolledToBottom=t(this.refs.scrollable);this._originalScrollHeight=this.refs.scrollable.scrollHeight;this._originalScrollTop=this.refs.scrollable.scrollTop;this._originalActiveMsgID=this._visiblyActiveMsgID()},componentDidUpdate:function u(v){__p&&__p();var w=this._visiblyActiveMsgID();if(w&&w!==this._originalActiveMsgID){c("OzHelpers").debug("[messagelist] scrolling to active msg id "+w);this.refs.groupList.scrollToMessage(w)}else if(this._wasScrolledToBottom||s(v.messages,this.props.messages)||c("OzHelpers").threadID(v.thread)!==c("OzHelpers").threadID(this.props.thread)){c("OzHelpers").debug("[messagelist] scrolling bottom");c("OzHelpers").scrollToBottom(this.refs.scrollable)}else{var x=this.refs.scrollable.scrollHeight-this._originalScrollHeight+this._originalScrollTop;this.refs.scrollable.scrollTop=x}},resize:function u(){this.componentDidUpdate(this.props)},_visibleMessages:function u(){var v=this.props,w=v.messages,x=v.clientLimit;return w.takeLast(x)},_visiblyActiveMsgID:function u(){var v=this.props.activeMsgID,w=this._visibleMessages();if(w.some(function(x){return c("OzHelpers").msgID(x)===v}))return v;if(v)c("OzHelpers").debug("[messagelist] msg "+v+" not visible",w.toJS());return null},render:function u(){var v=this.props,w=v.loading,x=v.sending,y=v.thread;return c("React").createElement("div",{onScroll:this._handleScroll,className:"_4fj7",ref:"scrollable"},c("React").createElement(m,{loading:w}),c("React").createElement(o,{activeMsgID:this.props.activeMsgID,thread:y,messages:this._visibleMessages(),ref:"groupList",repNames:this.props.repNames}),c("React").createElement(m,{loading:x}))},_handleScroll:function u(){if(this.refs.scrollable.scrollTop<n)this.props.onScrollTop()}});function q(u,v,w){var x=u.get("timestamp"),y=function y(A){var B=A>=x,C=!w||A<w;return B&&C},z=v.get("last-seen");if(y(z))u=u.set("ui-seen",true);return u}function r(u,v,w){var x=v.groupsList,y=v.nextTimestamp;w=q(w,u,y);var z=w.get("author"),A=w.get("timestamp"),B=c("OzHelpers").authorType(w),C=x[0],D=C&&C[C.length-1],E=D&&D.get("author"),F=D?D.get("timestamp"):Infinity,G=D&&c("OzHelpers").authorType(D);if(E!==z||F-A>6e4||G!==B)x.unshift([w]);else C.unshift(w);return{groupsList:x,nextTimestamp:A}}function s(u,v){var w=u.last(),x=v.last();return x.get("timestamp")>w.get("timestamp")}function t(u){return u.scrollHeight-u.scrollTop===u.clientHeight}f.exports=p}),null);
__d("OzIntentDropdown.react",["cx","Promise","immutable","OzSearchSource","React","SearchableDropdownInput.contrib","SearchableEntry"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").Map,l=c("immutable").List,m=c("React").PropTypes;i=babelHelpers.inherits(n,c("React").PureComponent);j=i&&i.prototype;n.prototype.componentWillMount=function(){"use strict";this.$OzIntentDropdown1=new(c("OzSearchSource"))(function(s){var t=s.query;return c("Promise").resolve(o(t,this.props.witIntents))}.bind(this))};n.prototype.componentDidMount=function(){"use strict";var s=this.refs.dropdown;s&&s.focusInput()};n.prototype.render=function(){"use strict";var s=this.props,t=s.onSelect,u=s.selected;return c("React").createElement("div",{className:"_5yeg"},c("React").createElement(c("SearchableDropdownInput.contrib"),{ref:"dropdown",listClassName:"_2sg3",searchSource:this.$OzIntentDropdown1,value:u?r(u):null,onSelect:function v(w){return t(q(w))},placeholder:"Pick Intent",showSelectedSubtitle:false}))};function n(){"use strict";i.apply(this,arguments)}n.propTypes={selected:m.instanceOf(k),witIntents:m.instanceOf(k).isRequired,onSelect:m.func.isRequired};function o(s,t){var u=function u(v){return v.map(r).toArray()};if(!s)return u(t.take(10));return u(p(t,s).take(10))}function p(s,t){var u=function u(w){return(w||"").toLowerCase().indexOf(t)>=0},v=s.groupBy(function(w){return u(w.get("name"))?"with-name":"other"});return(v.get("with-name")||l()).concat((v.get("other")||l()).filter(function(w){return u(w.get("doc"))}))}function q(s){return k({name:s.getTitle(),doc:s.getSubtitle(),id:s.getUniqueID()})}function r(s){return new(c("SearchableEntry"))({title:s.get("name"),subtitle:s.get("doc"),uniqueID:s.get("id")})}f.exports=n}),null);
__d("OzIntentCreator.react",["cx","OzAPI","OzHelpers","immutable","Keys","OzNotify","OzActions","OzDraggable.react","OzIntentDropdown.react","ReactComponentWithPureRenderMixin","React","Reflux"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Record,j=c("immutable").Map,k=c("React").PropTypes,l=i({shown:false,selected:null,mid:null}),m=c("Reflux").createStore({init:function t(){this.data=l();this.listenToMany(c("OzActions").intentCreator)},getInitialState:function t(){return this.data},onSelect:function t(u){this._u(function(v){return v.set("selected",u)})},toggle:function t(u){this._u(function(v){return v.update("shown",function(w){return!w}).set("mid",u)})},clear:function t(){this._u(function(u){return l()})},_u:function t(u){this.data=u(this.data);this.trigger(this.data)}}),n=c("React").createClass({displayName:"OzIntentCreator",mixins:[c("Reflux").connect(m,"store"),c("ReactComponentWithPureRenderMixin")],propTypes:{witIntents:k.instanceOf(j).isRequired,thread:k.instanceOf(j).isRequired},contextTypes:{router:k.object.isRequired},componentDidMount:function t(){document.addEventListener("keydown",this._handleKBShortcuts);this._unlisten=function(){document.removeEventListener("keydown",this._handleKBShortcuts)}.bind(this)},componentWillUnmount:function t(){this._unlisten()},render:function t(){if(!this.state.store.get("shown"))return null;var u=this.props.witIntents;return c("React").createElement(c("OzDraggable.react"),{className:"_1l0z"},c("React").createElement("div",{className:"_1l0-"},c("React").createElement("div",{className:"_1l0_"},c("React").createElement("div",{className:"_1l10"},"Intent"),c("React").createElement("div",{className:"_1l11"},c("React").createElement(c("OzIntentDropdown.react"),{witIntents:u.filterNot(q),selected:this._selected(),onSelect:c("OzActions").intentCreator.select}))),c("React").createElement("div",{className:"_1l14"},c("React").createElement(o,{color:"blue",onClick:this._handleSave},"Save"),c("React").createElement(o,{color:"grey",onClick:c("OzActions").intentCreator.clear},"Cancel"))))},_selected:function t(){var u=this.state.store.get("selected"),v=this.props.thread.get("intent-diag");return u||p(v,this.props.witIntents)},_handleSave:function t(){var u=this._selected(),v=this.props.thread;if(!u){c("OzNotify").error("You need to pick an intent!");return}c("OzActions").intentCreator.clear();c("OzAPI").createIntent(c("OzHelpers").threadID(v),r(u,v.get("intent-diag"),this.state.store.get("mid"))).done(function(w){this.context.router.push(c("OzHelpers").threadPath({threadid:c("OzHelpers").threadID(w),intentid:w.getIn(["intents",-1,"id"])}))}.bind(this))},_handleKBShortcuts:function t(u){var v=this.state.store.get("shown");if(s(u)||u.which===c("Keys").ESC&&v){u.preventDefault();c("OzActions").intentCreator.toggle()}}}),o=c("OzHelpers").pure(function(t){var u=t.color,v=t.children,w=t.onClick;return c("React").createElement("button",{onClick:w,className:"_1-hv _1l1b"+(u==="blue"?" _1l1x":"")+(u==="grey"?" _1l1y":"")},v)});function p(t,u){if(!t)return null;var v=u.get(t.get("wit-intent-uuid"));if(!v||q(v))return null;return v}function q(t){return t.get("name").match(/^dialog_/)}function r(t,u,v){var w=j({name:t.get("name"),"wit-intent-uuid":t.get("id"),mid:v});return u&&w.get("wit-intent-uuid")===u.get("wit-intent-uuid")?w.merge(u):w}function s(t){return t.getModifierState("Control")&&t.which==c("Keys").SPACE}f.exports=n}),null);
__d("OzInboxShow.react",["cx","Promise","OzStrings","OzAPI","OzHelpers","immutable","OzNotify","relativeTimeString.atlas","OzActions","OzButton.react","OzComposer.react","OzConfig","OzConfirmDialog.react","OzConstants","OzInboxMessageList.react","OzIntentCreator.react","OzStores","OzThreadLabels.react","OzUpdateDateTime.react","promiseFinally","OzImmutablePureRenderMixin","React","Reflux","Tooltip"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").List,j=c("immutable").Map,k=c("React").PropTypes,l=c("OzConstants").AUTHOR_TYPES,m=c("OzStores").PendingMessageStateStore,n=c("OzThreadLabels.react").OzLabelList,o=c("OzConfig").ConfigStore,p=c("Reflux").createAction(),q=c("Reflux").createStore({init:function A(){this._data=j();this.listenTo(p,this._onUpdateFetchState)},getInitialState:function A(){return this._data},_onUpdateFetchState:function A(B,C){this._data=this._data.update(B,function(D){return(D||j()).merge(C)});this.trigger(this._data)}}),r="NO_OWNER",s=25,t=25,u=100,v=1e4,w=c("React").createClass({displayName:"OzInboxShow",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(q,"fetchStates"),c("Reflux").connect(m,"pendingMessageState"),c("Reflux").connect(o,"config")],contextTypes:{uid:k.string.isRequired,router:k.object.isRequired},getInitialState:function A(){return z()},componentDidMount:function A(){this._init(this.props);var B=c("OzActions").scrollThreadToTimestamp.listen(this._scrollToTimestamp);this._unlisten=function(){B()}},componentWillReceiveProps:function A(B){if(c("OzHelpers").threadID(B.thread)!==c("OzHelpers").threadID(this.props.thread)){c("OzHelpers").debug("[inboxshow] thread changed");this._init(B)}if(c("OzHelpers").isUnread(B.thread)&&c("OzHelpers").isOwner(B.thread,this.context.uid))c("OzAPI").markRead(c("OzHelpers").threadID(B.thread))},_init:function A(B){this.setState(z(),function(C){if(!B.thread.get("light-thread")&&x(B.thread).size<s)this._fetchMessages()}.bind(this))},componentWillUnmount:function A(){this._unlisten()},render:function A(){var B=this.state,C=B.fetchStates,D=B.pendingMessageState,E=B.clientLimit,F=B.activeMsgID,G=this.props,H=G.reps,I=G.thread,J=G.merchants,K=G.witIntents,L=x(I),M=c("OzHelpers").threadID(I),N=D.get(M,0)>0,O=H.map(function(Q){return Q.get("name")});if(F)c("OzHelpers").debug("[inboxshow] Rendering with active msg id "+F);var P={humans:this.props.humans,onOwnerChange:this._handleOwnerChange,repNames:O,reps:H,requirements:this.props.requirements,thread:I,witIntents:this.props.witIntents};return c("React").createElement("div",{className:"_1x8x"+(c("OzHelpers").hasTag(I,"employee")?" _1yyg":"")+(c("OzHelpers").hasEngage(I)?" _1fi":"")},c("React").createElement(c("OzIntentCreator.react"),{thread:I,witIntents:K}),c("React").createElement("div",{className:"_1x8y"},this._renderHistoryHeader(),c("React").createElement("div",{className:"_1x96"},c("React").createElement(c("OzInboxMessageList.react"),{activeMsgID:F,clientLimit:E,loading:!!C.getIn([M,"loading"]),onScrollTop:this._fetchMessages,messages:L,ref:"messageList",repNames:O,sending:N,thread:I})),c("React").createElement("div",{className:"_237y"},c("React").createElement(c("OzComposer.react"),{merchants:J,onResize:this._handleResize,thread:I}))),c("React").cloneElement(this.props.children,P))},_scrollToTimestamp:function A(B){__p&&__p();var C=c("OzHelpers").threadID(this.props.thread);c("OzHelpers").debug("[inboxshow] received request to scroll to ts "+B);this.setState({activeMsgID:null});this._backloadHistoryUntil(C,B)["catch"](function(D){return c("OzActions").doneScrollingToTimestamp(B,true)}).then(function(D){c("OzActions").doneScrollingToTimestamp(B);if(c("OzHelpers").threadID(this.props.thread)!==C)c("OzHelpers").debug("[inboxshow] aborting scroll because thread changed");else{this.setState({clientLimit:this.state.clientLimit+D.size});var E=D.isEmpty()?x(this.props.thread):D,F=c("OzHelpers").msgID(E.filter(function(G){return c("OzHelpers").authorType(G)===l.USER}).findLast(function(G){return G.get("timestamp")<=B}));this._activateAndScrollToMsg(F)}}.bind(this)).done()},_backloadHistoryUntil:function A(B,C){__p&&__p();var D=function D(H,I){__p&&__p();return c("OzAPI").history(B,H,u).then(function(J){var K=y(J,H);if(K===H||J.isEmpty())throw K;var L=I.merge(J);c("OzHelpers").debug("[inboxshow] got "+L.size+"; dt="+(K-C));var M=J.filter(function(N){return c("OzHelpers").authorType(N)===l.USER});return M.some(function(N){return N.get("timestamp")<=C})?L:D(K,I.merge(J))})},E=this.state.fetchStates.getIn([B,"timestamp"]),F=this._unseenButLoadedMessages(),G=x(this.props.thread).filter(function(H){return c("OzHelpers").authorType(H)===l.USER}).some(function(H){return H.get("timestamp")<=C});if(G){c("OzHelpers").debug("[inboxshow] desired timestamp "+C+" already loaded");return new(c("Promise"))(function(H){return H(F)})}c("OzHelpers").debug("[inboxshow] backloading to ts "+C+" from "+E);return this._withFetchState(B,E,D(E,j())).then(function(H){return H.merge(F).sortBy(function(I){return I.get("timestamp")})})},_activateAndScrollToMsg:function A(B){this.setState({activeMsgID:B},function(C){window.setTimeout(function(){if(this.state.activeMsgID===B){c("OzHelpers").debug("[inboxshow] CLEARING ACTIVE MSG ID");this.setState({activeMsgID:null})}}.bind(this),v)}.bind(this))},_withFetchState:function A(B,C,D){__p&&__p();var E=this.state.fetchStates.get(B,j());if(E.get("loading")||E.get("fetchedAll")){c("OzHelpers").debug("[inboxshow] already loading or at beginning of time");return new(c("Promise"))(function(F){return F()})}c("OzHelpers").debug("[inboxshow] performing load");p(B,j({loading:true}));return c("promiseFinally")(D,function(F){return p(B,j({loading:false}))}).then(function(F){var G=y(F,C||Infinity);c("OzHelpers").debug("[inboxshow] loaded "+F.size+"; ts="+G);p(B,j({fetchedAll:F.isEmpty()||G===C,timestamp:G}));return F})},_unseenButLoadedMessages:function A(){return x(this.props.thread).skipLast(this.state.clientLimit)},_fetchMessages:function A(){var B=c("OzHelpers").threadID(this.props.thread),C=this.state.fetchStates.getIn([B,"timestamp"]);this.setState({clientLimit:this.state.clientLimit+s});if(!this._unseenButLoadedMessages().isEmpty()){c("OzHelpers").debug("[inboxshow] using client cache instead of fetch");return}this._withFetchState(B,C,c("OzAPI").history(B,C,t)).done()},_handleGrab:function A(){c("OzAPI").grab(c("OzHelpers").threadID(this.props.thread))},_handleResize:function A(){this.refs.messageList.resize()},_handleOwnerChange:function A(B){__p&&__p();var C=B.value;if(C&&C!==r){var D=this.props.reps.get(C),E=this.props.thread,F=c("OzHelpers").threadID(E);if(!c("OzHelpers").hasOpenIntents(E)){var G="You must create an intent first";c("OzNotify").warn(G)}else{if(D.get("is-coach")&&!c("OzHelpers").isEscalated(E))c("OzAPI").escalateTo(F,C);else c("OzAPI").assignTo(F,C);if(!D.get("is-coach")&&c("OzHelpers").isEscalated(E)){var H='Please remove the "Escalated" tag to prevent the thread from getting reassigned to a coach';c("OzNotify").warn(H)}}}},_renderHistoryHeader:function A(){var B=this.props.thread,C=c("OzHelpers").threadID(B),D=c("OzHelpers").hasTag(B,"employee")||c("OzHelpers").hasEngage(B)?"light":"dark",E=function E(J,K){return c("React").createElement(c("OzButton.react"),{onClick:K},J)},F=function(J){return function(K){c("OzHelpers").isOwner(B,this.context.uid)?J():c("OzActions").showDialog(c("OzConfirmDialog.react"),{onConfirm:J,body:"You don't own this thread. If you proceed, the user may be forgotten until they message us again.",header:"Are you sure this user doesn't need to be engaged?"})}.bind(this)}.bind(this),G=c("OzHelpers").locationLastSeen(B),H=j({hour:"numeric",minute:"numeric"}),I=(c("OzHelpers").timezone(B)||"location unknown").replace(/_/g," ");return c("React").createElement("div",{className:"_1q4l"},c("React").createElement("div",{className:"_4l-w"},c("React").createElement("h2",{className:"_1q4m"},c("OzHelpers").getName(B)),c("React").createElement("div",{className:"_29x1"},B.getIn(["location","timezone"])?c("React").createElement("span",c("Tooltip").propsFor("at the user's last known location, updated "+c("relativeTimeString.atlas")(+G,true),"below"),c("React").createElement(c("OzUpdateDateTime.react"),{locale:"en-US",options:H,timezoneOffset:B.getIn(["location","timezone-offset"],0)})," ("+I+")"):c("React").createElement("span",null,"(location unknown)"))),c("React").createElement("div",{className:"_1q4n"},c("React").createElement(n,{className:"_1q4o",thread:B,shade:D,removable:true,addable:true}),c("React").createElement("div",{className:"_1q4p"},c("OzHelpers").hasEngage(B)&&E("No need to engage",F(function(J){return c("OzAPI").notready(C)})))))}}),x=c("OzHelpers").memoize(function(A){return A.get("messages").sortBy(function(B){return B.get("timestamp")})},function(A){return A.get("messages").hashCode()});function y(A,B){return A.map(function(C){return C.get("timestamp")}).reduce(function(C,D){return Math.min(C,D)},B)}function z(){return{activeMsgID:null,clientLimit:s}}f.exports=w}),null);
__d("OzMerchantStatus.react",["cx","immutable","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").Map,l=c("React").PropTypes;i=babelHelpers.inherits(m,c("React").Component);j=i&&i.prototype;m.prototype.render=function(){"use strict";var n=this.props.merchant,o=n.get("approved"),p=n.get("blacklisted");return c("React").createElement("i",{className:"_4wc0"+(o?" _4wbz":"")+(p?" _4wb-":""),title:o&&"approved"||p&&"blacklisted"})};function m(){"use strict";i.apply(this,arguments)}m.propTypes={merchant:l.instanceOf(k).isRequired};f.exports=m}),null);
__d("OzMerchantRow.react",["cx","OzAPI","OzHelpers","immutable","Layout.react","LeftRight.react","MessengerDialogHeader.react","MessengerDialogTitle.react","OzActions","OzButton.react","OzMerchantDialog.react","OzMerchantStatus.react","OzImmutablePureRenderMixin","React","SUIAtlasTheme","SUINotice.react","XUIDialog.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("Layout.react").Column,k=c("Layout.react").FillColumn,l=c("React").PropTypes,m=c("React").createClass({displayName:"DeleteMerchantDialog",propTypes:{merchant:l.object.isRequired,onConfirm:l.func.isRequired},render:function o(){return c("React").createElement(c("XUIDialog.react"),{width:544,shown:true,layerHideOnBlur:false,className:"_4ebx"},c("React").createElement("div",{className:"_4eby _2c9g"},c("React").createElement(c("MessengerDialogHeader.react"),null,c("React").createElement(c("MessengerDialogTitle.react"),null,'Delete merchant "'+this.props.merchant.get("name-dba")+'"?')),c("React").createElement(c("SUINotice.react"),{theme:c("SUIAtlasTheme"),type:"error"},c("React").createElement("div",{className:"_4wby"},"This action is irreversible. Are you sure?"),c("React").createElement(c("LeftRight.react"),null,c("React").createElement(c("OzButton.react"),{onClick:c("OzActions").hideDialog},"Cancel"),c("React").createElement(c("OzButton.react"),{onClick:this.props.onConfirm},"Yes, permanently delete this merchant")))))},_handleToggle:function o(p){c("OzHelpers").debug("[merchantdialog] toggle",arguments);if(!p)c("OzActions").hideDialog()}}),n=c("React").createClass({displayName:"OzMerchantRow",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{merchant:l.instanceOf(i).isRequired},render:function o(){var p=this.props.merchant,q=p.get("website"),r=function r(t){return"$"+(t?(t/100).toFixed(2):0)},s=function s(t){return t||0};return c("React").createElement(c("Layout.react"),{className:"_59hd"},c("React").createElement(j,{className:"mrm _728"},c("React").createElement(c("OzMerchantStatus.react"),{merchant:p})),this._renderMerchantInfo("name-dba"),this._renderMerchantInfo("name-legal"),this._renderMerchantInfo("phone"),this._renderMerchantInfo("cumulative-transaction-amount",r),this._renderMerchantInfo("cumulative-transaction-count",s),c("React").createElement(k,{className:"mrm _4wc2 _4wc3"},c("React").createElement("a",{target:"_blank",href:q},q)),this._renderActions())},_renderMerchantInfo:function o(p,q){var r=this.props.merchant,s=r.get(p);if(q)s=q(s);return c("React").createElement(j,{className:"mrm _4wc2 _72a"},s)},_renderActions:function o(){var p=this._getActions();if(!p)return null;var q=p.map(function(r){var s=r.f,t=r.body;return c("React").createElement(c("OzButton.react"),{key:t,onClick:s},t)});return c("React").createElement(j,{className:"mrm _6w4"},q)},_getActions:function o(){var p=[],q=this.props.merchant;p.push({body:"Edit",f:this._handleMerchantEdit()});p.push({body:"Delete",f:this._handleMerchantDelete()});if(q.get("blacklisted")===true)p.push({body:"Whitelist",f:this._handleMerchantBlacklist(false)});else p.push({body:"Blacklist",f:this._handleMerchantBlacklist(true)});return p},_handleMerchantEdit:function o(){return function(p,q){var r=this.props.merchant;c("OzActions").showDialog(c("OzMerchantDialog.react"),{initialMerchant:r,title:"Edit merchant "+r.get("name-dba"),onMerchant:function s(r){c("OzAPI").editMerchant(r);c("OzActions").hideDialog()}});q()}.bind(this)},_handleMerchantBlacklist:function o(p){return function(q,r){var s=this.props.merchant;c("OzAPI").editMerchant(i({id:s.get("id"),blacklisted:p}));r()}.bind(this)},_handleMerchantDelete:function o(){return function(p,q){var r=this.props.merchant;c("OzActions").showDialog(m,{merchant:this.props.merchant,onConfirm:function s(){c("OzAPI").deleteMerchant(i({id:r.get("id")})).then(c("OzActions").hideDialog)}});q()}.bind(this)}});f.exports=n}),null);
__d("OzMerchants.react",["cx","OzAPI","immutable","Layout.react","MessengerFlexScrollableArea.react","OzActions","OzButton.react","OzMerchantDialog.react","OzMerchantRow.react","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("Layout.react").Column,l=c("Layout.react").FillColumn,m=c("immutable").Map,n=c("React").PropTypes;i=babelHelpers.inherits(o,c("React").Component);j=i&&i.prototype;function o(){__p&&__p();var p,q;"use strict";for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=j.constructor).call.apply(p,[this].concat(s)),this.state={slice:25},this.$OzMerchants4=function(){c("OzActions").showDialog(c("OzMerchantDialog.react"),{onMerchant:function u(v){c("OzAPI").createMerchant(v);c("OzActions").hideDialog()}})},this.$OzMerchants2=function(){return c("React").createElement(c("Layout.react"),{className:"_726"},c("React").createElement(k,{className:"mrm _727 _728"},"Status"),this.$OzMerchants5("Name"),this.$OzMerchants5("Legal Name"),this.$OzMerchants5("Phone"),this.$OzMerchants5("Transaction total"),this.$OzMerchants5("Transaction count"),c("React").createElement(l,{className:"mrm _727"},"Website"),c("React").createElement(k,{className:"mrm _729"},c("React").createElement(c("OzButton.react"),{onClick:this.$OzMerchants4},"New merchant")))}.bind(this),this.$OzMerchants5=function(u){return c("React").createElement(k,{className:"mrm _727 _72a"},u)},this.$OzMerchants3=function(){var u=this.props.merchants.sortBy(function(v){return v.get("name-dba","").toLowerCase()}).toSeq().take(this.state.slice).map(function(v){return c("React").createElement(c("OzMerchantRow.react"),{key:v.get("name-dba"),merchant:v})}).valueSeq();return c("React").createElement(c("MessengerFlexScrollableArea.react"),{className:"_72b",onScroll:this.$OzMerchants6,ref:"scrollable"},u)}.bind(this),this.$OzMerchants1=function(){return c("React").createElement("div",null,"No merchants to show")},this.$OzMerchants6=function(){if(this.refs.scrollable.isScrolledToBottom())this.setState(function(u){return{slice:u.slice+25}})}.bind(this),q}o.prototype.render=function(){"use strict";if(this.props.merchants.isEmpty())return this.$OzMerchants1();return c("React").createElement(c("Layout.react"),null,c("React").createElement(l,null,this.$OzMerchants2(),this.$OzMerchants3()))};f.exports=o}),null);
__d("OzPerformance",["OzHelpers","OzStores","immutable","OzAPI","OzAJAX","OzReactMetrics"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("immutable").Map,i=1e3*60,j=function j(){if(!window.performance||!window.performance.memory)return h({});var p=window.performance.memory,q=p.totalJSHeapSize,r=p.usedJSHeapSize,s=Math.round(100*r/q);return h({totalHeap:q,usedHeap:r,percent:s})},k=function k(){var p=Object.keys(c("OzStores")).map(function(r){return c("OzStores")[r]}),q=p.map(function(r){return r.metrics&&r.metrics()});return q.reduce(function(r,s){return r.merge(s)},h())},l=function l(){var p=c("OzAPI").metrics,q=p.getIn(["realtime","updated-thread-fetch-thread"],0),r=p.getIn(["realtime","updated-thread"],1),s=Math.round(100*q/r),t=p.getIn(["realtime","thread-metrics-update-thread"],0),u=p.getIn(["realtime","thread-metrics"],1),v=Math.round(100*t/u);return p.setIn(["realtime","percent-fetched"],s).setIn(["realtime","percent-metrics-stored"],v)},m=function m(){c("OzHelpers").info("[perf]",{memory:j().toJS(),stores:k().toJS(),api:l().toJS(),react:c("OzReactMetrics").metrics,ajax:c("OzAJAX").metrics})},n,o=function o(){n=window.setInterval(m,i)};f.exports={init:o,timer:n}}),null);
__d("ozFormatTime",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=3600,i=60;function j(k){__p&&__p();var l=Math.floor(k/h);k%=h;var m=Math.floor(k/i);k%=i;var n=Math.round(k),o="";if(l)o+=l+"h ";if(m)o+=m+"m ";if(n)o+=n+"s";return o}f.exports=j}),null);
__d("OzEventShow.react",["cx","OzAPI","OzHelpers","immutable","OzActions","OzDate.react","ozFormatTime","OzImmutablePureRenderMixin","React","ShimButton.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("React").PropTypes,k=c("React").createClass({displayName:"OzEventShow",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{activeIntent:j.instanceOf(i).isRequired,event:j.instanceOf(i).isRequired},render:function q(){var event=this.props.event;switch(event.get("type")){case"send-email":case"receive-email":return c("React").createElement(m,{event:event,onEmailView:this._handleEmailView,onEmailReply:this._handleEmailReply});case"send-calendar":return c("React").createElement(l,{invite:event.get("data")});case"completed-call":return c("React").createElement(n,{event:event,onCallPlay:this._handleCallPlay,onCallBack:this._handleCallBack});default:return c("React").createElement("div",null,"'Not supported yet'")}},_handleEmailView:function q(r){c("OzActions").emailComposer.add(babelHelpers["extends"]({},c("OzHelpers").eventToEmail(r),{disabled:true}))},_handleEmailReply:function q(r){c("OzActions").emailComposer.add(c("OzHelpers").eventToEmail(c("OzHelpers").reEmail(r)))},_handleCallPlay:function q(r){return c("OzAPI").everstoreURI(r).then(function(s){return window.open(s)})},_handleCallBack:function q(r){c("OzActions").twilio.changeTo(r.getIn(["data","remote-phone"]));c("OzActions").twilio.useIntent(this.props.activeIntent)}}),l=c("OzHelpers").pure(function(q){var r=q.invite;return c("React").createElement("div",{className:"_1h7p"},c("React").createElement("div",{className:"_1h7q"}),c("React").createElement("div",{className:"_1h7v _p44"},c("React").createElement("span",{className:"_1h7r"},r.get("title"))),c("React").createElement(o,{label:"Location",row:r.get("location")||"n/a"}),c("React").createElement(o,{label:"Start",row:c("React").createElement(c("OzDate.react"),{timestamp:r.get("start")})}),c("React").createElement(o,{label:"End",row:c("React").createElement(c("OzDate.react"),{timestamp:r.get("end")})}))},"Invite"),m=c("OzHelpers").pure(function(q){var event=q.event,r=q.onEmailView,s=q.onEmailReply,t=event.get("type")==="send-email",u=event.get("data"),v="Email "+(t?"to "+u.get("to").join(", "):"from "+u.get("from"));return c("React").createElement("div",{className:"_1h7p"},c("React").createElement("div",{className:"_1h7q"}),c("React").createElement("div",{className:"_1h7v _p44"},c("React").createElement("span",{className:"_1h7r"},v)),c("React").createElement(o,{label:"Subject",row:u.get("subject","[No subject]")}),c("OzHelpers").nonempty(u.get("cc"))?c("React").createElement(o,{label:"C.C.",row:u.get("cc").join(", ")}):null,c("OzHelpers").nonempty(u.get("bcc"))?c("React").createElement(o,{label:"B.C.C.",row:u.get("bcc").join(", ")}):null,c("React").createElement(o,{label:"Sent",row:c("React").createElement(c("OzDate.react"),{timestamp:u.get("sent-at")})}),c("React").createElement(p,{actions:c("immutable").fromJS([["View",function(w){r(t?event:c("OzHelpers").switchRecip(event))}],["Reply",function(w){s(t?event:c("OzHelpers").switchRecip(event))}]])}))},"Email"),n=c("OzHelpers").pure(function(q){var event=q.event,r=q.onCallPlay,s=q.onCallBack,t=event.get("data"),u={"in":"Call from ",out:"Call to ",voicemail:"Voicemail from "}[t.get("direction")],v=c("OzHelpers").parsePhoneNumber(t.get("remote-phone")),w=t.get("RecordingDuration"),x=t.get("recording-ev-handle"),y=x?[["Call Back",function(z){return s(event)}],["Play Voicemail",function(z){return r(x)}]]:[["Call Back",function(z){return s(event)}]];return c("React").createElement("div",{className:"_1h7p"},c("React").createElement("div",{className:"_1h7q"}),c("React").createElement("div",{className:"_1h7v _p44"},c("React").createElement("span",{className:"_1h7r"},u+v)),c("React").createElement(o,{label:"Date",row:c("React").createElement(c("OzDate.react"),{timestamp:event.get("timestamp")})}),c("React").createElement(o,{label:"Duration",row:c("ozFormatTime")(w)}),c("React").createElement(p,{actions:c("immutable").fromJS(y)}))},"Call"),o=c("OzHelpers").pure(function(q){var r=q.label,s=q.row;return c("React").createElement("div",{className:"_1h7v"},c("React").createElement("div",{className:"_1h7w"},r),c("React").createElement("div",{className:"_1h7y"},s))},"Row"),p=c("OzHelpers").pure(function(q){var r=q.actions;return c("React").createElement("div",{className:"_1h7t"},r.map(function(s){return c("React").createElement(c("ShimButton.react"),{className:"_47yc",key:s.first(),onClick:s.last()},s.first())}))},"ActionRow");f.exports=k}),null);
__d("OzFeedbackCloseDialog.react",["cx","invariant","ix","OzHelpers","relativeTimeString.atlas","Image.react","immutable","MessengerDialog.react","MessengerDialogHeader.react","MessengerDialogTitle.react","OzActions","OzBubblePreview.react","OzConfig","OzDate.react","OzFormPreview.react","React","ReactDOM","Reflux","TextAreaWithLineLimit.react","XUIButton.react","XUIRadioButtonGroup.react","XUISingleSelector.react"],(function a(b,c,d,e,f,g,h,i,j){__p&&__p();var k,l,m=c("React").PropTypes,n=c("immutable").List,o=c("immutable").Map,p=c("immutable").OrderedMap,q=c("immutable").Set,r=c("OzFormPreview.react").Row,s="fulfilled",t="unfulfilled",u="deleted",v="completed",w="out-of-scope",x="not-completed-user-cancel",y="not-completed-user-wish-na",z="not-completed-other",A="delete-irrelevant",B="good",C="no-need",D="opportunity",E=p((k={},k[v]="Request Successfully Completed",k[w]="Request Out of Scope",k[x]="Request Not Completed: User Changed Their Mind",k[y]="Request Not Completed: User Wish N/A",k[z]="Request Not Completed: Other Reason",k[A]="Delete: Irrelevant Intent",k)),F=p({"POL-LEGAL-FINANCIAL-MEDICAL":"1- Provide legal, financial, medical, or professional advice or services","POL-INSURANCE":"2- Purchase insurance or provide quotes","POL-PERSONAL-ACCOUNTS":"3- Access personal accounts that require logins","POL-CREATIVE-CONTENT":"4- Develop creative content","POL-AUTHENTICATE":"5- Authenticate goods or services","POL-NEGOTIATE":"6- Negotiate pricing or trade of products or services","POL-FB-VIOLATION":"7- Activity violating FB's Statement of Rights and Responsibilities","POL-TOBACCO-FIREARMS-ADULT":"8- Action violating FB/3rd party terms: tobacco, firearms, adult products/services, etc","POL-FOREIGN-PURCHASE":"9- Facilitate foreign purchases","POL-DONATION":"10- Make donations or contributions in a customer's name","POL-MEDICAL-SEARCH-APPOINTMENT":"11- Search for medical products or make medical appointments","POL-TRAVEL-UNDERAGED-SOLO":"12- Book travel for persons under the age of 18 unless purchased by a user who is the parent or legal guardian"}),G=o({flight_request:"Did you book the flight?",restaurant:"Did you book the restaurant?",restaurant_bar:"Did you book the restaurant?",ticket_purchase:"Did you buy the ticket?",movie_concert_show:"Did you buy the ticket?"}),H="Objective_None",I=o({restaurant:"M has finished working on your restaurant request.",restaurant_bar:"M has finished working on your restaurant request.",ticket_purchase:"M has finished working on your ticket request.",movie_concert_show:"M has finished working on your ticket request.",flight_request:"M has finished working on your air-travel request."}),J="option-not-presented",K="really-bad-experience",L="other",M=p((l={},l[K]="Very bad experience; sending the survey would make it worse",l[L]="Other",l)),N=function N(T){return T.map(function(U,V){return c("React").createElement(c("XUISingleSelector.react").Option,{key:U,value:V},U)}).toList()};function O(T){switch(T){case v:return s;case w:case x:case y:case z:return t;case A:return u;default:return undefined}}function P(T,U){var V=G.get(U.get("name"),H);return T===v&&V!==H}var Q=c("React").createClass({displayName:"OzFeedbackCloseDialog",mixins:[c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{onFeedbackDone:m.func.isRequired,title:m.string,intent:m.instanceOf(o).isRequired,scheduleds:m.instanceOf(n).isRequired},getDefaultProps:function T(){return{title:"Before closing, please tell us how well M did"}},getInitialState:function T(){return{feedback:o({"close-state":"fulfilled","close-sub-state":v,"objective-reached":null,"not-completed-other":"","user-happy":0,"was-fast":true,"policy-value":F.keySeq().first(),"automation-value":B,"automation-opportunity":"","was-bug":false,"did-not-send-survey-reason":this._shouldAllowSendSurvey()?K:J}),willSendSurvey:this._shouldAllowSendSurvey(),scheduledsToCancel:q()}},_onCloseChange:function T(U){var V=this.props.intent;this.setState({feedback:this.state.feedback.set("close-state",O(U.value)).set("close-sub-state",U.value).set("objective-reached",P(U.value,V))})},_onPolicyChange:function T(U){this.setState(function(V){var W=V.feedback;return{feedback:W.setIn(["policy-value"],U.value)}})},_onReasonForNotSendingSurveyChange:function T(U){this.setState(function(V){var W=V.feedback;return{feedback:W.setIn(["did-not-send-survey-reason"],U.value)}})},_makeOnChangeHandler:function T(U){return function(V){this.setState(function(W){var X=W.feedback;return{feedback:X.set(U,V)}})}.bind(this)},componentDidMount:function T(){var U=this.refs["selector_close-sub-state"]?c("ReactDOM").findDOMNode(this.refs["selector_close-sub-state"].refs.button):null;U&&U.focus()},render:function T(){var U=this.state.scheduledsToCancel&&this.state.scheduledsToCancel.count(),V=!U&&"Close Intent"||U===1&&"Close Intent and Delete 1 Scheduled Send"||"Close Intent and Delete "+U+" Scheduled Sends";return c("React").createElement(c("MessengerDialog.react"),{onToggle:this._handleToggle,ref:"dialog",type:"default",width:544},c("React").createElement(c("MessengerDialogHeader.react"),null,c("React").createElement(c("MessengerDialogTitle.react"),null,this.props.title)),this._renderFields(),this._renderOptions(),this._renderTimeWarning(),c("React").createElement("div",{className:"_4k_x"},this._renderDialogAction(V,this._handleSave),this._renderDialogAction("Cancel",c("OzActions").hideDialog)))},_renderTimeWarning:function T(){var U=this.props.intent,V=U.getIn(["params","datetime"]),W=V&&V.first()&&V.first().get("value")&&V.first().get("value").endsWith("07:00:00.000Z");return W?c("React").createElement("div",{className:"_581n"},"The time set in this intent is 12am, and the AI might schedule some messages around that time. Are you sure you set the time correctly?"):null},_renderDialogAction:function T(U,V){return c("React").createElement(c("XUIButton.react"),{onClick:V,className:"_42hl",label:U})},_renderFields:function T(){var U=this.props.intent,V=this.state.feedback,W=G.get(U.get("name"),H);return c("React").createElement("div",{className:"_42hk"},c("React").createElement(r,{label:U.get("name")},c("React").createElement("div",{className:"_8o2"},c("React").createElement("span",null,"Intent opened ",c("OzDate.react").formatTimestamp(U.get("created-at"))),c("React").createElement("br",null),c("React").createElement("span",null,c("relativeTimeString.atlas")(U.get("created-at"))))),c("React").createElement(r,{label:"Why are you closing this intent?"},c("React").createElement(c("XUISingleSelector.react"),{className:"_8o2",maxwidth:300,name:"selector_close-sub-state",ref:"selector_close-sub-state",onChange:this._onCloseChange,value:V.get("close-sub-state")},N(E))),V.get("close-sub-state")===v&&W!==H&&c("React").createElement(r,{label:W},c("React").createElement(c("XUIRadioButtonGroup.react"),{selectedValue:V.get("objective-reached"),onValueChange:this._makeOnChangeHandler("objective-reached"),selectedUse:"confirm",className:"_8o2"},c("React").createElement(c("XUIButton.react"),{value:true,label:"Yes"}),c("React").createElement(c("XUIButton.react"),{value:false,label:"No"}))),V.get("close-sub-state")===w&&c("React").createElement(r,{label:"What policy did the request violate?"},c("React").createElement(c("XUISingleSelector.react"),{maxwidth:1e3,name:"selector_policy-value",size:"large",onChange:this._onPolicyChange,value:V.get("policy-value"),className:"_8o2"},N(F))),V.get("close-sub-state")===z&&c("React").createElement(r,{label:"What was your reason?"},c("React").createElement(c("TextAreaWithLineLimit.react"),{value:V.get("not-completed-other"),onChange:this._makeOnChangeHandler("not-completed-other")})),c("React").createElement(r,{label:"How did the user seem?"},c("React").createElement(c("XUIRadioButtonGroup.react"),{className:"_8o2",selectedValue:V.get("user-happy"),onValueChange:this._makeOnChangeHandler("user-happy"),selectedUse:"confirm"},c("React").createElement(c("XUIButton.react"),{image:c("React").createElement(c("Image.react"),{src:j("40052"),title:"User loved it!"}),label:"User loved it!",labelIsHidden:true,value:4}),c("React").createElement(c("XUIButton.react"),{image:c("React").createElement(c("Image.react"),{src:j("40076"),title:"User was happy"}),label:"User was happy",labelIsHidden:true,value:3}),c("React").createElement(c("XUIButton.react"),{image:c("React").createElement(c("Image.react"),{src:j("40085"),title:"User was meh"}),label:"User was meh",labelIsHidden:true,value:2}),c("React").createElement(c("XUIButton.react"),{image:c("React").createElement(c("Image.react"),{src:j("40042"),title:"User was unhappy"}),label:"User was unhappy",labelIsHidden:true,value:1}),c("React").createElement(c("XUIButton.react"),{image:c("React").createElement(c("Image.react"),{src:j("316462"),title:"No Feedback"}),label:"No Feedback",labelIsHidden:true,value:0}))),c("React").createElement(r,{label:"Did the request go smoothly?"},c("React").createElement(c("XUIRadioButtonGroup.react"),{selectedValue:V.get("was-fast"),onValueChange:this._makeOnChangeHandler("was-fast"),selectedUse:"confirm",className:"_8o2"},c("React").createElement(c("XUIButton.react"),{value:true,label:"Yes: No Bugs and Good Automation"}),c("React").createElement(c("XUIButton.react"),{value:false,label:"No: I have something to report"}))),!V.get("was-fast")&&c("React").createElement(r,{label:"Did a bug affect your work on this request?"},c("React").createElement(c("XUIRadioButtonGroup.react"),{className:"_8o2",selectedValue:V.get("was-bug"),onValueChange:this._makeOnChangeHandler("was-bug"),selectedUse:"confirm"},c("React").createElement(c("XUIButton.react"),{value:false,label:"No"}),c("React").createElement(c("XUIButton.react"),{value:true,label:"Yes"}))),!V.get("was-fast")&&V.get("was-bug")&&c("React").createElement("div",{className:"_4k_y"},"Please"," ",c("React").createElement("a",{href:"https://our.intern.facebook.com/intern/tasks/?q=732683726825240",target:"_blank"},"create a task")," ","or use the bugnub. Your feedback helps us make this product great!"),!V.get("was-fast")&&c("React").createElement(r,{label:"Did AI help?",tooltip:"i.e. auto sends, scheduled sends, bubble suggestions, ..."},c("React").createElement(c("XUIRadioButtonGroup.react"),{className:"_8o2",selectedValue:V.get("automation-value"),onValueChange:this._makeOnChangeHandler("automation-value"),selectedUse:"confirm"},c("React").createElement(c("XUIButton.react"),{value:C,label:"There was no need"}),c("React").createElement(c("XUIButton.react"),{value:B,label:"Yes, perfectly"}),c("React").createElement(c("XUIButton.react"),{value:D,label:"Could have been better"}))),!V.get("was-fast")&&V.get("automation-value")==D&&c("React").createElement("div",null,c("React").createElement("div",{className:"_4k_y"},"You can provide some feedback here or post in the"," ",c("React").createElement("a",{href:"https://www.facebook.com/groups/880028888735948/",target:"_blank"},"Feedback Group"),"."),c("React").createElement(r,{label:"How could the AI be improved?"},c("React").createElement(c("TextAreaWithLineLimit.react"),{value:V.get("automation-opportunity"),onChange:this._makeOnChangeHandler("automation-opportunity")}))))},_renderOptions:function T(){var U=this.props.intent,V=this.state.feedback;return c("React").createElement("div",null,this._shouldAllowSendSurvey()&&c("React").createElement("div",{className:"_10-h"},c("React").createElement("input",{type:"checkbox",checked:this.state.willSendSurvey,onChange:this._handleToggleSendSurvey}),c("React").createElement("div",{className:"_10-i"},"Send survey and completion message to user:",c("React").createElement("br",null),c("React").createElement("span",{className:"_10-j"},'"',I.get(U.get("name")),'"'))),this._shouldAllowSendSurvey()&&!this.state.willSendSurvey&&c("React").createElement("div",{className:"_10-h"},c("React").createElement(r,{label:"Why have you decided not to send the survey?"},c("React").createElement(c("XUISingleSelector.react"),{className:"_8o2",maxwidth:400,onChange:this._onReasonForNotSendingSurveyChange,value:V.get("did-not-send-survey-reason")},N(M)))),this.state.config.getIn(["GK","cancelRestaurant"])&&this._perhapsDisplayScheduleds())},_handleSave:function T(){this.props.onFeedbackDone(this.props.intent,this._sanitizeFeedback(this.state.feedback.toJS()),this.state.willSendSurvey,this.state.scheduledsToCancel);c("OzActions").hideDialog()},_sanitizeFeedback:function T(U){__p&&__p();if(U["close-state"]!==s)U["objective-reached"]=false;if(U["close-sub-state"]!==w)U["policy-value"]="";if(U["close-sub-state"]!==z)U["not-completed-other"]="";if(U["was-fast"]){U["was-bug"]=false;U["automation-value"]=B}if(U["automation-value"]!==D)U["automation-opportunity"]="";return U},_handleToggle:function T(U){if(!U)c("OzActions").hideDialog()},_shouldAllowSendSurvey:function T(){return I.has(this.props.intent.get("name"))},_handleToggleSendSurvey:function T(U){this.setState({willSendSurvey:!this.state.willSendSurvey})},_handleScheduledItemClick:function T(U){o.isMap(U)||i(0);this.setState(function(V){var W=V.scheduledsToCancel;return{scheduledsToCancel:W.has(U)?W.remove(U):W.add(U)}})},_perhapsDisplayScheduleds:function T(){var U=this.props,V=U.intent,W=U.scheduleds,X={restaurant:"request_type",restaurant_bar:"request_type",appointment:"appt_action"}[V.get("name")],Y=X&&V.getIn(["params",X,0,"value"]);if(q(["restaurant","restaurant_bar","appointment"]).has(V.get("name"))&&Y==="cancel"&&!W.isEmpty())return c("React").createElement("div",{className:"_10-h"},c("React").createElement("div",{className:"_10-i"},"Do you need to cancel any scheduled sends?"),c("React").createElement("div",{className:"_5c03"},c("React").createElement("div",{className:"_5c04"},W.map(function(Z,$){return c("React").createElement(R,{key:$,item:Z,isPendingCancel:this.state.scheduledsToCancel.has(Z),onClick:this._handleScheduledItemClick})}.bind(this)))));return null}});function R(T){var U=T.item,V=T.onClick,W=T.isPendingCancel,X=function(Y){switch(U.get("type")){case"send":var Z=U.getIn(["data","text"]),$=U.getIn(["data","images"]);return c("React").createElement("div",{className:"_5c05"},Z&&'"'+Z+'"',$&&c("React").createElement(S,{images:$}));case"suggest":return c("React").createElement("div",{className:"_5c05"},c("React").createElement(c("OzBubblePreview.react"),{bubble:U.getIn(["data","suggestion"]),meta:U.get("meta"),source:U.get("source")}));default:c("OzHelpers").debug("[feedbackCloseDialog] could not render scheduled item",U);return null}}();return c("React").createElement("div",{className:"_5c06"+(W?" _5c07":""),onClick:function Y(Z){return V(U)},role:"presentation"},c("React").createElement("div",{className:"_5c11"}),c("React").createElement("div",{className:"_5c12"},c("OzDate.react").formatTimestamp(U.get("at"))),X)}function S(T){var U=T.images;return c("React").createElement("div",{className:"_5c4_"},U.map(function(V,W){return c("React").createElement(c("Image.react"),{key:W,className:"_1q16",src:V.get("url"),alt:V.get("filename")})}))}f.exports=Q}),null);
__d("OzReminderTaskEditor.react",["cx","InputLabel_DEPRECATED.react","InputLabelLabel_DEPRECATED.react","OzConstants","ContextualLayerAutoFlip","ContextualLayerUpdateOnScroll","DatePickerRestraints","OzHelpers","immutable","InputLabel.react","ReactLayeredComponentMixin_DEPRECATED","LayerHideOnBlur","MessengerButtonReact.bs","React","XUIContextualDialog.react","XUIDateTimePicker.react","XUIError.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("OzConstants").REMINDERS,j=c("MessengerButtonReact.bs").jsComponent,k=c("immutable").Map,l=c("immutable").Set,m=c("React").PropTypes,n=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],o=c("immutable").fromJS({traffic:{label:"Include traffic update",params:[{name:"origin",placeholder:"Origin address",err:"What is the origin address?"},{name:"destination",placeholder:"Destination address",err:"What is the destination address?"}]},weather:{label:"Include weather forecast",params:[{name:"location",placeholder:"City",err:"What city is the forecast for?"},{name:"metric",placeholder:"Celsius or Fahrenheit",err:"You need to set Celsius or Fahrenheit"}]}}),p=c("OzHelpers").pure(function(s){var t=s.action,u=s.errors,v=s.onToggle,w=s.onUpdate,x=s.task,y=!!x.getIn(["data","actions",t]);return c("React").createElement("div",null,c("React").createElement(c("InputLabel_DEPRECATED.react"),null,c("React").createElement("input",{type:"checkbox",checked:y,onChange:function z(A){return v(A,x,t)}}),c("React").createElement(c("InputLabelLabel_DEPRECATED.react"),null,o.getIn([t,"label"]))),y&&c("React").createElement("div",null,o.getIn([t,"params"]).map(function(z){var A=z.get("name"),B=["data","actions",t,A],C=x.getIn(B);return c("React").createElement(c("XUIError.react"),{key:t+"-"+A,xuiError:u.getIn([t,A])},c("React").createElement("input",{type:z.get("type","text"),className:"_wbw",placeholder:z.get("placeholder"),value:C,onChange:function D(E){return w(E,B)}}))}).valueSeq()))}),q=c("OzHelpers").pure(function(s){var t=s.task,u=s.errors,v=s.onToggle,w=s.onUpdate;return c("React").createElement("div",null,c("React").createElement("h3",{className:"_17f0"},"Actions"),o.keySeq().map(function(x){return c("React").createElement(p,{key:x,action:x,task:t,errors:u,onToggle:v,onUpdate:w})}).valueSeq())}),r=c("React").createClass({displayName:"OzReminderTaskEditor",mixins:[c("ReactLayeredComponentMixin_DEPRECATED")],propTypes:{onSave:m.func.isRequired,seedTask:m.instanceOf(k),layered:m.bool,location:m.instanceOf(k).isRequired},getInitialState:function s(){return{shown:false,task:this.props.seedTask||k({type:"reminder",state:"waiting"}),errors:k()}},componentWillReceiveProps:function s(t){if(!c("immutable").is(t.seedTask,this.props.seedTask))this.setState({task:t.seedTask,errors:k()})},_renderBody:function s(){var t=this.state,u=t.task,v=t.errors,w=this.props.location,x=l(u.getIn(["schedule","repeat-condition","days"]));return c("React").createElement("ul",{className:"_3ssq"},c("React").createElement("div",{className:"_wbu"},c("React").createElement(c("XUIDateTimePicker.react"),babelHelpers["extends"]({xuiError:v.get("scheduled-time"),className:"_wbv",date:new Date(u.get("start-at",c("OzHelpers").serverNow())),allowDuplicateDateSelection:true,onChange:function(y){this.setState({task:c("OzHelpers").updateInWhen(u.set("start-at",+y).set("deadline",+y),["schedule"],function(z){return z.set("start-at",+y)})})}.bind(this)},c("OzHelpers").dateRestraints())),c("React").createElement(c("XUIError.react"),{xuiError:v.get("description")},c("React").createElement("input",{ref:"input",className:"_wbw",placeholder:"Describe the Reminder",value:u.getIn(["data","description"]),onChange:function(y){this.setState({task:u.setIn(["data","description"],y.target.value)})}.bind(this)})),c("React").createElement("h3",{className:"_17f0"},"Recurrence"),n.map(function(y,z){var A=z+1;return c("React").createElement(c("InputLabel.react"),{key:z,label:y},c("React").createElement("input",{type:"checkbox",checked:x.has(A),onChange:function(B){var C=B.target.checked?x.add(A):x["delete"](A);this.setState({task:u.set("schedule",k({"start-at":u.get("start-at"),frequency:"weekly",timezone:w.get("timezone"),"timezone-offset":w.get("timezone-offset"),"repeat-condition":k({spacing:1,days:C.toList()})}))})}.bind(this)}))}.bind(this)),c("React").createElement(q,{task:u,errors:v,onToggle:this._handleActionToggle,onUpdate:this._handleActionUpdate}),c("React").createElement("div",{className:"_wbz"},c("React").createElement(j,{label:this.props.seedTask?"Update Reminder":"Add Reminder",disabled:this.state.saving,onClick:this._handleSave,type:"primary"}))))},render:function s(){if(this.props.layered){var t=c("React").Children.only(this.props.children);return c("React").cloneElement(t,{onClick:function(u){return this.setState({shown:!this.state.shown})}.bind(this)})}return this._renderBody()},renderLayers:function s(){var t=this.state.shown;if(!t)return null;return{contextualDialog:c("React").createElement(c("XUIContextualDialog.react"),{behaviors:{ContextualLayerAutoFlip:c("ContextualLayerAutoFlip"),ContextualLayerUpdateOnScroll:c("ContextualLayerUpdateOnScroll"),LayerHideOnBlur:c("LayerHideOnBlur")},position:"below",shown:t,contextRef:function(){return this}.bind(this),onToggle:function(u){return this.setState({shown:u})}.bind(this)},this._renderBody())}},_handleActionToggle:function s(t,u,v){var w=t.target.checked?u.setIn(["data","actions"],k([[v,k()]])):u.deleteIn(["data","actions"]);this.setState({task:w})},_handleActionUpdate:function s(t,u){this.setState({task:this.state.task.setIn(u,t.target.value)})},_handleSave:function s(){__p&&__p();var t=this.state.task,u=t.get("start-at"),v=function v(y){return!!t.getIn(["actions",y])},w=k(),x=c("OzHelpers").dateRestraints().dateRestraints;if(!u)w=w.set("scheduled-time","When would you like the reminder?");else if(u<c("OzHelpers").serverNow()+60*1e3)w=w.set("scheduled-time","Reminders should be in the future!");else if(!c("DatePickerRestraints").isValidDate(new Date(u),x))w=w.set("scheduled-time","Reminder is outside of the "+i.RANGE_IN_YEARS+" year range");if(!t.getIn(["data","description"]))w=w.set("description","What is the reminder about?");w=o.reduce(function(w,y,z){if(v(z))w=y.get("params").reduce(function(w,A){return t.getIn(["data","actions",z,A.get("name")])?w:w.setIn([z,A.get("name")],A.get("err"))},w);return w},w);this.setState({errors:w});if(w.size)return;this.setState({saving:true},function(y){this.props.onSave(t).then(function(y){if(this.props.layered)this.setState({shown:false,saving:false})}.bind(this))["catch"](function(z){return this.setState({saving:false})}.bind(this))}.bind(this))}});f.exports=r}),null);
__d("OzIntentActions.react",["cx","Promise","OzAPI","OzHelpers","Image.react","immutable","joinClasses","OzActions","OzConfig","OzDraggable.react","OzReminderTaskEditor.react","OzImmutablePureRenderMixin","React","Reflux","XUICloseButton.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").Map,l=c("React").PropTypes,m=5*6e4,n=10*6e4,o=c("React").createClass({displayName:"OzIntentActions",propTypes:{intent:l.instanceOf(k).isRequired,location:l.instanceOf(k).isRequired,userEmail:l.string},mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],contextTypes:{router:l.object.isRequired},getInitialState:function r(){return{reminderShown:false}},render:function r(){var s=this.state.config,t=s.get("display-tasks")||s.getIn(["GK","timeline"]);return c("React").createElement("div",{className:c("joinClasses")("_x-r",this.props.className)},c("React").createElement("div",{className:(t?"_2p6s":"")+(!t?" _ukm":""),style:this.props.timelineGK?{borderTop:"none"}:null},t?[["mail",this._handleEmail],["call",this._handleCall],["calendar",this._handleInvite],["todo",this._handleTask]].map(function(u){var v=u[0],w=u[1];return c("React").createElement("button",{key:v,className:"_1-hv _2p6t",onClick:w},c("React").createElement(c("Image.react"),{className:"_2p6u",id:v,src:"/images/oz/intent/"+v+"-2x.png"}))}):[["call",this._handleCall],["email",this._handleEmail],["invite",this._handleInvite]].map(function(u){var v=u[0],w=u[1];return c("React").createElement("button",{key:v,className:"_1-hv _ukn",onClick:w},v)})),this.state.reminderShown&&t?c("React").createElement(p,{onClose:this._handleCloseReminderTask,onCreate:this._handleCreateReminderTask,location:this.props.location}):null)},_handleTask:function r(){var s=this.props.intent,t=s.get("id"),u=s.get("user-id"),v=k({deadline:c("OzHelpers").serverNow()+n+m,"intent-id":t,"start-at":c("OzHelpers").serverNow()+n,state:"waiting",type:"reminder",data:{description:""}});c("OzAPI").createTask(u,v).then(function(w){this.context.router.push(c("OzHelpers").threadPath({threadid:u,intentid:t,taskid:w}))}.bind(this)).done()},_handleCreateReminderTask:function r(s){var t=this.props.intent;return c("OzAPI").createTask(t.get("user-id"),s.set("intent-id",t.get("id"))).then(function(u){return this.setState({reminderShown:false})}.bind(this))},_handleCloseReminderTask:function r(){this.setState({reminderShown:false})},_handleEmail:function r(){var s=this.props.intent;c("OzActions").emailComposer.add({intentId:s.get("id"),from:s.get("email-address")})},_handleInvite:function r(){c("OzActions").inviteComposer.create(this.props.intent.get("id"),this.props.userEmail,this.props.location.get("timezone"))},_handleCall:function r(){q(this.props.intent).done(function(s){return c("OzActions").twilio.useIntent(s)})}});i=babelHelpers.inherits(p,c("React").Component);j=i&&i.prototype;p.prototype.render=function(){"use strict";var r=this.props,s=r.onClose,t=r.onCreate,u=r.location;return c("React").createElement(c("OzDraggable.react"),{className:"_2jc4"},c("React").createElement("div",{className:"_2jc5"},"Reminder",c("React").createElement(c("XUICloseButton.react"),{onClick:s})),c("React").createElement(c("OzReminderTaskEditor.react"),{onSave:t,location:u}))};function p(){"use strict";i.apply(this,arguments)}p.propTypes={onClose:l.func.isRequired,onCreate:l.func.isRequired};function q(r){var s=r.get("phone-number");return s?c("Promise").resolve(r):c("OzAPI").addPhoneNumber(r.get("user-id"),r.get("id")).then(function(t){return r.merge(t)})}f.exports=o}),null);
__d("OzIntentParams.react",["cx","React"],(function a(b,c,d,e,f,g,h){"use strict";var i,j;i=babelHelpers.inherits(k,c("React").Component);j=i&&i.prototype;k.prototype.render=function(){return c("React").createElement("div",{className:"_3-ue"},this.props.children)};function k(){i.apply(this,arguments)}f.exports=k}),null);
__d("OzIntentParamsAbstractField.react",["cx","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;l.prototype.render=function(){return c("React").createElement("div",{className:"_5nij"+(!this.props.hasValue?" _2ez0":"")},this.props.label?c("React").createElement("label",{className:"_2230 ellipsis"},this.props.label):null,c("React").createElement("div",{className:"_2ulp"},c("React").Children.only(this.props.children)))};function l(){i.apply(this,arguments)}l.propTypes={hasValue:k.bool,label:k.string};f.exports=l}),null);
__d("OzIntentParamsTextField.react",["invariant","AbstractTextArea.react","DOMQuery","OzIntentParamsAbstractField.react","OzImmutablePureRenderMixin","React","ReactDOM","TextAreaControl"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("React").PropTypes,j=c("React").createClass({displayName:"OzIntentParamsTextField",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{label:i.string,onAsk:i.func,onChange:i.func,question:i.string,value:i.string.isRequired},_control:null,componentDidMount:function k(){var l=c("DOMQuery").find(c("ReactDOM").findDOMNode(this),"textarea");this._control=new(c("TextAreaControl"))(l);this._control.setAutogrow(true);this._control.onupdate()},componentDidUpdate:function k(l,m){if(l.value!==this.props.value)this._control.onupdate()},render:function k(){return c("React").createElement(c("OzIntentParamsAbstractField.react"),{hasValue:!!this.props.value,onAsk:this.props.onAsk,question:this.props.question},c("React").createElement(c("AbstractTextArea.react"),{onChange:this._handleChange,placeholder:this.props.label,value:this.props.value}))},_handleChange:function k(l){var m=l.target;m instanceof HTMLTextAreaElement||h(0);this.props.onChange&&this.props.onChange(m.value)}});f.exports=j}),null);
__d("OzRequirementTokenizer.react",["immutable","OzImmutablePureRenderMixin","React","OzTokenizer.react"],(function a(b,c,d,e,f,g){var h=c("immutable").Map,i=c("immutable").List,j=c("React").PropTypes,k=c("React").createClass({displayName:"OzRequirementTokenizer",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{allRequirements:j.instanceOf(h).isRequired,onDeleteRequirement:j.func.isRequired,onCreateRequirement:j.func.isRequired,selectedRequirements:j.instanceOf(i),placeholder:j.string.isRequired,timeline:j.bool},getDefaultProps:function l(){return{timeline:false}},_requirementSort:function l(m){var n=this.props.witIntentUUID,o=m.get("wit-intent-uuids").has(n)?1e5:0;return-(o+m.get("used-count",0))},render:function l(){var m=this.props,n=m.allRequirements,o=m.selectedRequirements,p=m.placeholder,q=m.onDeleteRequirement,r=m.onCreateRequirement,s=m.timeline;return c("React").createElement(c("OzTokenizer.react"),{placeholder:p,allTokens:n.toList(),chosenTokens:o,onDeleteToken:q,onCreateToken:r,resultRank:this._requirementSort,resultFilter:function t(u,v){return u.get("name").toLowerCase().indexOf(v.toLowerCase())>=0},timeline:s})}});f.exports=k}),null);
__d("OzTimestampScrolling.react",["cx","OzActions","React","Tooltip"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("React").PropTypes,l=3e3;i=babelHelpers.inherits(m,c("React").PureComponent);j=i&&i.prototype;function m(){var n,o;"use strict";for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.state={state:null},this.$OzTimestampScrolling2=function(){this.setState({state:"loading"});c("OzActions").scrollThreadToTimestamp(this.props.timestamp)}.bind(this),o}m.prototype.componentDidMount=function(){"use strict";this.$OzTimestampScrolling1=c("OzActions").doneScrollingToTimestamp.listen(function(n,o){if(this.props.timestamp===n)if(o)this.setState({state:"error"},function(p){window.setTimeout(function(p){this.setState({state:null})}.bind(this),l)}.bind(this));else this.setState({state:null})}.bind(this))};m.prototype.componentWillUnmount=function(){"use strict";this.$OzTimestampScrolling1()};m.prototype.render=function(){"use strict";var n="_1e3l"+(!this.state.state?" _1y5w":"")+(this.state.state==="loading"?" _1y5x":"")+(this.state.state==="error"?" _1y5y":"");return c("React").createElement("span",{className:n,onClick:this.$OzTimestampScrolling2,role:"presentation"},this.props.children)};m.propTypes={timestamp:k.number.isRequired};f.exports=m}),null);
__d("OzSidebarItemHeader.react",["cx","fbt","OzHelpers","Keys","OzCheckboxInput.react","OzConfig","OzDate.react","OzTimestampScrolling.react","OzImmutablePureRenderMixin","React","Reflux","Tooltip","XUIAbstractGlyphButton.react","XUICloseButton.react","FBButtonMenuCombo.react","OzButton.react","joinClasses"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=c("FBButtonMenuCombo.react").Item,k=c("React").PropTypes,l=c("React").createClass({displayName:"OzSidebarItemHeader",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{alias:k.string,closedAt:k.number,createdAt:k.number,creator:k.string,intentId:k.number,isBlocked:k.bool,isClosed:k.bool.isRequired,isExpanded:k.bool,label:k.string,onCancel:k.func,onChangeAlias:k.func,onIsExpandedToggle:k.func,onToggle:k.func,skipScrollToTimestamp:k.bool,subtitle:k.node,timelineGK:k.bool,title:k.string.isRequired},getDefaultProps:function n(){return{timelineGK:false}},getInitialState:function n(){return{isEditing:false}},render:function n(){var o=this.props,p=o.alias,q=o.className,r=o.closedAt,s=o.createdAt,t=o.intentId,u=o.isBlocked,v=o.isClosed,w=o.isExpanded,x=o.label,y=o.onCancel,z=o.onIsExpandedToggle,A=o.onToggle,B=o.skipScrollToTimestamp,C=o.subtitle,D=o.timelineGK,E=o.title,F=v?r:s,G=this.state.config.getIn(["GK","timeline"]),H=t&&G?{color:"white"}:{},I=t&&G?{background:c("OzHelpers").color(t)}:{};return c("React").createElement("div",{className:c("joinClasses")(q,"_31gu"+(w?" _31gx":"")+(u?" _27qc":"")+(v&&!D?" _31gy":""))},A?c("React").createElement(c("OzCheckboxInput.react"),{checked:v,className:"_31gz",onChange:A}):null,c("React").createElement("div",{className:"_31g-"},c("React").createElement("div",null,c("React").createElement("span",null,F?B?c("React").createElement(c("OzDate.react"),{className:"_56sd",timestamp:F}):c("React").createElement(c("OzTimestampScrolling.react"),{timestamp:F},c("React").createElement(c("OzDate.react"),{className:"_56sd",timestamp:F})):null),c("React").createElement(m,{alias:p,isBlocked:u,isEditing:this.state.isEditing,name:E,onChange:this._handleChangeAlias,onStartEditing:this._handleStartEditing,onCancelEditing:this._handleCancelEditing}),x?c("React").createElement("span",{className:"_5o4m"},x):null),c("React").createElement("span",{className:"_31h0"},C)),c("React").createElement("div",{className:"_3_41"},this.props.children,z?c("React").createElement(c("XUIAbstractGlyphButton.react"),{className:"_31h1",label:i._("Expand"),labelIsHidden:true,onClick:z}):null,y&&c("React").createElement(c("XUICloseButton.react"),{onClick:y})))},_handleStartEditing:function n(){this.props.onChangeAlias&&this.setState({isEditing:true})},_handleCancelEditing:function n(){this.setState({isEditing:false})},_handleChangeAlias:function n(o){var p=this.props.onChangeAlias;if(o.which===c("Keys").RETURN){p&&p(o.target.value);this.setState({isEditing:false})}}}),m=c("OzHelpers").pure(function(n){var o=n.name,p=n.isBlocked,q=n.isEditing,r=n.alias,s=n.onChange,t=n.onStartEditing,u=n.onCancelEditing,v=n.style;return q?c("React").createElement("textarea",{className:"_31g_ _1p0b",style:v,onKeyDown:s,placeholder:o,defaultValue:r,onBlur:u,ref:function w(x){if(x){x.focus();c("OzHelpers").moveCursorToInputEnd(x)}}}):c("React").createElement("span",babelHelpers["extends"]({className:"_31g_"+(p?" _7ok":""),style:v,onClick:t},c("Tooltip").propsFor(r?o:null)),r||o)});f.exports=l}),null);
__d("OzGenericIntent.react",["ix","cx","Promise","OzAPI","fbglyph","OzHelpers","promiseFinally","Image.react","immutable","MessengerButtonReact.bs","OzButton.react","OzConfig","OzFormPreview.react","OzIntentActions.react","OzIntentParams.react","OzRequirementTokenizer.react","OzSidebarItemHeader.react","OzImmutablePureRenderMixin","React","Reflux","OzIntentParamsTextField.react","Tooltip","OzDate.react","OzTimestampScrolling.react","URI","XUISingleSelector.react","Stars.react","OzActions","OzFeedbackCloseDialog.react"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=c("MessengerButtonReact.bs").jsComponent,k=c("immutable").List,l=c("immutable").Map,m=c("immutable").Set,n=c("React").PropTypes,o=c("OzFormPreview.react").Row,p=c("XUISingleSelector.react").Option,q=c("OzHelpers").pure(function(B){var C=B.meta,D=C&&C.get("send-survey",false);if(D){var E=C.get("rating3")||"-1",F=parseInt(E,10);return c("React").createElement("div",{className:"_40k2"+(F===1?" _40k3":"")+(F===0?" _40k4":"")},F===0?c("React").createElement("span",{title:"User says M is not done"},"Not Done"):c("React").createElement(c("Stars.react"),{count:F,max:3,size:"small",title:C.get("user-feedback")}))}else{var G=C&&C.getIn(["feedback","did-not-send-survey-reason"]);return c("React").createElement("div",{className:"_40k2"},c("React").createElement("span",null,G==="option-not-presented"?c("React").createElement("span",{title:"Not relevant"},"N/A"):G==="really-bad-experience"&&c("React").createElement("span",{className:"_40k3",title:"Survey not sent because of really bad ux"},"Bad")))}}),r=c("React").createClass({displayName:"OzGenericIntent",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{intent:n.instanceOf(l).isRequired,location:n.instanceOf(l).isRequired,notes:n.string.isRequired,onChangeAlias:n.func.isRequired,onClose:n.func.isRequired,onNotesChange:n.func.isRequired,onOpen:n.func.isRequired,onIsBlockedToggle:n.func.isRequired,onTriggerAI:n.func.isRequired,requirements:n.instanceOf(l).isRequired,onCreateRequirement:n.func,onDeleteRequirement:n.func,repNames:n.instanceOf(l).isRequired,userEmail:n.string,thread:n.instanceOf(l).isRequired,timelineGK:n.bool},render:function B(){var C=this.props,D=C.intent,E=C.repNames,F=C.timelineGK,G=c("OzHelpers").isDeleted(D);if(G)return c("React").createElement("span",null);var H=D.get("creator-fbid"),I=E.get(H,H),J=D.get("blocked"),K=c("OzHelpers").intentName(D);return c("React").createElement("div",{className:"_37lt"},c("React").createElement(c("OzSidebarItemHeader.react"),{alias:D.get("alias"),className:(!F?"_a2q":"")+(F?" _37lv":""),intentId:D.get("id"),isClosed:c("OzHelpers").isClosedIntent(D),onClose:this._handleClose,closeState:D.get("state"),isBlocked:J,onChangeAlias:this._handleChangeAlias,onFeedback:this._handleIntentFeedback,onToggle:this._handleToggle,onTriggerAI:this.props.onTriggerAI,timelineGK:F,title:K,creator:I},this._renderTriggerAI()),this._renderBody())},_renderTriggerAI:function B(){var C=h("140058"),D=h("112825"),E=this.state.config.getIn(["GK","timeline"])?C:D;return c("React").createElement(c("OzButton.react"),babelHelpers["extends"]({tight:true,onClick:this.props.onTriggerAI},c("Tooltip").propsFor("Rerun the AI for this intent")),c("React").createElement(c("Image.react"),{src:E}))},_renderBody:function B(){var C=this.props,D=C.intent,E=C.repNames,F=C.userEmail,G=C.location,H=C.thread,I=C.timelineGK,J=C.children,K=D.get("creator-fbid"),L=K===c("OzConfig").getStaticConfig("PAGE_ID")?"Bot":K,M="Created by "+E.get(K,L);return c("React").createElement("div",null,!I?c("React").createElement(c("OzIntentActions.react"),{intent:D,userEmail:F,location:G}):null,c("React").createElement("div",{className:"_1x_z"},c("React").createElement(c("OzFormPreview.react"),null,c("React").createElement(o,{label:"Status",className:"_10sn"},c("React").createElement(t,{intent:D,thread:H})),c("React").createElement(o,{label:"Created",tip:M,className:"_10sn"},u(D.get("created-at"))),c("React").createElement(o,{label:"Closed",className:"_10sn"},u(D.get("closed-at"))),c("React").createElement(o,{label:"Assigned Bot",className:"_10sn"},D.get("assigned-bot")||"None"))),c("React").createElement("div",{className:"_10sn"},J.length?c("React").createElement(c("OzIntentParams.react"),null,J):null,c("React").createElement("div",{className:"_2qn_"},this.state.config.getIn(["GK","bookOnOpenTableButton"])&&x(D)?this._renderOpenTableButton():null,this.state.config.getIn(["GK","scriptRestaurantClose"])&&x(D)?this._renderAutomationTrigger():null)),c("React").createElement("div",{className:"_1x-e _10sn"},c("React").createElement(c("OzRequirementTokenizer.react"),{allRequirements:this.props.requirements,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,selectedRequirements:D.get("requirements"),placeholder:"Add a requirement/tag..."})),c("React").createElement(c("OzIntentParams.react"),null,c("React").createElement("div",{className:"_19ny"},c("React").createElement(c("OzIntentParamsTextField.react"),{label:"Add notes about this intent...",onChange:this.props.onNotesChange,value:this.props.notes}))),I?c("React").createElement(c("OzIntentActions.react"),{intent:D,userEmail:F,location:G,timelineGK:I}):null)},_renderOpenTableButton:function B(){var C=this.props,D=C.thread,E=C.intent,F=y(D,E),G=z(F);if(!this.state.config.getIn(["GK","openTableAPI"]))return c("React").createElement(j,{className:(!(G&&G.length>0)?"_2qo0":"")+" _2qo1",onClick:this._handleOpenTableClick,type:"primary",label:"Book on OT"});else{var H=E.getIn(["params","request_type"],k()).first();if(!H||H.get("value")!=="reservation")return null;var I=A(E),J=!I.isEmpty()?"Missing fields: "+I.join(", "):"Book on OpenTable, schedule autosends, and send invite";return c("React").createElement(j,{className:(!I.isEmpty()?"_2qo0":"")+" _2qo1",onClick:this._handleOpenTableClick,type:"primary",label:"Book on OT via API",title:J})}},_renderAutomationTrigger:function B(){var C=this.props.intent,D=C.getIn(["params","request_type"],k()).first();if(!D||D.get("value")!=="reservation")return null;var E=A(C),F=!E.isEmpty()?"Missing fields: "+E.join(", "):"Send confirmation message, schedule autosends, and send invite";return c("React").createElement(j,{className:(!E.isEmpty()?"_2qo0":"")+" _2qo1",onClick:this._handleAutomationClick,type:"primary",label:"Run close automation",title:F})},_handleAutomationClick:function B(C){var D=this.props,E=D.thread,F=D.intent,G=c("OzHelpers").threadID(E),H=F.get("id"),I="close-restaurant",J=c("OzHelpers").getRequirement(F,I),K=J?c("OzAPI").deleteIntentRequirement(G,H,J.get("id")):c("Promise").resolve();return K.then(function(){return c("OzAPI").createIntentRequirement(G,H,I)})},_handleOpenTableClick:function B(C){var D=this.props,E=D.thread,F=D.intent,G=y(E,F);if(G.has("opentable-url"))if(this.state.config.getIn(["GK","openTableAPI"])&&G.has("ts")&&G.has("rid")&&G.has("party-size"))c("OzAPI").bookOpenTable(c("OzHelpers").threadID(E),F.get("id"),G.get("rid"),G.get("ts"),G.get("party-size"));else{var H=z(G);if(H.length)window.open(H,"_blank").focus()}},_handleChangeAlias:function B(C){var D=this.props,E=D.intent,F=D.onChangeAlias;F&&F(E,C)},_handleOpen:function B(){var C=this.props,D=C.intent,E=C.onOpen;E(D.get("id"))},_handleClose:function B(C){var D=this.props,E=D.intent,F=D.onClose;F(E.get("id"),C)},_handleIsBlockedToggle:function B(){var C=this.props,D=C.intent,E=C.onIsBlockedToggle;E(D)},_handleCreateRequirement:function B(C){var D=this.props,E=D.intent,F=D.onCreateRequirement;if(F)F(E.get("id"),C.get("name"))},_handleDeleteRequirement:function B(C){var D=this.props,E=D.intent,F=D.onDeleteRequirement;if(F)F(E.get("id"),C.get("id"))}}),s=["Active","Waiting","Closed"],t=c("React").createClass({displayName:"StatusDropdown",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{intent:n.instanceOf(l).isRequired,thread:n.instanceOf(l).isRequired},getInitialState:function B(){return{sem:0}},render:function B(){var C=this.props.intent,D=w(C),E=v(C).set("rating3",D.rating3).set("user-feedback",D.feedback);return c("React").createElement("div",null,c("React").createElement(c("XUISingleSelector.react"),{maxHeight:240,onChange:this._handleChange,value:this._value(),disabled:this.state.sem!==0},s.map(function(F){return c("React").createElement(p,{key:F,value:F},F)})),c("React").createElement(q,{meta:E}))},_value:function B(){var C=this.props.intent;return c("OzHelpers").isBlockedIntent(C)&&"Waiting"||c("OzHelpers").isClosedIntent(C)&&"Closed"||"Active"},_handleChange:function B(C){var D=C.value;switch(D){case"Active":this._handleOpen();break;case"Waiting":this._handleWaiting();break;case"Closed":this._handleIntentFeedback();break;default:c("OzHelpers").debug("[unknown intent state]")}},_sem:function B(C){var D=function(E){return this.setState(function(F){return{sem:F.sem+E}})}.bind(this);D(1);c("promiseFinally")(C,function(E){return D(-1)})},_handleOpen:function B(){var C=this.props.intent;this._sem(c("OzAPI").openIntent(C.get("user-id"),C.get("id")))},_handleWaiting:function B(){var C=this.props.intent;this._sem(c("OzAPI").blockIntent(C.get("user-id"),C.get("id")))},_handleIntentFeedback:function B(){var C=this.props,D=C.intent,E=C.thread,F=E.get("events",k()).filter(function(G){return m(["send","suggest"]).has(G.get("type"))&&G.get("at",0)>c("OzHelpers").serverNow()}).sortBy(function(G){return G.get("at")});c("OzActions").showDialog(c("OzFeedbackCloseDialog.react"),{intent:D,scheduleds:F,title:"Close Intent",onFeedbackDone:function(D,G,H,I){var J=G["close-state"];I&&I.map(function(K){return c("OzAPI").deleteScheduled(c("OzHelpers").threadID(E),K.get("id"))});this._sem(c("OzAPI").closeIntent(D.get("user-id"),D.get("id"),J,G,H));c("OzActions").hideDialog()}.bind(this)})}});function u(B){return B?c("React").createElement(c("OzTimestampScrolling.react"),{timestamp:B},c("React").createElement(c("OzDate.react"),{timestamp:B})):null}function v(B){return(B.get("events",k()).filter(function(C){return C.get("type")==="close-intent"}).maxBy(function(C){return C.get("timestamp")})||l()).get("data",l())}function w(B){var C=(B.get("events",k()).filter(function(D){return D&&D.getIn(["data","action"])==="intent_survey"}).last()||l()).getIn(["data","metadata"],"{}");return JSON.parse(C)}function x(B){var C=B.getIn(["metadata","category"]);return C==="restaurant"}function y(B,C){__p&&__p();var D=l(),E=B.get("guesses",k()).filter(function(P){return P.get("class")==="suggestions"}).first(),F=E?E.get("items",k()).filter(function(P){return P.get("type")==="bubble"}):k();if(F.count()>0){var G=F.first().get("meta",l()),H=G.getIn(["open-table","url"]),I=G.getIn(["open-table","rid"]);D=D.set("rid",I);if(H&&H.length>0){D=D.set("opentable-url",H);var J=C.get("params",l()),K=J.get("datetime",k()).first(),L=K?K.get("value",""):"";if(L.length>0){var M=new Date(L).getTime();D=D.set("ts",M)}var N=J.get("people_number",k()).first(),O=N?N.get("value",0):0;if(O>0)D=D.set("party-size",O)}}return D}function z(B){__p&&__p();var C=B.get("opentable-url");if(C&&C.length>0){var D=new(c("URI"))(C),E=B.get("ts");if(E){var F=new Date().getTimezoneOffset()*6e4,G=new Date(E-F).toISOString().slice(0,-1);D.addQueryData("dateTime",G)}var H=B.get("party-size",0);if(H>0)D.addQueryData("covers",H);return D.toString()}return""}function A(B){var C=k(["datetime","location","people_number","restaurant_name","place_id"]);return C.filterNot(function(D){return B.getIn(["params",D])})}f.exports=r}),null);
__d("OzIntentParamsDateTimeField.react",["immutable","OzDateTimePicker.react","OzIntentParamsAbstractField.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g){"use strict";var h=c("React").PropTypes,i=c("immutable").Map,j=c("React").createClass({displayName:"OzIntentParamsDateTimeField",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{label:h.string,location:h.instanceOf(i).isRequired,onChange:h.func,value:h.instanceOf(Date)},getInitialState:function k(){return{timezone:this.props.location.get("timezone")}},render:function k(){return c("React").createElement(c("OzIntentParamsAbstractField.react"),{hasValue:!!this.props.value,label:this.props.label},c("React").createElement(c("OzDateTimePicker.react"),{datePlaceholder:this.props.label,layout:"three-line",onChange:this._handleChange,showTimezoneName:false,timestamp:this.props.value&&this.props.value.getTime(),timezone:this.state.timezone}))},_handleChange:function k(l){var m=l.timezone,n=l.timestamp;this.props.onChange(new Date(n));this.setState({timezone:m})}});f.exports=j}),null);
__d("OzIntentParamsEnumField.react",["immutable","OzIntentParamsAbstractField.react","OzImmutablePureRenderMixin","React","XUISingleSelector.react"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("immutable").List,i=c("immutable").OrderedSet,j=c("React").PropTypes,k=c("XUISingleSelector.react").Option,l=c("React").createClass({displayName:"OzIntentParamsEnumField",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{label:j.string,onChange:j.func,onSave:j.func,placeholder:j.string,values:j.arrayOf(j.string).isRequired,value:j.string},getInitialState:function m(){return{value:this.props.value||""}},render:function m(){var n=(this.state.value?i(this.props.values).add(this.state.value).toList():h(this.props.values)).map(function(o){return c("React").createElement(k,{key:o,value:o},o)}).unshift(c("React").createElement(k,{key:this.props.placeholder,value:""},this.props.placeholder));return c("React").createElement(c("OzIntentParamsAbstractField.react"),{hasValue:!!this.state.value,label:this.props.label},c("React").createElement(c("XUISingleSelector.react"),{maxHeight:240,onChange:this._handleChange,value:this.state.value},n))},_handleChange:function m(n){this.props.onChange&&this.props.onChange(n.value);this.setState({value:n.value},this._save)},_save:function m(){if(this.props.onSave)this.props.onSave(this.state.value)}});f.exports=l}),null);
__d("OzIntentParamsNumberField.react",["cx","FBNumberInput.react","OzIntentParamsAbstractField.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("React").PropTypes,j=c("React").createClass({displayName:"OzIntentParamsNumberField",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{label:i.string,onChange:i.func,placeholder:i.string,value:i.number},render:function k(){return c("React").createElement(c("OzIntentParamsAbstractField.react"),{hasValue:this.props.value!=null,label:this.props.label},c("React").createElement(c("FBNumberInput.react"),{className:"_3dag",onValueChange:this.props.onChange,placeholder:this.props.placeholder,value:this.props.value}))}});f.exports=j}),null);
__d("OzPlaceField.react",["cx","joinClasses","immutable","OzConfig","OzLocationSearchSource","ReactComponentWithPureRenderMixin","React","Reflux","SearchableEntry","XUIError.react","XUITypeahead.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("React").PropTypes,j=c("immutable").Map,k=c("React").createClass({displayName:"OzPlaceField",mixins:[c("ReactComponentWithPureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:babelHelpers["extends"]({disabled:i.bool,onQueryStringChange:i.func.isRequired,onSelect:i.func.isRequired,placeholder:i.string,queryString:i.string,selectedEntry:i.instanceOf(j)},c("XUIError.react").PropTypes),getDefaultProps:function n(){return{disabled:false,placeholder:"Place"}},render:function n(){var o=this.props,p=o.className,q=o.disabled,r=o.onQueryStringChange,s=o.onSelect,t=o.placeholder,u=o.queryString,v=o.selectedEntry,w=c("joinClasses")("_44sp"+(q?" _44sq":""),p);return c("React").createElement(c("XUITypeahead.react"),{className:w,disabled:q,onChange:function x(y){return r(y.target.value)},onSelectAttempt:function x(y){return s(l(y))},placeholder:t,queryString:u,searchSource:c("OzLocationSearchSource"),selectedEntry:v&&v.get("id")&&v.get("name")?m(v):null,showEntriesOnFocus:true,tallInput:false,xuiErrorPosition:"left"})}});function l(n){return j({id:+n.getUniqueID(),name:n.getTitle(),description:n.getSubtitle(),photo:n.getPhoto()})}function m(n){return new(c("SearchableEntry"))({title:n.get("name"),subtitle:n.get("description"),uniqueID:n.get("id"),photo:n.get("photo")})}f.exports=k}),null);
__d("OzIntentParamsPlaceField.react",["OzIntentParamsAbstractField.react","OzPlaceField.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g){"use strict";var h=c("React").PropTypes,i=c("React").createClass({displayName:"OzIntentParamsPlaceField",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{label:h.string,onChange:h.func,onSave:h.func,placeholder:h.string,value:h.oneOfType([h.string,h.object])},render:function j(){var k=this.props,l=k.value,m=k.label,n=k.onChange,o=k.placeholder,p=l?typeof l==="string"?l:l.get("name")||"":"";return c("React").createElement(c("OzIntentParamsAbstractField.react"),{hasValue:!!l,label:m},c("React").createElement(c("OzPlaceField.react"),{onQueryStringChange:n,onSelect:n,placeholder:o,queryString:p,selectedEntry:typeof l==="object"?l:null}))}});f.exports=i}),null);
__d("OzIntentParamsPriceRangeField.react",["cx","OzIntentParamsAbstractField.react","OzImmutablePureRenderMixin","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("React").PropTypes,j=[1,2,3,4],k=c("React").createClass({displayName:"OzIntentParamsPriceRangeField",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{label:i.string,onChange:i.func,value:i.oneOf(j)},render:function l(){var m=this.props.value;return c("React").createElement(c("OzIntentParamsAbstractField.react"),{hasValue:!!m,label:this.props.label},c("React").createElement("span",{className:"_8l3"},j.map(function(n){return c("React").createElement("span",{className:"_8l4"+(m&&n<=m?" _8l6":""),key:n,onClick:function(o){return this._handleDollarClick(o,n)}.bind(this),role:"presentation"},"$")}.bind(this))))},_handleDollarClick:function l(m,n){m.preventDefault();var o=this.props.value==n?null:n;this.props.onChange&&this.props.onChange(o)}});f.exports=k}),null);
__d("OzIntentParamsStringField.react",["invariant","AbstractTextInput.react","OzIntentParamsAbstractField.react","OzImmutablePureRenderMixin","React","debounce"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("React").PropTypes,j=c("React").createClass({displayName:"OzIntentParamsStringField",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{label:i.string,onChange:i.func,onSave:i.func,placeholder:i.string,value:i.string},getInitialState:function k(){return{value:this.props.value||""}},componentWillMount:function k(){this._save=c("debounce")(this._save,750,this,true)},render:function k(){return c("React").createElement(c("OzIntentParamsAbstractField.react"),{hasValue:!!this.state.value,label:this.props.label},c("React").createElement(c("AbstractTextInput.react"),{onChange:this._handleChange,placeholder:this.props.placeholder,type:"text",value:this.state.value}))},_handleChange:function k(l){var m=l.target;m instanceof HTMLInputElement||h(0);this.props.onChange&&this.props.onChange(m.value);this.setState({value:m.value},this._save)},_save:function k(){if(this.props.onSave)this.props.onSave(this.state.value)}});f.exports=j}),null);
__d("OzIntentFactoryHelpers",["immutable","React","OzIntentParamsStringField.react","OzIntentParamsNumberField.react","OzIntentParamsPriceRangeField.react","OzIntentParamsEnumField.react","OzIntentParamsDateTimeField.react","OzIntentParamsPlaceField.react"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("immutable").Map,i={makeStateUpdater:function l(m){return function(n){var o;this._setStateAndSave((o={},o[m]=n,o))}},makeStateExtractor:function l(m){__p&&__p();return function(n){__p&&__p();var o=n.get("params")||h(),p={};for(var q=m,r=Array.isArray(q),s=0,q=r?q:q[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var t;if(r){if(s>=q.length)break;t=q[s++]}else{s=q.next();if(s.done)break;t=s.value}var u=t,v=u.name,w=u.type,x=j(o,v);switch(w){case"string":case"enum":p[v]=""+(x||"");break;case"number":case"pricerange":p[v]=+x||null;break;case"datetime":p[v]=x&&new Date(x);break;case"place":var y=j(o,"place_id");p[v]=h({id:y,name:x});break}}return babelHelpers["extends"]({},p,{notes:n.get("notes")||""})}},makeParamsUpdater:function l(m){__p&&__p();return function(n,o){__p&&__p();return(n||h()).withMutations(function(n){__p&&__p();for(var p=m,q=Array.isArray(p),r=0,p=q?p:p[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var s;if(q){if(r>=p.length)break;s=p[r++]}else{r=p.next();if(r.done)break;s=r.value}var t=s,u=t.name,v=t.type;switch(v){case"datetime":var w=o[u],x=w?{value:w.toISOString(),grain:"minute"}:undefined;k(n,u,x);break;case"place":var y=o[u];if(typeof y==="object"){k(n,"place_id",{value:y.get("id")});k(n,u,{value:y.get("name")})}else{k(n,"place_id",{value:null});k(n,u,{value:y})}break;default:k(n,u,{value:o[u]});break}}})}},makeFieldRenderer:function l(m){return function(n){return m.map(function(o){var p=o.label,q=o.name,r=o.placeholder,s=o.type,t=o.values,u=i.getFieldComponent(s);return c("React").createElement(u,{key:q,label:p,location:n,onChange:this._changeHandlers.get(q),placeholder:r||p,value:this.state[q],values:t})}.bind(this))}},getFieldComponent:function l(m){switch(m){case"string":return c("OzIntentParamsStringField.react");case"number":return c("OzIntentParamsNumberField.react");case"pricerange":return c("OzIntentParamsPriceRangeField.react");case"enum":return c("OzIntentParamsEnumField.react");case"datetime":return c("OzIntentParamsDateTimeField.react");case"place":return c("OzIntentParamsPlaceField.react");default:throw new Error("OzIntentFactoryHelpers: Unknown field type "+m+".")}}};function j(l,m){var n=l.get(m);if(n&&!n.isEmpty())return n.first().get("value");return null}function k(l,m,n){l.set(m,c("immutable").fromJS([n]))}f.exports=i}),null);
__d("OzIntentSchemas",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={get:function M(N,O){__p&&__p();var P=O.getIn(["GK","scriptRestaurantClose"]);switch(N){case"restaurant":case"restaurant_bar":return P?k:j;case"reminder":return l;case"appointment":case"nonmedical_appointment":return m;case"local_search":return n;case"good_purchase":return o;case"customer_service":case"customer_service_general":return p;case"weather_forecast":return q;case"hotel_and_accommodation":return r;case"activities_things_to_do":return s;case"ticket_purchase":case"movie_concert_show":return t;case"food_purchase":return u;case"utility":return v;case"book_car_transportation":case"vehicle_service":return w;case"traffic":return x;case"navigation":return y;case"flight_request":return z;case"stocks":return A;case"moviebot_search_movie":return B;case"moviebot_search_screening_event":return C;case"moviebot_buy_ticket":return D;case"moviebot_search_review":return E;case"moviebot_watch_trailer":return F;case"moviebot_provide_slot_value":return G;case"moviebot_reject":return H;case"moviebot_accept":return I;case"moviebot_greeting":return J;case"moviebot_help":return K;case"moviebot_other":return L;default:return i}}},i={name:"Generic",fields:[]},j={name:"Restaurant",fields:[{type:"enum",name:"request_type",label:"Action",placeholder:"Pick one...",values:["reservation","availability","cancel","confirm","change","info","location","option"]},{type:"string",name:"restaurant_name",label:"Name",placeholder:"Restaurant Name"},{type:"string",name:"restaurant_cuisine",label:"Cuisine"},{type:"string",name:"location",label:"Location"},{type:"number",name:"people_number",label:"Guests",placeholder:"Number of guests"},{type:"pricerange",name:"amount_of_money",label:"Price Range"},{type:"datetime",name:"datetime",label:"Date/Time"}]},k={name:"Restaurant",fields:[{type:"enum",name:"request_type",label:"Action",placeholder:"Pick one...",values:["reservation","availability","cancel","confirm","change","info","location","option"]},{type:"place",name:"restaurant_name",label:"Name",placeholder:"Restaurant Name"},{type:"string",name:"restaurant_cuisine",label:"Cuisine"},{type:"string",name:"location",label:"Location"},{type:"number",name:"people_number",label:"Guests",placeholder:"Number of guests"},{type:"pricerange",name:"amount_of_money",label:"Price Range"},{type:"datetime",name:"datetime",label:"Date/Time"}]},l={name:"reminder",fields:[{type:"datetime",name:"datetime",label:"Reminder Time"},{type:"string",name:"reminder",label:"About"}]},m={name:"NonMedicalAppt",fields:[{type:"enum",name:"appt_action",label:"Action",placeholder:"Pick one...",values:["availability","cancel","move","confirm","book"]},{type:"string",name:"appt_type",label:"Appt Type",placeholder:"Type of appointment"},{type:"string",name:"location",label:"Location",placeholder:"Location of appointment"},{type:"datetime",name:"datetime",label:"Datetime",placeholder:"Date and time of the appointment"},{type:"string",name:"local_search_query",label:"Name",placeholder:"Name of the place"}]},n={name:"LocalSearch",fields:[{type:"string",name:"local_query",label:"Query",placeholder:"Search query like yoga class..."},{type:"string",name:"location",label:"Location",placeholder:""},{type:"string",name:"local_name",label:"Name",placeholder:"Name of the place or business..."},{type:"datetime",name:"datetime",label:"Datetime",placeholder:""}]},o={name:"GoodPurchase",fields:[{type:"string",name:"good",label:"Good",placeholder:""},{type:"string",name:"provider",label:"Merchant",placeholder:""},{type:"string",name:"amount_of_money",label:"Price"},{type:"number",name:"good_number",label:"Items #",placeholder:"Number of Items"},{type:"string",name:"location",label:"Location",placeholder:""}]},p={name:"CustomerService",fields:[{type:"string",name:"provider",label:"Merchant"},{type:"string",name:"order_number",label:"Order #"}]},q={name:"Weather",fields:[{type:"string",name:"location",label:"Location"},{type:"datetime",name:"datetime",label:"Datetime"},{type:"string",name:"weather_type",label:"Type of forecast",placeholder:"temperature, snow, tide..."},{type:"string",name:"temperature_metric",label:"Metric",placeholder:"Celsius or Fahrenheit"}]},r={name:"Hotel",fields:[{type:"enum",name:"hotel_query_type",label:"Action",placeholder:"Pick one...",values:["reservation","availability","cancel","change","contact","extend","receipt"]},{type:"string",name:"location",label:"Location"},{type:"datetime",name:"datetime",label:"Check in",placeholder:"Date and time of the appointment"},{type:"number",name:"night_number",label:"Nights #",placeholder:"Number of Nights"},{type:"number",name:"people",label:"People",placeholder:"Number of Guests"},{type:"string",name:"amount_of_money",label:"Price"},{type:"string",name:"hotel_name",label:"Hotel Name"}]},s={name:"Activities",fields:[{type:"string",name:"reservation_type",label:"Activity"},{type:"string",name:"location",label:"Location"},{type:"datetime",name:"datetime",label:"Datetime"},{type:"string",name:"amount_of_money",label:"Price"},{type:"number",name:"people_number",label:"People",placeholder:"Number of People"}]},t={name:"Tickets",fields:[{type:"enum",name:"request_type",label:"Action",placeholder:"Pick one...",values:["reservation","availability","cancel","change","info","location","option","price","receipt","time","schedule"]},{type:"string",name:"event_type",label:"Type",placeholder:"Movie, show, concert..."},{type:"string",name:"event",label:"Name"},{type:"string",name:"event_venue",label:"Venue"},{type:"string",name:"location",label:"Location"},{type:"datetime",name:"datetime",label:"Datetime"},{type:"string",name:"amount_of_money",label:"Price"},{type:"number",name:"people_number",label:"Tickets #",placeholder:"Number of Tickets"}]},u={name:"FoodPurchase",fields:[{type:"string",name:"order",label:"Order",placeholder:""},{type:"string",name:"food_type",label:"Food Type",placeholder:""},{type:"string",name:"food_place",label:"Place"},{type:"enum",name:"delivery_type",label:"Delivery",placeholder:"Pick one...",values:["deliver","takeout"]},{type:"string",name:"location",label:"Location",placeholder:""},{type:"datetime",name:"datetime",label:"Datetime"}]},v={name:"Utility",fields:[{type:"enum",name:"request_type",label:"Action",placeholder:"Pick one...",values:["reservation","availability","cancel","change","info","location","option","price","receipt","time","schedule"]},{type:"string",name:"utility_provider",label:"Name",placeholder:"Name of the utility company"},{type:"string",name:"location",label:"Location",placeholder:""},{type:"string",name:"account_nbr",label:"Account #",placeholder:""}]},w={name:"Vehicle",fields:[{type:"enum",name:"hotel_query_type",label:"Action",placeholder:"Pick one...",values:["reservation","availability","cancel","change","info","location","option","price","receipt","time","schedule"]},{type:"string",name:"from",label:"From"},{type:"string",name:"to",label:"To"},{type:"datetime",name:"datetime",label:"Datetime",placeholder:"Date and time of the ride"},{type:"string",name:"car_type",label:"Car Type",placeholder:"Type of car (limo, uber, lift...)"},{type:"string",name:"people_number",label:"People",placeholder:"Number of Guests"},{type:"string",name:"vehicle_provider",label:"Rental Name",placeholder:"Car rental name like Hertz, Avis.."}]},x={name:"Traffic",fields:[{type:"string",name:"from",label:"Starting Point"},{type:"string",name:"to",label:"Destination"},{type:"datetime",name:"datetime",label:"Date/Time",placeholder:"Intended departure time (not supported by automation)"}]},y={name:"Navigation",fields:[{type:"string",name:"from",label:"Starting Point"},{type:"string",name:"to",label:"Destination"},{type:"datetime",name:"datetime",label:"Date/Time",placeholder:"Intended departure time (not supported by automation)"}]},z={name:"flight_request",fields:[{type:"enum",name:"flight_query_type",label:"Action",placeholder:"Pick one...",values:["book","price","upgrade","flight_status","cancel","change"]},{type:"string",name:"from",label:"From"},{type:"string",name:"to",label:"To"},{type:"datetime",name:"departure",label:"Departure"},{type:"datetime",name:"arrival",label:"Arrival"},{type:"string",name:"carrier",label:"Carrier"},{type:"string",name:"reference",label:"Reference #"},{type:"string",name:"passenger_num",label:"Passenger #"}]},A={name:"stocks",fields:[{type:"string",name:"stock_symbol_list",label:"Stocks",placeholder:"Comma separated list of symbols"}]},B={name:"moviebot_search_movie",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"},{type:"string",name:"location_text",label:"location - text",placeholder:"Part of message with location"},{type:"string",name:"location_entity",label:"location - entity",placeholder:"location referred to"},{type:"string",name:"theater_text",label:"theater - text",placeholder:"Part of message with theater"},{type:"string",name:"theater_entity",label:"theater - entity",placeholder:"theater referred to"},{type:"string",name:"datetime_text",label:"datetime - text",placeholder:"Part of message with datetime"},{type:"string",name:"datetime_entity",label:"datetime - entity",placeholder:"datetime referred to"},{type:"string",name:"screening_type_text",label:"screening_type - text",placeholder:"Part of message with screening_type"},{type:"string",name:"screening_type_entity",label:"screening_type - entity",placeholder:"screening_type referred to"},{type:"string",name:"age_rating_text",label:"age_rating - text",placeholder:"Part of message with age_rating"},{type:"string",name:"age_rating_entity",label:"age_rating - entity",placeholder:"age_rating referred to"},{type:"string",name:"genre_text",label:"genre - text",placeholder:"Part of message with genre"},{type:"string",name:"genre_entity",label:"genre - entity",placeholder:"genre referred to"}]},C={name:"moviebot_search_screening_event",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"},{type:"string",name:"movie_text",label:"movie - text",placeholder:"Part of message with movie"},{type:"string",name:"movie_entity",label:"movie - entity",placeholder:"movie referred to"},{type:"string",name:"location_text",label:"location - text",placeholder:"Part of message with location"},{type:"string",name:"location_entity",label:"location - entity",placeholder:"location referred to"},{type:"string",name:"theater_text",label:"theater - text",placeholder:"Part of message with theater"},{type:"string",name:"theater_entity",label:"theater - entity",placeholder:"theater referred to"},{type:"string",name:"datetime_text",label:"datetime - text",placeholder:"Part of message with datetime"},{type:"string",name:"datetime_entity",label:"datetime - entity",placeholder:"datetime referred to"},{type:"string",name:"screening_type_text",label:"screening_type - text",placeholder:"Part of message with screening_type"},{type:"string",name:"screening_type_entity",label:"screening_type - entity",placeholder:"screening_type referred to"}]},D={name:"moviebot_buy_ticket",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"},{type:"string",name:"movie_text",label:"movie - text",placeholder:"Part of message with movie"},{type:"string",name:"movie_entity",label:"movie - entity",placeholder:"movie referred to"},{type:"string",name:"location_text",label:"location - text",placeholder:"Part of message with location"},{type:"string",name:"location_entity",label:"location - entity",placeholder:"location referred to"},{type:"string",name:"theater_text",label:"theater - text",placeholder:"Part of message with theater"},{type:"string",name:"theater_entity",label:"theater - entity",placeholder:"theater referred to"},{type:"string",name:"datetime_text",label:"datetime - text",placeholder:"Part of message with datetime"},{type:"string",name:"datetime_entity",label:"datetime - entity",placeholder:"datetime referred to"},{type:"string",name:"ticket_count_text",label:"ticket_count - text",placeholder:"Part of message with ticket_count"},{type:"string",name:"ticket_count_entity",label:"ticket_count - entity",placeholder:"ticket_count referred to"},{type:"string",name:"screening_type_text",label:"screening_type - text",placeholder:"Part of message with screening_type"},{type:"string",name:"screening_type_entity",label:"screening_type - entity",placeholder:"screening_type referred to"}]},E={name:"moviebot_search_review",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"},{type:"string",name:"movie_text",label:"movie - text",placeholder:"Part of message with movie"},{type:"string",name:"movie_entity",label:"movie - entity",placeholder:"movie referred to"}]},F={name:"moviebot_watch_trailer",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"},{type:"string",name:"movie_text",label:"movie - text",placeholder:"Part of message with movie"},{type:"string",name:"movie_entity",label:"movie - entity",placeholder:"movie referred to"}]},G={name:"moviebot_provide_slot_value",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"},{type:"string",name:"movie_text",label:"movie - text",placeholder:"Part of message with movie"},{type:"string",name:"movie_entity",label:"movie - entity",placeholder:"movie referred to"},{type:"string",name:"location_text",label:"location - text",placeholder:"Part of message with location"},{type:"string",name:"location_entity",label:"location - entity",placeholder:"location referred to"},{type:"string",name:"theater_text",label:"theater - text",placeholder:"Part of message with theater"},{type:"string",name:"theater_entity",label:"theater - entity",placeholder:"theater referred to"},{type:"string",name:"datetime_text",label:"datetime - text",placeholder:"Part of message with datetime"},{type:"string",name:"datetime_entity",label:"datetime - entity",placeholder:"datetime referred to"},{type:"string",name:"ticket_count_text",label:"ticket_count - text",placeholder:"Part of message with ticket_count"},{type:"string",name:"ticket_count_entity",label:"ticket_count - entity",placeholder:"ticket_count referred to"},{type:"string",name:"screening_type_text",label:"screening_type - text",placeholder:"Part of message with screening_type"},{type:"string",name:"screening_type_entity",label:"screening_type - entity",placeholder:"screening_type referred to"},{type:"string",name:"age_rating_text",label:"age_rating - text",placeholder:"Part of message with age_rating"},{type:"string",name:"age_rating_entity",label:"age_rating - entity",placeholder:"age_rating referred to"}]},H={name:"moviebot_reject",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"}]},I={name:"moviebot_accept",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"}]},J={name:"moviebot_greeting",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"}]},K={name:"moviebot_help",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"}]},L={name:"moviebot_other",fields:[{type:"string",name:"message",label:"Message",placeholder:"Message being annotated"},{type:"string",name:"movie_text",label:"movie - text",placeholder:"Part of message with movie"},{type:"string",name:"movie_entity",label:"movie - entity",placeholder:"movie referred to"},{type:"string",name:"location_text",label:"location - text",placeholder:"Part of message with location"},{type:"string",name:"location_entity",label:"location - entity",placeholder:"location referred to"},{type:"string",name:"theater_text",label:"theater - text",placeholder:"Part of message with theater"},{type:"string",name:"theater_entity",label:"theater - entity",placeholder:"theater referred to"},{type:"string",name:"datetime_text",label:"datetime - text",placeholder:"Part of message with datetime"},{type:"string",name:"datetime_entity",label:"datetime - entity",placeholder:"datetime referred to"},{type:"string",name:"ticket_count_text",label:"ticket_count - text",placeholder:"Part of message with ticket_count"},{type:"string",name:"ticket_count_entity",label:"ticket_count - entity",placeholder:"ticket_count referred to"},{type:"string",name:"screening_type_text",label:"screening_type - text",placeholder:"Part of message with screening_type"},{type:"string",name:"screening_type_entity",label:"screening_type - entity",placeholder:"screening_type referred to"},{type:"string",name:"age_rating_text",label:"age_rating - text",placeholder:"Part of message with age_rating"},{type:"string",name:"age_rating_entity",label:"age_rating - entity",placeholder:"age_rating referred to"},{type:"string",name:"genre_text",label:"genre - text",placeholder:"Part of message with genre"},{type:"string",name:"genre_entity",label:"genre - entity",placeholder:"genre referred to"}]};f.exports=h}),null);
__d("OzIntentFactory",["immutable","Map","OzAPI","OzGenericIntent.react","OzIntentFactoryHelpers","OzIntentSchemas","OzImmutablePureRenderMixin","React","debounce"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("React").PropTypes,i=new(c("Map"))(),j={get:function l(m,n){var o=c("OzIntentSchemas").get(m,n);if(!i.has(m))i.set(m,k(o));return i.get(m)}};function k(l){__p&&__p();var m=c("immutable").Map,n=l.name,o=l.fields,p=1e4,q=c("OzIntentFactoryHelpers").makeStateExtractor(o),r=c("OzIntentFactoryHelpers").makeFieldRenderer(o),s=c("OzIntentFactoryHelpers").makeParamsUpdater(o);return c("React").createClass({displayName:"Oz"+n+"DynamicIntent",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{intent:h.instanceOf(m).isRequired,location:h.instanceOf(m).isRequired,onChangeAlias:h.func.isRequired,onClose:h.func.isRequired,onOpen:h.func.isRequired,onIsBlockedToggle:h.func.isRequired,onTriggerAI:h.func.isRequired,requirements:h.instanceOf(m).isRequired,repNames:h.instanceOf(m).isRequired,onCreateRequirement:h.func,onDeleteRequirement:h.func,thread:h.instanceOf(m).isRequired,userEmail:h.string},getInitialState:function t(){return babelHelpers["extends"]({isEditing:false},q(this.props.intent))},componentWillMount:function t(){__p&&__p();this._saveIntent=c("debounce")(this._saveIntent,500,this,true);this._changeHandlers=m().withMutations(function(u){__p&&__p();for(var v=o,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var y;if(w){if(x>=v.length)break;y=v[x++]}else{x=v.next();if(x.done)break;y=x.value}var z=y;u.set(z.name,c("OzIntentFactoryHelpers").makeStateUpdater(z.name).bind(this))}}.bind(this))},componentWillReceiveProps:function t(u){var v=this.state.isEditing;if(c("immutable").is(u.intent,this.props.intent)||v)return;this.setState(q(u.intent))},componentWillUnmount:function t(){window.clearTimeout(this._editingTimeout)},render:function t(){return c("React").createElement(c("OzGenericIntent.react"),babelHelpers["extends"]({},this.props,{notes:this.state.notes,onNotesChange:this._handleNotesChange}),this._renderFields(this.props.location))},_renderFields:r,_handleNotesChange:function t(u){this._setStateAndSave({notes:u})},_saveIntent:function t(){var u=this.props.intent;c("OzAPI").editIntent(u.get("user-id"),m({id:u.get("id"),params:s(u.get("params"),this.state),notes:this.state.notes}))},_setStateAndSave:function t(u){window.clearTimeout(this._editingTimeout);this.setState(babelHelpers["extends"]({isEditing:true},u),this._saveIntent);this._editingTimeout=window.setTimeout(function(v){return this.setState({isEditing:false})}.bind(this),p)}})}f.exports=j}),null);
__d("OzIntent.react",["OzAPI","OzHelpers","immutable","OzIntentFactory","OzImmutablePureRenderMixin","React","Reflux","OzConfig","OzWrapper.react"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("immutable").Map,i=c("React").PropTypes,j=c("React").createClass({displayName:"OzIntent",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{intent:i.instanceOf(h).isRequired,requirements:i.instanceOf(h).isRequired,repNames:i.instanceOf(h).isRequired,location:i.instanceOf(h).isRequired,thread:i.instanceOf(h).isRequired},render:function k(){var l=this.props,m=l.intent,n=l.intentMeta,o=l.location,p=l.repNames,q=l.requirements,r=l.thread,s=l.timelineGK,t=c("OzIntentFactory").get(c("OzHelpers").intentName(m),this.state.config);return c("React").createElement(t,{key:m.get("id"),intent:m,intentMeta:n,onChangeAlias:this._handleChangeAlias,onClose:this._handleClose,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,onOpen:this._handleOpen,onIsBlockedToggle:this._handleIsBlockedToggle,onTriggerAI:this._handleTriggerAI,repNames:p,requirements:q,location:o,thread:r,timelineGK:s})},_handleClose:function k(l,m,n){c("OzAPI").closeIntent(c("OzHelpers").threadID(this.props.thread),l,m,n)},_handleOpen:function k(l){c("OzAPI").openIntent(c("OzHelpers").threadID(this.props.thread),l)},_handleDeleteRequirement:function k(l,m){c("OzAPI").deleteIntentRequirement(c("OzHelpers").threadID(this.props.thread),l,m)},_handleCreateRequirement:function k(l,m){c("OzAPI").createIntentRequirement(c("OzHelpers").threadID(this.props.thread),l,m)},_handleChangeAlias:function k(l,m){c("OzAPI").editIntent(l.get("user-id"),h({id:l.get("id"),alias:m}))},_handleIsBlockedToggle:function k(l){l.get("blocked")?c("OzAPI").unblockIntent(c("OzHelpers").threadID(this.props.thread),l.get("id")):c("OzAPI").blockIntent(c("OzHelpers").threadID(this.props.thread),l.get("id"))},_handleTriggerAI:function k(l,m){var n=this.props.intent;c("OzAPI").triggerAIForIntent(n.get("user-id"),n.get("id"));window.setTimeout(m,2500)}});f.exports=c("OzWrapper.react")(j)}),null);
__d("OzIntentEvents.react",["cx","OzAPI","OzHelpers","ozFormatTime","immutable","OzConfig","OzDate.react","OzTimestampScrolling.react","React","Reflux","Tooltip","OzActions"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("immutable").List,k=c("React").PropTypes,l=c("React").createClass({displayName:"OzIntentEvents",mixins:[c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{intent:k.instanceOf(i).isRequired},render:function z(){var A=this.props.intent,B=(A.get("events")||j()).toList(),C=B.filter(function(G){return G.get("type")==="completed-call"}),D=B.filter(function(G){return G.get("type")==="send-email"||G.get("type")==="receive-email"}),E=B.filter(function(G){return G.get("type")==="send-calendar"}),F=B.filter(function(G){return G.get("type")==="book-reservation"&&G.getIn(["data","confirmation-number"])});return c("React").createElement("div",{className:"_4h0y"},c("React").createElement(s,{header:"Calls",events:C,onCallPlay:p}),c("React").createElement(s,{header:"Emails",events:D}),c("React").createElement(s,{header:"Invites",events:E}),c("React").createElement(s,{header:"Reservations",events:F}))}}),m=function m(z){c("OzActions").emailComposer.add(babelHelpers["extends"]({},c("OzHelpers").eventToEmail(z),{disabled:true}))},n=function n(z){c("OzActions").emailComposer.add(c("OzHelpers").eventToEmail(c("OzHelpers").reEmail(z)))},o=function o(z){c("OzActions").inviteComposer.add(c("OzHelpers").eventToInvite(z))},p=function p(z){return c("OzAPI").everstoreURI(z).then(function(A){return window.open(A)})},q=function q(z){window.open(z.getIn(["data","opentable-listing","url"]))},r=function r(z){return-z.get("id")},s=c("OzHelpers").pure(function(z){var A=z.header,B=z.events;return B&&!B.isEmpty()?c("React").createElement("details",{open:true},c("React").createElement("summary",{className:"_177e _3_lv"},A,"... (",B.count(),")"),c("React").createElement("div",{className:"_4h0z"},B.map(function(event){return c("React").createElement(t,{orderBy:r,event:event,key:event.get("id")})}))):null}),t=c("OzHelpers").pure(function(z){__p&&__p();var event=z.event,A=z.orderBy,B=event.get("data");switch(event.get("type")){case"send-email":return c("React").createElement(y,{order:A(event),sign:"@",subtitle:B.get("subject"),actions:[["VIEW",function(F){return m(event)}],["REPLY",function(F){return n(event)}]]},c("React").createElement(v,{data:B,type:"to"}));case"receive-email":return c("React").createElement(y,{order:A(event),sign:"@",subtitle:B.get("subject"),actions:[["VIEW",function(F){return m(c("OzHelpers").switchRecip(event))}],["REPLY",function(F){return n(c("OzHelpers").switchRecip(event))}]]},c("React").createElement(v,{data:B,type:"from"}));case"send-calendar":return c("React").createElement(y,{order:A(event),sign:"@",subtitle:B.get("title"),timestamp:B.get("start"),actions:[["VIEW",function(F){return o(event)}]]},c("React").createElement(w,{data:B}));case"completed-call":return c("React").createElement(x,{event:event,onCallPlay:p,orderBy:A});case"book-reservation":var C=new Date(B.get("ts")),D=c("OzHelpers").toLocaleDate(C)+" at "+c("OzHelpers").toLocaleTime(C),E="Table for "+B.get("covers")+" on "+D;return c("React").createElement(y,{order:A(event),sign:"",subtitle:E,event:event,actions:[["VIEW",function(F){return q(event)}]]});default:return null}}),u=function u(z){if(!z)return j();if(typeof z.join==="function")return z;return j([z])},v=c("OzHelpers").pure(function(z){var A=z.data,B=z.type,C=(B==="to"?"Sent":"Received")+" at "+c("OzHelpers").toLocaleTime(A.get("sent-at"))+" on "+c("OzHelpers").toLocaleDate(A.get("sent-at")),D=B==="from"?A.get("from"):u(A.get("to")).join(", "),E=B==="to"?"To":"From";return c("React").createElement("span",c("Tooltip").propsFor(C),E," ",c("React").createElement("strong",null,D))}),w=c("OzHelpers").pure(function(z){var A=z.data,B="Sent at "+c("OzHelpers").toLocaleTime(A.get("sent-at"))+" on "+c("OzHelpers").toLocaleDate(A.get("sent-at"));return c("React").createElement("span",c("Tooltip").propsFor(B),c("React").createElement("strong",null,u(A.get("to")).join(", ")||null))}),x=c("OzHelpers").pure(function(z){var event=z.event,A=z.onCallPlay,B=z.orderBy,C=event.get("data"),D={"in":"Call from",out:"Call to",voicemail:"Voicemail from"}[C.get("direction")],E=c("OzHelpers").parsePhoneNumber(C.get("remote-phone")),F=C.get("RecordingDuration"),G=C.get("recording-ev-handle"),H=G?[["PLAY",function(I){return A(G)}]]:[];return c("React").createElement(y,{order:B(event),sign:"#",subtitle:c("ozFormatTime")(+F),timestamp:event.get("timestamp"),actions:H},c("React").createElement("span",null,D," ",c("React").createElement("strong",null,E)))}),y=c("OzHelpers").pure(function(z){var A=z.sign,B=z.children,C=z.subtitle,D=z.actions,E=z.timestamp,F=z.order;return c("React").createElement("div",{className:"_25js",style:{order:F}},c("React").createElement("div",{className:"_4h12"},A),c("React").createElement("div",{className:"_4h18"},c("React").createElement("div",null,B),c("React").createElement("div",null,C,C&&E?c("React").createElement("span",null," \u2014 "):null,E?c("React").createElement(c("OzTimestampScrolling.react"),{timestamp:E},c("React").createElement(c("OzDate.react"),{timestamp:E,className:"_3_lw"})):null)),c("React").createElement("div",{className:"_4h19"},D.map(function(G,H){var I=G[0],J=G[1];return c("React").createElement("div",{key:H},c("React").createElement("button",{key:H,className:"_1-hv _30yy _4h1a",onClick:J},I))})))});f.exports={OzIntentEvents:l,EventContainer:t}}),null);
__d("OzIntentList.react",["cx","OzHelpers","immutable","OzIntentEvents.react","OzSidebarItemHeader.react","OzImmutablePureRenderMixin","React","OzWrapper.react","ReactDOM","ReactRouter"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("OzIntentEvents.react").OzIntentEvents,j=c("React").PropTypes,k=c("ReactRouter").Link,l=c("React").createClass({displayName:"OzIntentList",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{activeIntentId:j.number,intents:j.instanceOf(c("immutable").List).isRequired,timelineGK:j.bool},componentDidMount:function n(){var o=c("ReactDOM").findDOMNode(this.refs[this.props.activeIntentId]);o&&o.scrollIntoViewIfNeeded()},componentDidUpdate:function n(o){var p=this.props,q=p.activeIntentId,r=p.isHistory,s=c("ReactDOM").findDOMNode(this.refs[q]);if(s&&(o.activeIntentId!==q||o.isHistory!==r))s.scrollIntoViewIfNeeded()},render:function n(){return c("React").createElement("div",null,this.props.intents.map(this._renderIntent))},_renderIntent:function n(o){var p=o.get("id"),q=this.props,r=q.activeIntentId,s=q.timelineGK,t=r===p;return c("React").createElement(m,{ref:p,key:p,intent:o,isExpanded:t,timelineGK:s})}}),m=c("OzHelpers").pure(function(n){var o=n.intent,p=n.isExpanded,q=n.timelineGK;return c("React").createElement("div",null,c("React").createElement(k,{className:"_qsr",to:c("OzHelpers").threadPath({threadid:o.get("user-id"),intentid:o.get("id")})},c("React").createElement(c("OzSidebarItemHeader.react"),{alias:o.get("alias"),className:"_qsu"+(p?" _qsv":""),closedAt:o.get("closed-at"),closeState:o.get("state"),createdAt:o.get("created-at"),isBlocked:o.get("blocked"),isClosed:c("OzHelpers").isClosedIntent(o),label:c("OzHelpers").isOpenIntent(o)&&o.get("assigned-bot")?"BOT":null,skipScrollToTimestamp:true,title:c("OzHelpers").intentName(o),timelineGK:q})),p&&c("React").createElement(i,{intent:o}))});f.exports=c("OzWrapper.react")(l)}),null);
__d("OzIntentTabs.react",["cx","OzHelpers","immutable","OzImmutablePureRenderMixin","React","ReactRouter"],(function a(b,c,d,e,f,g,h){var i=c("ReactRouter").Link,j=c("immutable").List,k=c("React").PropTypes,l=c("React").createClass({displayName:"OzIntentTabs",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{intents:k.instanceOf(j).isRequired,tasks:k.instanceOf(j).isRequired,threadId:k.string.isRequired,activeIntentId:k.number},render:function n(){var o=this.props,p=o.activeIntentId,q=o.intents,r=o.tasks,s=o.threadId;return c("React").createElement("div",{className:"_27fz"},c("React").createElement(i,{className:"_27f-"+(!p?" _27f_":""),to:c("OzHelpers").threadPath({threadid:s})},"All tasks"),q.map(function(t){return c("React").createElement(m,{key:t.get("id"),intent:t,tasks:r,activeIntentId:p})}))}}),m=c("OzHelpers").pure(function(n){var o=n.intent,p=n.activeIntentId,q=n.tasks,r=o.get("id")===p,s=c("OzHelpers").isBlockedIntent(o),t=c("OzHelpers").isClosedIntent(o),u=c("OzHelpers").nextTaskForIntent(o,q);return c("React").createElement(i,{className:"_27f-"+(r?" _27f_":"")+(s||t?" _xpo":""),to:c("OzHelpers").threadPath({threadid:o.get("user-id"),intentid:o.get("id"),taskid:u&&u.get("id")})},o.get("alias",o.get("name")))});f.exports=l}),null);
__d("OzReminderNotesField.react",["OzIntentParamsTextField.react","OzImmutablePureRenderMixin","React","debounce"],(function a(b,c,d,e,f,g){"use strict";var h=c("React").PropTypes,i=c("React").createClass({displayName:"OzReminderNotesField",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{seedNotes:h.string,onSave:h.func.isRequired},getInitialState:function j(){return{notes:this.props.seedNotes||""}},componentWillMount:function j(){this._save=c("debounce")(this._save,750,this,true)},render:function j(){return c("React").createElement(c("OzIntentParamsTextField.react"),{label:"Add notes about this reminder...",onChange:this._handleChange,value:this.state.notes})},_handleChange:function j(k){this.setState({notes:k},this._save)},_save:function j(){this.props.onSave(this.state.notes)}});f.exports=i}),null);
__d("OzReminderTask.react",["cx","OzAPI","OzHelpers","immutable","OzIntentParamsAbstractField.react","OzIntentParamsStringField.react","OzReminderTaskEditor.react","OzReminderNotesField.react","OzSidebarItemHeader.react","OzImmutablePureRenderMixin","React","ReactRouter","formatDate"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("immutable").Map,j=c("React").PropTypes,k=c("ReactRouter").Link,l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m=c("React").createClass({displayName:"OzReminderTask",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{task:j.instanceOf(i).isRequired,repNames:j.instanceOf(i).isRequired,location:j.instanceOf(i).isRequired},render:function o(){var p=this.props,q=p.task,r=p.repNames,s=p.location,t=q.getIn(["data","description"]),u=c("OzHelpers").isUrgentTask(q),v=q.getIn(["data","suggestion"]),w=c("OzHelpers").isClosedTask(q),x=q.get("from"),y=r.get(x,x);return c("React").createElement("div",{className:"_wc0"+(u?" _wc2":"")+(c("OzHelpers").isPaidTask(q)?" _3d-l":"")+(w?" _3d-m":"")},c("React").createElement(c("OzSidebarItemHeader.react"),{className:"_1k8u",creator:y,isClosed:w,isExpanded:true,onToggle:this._handleToggle,onCancel:this._handleCancel,title:t||n(v)},u?c("React").createElement("button",{className:"_1-hv _260v _260w",alt:"Snooze",onClick:this._handleSnooze}):null,!w?c("React").createElement(c("OzReminderTaskEditor.react"),{layered:true,onSave:this._handleEdit,seedTask:q,location:s},c("React").createElement("a",{className:"_260y"},c("React").createElement("i",{className:"_5x82"}))):null),this._renderBody())},_renderBody:function o(){var p=this.props.task,q=p.getIn(["schedule","repeat-condition","days"]),r=c("OzHelpers").threadPath({threadid:p.get("user-id"),intentid:p.get("intent-id")}),s=p.get("state")==="waiting"?"Fires on":"Fired on";return c("React").createElement("div",{className:"_wc3"},c("React").createElement("div",{className:"_1k8v _3-ue"},c("React").createElement(k,{to:r},c("React").createElement("span",null,"Go to intent")),this._renderPayment(p),c("React").createElement(c("OzIntentParamsAbstractField.react"),{label:s},c("React").createElement("span",null,c("formatDate")(new Date(p.get("start-at")),"M jS, g:ia"))),c("React").createElement(c("OzIntentParamsAbstractField.react"),{label:"Due"},c("React").createElement("span",null,c("formatDate")(new Date(p.get("deadline")),"M jS, g:ia"))),q&&!q.isEmpty()?c("React").createElement(c("OzIntentParamsAbstractField.react"),{label:"Recurs"},c("React").createElement("span",null,q.size===7?"Every Day":q.sort().map(function(t){return l[t%7]}).toArray().join(" "))):null,c("React").createElement(c("OzReminderNotesField.react"),{seedNotes:p.getIn(["data","notes"])||p.getIn(["data","description"]),onSave:this._handleNotesSave})))},_renderPayment:function o(p){var q=p.getIn(["data","suggestion"]);if(!q)return null;var r=p.getIn(["data","credit-card"]),s=q.get("name");return c("React").createElement("div",null,c("React").createElement(c("OzIntentParamsAbstractField.react"),{label:"Link"},c("React").createElement("div",{className:"_3d-q"},c("React").createElement("a",{className:"_3d-r",target:"_blank",href:q.get("target-url"),title:q.get("description")},"Click here to view ",s),r?c("React").createElement("a",{className:"_3d-s",href:"#",title:"Show credit card information",onClick:this._handlePaymentLinkClick}):null)),c("React").createElement(c("OzIntentParamsStringField.react"),{label:"Confirmation #",onSave:this._handleItemNumberSave,placeholder:"Confirmation number",value:p.getIn(["data","item-number"])||""}))},_handleNotesSave:function o(p){this._handleEdit(this.props.task.setIn(["data","notes"],p))},_handleItemNumberSave:function o(p){this._handleEdit(this.props.task.setIn(["data","item-number"],p))},_handleToggle:function o(){var p=this.props.task;c("OzHelpers").isClosedTask(p)?this._handleOpen(p):this._handleComplete(p)},_handleComplete:function o(p){c("OzAPI").completeTask(p.get("user-id"),p)},_handleCancel:function o(){var p=this.props.task;c("OzAPI").cancelTask(p.get("user-id"),p)},_handleEdit:function o(p){return c("OzAPI").editTask(p.get("user-id"),p)},_handleOpen:function o(p){c("OzAPI").openTask(p.get("user-id"),p)},_handleSnooze:function o(){var p=this.props.task,q=c("OzHelpers").serverNow()+1e3*60*10;c("OzAPI").editTask(p.get("user-id"),p.set("deadline",q))},_handlePaymentLinkClick:function o(p){var q=this.props.task.getIn(["data","credit-card"]);if(!q)return;var r=this.props.task.getIn(["data","suggestion","amount"])/100,s=q.get("number"),t=q.get("cvv"),u=q.get("month"),v=q.get("year"),w=q.get("zip"),x="https://cdn4.iconfinder.com/data/icons/simple-peyment-methods/512/mastercard-128.png";c("OzAPI").notifyExtension({action:"show",title:"Temporary Credit Card Information",desc:"Amount: $"+r+" Number: "+s+" cvv: "+t+" zip: "+w,html:"Amount: $"+r+"<br/>\n      Number: "+s+"<br/>\n      CVV: "+t+"<br/>\n      Month: "+u+"<br/>\n      Year: "+v,id:s,timeout:0,picture:x})}});function n(o){if(!o)return null;var p=o.get("amount")/100,q=o.get("name");return"User paid $"+p+" for "+q}f.exports=m}),null);
__d("OzReminderTasks.react",["cx","OzAPI","OzHelpers","immutable","OzSidebarItemHeader.react","OzStores","OzImmutablePureRenderMixin","React","ReactCSSTransitionGroup","ReactRouter","Reflux"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("OzStores").ActiveThreadStore,j=c("ReactRouter").Link,k=c("immutable").List,l=c("immutable").Map,m=c("React").PropTypes,n=c("React").createClass({displayName:"OzReminderTasks",propTypes:{isHistory:m.bool,repNames:m.instanceOf(l).isRequired,thread:m.object.isRequired},mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(i,"activeThread")],render:function q(){return c("React").createElement("div",{className:"_1x92"},c("React").createElement("h2",{className:"_1x93"},"Reminders for thread"),this._renderTasks())},_handleCreate:function q(r){c("OzAPI").createTask(c("OzHelpers").threadID(this.props.thread),r)},_handleClose:function q(r){c("OzAPI").completeTask(c("OzHelpers").threadID(this.props.thread),r)},_handleEdit:function q(r){return c("OzAPI").editTask(c("OzHelpers").threadID(this.props.thread),r)},_handleOpen:function q(r){c("OzAPI").editTask(c("OzHelpers").threadID(this.props.thread),l({id:r.get("id"),state:"dispatched"}))},_handleSnooze:function q(r){c("OzAPI").editTask(c("OzHelpers").threadID(this.props.thread),l({id:r.get("id"),deadline:c("OzHelpers").serverNow()+1e3*60*5}))},_renderTasks:function q(){var r=this.props,s=r.isHistory,t=r.repNames,u=r.thread,v=this.state.activeThread.get("activeTask"),w=c("OzHelpers").threadID(u),x=u.get("tasks",k()).filter(function(y){return y.get("type")==="reminder"&&(s?c("OzHelpers").isClosedTask(y):!c("OzHelpers").isClosedTask(y))}).toSeq().sortBy(function(y){return y.get("deadline")}).map(function(y){return c("React").createElement(o,{key:y.get("id"),task:y,isExpanded:y.get("id")===v,repNames:t})});return c("React").createElement("div",{key:w+"-"+!!s,className:"_wc7"},c("React").createElement(c("ReactCSSTransitionGroup"),{transitionName:"oz-fade-in-out",transitionEnterTimeout:300,transitionLeaveTimeout:300},x))}}),o=c("OzHelpers").pure(function(q){var r=q.task,s=q.isExpanded,t=q.repNames,u=r.getIn(["data","description"]),v=c("OzHelpers").isClosedTask(r),w=r.get("from"),x=t.get(w,w),y=r.getIn(["data","suggestion"]);return c("React").createElement(j,{className:"_qsr _wc0"+(c("OzHelpers").isUrgentTask(r)?" _wc2":"")+(c("OzHelpers").isPaidTask(r)?" _3d-l":"")+(v?" _3d-m":""),to:c("OzHelpers").threadPath({threadid:r.get("user-id"),intentid:r.get("intent-id"),taskid:r.get("id")})},c("React").createElement(c("OzSidebarItemHeader.react"),{className:"_1k8u"+(s?" _qsv":""),creator:x,isClosed:v,isExpanded:s,title:u||p(y)||"[No Title]"}))});function p(q){if(!q)return null;var r=q.get("amount")/100,s=q.get("name");return"User paid $"+r+" for "+s}f.exports=n}),null);
__d("OzReminderEditor.react",["cx","InputLabel_DEPRECATED.react","InputLabelLabel_DEPRECATED.react","OzConstants","ContextualLayerAutoFlip","ContextualLayerUpdateOnScroll","DatePickerRestraints","OzHelpers","immutable","InputLabel.react","ReactLayeredComponentMixin_DEPRECATED","LayerHideOnBlur","MessengerButtonReact.bs","OzDateTimePicker.react","React","XUIContextualDialog.react","XUIError.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("OzConstants").REMINDERS,j=c("MessengerButtonReact.bs").jsComponent,k=c("immutable").Map,l=c("immutable").Set,m=c("React").PropTypes,n=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],o=c("immutable").fromJS({traffic:{label:"Include traffic update",params:[{name:"origin",placeholder:"Origin address",err:"What is the origin address?"},{name:"destination",placeholder:"Destination address",err:"What is the destination address?"}]},weather:{label:"Include weather forecast",params:[{name:"location",placeholder:"City",err:"What city is the forecast for?"},{name:"metric",placeholder:"Celsius or Fahrenheit",err:"You need to set Celsius or Fahrenheit"}]}}),p=c("OzHelpers").pure(function(s){var t=s.action,u=s.errors,v=s.onToggle,w=s.onUpdate,x=s.reminder,y=!!x.getIn(["actions",t]);return c("React").createElement("div",null,c("React").createElement(c("InputLabel_DEPRECATED.react"),{className:"_2_xq"},c("React").createElement("input",{type:"checkbox",checked:y,onChange:function z(A){return v(A,x,t)}}),c("React").createElement(c("InputLabelLabel_DEPRECATED.react"),null,o.getIn([t,"label"]))),y&&c("React").createElement("div",null,o.getIn([t,"params"]).map(function(z){var A=z.get("name"),B=["actions",t,A];return c("React").createElement("div",{key:t+"-"+A},c("React").createElement(c("XUIError.react"),{xuiError:u.getIn([t,A])},c("React").createElement("input",{type:z.get("type","text"),className:"_2_xr",placeholder:z.get("placeholder"),value:x.getIn(B),onChange:function C(D){return w(D,B)}})))}).valueSeq()))}),q=c("OzHelpers").pure(function(s){var t=s.reminder,u=s.errors,v=s.onToggle,w=s.onUpdate;return c("React").createElement("div",null,c("React").createElement("h3",{className:"_17f0"},"Actions"),o.keySeq().map(function(x){return c("React").createElement(p,{key:x,action:x,reminder:t,errors:u,onToggle:v,onUpdate:w})}).valueSeq())}),r=c("React").createClass({displayName:"OzReminderEditor",mixins:[c("ReactLayeredComponentMixin_DEPRECATED")],propTypes:{onSave:m.func.isRequired,seedReminder:m.instanceOf(k),timezone:m.string},getInitialState:function s(){return{shown:false,reminder:this.props.seedReminder||k(),timezone:this.props.timezone,errors:k()}},componentWillReceiveProps:function s(t){if(!c("immutable").is(t.seedReminder,this.props.seedReminder))this.setState({reminder:t.seedReminder,errors:k()})},render:function s(){var t=c("React").Children.only(this.props.children);return c("React").cloneElement(t,{onClick:function(u){return this.setState({shown:!this.state.shown})}.bind(this)})},renderLayers:function s(){__p&&__p();var t=this.state,u=t.shown,v=t.reminder,w=t.errors;if(!u)return null;var x=l(v.get("days"));return{contextualDialog:c("React").createElement(c("XUIContextualDialog.react"),{autoFocus:false,behaviors:{ContextualLayerAutoFlip:c("ContextualLayerAutoFlip"),ContextualLayerUpdateOnScroll:c("ContextualLayerUpdateOnScroll"),LayerHideOnBlur:c("LayerHideOnBlur")},position:"below",shown:u,contextRef:function(){return this}.bind(this),onToggle:function(y){return this.setState({shown:y})}.bind(this)},c("React").createElement("ul",{className:"_3ssq"},c("React").createElement("div",{className:"_wbu"},c("React").createElement(c("OzDateTimePicker.react"),babelHelpers["extends"]({xuiError:w.get("scheduled-time"),className:"_wbv",showTimezoneName:false,timestamp:v.get("scheduled-time",c("OzHelpers").serverNow()),timezone:this.state.timezone,onChange:function(y){var z=y.timestamp,A=y.timezone;this.setState({reminder:v.set("scheduled-time",+z),timezone:A})}.bind(this)},c("OzHelpers").dateRestraints())),c("React").createElement(c("XUIError.react"),{xuiError:w.get("description")},c("React").createElement("input",{ref:"input",className:"_wbw",placeholder:"Describe the Reminder",value:v.getIn(["body","description"]),onChange:function(y){this.setState({reminder:v.setIn(["body","description"],y.target.value)})}.bind(this)})),c("React").createElement("h3",{className:"_17f0"},"Recurrence"),n.map(function(y,z){var A=z+1;return c("React").createElement(c("InputLabel.react"),{className:"_2_xq",key:z,label:y},c("React").createElement("input",{type:"checkbox",checked:x.has(A),onChange:function(B){var C=B.target.checked?x.add(A):x["delete"](A);this.setState({reminder:v.set("days",C.toList())})}.bind(this)}))}.bind(this)),c("React").createElement(q,{reminder:v,errors:w,onToggle:this._handleActionToggle,onUpdate:this._handleActionUpdate}),c("React").createElement("div",{className:"_wbz"},c("React").createElement(j,{label:this.props.seedReminder?"Update Reminder":"Add Reminder",onClick:this._handleSave,type:"primary"})))))}},_handleActionToggle:function s(t,u,v){var w=t.target.checked?u.set("actions",k([[v,k()]])):u["delete"]("actions");this.setState({reminder:w})},_handleActionUpdate:function s(t,u){this.setState({reminder:this.state.reminder.setIn(u,t.target.value)})},_handleSave:function s(){__p&&__p();var t=this.state.reminder,u=t.get("scheduled-time"),v=function v(y){return!!t.getIn(["actions",y])},w=k(),x=c("OzHelpers").dateRestraints().dateRestraints;if(!u)w=w.set("scheduled-time","When would you like the reminder?");else if(u<c("OzHelpers").serverNow()+60*1e3)w=w.set("scheduled-time","Reminders should be in the future!");else if(!c("DatePickerRestraints").isValidDate(new Date(u),x))w=w.set("scheduled-time","Reminder is outside of the "+i.RANGE_IN_YEARS+" year range");if(!t.getIn(["body","description"]))w=w.set("description","What is the reminder about?");w=o.reduce(function(w,y,z){if(v(z))w=y.get("params").reduce(function(w,A){return t.getIn(["actions",z,A.get("name")])?w:w.setIn([z,A.get("name")],A.get("err"))},w);return w},w);this.setState({errors:w});if(w.size)return;this.setState({reminder:k(),shown:false},function(y){return this.props.onSave(t)}.bind(this))}});f.exports=r}),null);
__d("OzReminder.react",["cx","invariant","OzAPI","OzHelpers","Event","immutable","OzIntentParamsAbstractField.react","OzIntentParamsStringField.react","OzReminderEditor.react","OzReminderNotesField.react","OzSidebarItemHeader.react","OzImmutablePureRenderMixin","React","XUICloseButton.react","formatDate"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=c("immutable").List,k=c("immutable").Map,l=c("React").PropTypes,m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=c("React").createClass({displayName:"OzReminder",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onClose:l.func.isRequired,onEdit:l.func.isRequired,onOpen:l.func.isRequired,onSnooze:l.func.isRequired,reminder:l.instanceOf(k).isRequired,repNames:l.instanceOf(k).isRequired,timezone:l.string},getInitialState:function p(){return{isExpanded:c("OzHelpers").isUrgentReminder(this.props.reminder)}},componentWillReceiveProps:function p(q){if(q.reminder.get("id")===this.props.reminder.get("id")&&c("OzHelpers").isUrgentReminder(q.reminder)&&!c("OzHelpers").isUrgentReminder(this.props.reminder))this.setState({isExpanded:true})},render:function p(){var q=this.props,r=q.onEdit,s=q.onSnooze,t=q.reminder,u=q.repNames,v=q.timezone,w=t.getIn(["body","description"]),x=c("OzHelpers").isUrgentReminder(t),y=t.getIn(["body","suggestion"]),z=t.get("state")==="closed",A=t.get("creator-fbid"),B=u.get(A,A);return c("React").createElement("div",{className:"_wc0"+(x?" _wc2":"")+(c("OzHelpers").isPaidReminder(t)?" _3d-l":"")+(z?" _3d-m":"")},c("React").createElement(c("OzSidebarItemHeader.react"),{className:"_1k8u",creator:B,isClosed:z,isExpanded:this.state.isExpanded,onIsExpandedToggle:this._handleIsExpandedToggle,onToggle:this._handleToggle,subtitle:c("OzHelpers").isSnoozedReminder(t)?"(snoozed)":null,title:w||o(y)||"[No Title]"},x?c("React").createElement("button",{className:"_1-hv _260v _260w",alt:"Snooze",onClick:function C(D){return s(t)}}):null,c("React").createElement(c("OzReminderEditor.react"),{onSave:r,seedReminder:t,timezone:v},c("React").createElement("a",{className:"_260y"},c("React").createElement("i",{className:"_5x82"})))),this._renderBody())},_renderBody:function p(){if(!this.state.isExpanded)return null;var q=this.props.reminder,r=q.get("scheduled-time"),s=q.get("last-fired"),t=q.get("state")==="closed",u=c("OzHelpers").isUrgentReminder(q),v=q.get("state")==="snoozed"&&s||r>c("OzHelpers").serverNow()&&r,w=(u||t)&&s,x=q.get("days");return c("React").createElement("div",{className:"_wc3"},c("React").createElement("div",{className:"_1k8v _3-ue"},this._renderPayment(q),w?c("React").createElement(c("OzIntentParamsAbstractField.react"),{label:"Fired On"},c("React").createElement("span",null,c("formatDate")(new Date(w),"M jS, g:ia"))):null,v?c("React").createElement(c("OzIntentParamsAbstractField.react"),{label:"Will Fire On"},c("React").createElement("span",null,c("formatDate")(new Date(v),"M jS, g:ia"))):null,x&&!x.isEmpty()?c("React").createElement(c("OzIntentParamsAbstractField.react"),{label:"Recurs"},c("React").createElement("span",null,x.size===7?"Every Day":x.sort().map(function(y){return m[y%7]}).toArray().join(" "))):null,c("React").createElement(c("OzReminderNotesField.react"),{seedNotes:q.get("notes")||q.getIn(["body","description"]),onSave:this._handleNotesSave})))},_renderPayment:function p(q){var r=q.getIn(["body","suggestion"]);if(!r)return null;var s=q.getIn(["body","credit-card"]),t=r.get("name");return c("React").createElement("div",null,c("React").createElement(c("OzIntentParamsAbstractField.react"),{label:"Link"},c("React").createElement("div",{className:"_3d-q"},c("React").createElement("a",{className:"_3d-r",target:"_blank",href:r.get("target-url"),title:r.get("description")},"Click here to view ",t),s?c("React").createElement("a",{className:"_3d-s",href:"#",title:"Show credit card information",onClick:this._handlePaymentLinkClick}):null)),c("React").createElement(c("OzIntentParamsStringField.react"),{label:"Confirmation #",onSave:this._handleItemNumberSave,placeholder:"Confirmation number",value:q.getIn(["body","item-number"])||""}))},_handleIsExpandedToggle:function p(){this.setState({isExpanded:!this.state.isExpanded})},_handleNotesSave:function p(q){this.props.onEdit(this.props.reminder.set("notes",q))},_handleItemNumberSave:function p(q){this.props.onEdit(this.props.reminder.setIn(["body","item-number"],q))},_handleToggle:function p(q){var r=this.props,s=r.onClose,t=r.onOpen,u=r.reminder;q?s(u):t(u)},_handlePaymentLinkClick:function p(q){var r=this.props.reminder.getIn(["body","credit-card"]);if(!r)return;var s=this.props.reminder.getIn(["body","suggestion","amount"])/100,t=r.get("number"),u=r.get("cvv"),v=r.get("month"),w=r.get("year"),x=r.get("zip");c("OzAPI").notifyExtension({action:"show",title:"Temporary Credit Card Information",desc:"Amount: $"+s+" Number: "+t+" cvv: "+u+" zip: "+x,html:"Amount: $"+s+"<br/>\n      Number: "+t+"<br/>\n      CVV: "+u+"<br/>\n      Month: "+v+"<br/>\n      Year: "+w,id:t,timeout:0,picture:"https://cdn4.iconfinder.com/data/icons/simple-peyment-methods/512/mastercard-128.png"})}});function o(p){if(!p)return null;var q=p.get("amount")/100,r=p.get("name");return"User paid $"+q+" for "+r}f.exports=n}),null);
__d("OzReminders.react",["cx","OzAPI","OzHelpers","immutable","OzReminder.react","OzReminderEditor.react","React","OzWrapper.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("immutable").List,l=c("immutable").Map,m=c("React").PropTypes;i=babelHelpers.inherits(n,c("React").Component);j=i&&i.prototype;function n(){__p&&__p();var o,p;"use strict";for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=j.constructor).call.apply(o,[this].concat(r)),this.$OzReminders2=function(t){c("OzAPI").createReminder(c("OzHelpers").threadID(this.props.thread),t)}.bind(this),this.$OzReminders3=function(t){c("OzAPI").closeReminder(c("OzHelpers").threadID(this.props.thread),t.get("id"),!!t.get("days")&&t.get("state")==="pending")}.bind(this),this.$OzReminders4=function(t){c("OzAPI").editReminder(c("OzHelpers").threadID(this.props.thread),t)}.bind(this),this.$OzReminders5=function(t){c("OzAPI").editReminder(c("OzHelpers").threadID(this.props.thread),t.set("state","pending"))}.bind(this),this.$OzReminders6=function(t){c("OzAPI").snoozeReminder(c("OzHelpers").threadID(this.props.thread),t.get("id"))}.bind(this),this.$OzReminders1=function(){var t=this.props,u=t.isHistory,v=t.repNames,w=t.thread,x=c("OzHelpers").threadID(w),y=w.get("reminders",k()).sortBy(function(z){return z.get("last-fired")||z.get("scheduled-time")}).toSeq().filter(function(z){return u?z.get("state")==="closed":z.get("state")!=="closed"}).map(function(z){return c("React").createElement(c("OzReminder.react"),{key:z.get("id"),onClose:this.$OzReminders3,onEdit:this.$OzReminders4,onOpen:this.$OzReminders5,onSnooze:this.$OzReminders6,reminder:z,repNames:v,timezone:c("OzHelpers").timezone(w)})}.bind(this));return c("React").createElement("div",{key:x+"-"+!!u,className:"_wc7"},y)}.bind(this),p}n.prototype.render=function(){"use strict";return c("React").createElement("div",{className:"_1x92"},c("React").createElement("h2",{className:"_1x93"},"Reminders"),this.$OzReminders1(),!this.props.isHistory?c("React").createElement(c("OzReminderEditor.react"),{onSave:this.$OzReminders2,timezone:c("OzHelpers").timezone(this.props.thread)},c("React").createElement("a",{className:"_59jg"},c("React").createElement("div",{className:"_4nd4"}),c("React").createElement("span",{className:"_59jh"},"Add a reminder..."))):null)};n.propTypes={isHistory:m.bool,repNames:m.instanceOf(l).isRequired,thread:m.object.isRequired};f.exports=c("OzWrapper.react")(n)}),null);
__d("OzTaskComposers.react",["cx","OzHelpers","OzAPI","CajaHTMLSanitizer","CIWebmailValidator","DraftEditor.react","EditorState","ContentState","FileInput.react","immutable","OzNotify","OzActions","OzDateTimePicker.react","OzDraggableModal.react","OzPlaceField.react","promiseFinally","OzImmutablePureRenderMixin","React","Reflux","XUICloseButton.react","XUIError.react"],(function aa(ba,a,ca,da,b,ea,fa){__p&&__p();var c,d,e,f,g=a("CIWebmailValidator").isValidEmail,h=a("immutable").Map,i=a("immutable").List,j=a("immutable").Record,k=a("React").PropTypes,l={intentId:null,id:null,type:null,errors:h(),disabled:false,sending:false},m=["to"],n=["from"],o=["cc"],p=["bcc"],q=["body",0,"body","contents"],r=a("immutable").fromJS([{"content-type":"text/plain; charset=UTF-8",body:{contents:""}}]),s=a("immutable").fromJS({to:"",cc:"",bcc:"",from:"",subject:"",body:r}),t=j(babelHelpers["extends"]({},l,{email:s,uploadSem:0})),u=a("Reflux").createStore({init:function H(){this._offlineId=0;this.data=h();this.listenToMany(a("OzActions").emailComposer)},getInitialState:function H(){return this.data},onUpdate:function H(I){this._u(function(J){return J.set(I.get("id"),I)})},onDelete:function H(I){this._u(function(J){return J["delete"](I)})},onAdd:function H(){var I=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],J=new t(I).update("id",function(K){return K||this._offlineId++}.bind(this)).updateIn(["email","from"],function(K){return I.from||(i.isList(K)?K.first():K)}).update("email",ma);this._u(function(K){return K.set(J.get("id"),J)})},_u:function H(I){this.data=I(this.data);this.trigger(this.data)}}),v=a("React").createClass({displayName:"EmailContainer",mixins:[a("OzImmutablePureRenderMixin")],propTypes:{emailState:k.instanceOf(t).isRequired},render:function H(){var I=this.props.emailState;return a("React").createElement(w,{email:I.get("email"),errors:I.get("errors"),disabled:I.get("disabled"),sending:I.get("sending"),onClose:this._handleClose,onChange:this._handleChange,onSend:this._handleSend,onUpload:this._handleUpload,onAttOpen:this._handleAttOpen})},_handleClose:function H(){a("OzActions").emailComposer["delete"](this.props.emailState.get("id"))},_handleChange:function H(I){a("OzActions").emailComposer.update(this.props.emailState.set("email",I))},_handleSend:function H(){__p&&__p();var I=this.props.emailState,J=I.get("email"),K=[[J.getIn(m),"Please specify a destination email address"],[J.get("subject"),"Please write a subject"],[J.getIn(q),"Please write a message"],[I.get("uploadSem")===0,"Your attachments are still uploading"]].find(function(N){var O=N[0],P=N[1];return!O});if(K){a("OzNotify").error(K[1]);return}var L=na(J).set("intent-id",I.get("intentId")),M=h({to:m,cc:o,bcc:p}).map(function(N){return B(L.getIn(N))}).filter(function(N){return N});if(!M.isEmpty()){a("OzActions").emailComposer.update(I.set("errors",M));return}a("OzActions").emailComposer.update(I.set("sending",true));a("OzAPI").sendEmail(L,I.get("intentId")).then(function(N){a("OzActions").emailComposer["delete"](I.get("id"))})["catch"](function(N){a("OzActions").emailComposer.update(I.set("sending",false))})},_handleAttOpen:function H(I){var J=I.getIn(["body","everstore-handle"]);a("OzAPI").everstoreURI(J).done(function(K){return window.open(K)})},_handleUpload:function H(I){__p&&__p();var J=function(L){return a("OzActions").emailComposer.update(this.props.emailState.update("uploadSem",function(J){return J+L}))}.bind(this);J(1);var K=a("OzAPI").everstoreUpload(h({blob:I})).then(function(L){return la(L,I)}).then(function(L){a("OzActions").emailComposer.update(this.props.emailState.updateIn(["email","body"],function(M){return M.push(L)}))}.bind(this));a("promiseFinally")(K,function(L){return J(-1)})}});c=babelHelpers.inherits(w,a("React").Component);d=c&&c.prototype;function w(H){"use strict";d.constructor.call(this,H);var I=function I(J){return a("EditorState").createWithContent(a("ContentState").createFromText(H.email.getIn(J)||""))};this.state={showCC:false,showBCC:false,inputEditorStates:{from:I(n),to:I(m),cc:I(o),bcc:I(p),subject:I(["subject"])}}}w.prototype.componentDidMount=function(){"use strict";var H=["to","subject"].find(function(I){var J=this.state.inputEditorStates[I];return J&&!J.getCurrentContent().getPlainText().length}.bind(this)),I=this.refs[H||"body"];I&&I.focus()};w.prototype.render=function(){"use strict";__p&&__p();var H=this.props,I=H.email,J=H.errors,K=H.onClose,L=H.onUpload,M=H.onAttOpen,N=H.onChange,O=H.onSend,P=H.disabled,Q=H.sending,R=this.state.showCC||P&&I.getIn(o),S=this.state.showBCC||P&&I.getIn(p),T=function(W,X,Y){return a("React").createElement(y,{error:J.get(X),editorState:this.state.inputEditorStates[X],disabled:P||Q,placeholder:W,ref:X,onChange:function(Z){var $;this.setState({inputEditorStates:babelHelpers["extends"]({},this.state.inputEditorStates,($={},$[X]=Z,$))});var sa=Z.getCurrentContent().getPlainText();N(I.setIn(Y,sa))}.bind(this)})}.bind(this),U=A(I,"text/plain");if(U==-1)U=0;var V=["body",U,"body","contents"];return a("React").createElement(a("OzDraggableModal.react"),{className:"_4h1d",getHandle:function(W){return this.refs.header}.bind(this)},a("React").createElement("div",null,a("React").createElement("div",{className:"_4h1e",ref:"header"},a("React").createElement(a("XUICloseButton.react"),{onClick:K})),a("React").createElement(y,{editorState:this.state.inputEditorStates.from,disabled:true,onChange:function W(X){return null}}),a("React").createElement("div",{className:"_1jg2"},T("To","to",m),!R&&!(P||Q)?a("React").createElement("button",{tabIndex:"-1",className:"_1jg3",onClick:function(W){return this.setState({showCC:true})}.bind(this)},"CC"):null,!S&&!(P||Q)?a("React").createElement("button",{tabIndex:"-1",className:"_1jg3",onClick:function(W){return this.setState({showBCC:true})}.bind(this)},"BCC"):null),R?T("Cc","cc",o):null,S?T("Bcc","bcc",p):null,T("Subject","subject",["subject"]),P?a("React").createElement(x,{email:I}):a("React").createElement("textarea",{disabled:P||Q,placeholder:"Write your masterpiece",ref:"body",className:"_1-i0 _4h1j",value:I.getIn(V),onChange:function W(X){return N(I.setIn(V,X.target.value))}}),a("React").createElement(ga,{email:I,onChange:N,onAttOpen:M}),P?null:a("React").createElement("div",{className:"_5l1v"},a("React").createElement("button",{onClick:O,disabled:Q,className:"_1-hv _30yy _n8p"},Q?"Sending...":"Send"),a("React").createElement(a("FileInput.react"),{ref:"fileInput",onChange:function(W){L(W.target.files[0]);this.refs.fileInput.getFileInput().clear()}.bind(this)},a("React").createElement("a",{title:"add images",className:"_5l1w _30yy"})))))};w.propTypes={onClose:k.func.isRequired,onSend:k.func,disabled:k.bool,sending:k.bool,email:k.instanceOf(h).isRequired,errors:k.instanceOf(h),onChange:k.func.isRequired,onUpload:k.func.isRequired,onAttOpen:k.func.isRequired};var x=a("OzHelpers").pure(function(H){var I=H.email,J=ia(I,"text/html","text/plain"),K=J.getIn(["body","contents"]);return a("React").createElement("div",{className:"_3x40"},ka(J)?a("React").createElement("div",{style:{whiteSpace:"pre-wrap"}},K):a("React").createElement(z,{html:K}))}),y=a("React").createClass({displayName:"EmailInput",propTypes:{disabled:k.bool,editorState:k.instanceOf(a("EditorState")).isRequired,error:k.string,onChange:k.func,placeholder:k.string},defaultProps:{disabled:false,error:null,onChange:function H(){},placeholder:null},focus:function H(){this.refs.editor.focus()},render:function H(){return a("React").createElement(a("XUIError.react"),{xuiError:this.props.error,xuiErrorPosition:"left"},a("React").createElement("div",{className:"_1-i0 _4h1i",onClick:this.focus,role:"presentation"},a("React").createElement(a("DraftEditor.react"),{editorState:this.props.editorState,ref:"editor",onChange:this.props.onChange,placeholder:this.props.placeholder,readOnly:this.props.disabled})))}}),z=a("OzHelpers").pure(function(H){var I=H.html,J=babelHelpers.objectWithoutProperties(H,["html"]);return a("React").createElement("div",babelHelpers["extends"]({},J,{dangerouslySetInnerHTML:{__html:a("CajaHTMLSanitizer").sanitize(I,function(K){return K})}}))}),ga=a("OzHelpers").pure(function(H){var I=H.email,J=H.onAttOpen,K=H.onChange,L=I.get("body").map(function(M,N){return ja(M)?null:a("React").createElement(ha,{key:N,part:M,onClick:function O(P){return J(M)},onRemove:function O(P){return K(I.update("body",function(Q){return Q["delete"](N)}))}})}).filter(function(M){return!!M});return L.isEmpty()?null:a("React").createElement("div",{className:"_5l1-"},L)}),ha=a("OzHelpers").pure(function(H){var I=H.part,J=H.onClick,K=H.onRemove;return a("React").createElement("div",{className:"_5l26"},a("React").createElement("button",{className:"_1-hv",onClick:J},I.getIn(["body","filename"])),a("React").createElement(a("XUICloseButton.react"),{onClick:K}))});function ia(H){for(var I=arguments.length,J=Array(I>1?I-1:0),K=1;K<I;K++)J[K-1]=arguments[K];var L=J.map(function(M){return A(H,M)}).find(function(L){return L>-1});return Number.isSafeInteger(L)?H.getIn(["body",L]):r.first()}function A(H,I){return H.get("body").findIndex(function(J){return J.get("content-type").indexOf(I)>-1})}function ja(H){var I=H.get("content-type");return I&&I.indexOf("text/plain")>-1||I.indexOf("text/html")>-1}function ka(H){return H.get("content-type").indexOf("text/plain")>-1}function B(H){H=i(H);var I=H.filterNot(g);return I.isEmpty()?null:"Invalid email address(es): "+I.join(", ")+"."}function la(H,I){return a("immutable").fromJS({"content-type":I.type,body:{"everstore-handle":H,filename:I.name}})}function ma(H){return H.updateIn(m,C).updateIn(o,C).updateIn(p,C)}function na(H){return H.updateIn(m,D).updateIn(o,D).updateIn(p,D)}function C(H){return H&&H.join(", ")}function D(H){return H?H.split(/[, ]/).filter(function(I){return I.length}):[]}var E=a("immutable").fromJS({title:"",description:"",start:null,startTimezone:"",end:null,endTimezone:"",location:"",to:""}),F=j(babelHelpers["extends"]({},l,{invite:E})),oa=a("Reflux").createStore({init:function H(){this._offlineId=0;this.data=h();this.listenToMany(a("OzActions").inviteComposer)},getInitialState:function H(){return this.data},onUpdate:function H(I){this._u(function(J){return J.set(I.get("id"),I)})},onDelete:function H(I){this._u(function(J){return J["delete"](I)})},onAdd:function H(){var I=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],J=new F(I).update("id",function(K){return K||this._offlineId++}.bind(this)).updateIn(["invite","to"],C);this._u(function(K){return K.set(J.get("id"),J)})},onCreate:function H(I,J,K){var L=new F({intentId:I,invite:qa(J,K),id:this._offlineId++});this._u(function(M){return M.set(L.get("id"),L)})},_u:function H(I){this.data=I(this.data);this.trigger(this.data)}}),pa=a("React").createClass({displayName:"InviteContainer",mixins:[a("OzImmutablePureRenderMixin")],propTypes:{inviteState:k.instanceOf(F).isRequired},render:function H(){var I=this.props.inviteState;return a("React").createElement(G,{disabled:I.get("disabled"),sending:I.get("sending"),initialTimezone:I.get("timezone"),invite:I.get("invite"),errors:I.get("errors"),onChange:this._handleChange,onClose:this._handleClose,onSend:this._handleSend})},_handleChange:function H(I){a("OzActions").inviteComposer.update(this.props.inviteState.set("invite",I))},_handleClose:function H(){a("OzActions").inviteComposer["delete"](this.props.inviteState.get("id"))},_handleSend:function H(){__p&&__p();var I=this.props.inviteState,J=I.get("invite"),K=J.get("selectedPlace"),L=[[J.get("to")||K,"Please click on a location in the dropdown or enter an email address"],[J.get("title"),"Please choose a title"],[J.get("start"),"Please select a start time"],[J.get("end"),"Please select an end time"],[J.get("end")>=J.get("start"),"Event must start before it ends"]].find(function(O){var P=O[0],Q=O[1];return!P});if(L){a("OzNotify").error(L[1]);return}var M=K?J["delete"]("selectedPlace").set("intent-id",I.get("intentId"))["delete"]("to")["delete"]("description").set("place-id",K.get("id")):J["delete"]("selectedPlace").set("intent-id",I.get("intentId")).update("to",D),N=h({to:"to"}).map(function(O){return B(M.get(O))}).filter(function(O){return O});if(!N.isEmpty()){a("OzActions").inviteComposer.update(I.set("errors",N));return}a("OzActions").inviteComposer.update(I.set("sending",true));a("OzAPI").sendInvite(M,I.get("intentId")).then(function(O){a("OzActions").inviteComposer["delete"](I.get("id"))})["catch"](function(O){a("OzActions").inviteComposer.update(I.set("sending",false))})}});e=babelHelpers.inherits(G,a("React").Component);f=e&&e.prototype;G.prototype.componentDidMount=function(){"use strict";var H=["title","description","location","to"].map(function(I){return this.refs[I]}.bind(this)).find(function(H){return H&&!H.value});H&&H.focus()};G.prototype.render=function(){"use strict";__p&&__p();var H=this.props,I=H.disabled,J=H.sending,K=H.invite,L=H.errors,M=H.onClose,N=H.onChange,O=H.onSend,P=function P(T,U){return a("React").createElement(a("XUIError.react"),{xuiError:L.get(U),xuiErrorPosition:"left"},a("React").createElement("input",{type:"text",className:"_1-i0 _4h1i",disabled:I||J,placeholder:T,ref:U,value:K.get(U),onChange:function V(W){return N(K.set(U,W.target.value))}}))},Q=function Q(T,U){return a("React").createElement("div",null,T+":",a("React").createElement(a("OzDateTimePicker.react"),babelHelpers["extends"]({className:"_pto",layout:"two-line",timestamp:K.get(U)||a("OzHelpers").serverNow(),timezone:K.get(U+"Timezone"),disabled:I||J,onChange:function V(W){var X=W.timestamp,Y=W.timezone;return N(K.set(U,+X).set(U+"Timezone",Y))}},a("OzHelpers").dateRestraints())))},R=function R(T,U,V){return a("React").createElement(a("OzPlaceField.react"),{className:"_1-i0 _n8q",disabled:I||J,onQueryStringChange:function W(X){N(K["delete"](V).set(U,X))},onSelect:function W(X){N(K.set(V,X).set(U,X.get("name")))},placeholder:T,queryString:K.get(U),selectedEntry:K.get(V),xuiError:L.get(U)||L.get(V)})},S=!!K.get("selectedPlace")||!!K.get("place-id");return a("React").createElement(a("OzDraggableModal.react"),{className:"_ptp"},a("React").createElement("div",{className:"_ptq"},"Calendar Invite",a("React").createElement(a("XUICloseButton.react"),{onClick:M})),P("Title","title"),S||P("Description","description"),R("Location...","location","selectedPlace"),S||P("Email to...","to"),Q("Start Time","start"),Q("End Time","end"),I?null:a("React").createElement("div",{className:"_5l1v"},a("React").createElement("button",{onClick:O,disabled:J,className:"_1-hv _30yy _n8p"},J?"Sending...":S?"Send Bubble":"Send Email")))};function G(){"use strict";e.apply(this,arguments)}G.propTypes={invite:k.instanceOf(h).isRequired,errors:k.instanceOf(h),onClose:k.func.isRequired,onChange:k.func.isRequired,onSend:k.func.isRequired,disabled:k.bool,sending:k.bool};function qa(){var H=arguments.length<=0||arguments[0]===undefined?"":arguments[0],I=arguments.length<=1||arguments[1]===undefined?"":arguments[1];return E.set("start",a("OzHelpers").serverNow()).set("startTimezone",I).set("end",a("OzHelpers").serverNow()).set("endTimezone",I).set("to",H)}var ra=a("React").createClass({displayName:"OzTaskComposers",mixins:[a("OzImmutablePureRenderMixin"),a("Reflux").connect(u,"emails"),a("Reflux").connect(oa,"invites")],propTypes:{intent:k.instanceOf(h).isRequired},render:function H(){var I=function(L){return L.get("intentId")==this.props.intent.get("id")}.bind(this),J=this.state.emails.filter(I),K=this.state.invites.filter(I);return a("React").createElement("span",null,J.map(function(L){return a("React").createElement(v,{key:L.get("id"),emailState:L})}).valueSeq(),K.map(function(L){return a("React").createElement(pa,{key:L.get("id"),inviteState:L})}).valueSeq())}});b.exports=ra}),null);
__d("OzTaskActionEditor.react",["cx","OzHelpers","immutable","InputLabel_DEPRECATED.react","InputLabelLabel_DEPRECATED.react","MessengerButtonReact.bs","OzImmutablePureRenderMixin","React","XUIError.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("MessengerButtonReact.bs").jsComponent,j=c("immutable").Map,k=c("React").PropTypes,l=c("immutable").fromJS({traffic:{label:"Include traffic update",params:[{name:"origin",placeholder:"Origin address",err:"What is the origin address?"},{name:"destination",placeholder:"Destination address",err:"What is the destination address?"}]},weather:{label:"Include weather forecast",params:[{name:"location",placeholder:"City",err:"What city is the forecast for?"},{name:"metric",placeholder:"Celsius or Fahrenheit",err:"You need to set Celsius or Fahrenheit"}]}}),m=c("OzHelpers").pure(function(o){var p=o.action,q=o.errors,r=o.onToggle,s=o.onUpdate,t=o.actions,u=!!t.get(p);return c("React").createElement("div",null,c("React").createElement(c("InputLabel_DEPRECATED.react"),null,c("React").createElement("input",{type:"checkbox",checked:u,onChange:function v(w){return r(w,p)}}),c("React").createElement(c("InputLabelLabel_DEPRECATED.react"),null,l.getIn([p,"label"]))),u&&c("React").createElement("div",null,l.getIn([p,"params"]).map(function(v){var w=v.get("name"),x=[p,w],y=t.getIn(x);return c("React").createElement(c("XUIError.react"),{key:p+"-"+w,xuiError:q.getIn([p,w])},c("React").createElement("input",{type:v.get("type","text"),className:"_wbw",placeholder:v.get("placeholder"),value:y,onChange:function z(A){return s(A,x)}}))}).valueSeq()))}),n=c("React").createClass({displayName:"OzTaskActionEditor",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{task:k.instanceOf(j).isRequired,onSelectAction:k.func.isRequired},getInitialState:function o(){return{errors:j(),actions:this.props.task.getIn(["data","actions"],j())}},render:function o(){return c("React").createElement("div",{className:"_3zsp"},l.keySeq().map(function(p){return c("React").createElement(m,{key:p,action:p,actions:this.state.actions,errors:this.state.errors,onToggle:this._handleActionToggle,onUpdate:this._handleActionUpdate})}.bind(this)).valueSeq(),c("React").createElement(i,{onClick:this._handleSaveActions,label:"Set Actions",type:"primary"}))},_handleActionToggle:function o(p,q){var r=p.target.checked?j([[q,j()]]):j();this.setState({actions:r})},_handleActionUpdate:function o(p,q){this.setState({actions:this.state.actions.setIn(q,p.target.value)})},_handleSaveActions:function o(){var p=this.props.onSelectAction,q=this.state.actions,r=this._findErrors();if(r.count())this.setState({errors:r});else p(q)},_findErrors:function o(){var p=this.state.actions,q=function q(r){return!!p.get(r)};return l.reduce(function(r,s,t){if(q(t))r=s.get("params").reduce(function(r,u){return p.getIn([t,u.get("name")])?r:r.setIn([t,u.get("name")],u.get("err"))},r);return r},j())}});f.exports=n}),null);
__d("OzTaskShow.react",["cx","debounce","getActiveElement","OzHelpers","immutable","InputLabel.react","Keys","LayerHideOnBlur","MessengerButtonReact.bs","OzNotify","OzActions","OzConfirmDialog.react","OzDate.react","OzDateTimePicker.react","OzTaskActionEditor.react","OzImmutablePureRenderMixin","React","ShimButton.react","XUIContextualDialog.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("MessengerButtonReact.bs").jsComponent,j=c("immutable").Map,k=c("immutable").List,l=c("immutable").Set,m=c("React").PropTypes,n=1e3,o=c("React").createClass({displayName:"OzTaskShow",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{location:m.instanceOf(j).isRequired,onCancel:m.func.isRequired,onComplete:m.func.isRequired,onOpen:m.func.isRequired,onSave:m.func.isRequired,task:m.instanceOf(j).isRequired},render:function x(){var y=this.props,z=y.task,A=y.location,B=y.onCancel,C=y.onComplete,D=y.onOpen;return c("React").createElement("div",{className:"_1h7p"},c("React").createElement("div",{className:"_1h7q"}),c("React").createElement(p,{task:z,onChangeDescription:this._handleChangeDescription}),c("React").createElement(w,{task:z,onChangeNotes:this._handleChangeNotes}),c("React").createElement(r,{task:z,location:A,onSelectDeadline:this._handleSelectDeadline}),c("React").createElement(s,{task:z,onChangeDuration:this._handleChangeDuration}),c("React").createElement(v,{task:z,onChangeActions:this._handleChangeActions}),c("React").createElement(u,{task:z,onChangeRecur:this._handleChangeRecur}),c("React").createElement(q,{task:z,onCancelTask:B,onOpenTask:D,onCompleteTask:C}))},_handleChangeDescription:function x(y){var z=this.props,A=z.onSave,B=z.task;A(B.setIn(["data","description"],y))},_handleSelectDeadline:function x(y){var z=this.props,A=z.onSave,B=z.task,C=y-B.get("deadline");A(B.set("deadline",y).update("start-at",function(D){return D+C}))},_handleChangeDuration:function x(y){var z=this.props,A=z.onSave,B=z.task;if(y<0)c("OzNotify").warn("Duration must be greater than 0");else A(B.set("start-at",B.get("deadline")-y*6e4))},_handleChangeRecur:function x(y){var z=this.props,A=z.onSave,B=z.task,C=z.location;A(B.set("schedule",j({"start-at":B.get("start-at"),frequency:"weekly",timezone:C.get("timezone"),"timezone-offset":C.get("timezone-offset"),"repeat-condition":j({spacing:1,days:y.toList()})})))},_handleChangeActions:function x(y){var z=this.props,A=z.onSave,B=z.task;A(B.setIn(["data","actions"],y))},_handleChangeNotes:function x(y){var z=this.props,A=z.onSave,B=z.task;A(B.setIn(["data","notes"],y))}}),p=c("React").createClass({displayName:"OzTaskShowDescription",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onChangeDescription:m.func.isRequired,task:m.instanceOf(j).isRequired},componentDidMount:function x(){if(!this.props.task.getIn(["data","description"]))this.setState({editing:true})},getInitialState:function x(){return{editing:false}},render:function x(){var y=this.props.task,z=(y.get("state")==="completed"?"[Closed] ":"")+(y.getIn(["data","description"],"").length?y.getIn(["data","description"]):"untitled task");return c("React").createElement("div",{className:"_1h7v _p44"},this.state.editing?c("React").createElement("textarea",{className:"_1h7r _1h7s",placeholder:"untitled task",defaultValue:y.getIn(["data","description"]),onBlur:function(A){return this.setState({editing:false})}.bind(this),onKeyDown:this._handleKeydown,ref:function A(B){if(B){B.focus();c("OzHelpers").moveCursorToInputEnd(B)}}}):c("React").createElement(c("ShimButton.react"),{className:"_1h7r",inline:true,onClick:function(A){return this.setState({editing:true})}.bind(this)},z))},_handleKeydown:function x(y){var z=this.props.onChangeDescription;switch(y.which){case c("Keys").RETURN:case c("Keys").TAB:z(y.target.value);case c("Keys").ESC:this.setState({editing:false})}}}),q=c("React").createClass({displayName:"OzTaskShowStateSelector",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onCancelTask:m.func.isRequired,onCompleteTask:m.func.isRequired,onOpenTask:m.func.isRequired,task:m.instanceOf(j).isRequired},_maybeConfirmCancel:function x(){var y=this.props,z=y.task,A=y.onCancelTask;if(z.has("schedule"))c("OzActions").showDialog(c("OzConfirmDialog.react"),{onConfirm:function B(C){return A(z,true)},onCancel:function B(C){return A(z,false)},body:"This is a recurring task. Do you want to delete just this instance or all future occurrences also?",header:"Delete Recurring Task",confirmLabel:"Delete Future Tasks",cancelLabel:"Only This One"});else A(z,false)},render:function x(){var y=this.props,z=y.onCancelTask,A=y.onCompleteTask,B=y.onOpenTask,C=y.task;return c("React").createElement("div",{className:"_1h7t"},c("React").createElement(c("ShimButton.react"),{className:"_47xm",onClick:this._maybeConfirmCancel},"Delete"),C.get("state")==="completed"?c("React").createElement(c("ShimButton.react"),{className:"_47yc",onClick:function D(E){return B(C)}},"Reopen task"):c("React").createElement(c("ShimButton.react"),{className:"_47yd",onClick:function D(E){return A(C)}},"Mark complete"))}}),r=c("React").createClass({displayName:"OzTaskShowDeadlineSelector",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onSelectDeadline:m.func.isRequired,location:m.instanceOf(j).isRequired,task:m.instanceOf(j).isRequired},getInitialState:function x(){return{editing:false}},render:function x(){var y=this.props,z=y.task,A=y.location;return c("React").createElement("div",{className:"_1h7v"},c("React").createElement("div",{className:"_1h7w"},"Due"),c("React").createElement("div",{className:"_1h7y"},this.state.editing?c("React").createElement("div",{className:"_1h7z"},c("React").createElement(c("OzDateTimePicker.react"),{className:"_1xh-",layout:"three-line",showTimezoneName:false,timestamp:this.state.timestamp||Date.now(),timezone:this.state.timezone||A.get("timezone"),onChange:function(B){return this.setState(B)}.bind(this)}),c("React").createElement("div",{className:"_1xh_"},c("React").createElement(c("ShimButton.react"),{className:"_1h7-",onClick:this._handleSelectDeadline},"\u2713"),c("React").createElement(c("ShimButton.react"),{className:"_1h7_",onClick:this._handleCancel},"\u2715"))):c("React").createElement(c("ShimButton.react"),{className:"_1h80",onClick:this._handleStartEditing},c("React").createElement(c("OzDate.react"),{timestamp:z.get("deadline")}))))},_handleSelectDeadline:function x(){this.props.onSelectDeadline(this.state.timestamp);this.setState({editing:false})},_handleStartEditing:function x(){this.setState({editing:true,timestamp:this.props.task.get("deadline")})},_handleCancel:function x(){this.setState({editing:false})}}),s=c("React").createClass({displayName:"OzTaskShowDuration",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onChangeDuration:m.func.isRequired,task:m.instanceOf(j).isRequired},getInitialState:function x(){return{editing:false}},render:function x(){return c("React").createElement("div",{className:"_1h7v"},c("React").createElement("div",{className:"_1h7w"},"Duration (min)"),c("React").createElement("div",{className:"_1h7y"},this.state.editing?c("React").createElement("textarea",{className:"_1h81 _1h7s",defaultValue:this._getDuration(),onBlur:function(y){return this.setState({editing:false})}.bind(this),onKeyDown:this._handleKeydown,ref:function y(z){if(z){z.focus();c("OzHelpers").moveCursorToInputEnd(z)}}}):c("React").createElement(c("ShimButton.react"),{className:"_1h81",inline:true,onClick:function(y){return this.setState({editing:true})}.bind(this)},this._getDuration())))},_getDuration:function x(){var y=this.props.task;return Math.round((y.get("deadline")-y.get("start-at"))/6e4)},_handleKeydown:function x(y){var z=this.props.onChangeDuration;if(y.which===c("Keys").RETURN){z(y.target.value);this.setState({editing:false})}}}),t=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],u=c("React").createClass({displayName:"OzTaskShowRecurSelector",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onChangeRecur:m.func.isRequired,task:m.instanceOf(j).isRequired},getInitialState:function x(){return{editing:false,daysSet:l()}},componentWillMount:function x(){var y=this.props.task;this.setState({daysSet:l(y.getIn(["schedule","repeat-condition","days"]))})},render:function x(){__p&&__p();var y=this.props.task,z=this.state,A=z.editing,B=z.daysSet,C=y.getIn(["schedule","repeat-condition","days"],k()).map(function(D){return t[D-1]}).join(", ");return c("React").createElement("div",{className:"_1h7v"},c("React").createElement("div",{className:"_1h7w"},"Recurrence"),c("React").createElement("div",{className:"_1h7y"},c("React").createElement("span",{onClick:function(D){return this.setState({editing:true})}.bind(this),ref:"setSpan",role:"button",tabIndex:"0"},C.length?C:"Set Recurrence..."),c("React").createElement(c("XUIContextualDialog.react"),{position:"above",contextRef:function(D){return this.refs.setSpan}.bind(this),className:"_3zsp",shown:A,onToggle:function(D){return this.setState({editing:D})}.bind(this),behaviors:{LayerHideOnBlur:c("LayerHideOnBlur")}},c("React").createElement("div",{className:"_3zsp"},t.map(function(D,E){var F=E+1;return c("React").createElement(c("InputLabel.react"),{key:E,label:D},c("React").createElement("input",{type:"checkbox",checked:B.has(F),onChange:function(G){var H=G.target.checked?B.add(F):B["delete"](F);this.setState({daysSet:H})}.bind(this)}))}.bind(this)),c("React").createElement(i,{onClick:this._handleChangeRecur,label:"Set Recurrence",type:"primary"})))))},_handleChangeRecur:function x(){this.props.onChangeRecur(this.state.daysSet);this.setState({editing:false})}}),v=c("React").createClass({displayName:"OzTaskShowActionSelector",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onChangeActions:m.func.isRequired,task:m.instanceOf(j).isRequired},getInitialState:function x(){return{editing:false}},render:function x(){var y=this.props.task,z=this.state.editing,A=y.getIn(["data","actions"],j()).keySeq().join(", ");return c("React").createElement("div",{className:"_1h7v"},c("React").createElement("div",{className:"_1h7w"},"Actions"),c("React").createElement("div",{className:"_1h7y"},c("React").createElement("span",{onClick:function(B){return this.setState({editing:true})}.bind(this),ref:"setSpan",role:"button",tabIndex:"0"},A.length?A:"Set Actions..."),c("React").createElement(c("XUIContextualDialog.react"),{position:"above",contextRef:function(B){return this.refs.setSpan}.bind(this),className:"_3zsp",shown:z,onToggle:function(B){return this.setState({editing:B})}.bind(this),behaviors:{LayerHideOnBlur:c("LayerHideOnBlur")}},c("React").createElement(c("OzTaskActionEditor.react"),{task:y,onSelectAction:this._handleSelectAction}))))},_handleSelectAction:function x(y){this.props.onChangeActions(y);this.setState({editing:false})}}),w=c("React").createClass({displayName:"OzTaskShowNotes",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onChangeNotes:m.func.isRequired,task:m.instanceOf(j).isRequired},getInitialState:function x(){return{editedText:this.props.task.getIn(["data","notes"],"")}},componentWillReceiveProps:function x(y){var z=y.task.get(["data","notes"]),A=c("getActiveElement")()===this.refs.textarea;if(z!==this.props.task.get(["data","notes"])&&!A)this.setState({editedText:z})},componentWillMount:function x(){this._save=c("debounce")(this._save,n,this,true)},render:function x(){return c("React").createElement("div",{className:"_1h7v"},c("React").createElement("textarea",{className:"_1h83 _1h7s",placeholder:"Add a note...",ref:"textarea",value:this.state.editedText,onChange:this._handleChange}))},_handleChange:function x(){var y=this.refs.textarea.value;this.setState({editedText:y},this._save)},_save:function x(){this.props.onChangeNotes(this.state.editedText)}});f.exports=o}),null);
__d("OzCalendarEvent.react",["cx","Image.react","LineClamp.react","React","Tooltip","formatDate","joinClasses"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("React").PropTypes,l="_2erb",m=6e4;i=babelHelpers.inherits(n,c("React").Component);j=i&&i.prototype;function n(){__p&&__p();var o,p;"use strict";for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=j.constructor).call.apply(o,[this].concat(r)),this.state={mouseDown:false},this.$OzCalendarEvent2=function(){this.setState({mouseDown:true})}.bind(this),this.$OzCalendarEvent3=function(){this.setState({mouseDown:false})}.bind(this),this.$OzCalendarEvent5=function(){if(!this.props.animation)return null;return c("React").createElement("div",{className:"_2ere",style:this.$OzCalendarEvent1(this.props.shade,this.props.tentative)})}.bind(this),p}n.prototype.$OzCalendarEvent1=function(o,p){"use strict";return{backgroundColor:"rgb(1, 136, 245)",backgroundImage:"repeating-linear-gradient(-45deg,rgba(70, 130, 200, 0.8),rgba(70, 130, 200, 0.8) 10px,rgba(70, 130, 200, 0.5) 10px,rgba(70, 130, 200, 0.5) 20px)"}};n.prototype.$OzCalendarEvent4=function(){"use strict";var o=this.props;return function(p){if(this.state.mouseDown){if(this.props.onInitiateDrag&&this.props.draggable)this.props.onInitiateDrag(o,p);this.setState({mouseDown:false})}}.bind(this)};n.prototype.render=function(){"use strict";__p&&__p();var o=Math.floor((this.props.height-12)/14)-1,p=Math.max(0,this.props.endTime-this.props.startTime),q=Math.round(p/m),r=q<15,s=q===15,t="_2erb"+(this.props.selected?" _2erf":"")+(this.props.tentative?" _2erg":"")+(s?" _2erh":"")+(r?" _2erk":""),u=[];if(this.props.icons)for(var v=0;v<this.props.icons.length;v++){var w=this.props.icons[v],x=w[0],y=w[1],z=c("React").createElement(c("Image.react"),{className:"_2erl",src:x,key:v,"aria-label":y,"data-hover":"tooltip","data-tooltip-content":y});u.push(z)}var A=c("React").createElement("div",null,u),B=null,C=null;if(this.props.showTime){var D=null,E=null;if(!this.props.isAllDayEvent){D=c("formatDate")(new Date(this.props.startTime),"g:ia");E="-"+c("formatDate")(new Date(this.props.endTime),"g:ia")}else D="All day";C=D+(E||"");B=c("React").createElement("span",{className:"_2erm"},D)}var F=(C||"")+"\n"+String(this.props.title)+"\n"+String(this.props.location),G=null;if(o>0)G=c("React").createElement(c("LineClamp.react"),{disableNative:true,lineHeight:14,className:"_2ero",lines:o},this.props.subTitle);var H=this.props.draggable?{onMouseDown:this.$OzCalendarEvent2,onMouseUp:this.$OzCalendarEvent3,onMouseMove:this.$OzCalendarEvent4()}:{},I=this.props.hasOutline?"_2ers":"";return c("React").createElement("div",babelHelpers["extends"]({},this.props,H,{className:c("joinClasses")("_2ert",I),title:"",onClick:this.props.onEventClicked}),this.$OzCalendarEvent5(),c("React").createElement("div",{className:c("joinClasses")(this.props.className,t),style:this.$OzCalendarEvent1(this.props.shade,this.props.tentative)},A,c("React").createElement("div",{className:"_2eru"},c("React").createElement("span",babelHelpers["extends"]({className:"_2erv"+(r?" _2erw":"")},c("Tooltip").propsFor(this.props.hasTooltip?F:null)),B,this.props.title),G)))};n.propTypes={className:k.string,startTime:k.number.isRequired,endTime:k.number.isRequired,title:k.oneOfType([k.string,k.object]),location:k.string,shade:k.string.isRequired,icons:k.array,hasOutline:k.bool,hasTooltip:k.bool,height:k.number.isRequired,selected:k.bool.isRequired,tentative:k.bool,onEventClicked:k.func.isRequired,onInitiateDrag:k.func,draggable:k.bool,subTitle:k.oneOfType([k.string,k.object]),isAllDayEvent:k.bool,showTime:k.bool};n.defaultProps={showTime:true,draggable:false};n.EVENT_CLASS_NAME=l;f.exports=n}),null);
__d("OzCalendarUtils",["DateConsts","immutable"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("DateConsts").MIN_PER_HOUR*c("DateConsts").SEC_PER_MIN*c("DateConsts").MS_PER_SEC,i=c("DateConsts").HOUR_PER_DAY*h,j=7;function k(y,z){return q(y).toDateString()===q(z).toDateString()}function l(y,z){var A=new Date(y);A.setDate(A.getDate()+z);return A.getTime()}function m(y,z){var A=new Date(y),B=new Date(z),C=Date.UTC(A.getFullYear(),A.getMonth(),A.getDate()),D=Date.UTC(B.getFullYear(),B.getMonth(),B.getDate());return Math.floor((D-C)/i)}function n(y){__p&&__p();var z=arguments.length<=1||arguments[1]===undefined?1:arguments[1];if(z===null)z=1;var A=new Date(y);A.setHours(0);A.setMinutes(0);A.setSeconds(0);A.setMilliseconds(0);var B=A.getDay()-z;if(B<0)B+=7;return l(A.getTime(),-B)}function o(y){var z=arguments.length<=1||arguments[1]===undefined?1:arguments[1];return new Date(n(y.getTime(),z))}function p(y,z){return n(y.getTime())===n(z.getTime())}function q(y){var z=new Date(y),A=new Date(z.getFullYear(),z.getMonth(),z.getDate());return A}function r(y,z){var A=new Date(y);A.setDate(A.getDate()+z);return A}function s(y,z){var A=arguments.length<=2||arguments[2]===undefined?1:arguments[2],B=[],C=0,D=new Date(n(y,A));do{var E=r(D,C),F=r(D,C+7);B.push(E);C+=7}while(F.getTime()<z);return B}function t(y,z){var A=[],B=0;if(y>z)return A;do{var C=r(y,B),D=r(y,B+1);A.push(C);B+=1}while(D.getTime()<=z);return A}function u(event){return x.datesFrameToDays(x.timestampToDateOnly(event.props.startTime),x.timestampToDateOnly(event.props.endTime))}function v(event,y,z){var A=q(event.props.startTime),B=q(event.props.endTime),C=q(y),D=l(q(z).getTime(),1);return x.datesFrameToDays(new Date(Math.max(A,C)),new Date(Math.min(B,D)))}function w(y,z,A){__p&&__p();var B=c("immutable").Map(),w=c("immutable").Map();y.concat().sort(function(C,D){return C.props.startTime-D.props.startTime}).forEach(function(event){__p&&__p();var C=c("immutable").List(v(event,z,A)),D=0;while(true){var E=C.every(function(F){return!B.get(F,c("immutable").Set()).has(D)});if(E){w=w.set(event.key,D);B=C.reduce(function(F,G){return F.update(G,c("immutable").Set(),function(H){return H.add(D)})},B);break}D++}});return w}var x={MS_IN_HOUR:h,DAY_IN_WEEK:j,datesEqual:k,compareWeeks:p,datesFrameToDays:t,timeFrameToWeeks:s,getWeekStartDate:o,addDaysToTimestamp:l,getDayDifference:m,getWeekStartTimestamp:n,timestampToDateOnly:q,getShiftedDate:r,slotsByEventKey:w,daysOfEvent:u,daysOfEventInRange:v};f.exports=x}),null);
__d("OzFlexBox.react",["cx","invariant","DOM","React","joinClasses"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j,k,l;j=babelHelpers.inherits(m,c("React").Component);k=j&&j.prototype;m.prototype.render=function(){"use strict";var p="_4o6j"+(this.props.direction&&m.VERTICAL?" _4o6k":"")+(this.props.direction&&m.REVERSE?" _4o6l":"");return c("React").createElement("div",babelHelpers["extends"]({},this.props,{className:c("joinClasses")(this.props.className,p)}),c("React").Children.map(this.props.children,n,this))};function m(){"use strict";j.apply(this,arguments)}m.VERTICAL=1;m.REVERSE=2;function n(p){if(!p)return null;var q=this.props.direction&&m.VERTICAL,r=p.props,s=r.boxFlex,t=r.boxSize,u=r.boxMinSize,v=r.boxMaxSize;!(s&&t)||i(0);var w={WebkitBoxFlex:s,WebkitFlex:s,MozFlex:s,flex:s,width:q?null:t,height:q?t:null,minWidth:q?null:u,minHeight:q?u:null,maxWidth:q?null:v,maxHeight:q?v:null};return c("React").createElement("div",{style:w,className:"_4o6m"},p)}function o(){__p&&__p();if(l!==undefined)return l;var p=c("DOM").create("div");p.style.display="-webkit-flex";if(p.style.display==="-webkit-flex")return l=false;p.style.display="-moz-flex";if(p.style.display==="-moz-flex")return l=false;p.style.display="flex";if(p.style.display==="flex")return l=false;return l=true}m.isLolzyFlex=o;f.exports=m}),null);
__d("OzCalendarMonthly.react",["cx","OzFlexBox.react","DateConsts","DateStrings","OzCalendarUtils","Link.react","React","ReactDOM","ResizeListener","ScrollableArea.react","getElementPosition","joinClasses"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;function l(){__p&&__p();var m,n;"use strict";for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.state={selectedEventKey:null,currentTime:new Date(),dayHeight:null},this.$OzCalendarMonthly1=null,this.$OzCalendarMonthly2=27,this.$OzCalendarMonthly3=20,this.$OzCalendarMonthly4=22,this.$OzCalendarMonthly5=null,this.getCalendarContentPosition=function(){var r=c("ReactDOM").findDOMNode(this.refs.scrollable);if(r)return c("getElementPosition")(r);return null}.bind(this),this.$OzCalendarMonthly6=function(){var r=c("getElementPosition")(c("ReactDOM").findDOMNode(this.refs.testCell));return r.height}.bind(this),this.$OzCalendarMonthly7=function(){var r=this.$OzCalendarMonthly8();if(this.props.onFrameChange)this.props.onFrameChange(r.start,r.end);if(this.props.scrollToCurrentTime){var s=this.refs.scrollable.getArea();if(s)s.setScrollTop(this.state.dayHeight*(this.getCurrentDateRow()-1)+1,false)}}.bind(this),this.$OzCalendarMonthly10=function(r){if(this.props.onDateClick){var s=this.props.onDateClick;return function(){return s(r)}}else return null}.bind(this),this.$OzCalendarMonthly9=function(r){if(this.props.onShowMore)this.props.onShowMore(r)}.bind(this),n}l.prototype.componentDidMount=function(){"use strict";this.$OzCalendarMonthly1=setInterval(function(){return this.setState({currentTime:new Date()})}.bind(this),60*1e3);this.setState({dayHeight:this.$OzCalendarMonthly6()});setTimeout(function(){return this.$OzCalendarMonthly7()}.bind(this),0);this.$OzCalendarMonthly5=c("ResizeListener").add(function(){return this.setState({dayHeight:this.$OzCalendarMonthly6()})}.bind(this))};l.prototype.componentWillUnmount=function(){"use strict";if(this.$OzCalendarMonthly1)clearInterval(this.$OzCalendarMonthly1);if(this.$OzCalendarMonthly5)this.$OzCalendarMonthly5.remove()};l.prototype.componentDidUpdate=function(m,n){"use strict";if(m&&m.date!==this.props.date)this.$OzCalendarMonthly7()};l.prototype.$OzCalendarMonthly8=function(){"use strict";var m=this.getCalendarStartDate(),n=c("OzCalendarUtils").getShiftedDate(m,c("DateConsts").DAYS_PER_WEEK*6-1);return{start:m.getTime(),end:n.getTime()}};l.prototype.render=function(){"use strict";__p&&__p();var m=this.groupEvents(),n=[],o=[];for(var p=0;p<c("DateConsts").DAYS_PER_WEEK;p++){n.push(this.renderCol(p,m));o.push(this.renderDayHeader(p))}var q=c("React").createElement(c("ScrollableArea.react"),{className:"_2bgx",ref:"scrollable",shadow:false},c("React").createElement(c("OzFlexBox.react"),{className:"_2bgy"},n)),r=c("joinClasses")(this.props.className,"_2bgz _2bg-"),s={};if(this.props.calendarHeight)s={height:this.props.calendarHeight+"px"};return c("React").createElement("div",{style:s,className:r},c("React").createElement(c("OzFlexBox.react"),{className:"_2bgy"},o),q)};l.prototype.groupEvents=function(){"use strict";__p&&__p();var m=[],n=c("React").Children.toArray(this.props.children).sort(function(p,q){return p.props.startTime-q.props.startTime}),o=c("OzCalendarUtils").slotsByEventKey(n,this.getCalendarStartDate(),this.getCalendarEndDate());n.forEach(function(event){var p=c("OzCalendarUtils").daysOfEventInRange(event,this.getCalendarStartDate(),this.getCalendarEndDate());p.forEach(function(q){var r=o.get(event.key);if(!m[q])m[q]=[];m[q][r]=this.cloneOfEventForDay(event,q,r)}.bind(this))}.bind(this));return m};l.prototype.cloneOfEventForDay=function(event,m,n){"use strict";var o=!c("OzCalendarUtils").datesEqual(event.props.startTime,event.props.endTime),p=c("OzCalendarUtils").datesEqual(m,event.props.startTime)||c("OzCalendarUtils").datesEqual(m,this.getCalendarStartDate()),q=c("OzCalendarUtils").datesEqual(m,event.props.endTime)||c("OzCalendarUtils").datesEqual(m,this.getCalendarEndDate());return c("React").cloneElement(event,{className:(!p&&!q?"_2bg_":"")+(o&&p?" _2bh2":"")+(o&&q?" _2bh3":""),key:event.key,height:24,onEventClicked:function(){return this.setState({selectedEventKey:event.key})}.bind(this),selected:this.state.selectedEventKey===event.key,style:{top:n*this.$OzCalendarMonthly4+this.$OzCalendarMonthly2+"px"}})};l.prototype.getCalendarStartDate=function(){"use strict";var m=new Date(this.props.date.getFullYear(),this.props.date.getMonth(),1);m.setDate(m.getDate()-m.getDay());return m};l.prototype.getCalendarEndDate=function(){"use strict";var m=new Date(this.props.date.getFullYear(),this.props.date.getMonth(),1);m.setDate(m.getDate()+42);return m};l.prototype.getCurrentDateRow=function(){"use strict";var m=c("OzCalendarUtils").getDayDifference(this.getCalendarStartDate().getTime(),this.state.currentTime.getTime()),n=Math.floor(m/7);if(n>5)return 0;return n};l.prototype.renderGridLines=function(m,n,o){"use strict";__p&&__p();var p=0,q=5,r=[];for(var s=0;s<=q;s++){p=s*c("DateConsts").DAYS_PER_WEEK+m;var t=c("OzCalendarUtils").getShiftedDate(this.getCalendarStartDate(),p),u=this.props.highlightedDay,v=(o&&s===0?"_2bh4":"")+(!o&&s===0?" _2bh5":"")+(m===0&&s===q?" _2bh6":"")+(o&&s===q?" _2bh7":"")+(o&&s!==q?" _2bh8":"")+(!o&&s===q?" _2bh9":"")+(m===0?" _2bha":"")+" _2bhb"+(t.toDateString()===this.state.currentTime.toDateString()?" _2bhe":"")+(u&&t.toDateString()===u.toDateString()?" _2bhf":""),w=null;if(this.state.dayHeight){var x=Math.floor((this.state.dayHeight-this.$OzCalendarMonthly2-this.$OzCalendarMonthly3)/this.$OzCalendarMonthly4)+1;if(n[t]&&n[t].length>x){(function(y){w=c("React").createElement(c("Link.react"),{onClick:function(){return this.$OzCalendarMonthly9(y)}.bind(this),className:"_2bhg"},"Show more ("+(n[t].length-x)+")")}).bind(this)(t);n[t]=n[t].slice(0,x)}}else n[t]=[];r.push(c("React").createElement("div",{key:s,ref:m===0&&s===0?"testCell":null,style:{height:"16.666%"},onDoubleClick:this.$OzCalendarMonthly10(t),className:v},c("React").createElement("div",{className:"_2bhh"+(t.getMonth()!==this.props.date.getMonth()?" _2bhi":"")},t.getMonth()!==this.props.date.getMonth()&&t.getDate()===1?c("DateStrings").getMonthNameShort(t.getMonth()+1).toString()+" ":null,t.getDate()),c("React").createElement("div",{className:"_2bhj"},n[t],w)))}return c("React").createElement("div",null,r)};l.prototype.renderDayHeader=function(m){"use strict";var n=c("React").createElement("div",{className:"_2bhk"},c("DateStrings").getWeekdayName(m)),o=m===6;return c("React").createElement("div",{className:"_2bhx",boxFlex:1,key:m},c("React").createElement("div",{className:"_2bhy"+(o?" _2bhz":"")+(m===0?" _2bh-":"")},n))};l.prototype.renderCol=function(m,n){"use strict";var o=m===6;return c("React").createElement("div",{className:"_2bhx",boxFlex:1,key:m},this.renderGridLines(m,n,o))};l.propTypes={date:k.instanceOf(Date).isRequired,calendarHeight:k.number,onShowMore:k.func,scrollToCurrentTime:k.bool,onDateClick:k.func,highlightedDay:k.instanceOf(Date)};l.defaultProps={dayStartHour:9,dayEndHour:17,daysPerWeek:5,date:new Date(),weekStartDay:1,enableCurrentTimeMarker:true,calendarHeight:700};f.exports=l}),null);
__d("OzCalendarType",[],(function a(b,c,d,e,f,g){f.exports={MONTH:1,WEEK:2,DAY:3}}),null);
__d("OzCalendarPager.react",["cx","fbt","ix","OzCalendarUtils","Image.react","OzCalendarType","React","XUIButton.react","XUIButtonGroup.react"],(function a(b,c,d,e,f,g,h,i,j){__p&&__p();var k,l,m=c("React").PropTypes;k=babelHelpers.inherits(n,c("React").Component);l=k&&k.prototype;n.prototype.onWeekNavigate=function(o){"use strict";this.props.onDateChange&&this.props.onDateChange(new Date(o))};n.prototype.$OzCalendarPager1=function(o){"use strict";var p=this.props.date.getTime(),q=c("OzCalendarUtils").addDaysToTimestamp(p,o);return q};n.prototype.$OzCalendarPager2=function(o){"use strict";var p=c("OzCalendarUtils").getWeekStartTimestamp(this.props.date.getTime()),q=c("OzCalendarUtils").addDaysToTimestamp(p,o*c("OzCalendarUtils").DAY_IN_WEEK);return q};n.prototype.$OzCalendarPager3=function(o){"use strict";return new Date(this.props.date.getFullYear(),this.props.date.getMonth()+o*1,1).getTime()};n.prototype.$OzCalendarPager4=function(o){"use strict";return new Date(this.props.date.getFullYear()+o*1,this.props.date.getMonth(),1).getTime()};n.prototype.$OzCalendarPager5=function(o){"use strict";__p&&__p();var p;switch(this.props.mode){case c("OzCalendarType").MONTH:p=this.$OzCalendarPager3(o);break;case c("OzCalendarType").WEEK:p=this.$OzCalendarPager2(o);break;case c("OzCalendarType").DAY:p=this.$OzCalendarPager1(o);break}this.onWeekNavigate(p)};n.prototype.$OzCalendarPager6=function(o){"use strict";var p=this.props.mode===c("OzCalendarType").MONTH?this.$OzCalendarPager4(o):this.$OzCalendarPager3(o);this.onWeekNavigate(p)};n.prototype.render=function(){"use strict";var o=this.props,p=o.buttonSize,q=o.disabled,r=o.hasFastSwitch;return c("React").createElement(c("XUIButtonGroup.react"),{className:"_3-95"},r?c("React").createElement(c("XUIButton.react"),{disabled:q,image:c("React").createElement(c("Image.react"),{src:j("101337")}),label:i._("First Page"),labelIsHidden:true,role:"button",size:p,style:{opacity:.63},onClick:function(){return this.$OzCalendarPager6(-1)}.bind(this)}):null,c("React").createElement(c("XUIButton.react"),{disabled:q,image:c("React").createElement(c("Image.react"),{src:j("101339")}),label:i._("Previous"),labelIsHidden:true,role:"button",size:p,onClick:function(){return this.$OzCalendarPager5(-1)}.bind(this)}),c("React").createElement(c("XUIButton.react"),{label:"Today",disabled:q,size:p,onClick:function(){return this.onWeekNavigate(Date.now())}.bind(this)}),c("React").createElement(c("XUIButton.react"),{disabled:q,image:c("React").createElement(c("Image.react"),{src:j("101341")}),label:i._("Next"),labelIsHidden:true,role:"button",size:p,onClick:function(){return this.$OzCalendarPager5(1)}.bind(this)}),r?c("React").createElement(c("XUIButton.react"),{disabled:q,image:c("React").createElement(c("Image.react"),{src:j("101338")}),label:i._("Last Page"),labelIsHidden:true,role:"button",size:p,style:{opacity:.63},onClick:function(){return this.$OzCalendarPager6(1)}.bind(this)}):null)};function n(){"use strict";k.apply(this,arguments)}n.propTypes={date:m.instanceOf(Date).isRequired,onDateChange:m.func,buttonSize:m.string,mode:m.oneOf([c("OzCalendarType").MONTH,c("OzCalendarType").WEEK,c("OzCalendarType").DAY]),hasFastSwitch:m.bool,disabled:m.bool};n.defaultProps={mode:c("OzCalendarType").WEEK};f.exports=n}),null);
__d("OzPagedMonthlyCalendar.react",["cx","DateStrings","OzCalendarMonthly.react","OzCalendarPager.react","OzCalendarType","LoadingIndicator.react","React"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;function l(){__p&&__p();var m,n;"use strict";for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.state={date:new Date(this.props.date)},this.$OzPagedMonthlyCalendar2=function(){if(!this.props.isLoading)return null;return c("React").createElement("div",{className:"_1ifd"},c("React").createElement(c("LoadingIndicator.react"),{size:"large",color:"white"}))}.bind(this),this.$OzPagedMonthlyCalendar3=function(){return c("React").createElement("div",{className:"_1ife"},c("React").createElement(c("OzCalendarMonthly.react"),{date:this.state.date,className:"_1iff",onDateClick:this.props.onDateClick,onShowMore:this.props.onShowMore,highlightedDay:this.props.highlightedDay},this.props.events))}.bind(this),this.$OzPagedMonthlyCalendar4=function(r){this.setState({date:r},function(){this.props.onDateChange(r)}.bind(this))}.bind(this),n}l.prototype.render=function(){"use strict";return c("React").createElement("div",{className:"_1if8"},this.$OzPagedMonthlyCalendar1(),this.$OzPagedMonthlyCalendar2(),this.$OzPagedMonthlyCalendar3())};l.prototype.$OzPagedMonthlyCalendar1=function(){"use strict";return c("React").createElement("div",{className:"_1if9"},c("React").createElement("div",{className:"_1ifa"},this.props.events.length+" events"),c("React").createElement("div",{className:"_1ifb"},c("React").createElement(c("OzCalendarPager.react"),{date:this.state.date,mode:c("OzCalendarType").MONTH,onDateChange:this.$OzPagedMonthlyCalendar4,hasFastSwitch:true})),c("React").createElement("div",{className:"_1ifc"},c("React").createElement("strong",null,c("DateStrings").getMonthName(this.state.date.getMonth()+1)),"  ",this.state.date.getFullYear()))};l.propTypes={date:k.instanceOf(Date).isRequired,events:k.array.isRequired,isLoading:k.bool,onDateClick:k.func,onDateChange:k.func.isRequired,onShowMore:k.func.isRequired,highlightedDay:k.instanceOf(Date)};f.exports=l}),null);
__d("OzCalendarModal.react",["cx","OzConfig","OzImmutablePureRenderMixin","immutable","React","Reflux","OzDraggableModal.react","XUICloseButton.react","OzPagedMonthlyCalendar.react","OzCalendarEvent.react","XUIDialog.react","XUIDialogBody.react","XUIDialogTitle.react","formatDate"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=c("React").PropTypes,l=c("immutable").Map,m=c("React").createClass({displayName:"OzCalendarModal",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{events:k.array.isRequired,onClose:k.func.isRequired},getInitialState:function q(){return{moreDialogShown:false,moreDialogDate:new Date()}},render:function q(){var r=this.state.config.get("GK",l()),s=r.get("calendar"),t=this.props,u=t.events,v=t.onClose;return c("React").createElement(c("OzDraggableModal.react"),{className:"_33-2",getHandle:function(w){return this.refs.header}.bind(this)},c("React").createElement("div",{className:"_33-3",ref:"header"},!s?"Calendar - Busy/Free Access only":"Calendar",c("React").createElement(c("XUICloseButton.react"),{onClick:v})),c("React").createElement(c("OzPagedMonthlyCalendar.react"),{isLoading:false,events:n(u,s),date:new Date(),onDateChange:function w(x){},onShowMore:this._calendarShowMore}),this._renderShowMoreDialog(s))},_renderShowMoreDialog:function q(r){if(this.state.moreDialogShown)return c("React").createElement(p,{events:o(this.props.events,this.state.moreDialogDate),date:this.state.moreDialogDate,onToggle:this._onShowMoreToggle,calendarBusy:r});return null},_calendarShowMore:function q(r){this.setState({moreDialogShown:true,moreDialogDate:r})}}),n=function n(q,r){return q.map(function(s){return c("React").createElement(c("OzCalendarEvent.react"),{key:s.identifier,title:r?s.title:"Busy",location:r?s.location:"",startTime:new Date(s.startDate).getTime(),endTime:new Date(s.endDate).getTime(),shade:"DarkBlue",hasTooltip:r})})},o=function o(q,r){var s=new Date(r);s.setTime(s.getTime()+864e5);return q.sort(function(t,u){return new Date(t.startDate).getTime()-new Date(u.startDate).getTime()}).filter(function(t){return new Date(t.startDate).getTime()>=new Date(r).getTime()||new Date(t.endDate).getTime()>=new Date(r).getTime()}).filter(function(t){return new Date(t.startDate).getTime()<s.getTime()})};i=babelHelpers.inherits(p,c("React").Component);j=i&&i.prototype;function p(){__p&&__p();var q,r;"use strict";for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=j.constructor).call.apply(q,[this].concat(t)),this.$OzCalendarEventShowMoreDialog1=function(v,w){var x=null,y="",z=null,A=new Date(v),B=new Date(w),C=A.getDate()==B.getDate()&&A.getMonth()==B.getMonth(),D=Math.floor((B-A)/(1e3*60*60))>13;if(!D||!C){x=c("formatDate")(A,C?"g:ia":"D M j, g:ia");y=c("formatDate")(B,C?"g:ia":"D M j, g:ia");z=x+(C?" - ":"\n")+y}else z="All day";return c("React").createElement("div",{className:"_33-c"},z)},r}p.prototype.render=function(){"use strict";var q=this.props.events.map(function(r){return c("React").createElement("div",{key:r.identifier,className:"_33-4"},this.$OzCalendarEventShowMoreDialog1(r.startDate,r.endDate),c("React").createElement("div",{className:"_33-b"},c("React").createElement("span",null,this.props.calendarBusy?r.title+"\n"+r.location:"Busy")))}.bind(this));return c("React").createElement(c("XUIDialog.react"),{shown:true,width:500,onToggle:this.props.onToggle},c("React").createElement(c("XUIDialogTitle.react"),null,q.length+" events on "+this.props.date.toDateString()),c("React").createElement(c("XUIDialogBody.react"),null,q))};p.propTypes={events:k.array.isRequired,date:k.instanceOf(Date).isRequired,onToggle:k.func,calendarBusy:k.bool};f.exports=m}),null);
__d("OzThreadMeta.react",["cx","OzAPI","OzHelpers","immutable","Keys","MessengerButtonReact.bs","OzFormPreview.react","OzThreadLabels.react","OzStores","OzSwitch.react","OzImmutablePureRenderMixin","React","Reflux","Tooltip","OzCalendarModal.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("MessengerButtonReact.bs").jsComponent,j=c("immutable").Map,k=c("OzFormPreview.react").Row,l=c("OzThreadLabels.react").OzUnderageLabel,m=c("React").PropTypes,n=c("OzStores").CalendarEventStore,o=c("React").createClass({displayName:"OzThreadMeta",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(n,"calendarEvents")],propTypes:{thread:m.object.isRequired,repNames:m.instanceOf(j).isRequired},getInitialState:function x(){return{newMeta:null,muted:w(this.props.thread),calendarShown:false}},componentWillReceiveProps:function x(y){if(c("OzHelpers").threadID(y.thread)!==c("OzHelpers").threadID(this.props.thread))this.setState({newMeta:null,muted:w(y.thread),locked:y.thread.get("locked")});else this.setState({muted:w(y.thread),locked:y.thread.get("locked")})},render:function x(){var y=c("OzHelpers").threadID(this.props.thread),z=this.state.calendarEvents.get(y,[]),A=[["Cancel","secondary",this._handleCancel],["DONE","primary",this._handleDone]],B=["Edit","primary",this._handleEdit],C=z&&z.length?[["Calendar","primary",this._handleCalendar],B]:[B],D=this.state.newMeta?A:C;return c("React").createElement("div",{className:"_56t0"+(this.state.newMeta?" _56t1":"")},this.state.calendarShown&&c("React").createElement(c("OzCalendarModal.react"),{events:z,onClose:this._onCalendarClose}),c("React").createElement(p,{thread:this.props.thread,buttons:D}),this.state.newMeta?c("React").createElement(t,{meta:this.state.newMeta,onCancel:this._handleCancel,onChange:this._handleChange,onDone:this._handleDone,onMutedToggle:this._handleMutedToggle,isMuted:this.state.muted}):c("React").createElement(r,{meta:v(this.props.thread),onMutedToggle:this._handleMutedToggle,isMuted:this.state.muted}),c("React").createElement(s,{thread:this.props.thread,repNames:this.props.repNames,locked:!!this.state.locked,onToggle:this._handleThreadLockToggle}))},_handleEdit:function x(){this.setState({newMeta:v(this.props.thread)})},_handleCancel:function x(){this.setState({newMeta:null})},_handleDone:function x(){c("OzAPI").saveMeta(c("OzHelpers").threadID(this.props.thread),this.state.newMeta);this.setState({newMeta:null})},_handleChange:function x(y){this.setState({newMeta:y})},_handleMutedToggle:function x(y){c("OzAPI").saveMuted(c("OzHelpers").threadID(this.props.thread),!y);this.setState({muted:!y})},_handleThreadLockToggle:function x(y){var z=this.props.thread,A=c("OzHelpers").threadID(z);if(this.state.locked){this.setState({locked:false});c("OzAPI").unlockThread(A,z.get("locked-at"))}else{this.setState({locked:true});c("OzAPI").lockThread(A)}},_handleCalendar:function x(){var y=this.props.thread,z=c("OzHelpers").threadID(y);c("OzAPI").fetchCalendar(z);this.setState({calendarShown:true})},_onCalendarClose:function x(){this.setState({calendarShown:false})}}),p=c("OzHelpers").pure(function(x){var y=x.thread,z=x.buttons;return c("React").createElement("div",{className:"_56t2"},c("React").createElement("div",{className:"_56t6"},c("React").createElement("h2",{className:"_56tb"},c("OzHelpers").getName(y)),c("React").createElement("div",{className:"_56tc"},z.map(function(A,B){var C=A[0],D=A[1],E=A[2];return c("React").createElement(i,{key:C,label:C,type:D,onClick:E})}))),c("React").createElement("div",{className:"_56td"},c("React").createElement(l,{thread:y})))}),q=c("OzHelpers").pure(function(x){var w=x.isMuted,y=x.onMutedToggle,z=function z(C){y(w)},A="Uncheck if person dislikes our proactive messages, e.g. surveys",B=c("React").createElement("span",c("Tooltip").propsFor(A),"Proactive?");return c("React").createElement(k,{label:B},c("React").createElement("input",{type:"checkbox",checked:!w,onChange:z}))}),r=c("OzHelpers").pure(function(x){var v=x.meta,w=x.isMuted,y=x.onMutedToggle,z=(v.get("address1","")+" "+v.get("address2","")+"\n     "+v.get("city","")+" "+v.get("state","")+" "+v.get("zip","")+"\n    ").trim();return c("React").createElement(c("OzFormPreview.react"),null,c("React").createElement(k,{label:"Nickname"},v.get("preferred-name")),c("React").createElement(k,{label:"Email"},v.get("email")),c("React").createElement(k,{label:"Phone"},v.get("phone")),c("React").createElement(k,{label:"Address"},z),c("React").createElement(k,{label:"Device OS"},v.get("os-type")),c("React").createElement(k,{label:"App Version"},v.get("app-version")),c("React").createElement(q,{isMuted:w,onMutedToggle:y}))}),s=c("OzHelpers").pure(function(x){var y=x.thread,z=x.repNames,A=x.locked,B=x.onToggle,C=z.get(y.get("locker-id")),D=C?(y.get("locked")?"Locked":"Last locked")+" by "+C:"";D+=D&&y.get("locked-at")?" at "+new Date(y.get("locked-at")).toLocaleString():"";var E=c("React").createElement("span",c("Tooltip").propsFor(D),A?"Click to unlock thread":"Click to lock thread");return c("React").createElement(c("OzSwitch.react"),{className:"_z1m",isAnimated:true,reverseColors:true,isOn:A,label:E,onToggle:B})}),t=c("React").createClass({displayName:"EditView",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{meta:m.instanceOf(j).isRequired,onCancel:m.func.isRequired,onChange:m.func.isRequired,onDone:m.func.isRequired,isMuted:m.bool.isRequired,onMutedToggle:m.func.isRequired},componentDidMount:function x(){this.refs["preferred-name"].focus()},render:function x(){var y=this._renderRow;return c("React").createElement("form",{className:"_56to",onKeyDown:this._handleKeyDown},c("React").createElement(u,null,y("Nickname","preferred-name","Add Preferred Name")),c("React").createElement(u,null,y("Email","email","Add email")),c("React").createElement(u,null,y("Phone","phone","Add phone")),c("React").createElement(u,null,y("Street","address1","Add Street"),y("Street","address2","Add Street"),y("City","city","Add City"),y("State","state"),y("Zip Code","zip")),c("React").createElement(u,null,c("React").createElement(q,{isMuted:this.props.isMuted,onMutedToggle:this.props.onMutedToggle})))},_handleKeyDown:function x(y){y.which===c("Keys").ESC?this.props.onCancel():y.which===c("Keys").RETURN?this.props.onDone():null},_renderRow:function x(y,z,A){var B=this.props,v=B.meta,C=B.onChange;return c("React").createElement(k,{label:y},c("React").createElement("input",{ref:z,type:"text",className:"_1-i0 _56uv",placeholder:A,value:v.get(z),onChange:function D(E){return C(v.set(z,E.target.value))}}))}}),u=c("OzHelpers").pure(function(x){var y=x.children;return c("React").createElement("div",{className:"_56vn"},y)});function v(x){return x.get("metadata-json")||j()}function w(x){return!!x.get("muted")}f.exports=o}),null);
__d("OzThreadNote.react",["cx","OzAPI","getActiveElement","OzHelpers","immutable","OzConfig","OzRequirementTokenizer.react","React","Reflux"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("React").PropTypes,k=1e3,l=c("React").createClass({displayName:"OzThreadNote",mixins:[c("Reflux").connect(c("OzConfig").ConfigStore,"config")],propTypes:{thread:j.instanceOf(i).isRequired,requirements:j.instanceOf(i).isRequired,timeline:j.bool},getDefaultProps:function m(){return{timeline:false}},getInitialState:function m(){return{editedText:this.props.thread.get("notes")||""}},componentWillReceiveProps:function m(n){var o=n.thread.get("notes"),p=c("getActiveElement")()===this.refs.textarea;if(o!==this.props.thread.get("notes")&&!p)this.setState({editedText:o})},render:function m(){var n=this.props,o=n.requirements,p=n.thread,q=n.timeline;return c("React").createElement("div",{className:"_1x92"},c("React").createElement("h2",{className:"_1x93"},"Thread Notes"),c("React").createElement("div",{className:"_41v4"},c("React").createElement(c("OzRequirementTokenizer.react"),{allRequirements:o,onDeleteRequirement:this._handleDeleteRequirement,onCreateRequirement:this._handleCreateRequirement,selectedRequirements:p.get("requirements"),placeholder:"Add a user tag...",timeline:q})),c("React").createElement("textarea",{ref:"textarea",className:"_1x95"+(this.props.timeline?" _11_w":""),placeholder:"Leave a note",value:this.state.editedText,onChange:this._handleChange}))},_handleChange:function m(){var n=this.props.thread,o=this.refs.textarea.value;this.setState({editedText:o});window.clearTimeout(this.timeout);this.timeout=window.setTimeout(function(){c("OzAPI").saveNote(c("OzHelpers").threadID(n),o)},k)},_handleCreateRequirement:function m(n){var o=this.props.thread;c("OzAPI").createThreadRequirement(c("OzHelpers").threadID(o),n.get("name"))},_handleDeleteRequirement:function m(n){var o=this.props.thread;c("OzAPI").deleteThreadRequirement(c("OzHelpers").threadID(o),n.get("id"))}});f.exports=l}),null);
__d("OzTimeline.react",["csx","cx","OzAPI","OzHelpers","immutable","OzActions","OzDate.react","OzStores","ozFormatTime","OzImmutablePureRenderMixin","React","ReactRouter","Reflux"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j=c("immutable").Map,k=c("immutable").List,l=c("React").PropTypes,m=c("ReactRouter").Link,n=c("OzStores").ActiveThreadStore,o=j({"send-email":"sent email","receive-email":"received email","send-calendar":"sent invite","completed-call":"phone call"}),p=c("React").createClass({displayName:"OzTimeline",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(n,"activeThread")],propTypes:{closedIntents:l.instanceOf(k).isRequired,events:l.instanceOf(k).isRequired,tasks:l.instanceOf(k).isRequired},contextTypes:{router:l.object.isRequired},componentDidMount:function w(){this._scrollTimeline();this._timeUpdateInterval=window.setInterval(function(x){return this.setState({time:c("OzHelpers").serverNow()})}.bind(this),6e4)},componentDidUpdate:function w(){this._scrollTimeline()},_scrollTimeline:function w(){var x=document.querySelector("._415b");if(x)x.scrollIntoView(true);var y=document.querySelector("._2mg4");if(y)y.scrollIntoView(true)},componentWillUnmount:function w(){window.clearInterval(this._timeUpdateInterval)},getInitialState:function w(){return{time:c("OzHelpers").serverNow()}},render:function w(){var x=this._sortedItems();return c("React").createElement("div",{className:"_201k"},c("React").createElement("div",{className:"_201l"},"Activity & tasks"),c("React").createElement("div",{className:"_4fj7 _201m",ref:"scrollable"},x.map(this._renderTimelineElement),c("React").createElement("div",{key:"OzTimelineSpacer",className:"_415b"})))},_sortedItems:function w(){var x=this.props,y=x.events,z=x.tasks,A=x.closedIntents;return y.filter(function(B){return o.has(B.get("type"))}).map(function(B){return B.set("item-type","event")}).concat(z.map(function(B){return B.set("item-type","task")})).concat(A.map(function(B){return B.set("item-type","intent").set("intent-id",B.get("id"))})).sortBy(v)},_renderTimelineElement:function w(x){var y=this.state,z=y.activeThread,A=y.time,B=this.props.tasks,C=x.get("item-type")+"-"+x.get("id");switch(x.get("item-type")){case"event":return c("React").createElement(r,{key:C,event:x,onEmailView:this._handleEmailView,onEmailReply:this._handleEmailReply,onInviteView:this._handleInviteView,activeThread:z});case"task":return c("React").createElement(s,{key:C,task:x,activeThread:z,time:A});case"intent":return c("React").createElement(t,{key:C,intent:x,tasks:B,activeThread:z});default:c("OzHelpers").err("unknown item",x);return null}},_handleEmailView:function w(x){c("OzActions").emailComposer.add(babelHelpers["extends"]({},c("OzHelpers").eventToEmail(x),{disabled:true}))},_handleEmailReply:function w(x){c("OzActions").emailComposer.add(c("OzHelpers").eventToEmail(c("OzHelpers").reEmail(x)))},_handleInviteView:function w(x){c("OzActions").inviteComposer.add(c("OzHelpers").eventToInvite(x))},_handleCallPlay:function w(x){return c("OzAPI").everstoreURI(x).then(function(y){return window.open(y)})}}),q=c("OzHelpers").pure(function(w){var x=w.activeThread,y=w.contents,z=w.item,A=w.onClick,B=w.path,C=w.status,D=w.summary,E=z.get("intent-id")===x.get("activeIntent"),F=z.get("id")===x.get(z.get("item-type")==="task"?"activeTask":"activeEvent");C=C||"completed";return c("React").createElement(m,{to:B,className:"_8i9"+(E?" _8ia":"")+(!E?" _8ib":"")+(F?" _2mg4":"")+(C==="pending"?" _4rsf":"")+(C==="completed"?" _4rsg":"")+(C==="close"?" _4rsj":"")+(C==="late"?" _4rsm":"")},c("React").createElement("div",{className:"_8id"}),c("React").createElement("div",{className:"_201o"}),c("React").createElement("div",{className:"_201p"},c("React").createElement("div",{className:"_201r"},z.get("intent-name")),c("React").createElement("div",{className:"_8ie"},D||"[Untitled]"),c("React").createElement("div",{className:"_2022"},C!=="completed"?"Due: ":null,c("React").createElement(c("OzDate.react"),{className:"_1qdh",timestamp:v(z)}))))},"OzTimelineItem"),r=c("OzHelpers").pure(function(w){__p&&__p();var x=w.activeThread,event=w.event,y=w.onCallPlay,z=w.onEmailReply,A=w.onEmailView,B=w.onInviteView,C=event.get("type"),D;switch(C){case"send-email":D="Email to "+event.getIn(["data","to"]).join(", ");break;case"receive-email":D="Email from "+event.getIn(["data","from"]);break;case"send-calendar":if(event.hasIn(["data","place-id"]))D="Invite bubble";else D="Invite to "+event.getIn(["data","to"]).join(", ");break;case"completed-call":var E=event.get("data"),F={"in":"Call from ",out:"Call to ",voicemail:"Voicemail from "}[E.get("direction")],G=c("OzHelpers").parsePhoneNumber(E.get("remote-phone")),H=E.get("RecordingDuration"),I=E.get("recording-ev-handle");D=F+G;break;default:D="Another event"}return c("React").createElement(q,{activeThread:x,path:c("OzHelpers").threadPath({threadid:event.get("user-id"),intentid:event.get("intent-id"),eventid:event.get("id")}),item:event,summary:D})},"OzTimelineEvent"),s=c("OzHelpers").pure(function(w){__p&&__p();var x=w.task,y=w.time,z=w.activeThread,A=function A(x){switch(x.get("type")){case"reminder":return x.getIn(["data","description"]);default:return x.get("type")}},B;if(c("OzHelpers").isCompletedTask(x))B="completed";else if(x.get("start-at")>y)B="pending";else if(x.get("deadline")>y)B="close";else B="late";var C=c("React").createElement("div",null,x.getIn(["data","notes"]));return c("React").createElement(q,{activeThread:z,path:c("OzHelpers").threadPath({threadid:x.get("user-id"),intentid:x.get("intent-id"),taskid:x.get("id")}),item:x,status:B,summary:A(x),contents:C})},"OzTimelineTask"),t=c("OzHelpers").pure(function(w){var x=w.intent,y=w.activeThread,z=w.tasks,A="Closed: "+x.get("alias",x.get("name")),B=c("OzHelpers").nextTaskForIntent(x,z);return c("React").createElement(q,{activeThread:y,path:c("OzHelpers").threadPath({threadid:x.get("user-id"),intentid:x.get("id"),taskid:B&&B.get("id")}),item:x,summary:A})}),u=j({event:"timestamp",task:"deadline",separator:"timestamp",intent:"closed-at"});function v(w){var x=u.get(w.get("item-type"));return w.get(x,w.get("created-at"))}f.exports=p}),null);
__d("OzThreadPanel.react",["cx","OzAPI","OzHelpers","immutable","OzConfig","OzHumans","OzEventShow.react","OzIntent.react","OzIntentActions.react","OzIntentList.react","OzIntentTabs.react","OzReminders.react","OzReminderTask.react","OzReminderTasks.react","OzStores","OzTabHeader.react","OzTaskComposers.react","OzTaskShow.react","OzThreadMeta.react","OzThreadNote.react","OzTimeline.react","OzImmutablePureRenderMixin","React","OzWrapper.react","Reflux","XUISelector.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("XUISelector.react").Option,j=c("immutable").Map,k=c("immutable").List,l=c("immutable").Set,m=c("React").PropTypes,n=c("OzStores").ActiveThreadStore,o="NO_OWNER",p="TODO",q="HISTORY",r=c("React").createClass({displayName:"OzThreadPanel",mixins:[c("OzImmutablePureRenderMixin"),c("Reflux").connect(c("OzConfig").ConfigStore,"config"),c("Reflux").connect(n,"activeThread"),c("Reflux").listenTo(n,"onActiveIntentChange")],onActiveIntentChange:function u(v){if(v.get("activeIntent")&&!v.get("activeTask")){var w=this._activeTabForIntent();if(w)this.setState({activeTab:w})}},componentWillMount:function u(){var v=this._activeTabForIntent();if(v)this.setState({activeTab:v})},componentWillReceiveProps:function u(v){if(!this.state.activeTab){var w=this._activeTabForIntent();if(w)this.setState({activeTab:w})}},render:function u(){__p&&__p();var v=this.props,w=v.thread,x=v.repNames,y=this.state,z=y.activeTab,A=y.config,B=y.activeThread,C=A.getIn(["GK","timeline"]),D=A.get("display-tasks")||C,E=B.get("activeIntent"),F=B.get("activeTask"),G=B.get("activeEvent"),H=!(C||z!==q),I=c("OzHelpers").intents(w).find(function(S){return S.get("id")===E}),J=H?c("OzHelpers").closedIntents(w).filterNot(c("OzHelpers").isDeleted):I?l(c("OzHelpers").openIntents(w).push(I)).toList():c("OzHelpers").openIntents(w),K=I&&F?(I.get("tasks")||k()).find(function(S){return S.get("id")===F}):null,L=I&&G?(I.get("events")||k()).find(function(S){return S.get("id")===G}):null,M={isHistory:H,repNames:x,thread:w},N=j(J.map(function(S){return[S.get("id"),c("OzHelpers").intentAlias(S)]}).concat(I?[[E,c("OzHelpers").intentAlias(I)]]:[])),O=w.get("tasks",k()).filter(function(S){return I?S.get("intent-id")==I.get("id"):true}).map(function(S){return S.set("intent-name",N.get(S.get("intent-id")))}),P=w.get("tasks",k()).filter(function(S){return S.get("state")!=="completed"}).map(function(S){return S.get("intent-id")}).toSet(),Q=w.get("intents").filter(function(S){return c("OzHelpers").isClosedIntent(S)&&P.get(S.get("id"))}),R=I?I.get("events",j()).valueSeq().map(function(S){return S.set("intent-name",N.get(S.get("intent-id")))}).toList():J.reduce(function(S,T){return S.concat(T.get("events",j()).valueSeq())},k()).map(function(S){return S.set("intent-name",N.get(S.get("intent-id")))});return c("React").createElement("div",{className:"_5l_x"},I&&c("React").createElement(c("OzTaskComposers.react"),{intent:I}),C?c("React").createElement(c("OzIntentTabs.react"),{intents:c("OzHelpers").openIntents(w).concat(Q),tasks:O,activeIntentId:E,threadId:w.get("user-id")}):null,c("React").createElement("div",{className:"_1c1k"+(C?" _5mt9":"")},c("React").createElement("div",{className:"_5l_y"},!C&&c("React").createElement(c("OzTabHeader.react"),{active:z,tabs:[["Todo",p],["History",q]],onChange:this._handleTabChange}),c("React").createElement("div",{className:"_5l_z"+(C?" _5mt9":"")},C?c("React").createElement(c("OzTimeline.react"),{events:R,tasks:O,closedIntents:!E?c("OzHelpers").closedIntents(w):k()}):c("React").createElement("div",{className:"_4fj7"},c("React").createElement(c("OzIntentList.react"),{intents:J,activeIntentId:B.get("activeIntent"),witIntents:this.props.witIntents,isHistory:H,timelineGK:C}))),H||!C?c("React").createElement("div",{className:"_4sm5"},D?c("React").createElement(c("OzReminderTasks.react"),M):c("React").createElement(c("OzReminders.react"),M)):null),c("React").createElement("div",{className:"_5l_-"+(C?" _11_w":"")+(C?" _5mt9":"")},c("React").createElement("div",{className:"_5l__"},c("React").createElement("div",{className:"_4fj7"},I?c("React").createElement(c("OzIntent.react"),{intent:I,key:"intent-"+I.get("id"),location:w.get("location")||j(),repNames:x,requirements:this.props.requirements,timelineGK:C,thread:w}):null,C&&K?c("React").createElement(c("OzTaskShow.react"),{key:"task-"+K.get("id"),location:w.get("location")||j(),onCancel:this._handleCancelTask,onComplete:this._handleCompleteTask,onSave:this._handleSaveTask,onOpen:this._handleOpenTask,task:K}):L?c("React").createElement(c("OzEventShow.react"),{key:"event-"+L.get("id"),activeIntent:I,event:L}):null)),!C&&c("React").createElement("div",null,c("React").createElement(c("OzThreadNote.react"),{key:c("OzHelpers").threadID(w),thread:w,requirements:this.props.requirements}),c("React").createElement(c("OzThreadMeta.react"),{thread:w,repNames:x}),c("React").createElement(s,{onOwnerChange:this.props.onOwnerChange,humans:this.props.humans,reps:this.props.reps,thread:w})))),C&&c("React").createElement("div",{className:"_5mtb"},c("React").createElement("div",null,c("React").createElement(c("OzThreadMeta.react"),{thread:w,repNames:x}),c("React").createElement(s,{onOwnerChange:this.props.onOwnerChange,humans:this.props.humans,reps:this.props.reps,thread:w})),c("React").createElement(c("OzThreadNote.react"),{key:c("OzHelpers").threadID(w),thread:w,timeline:C,requirements:this.props.requirements})))},_activeTab:function u(){return this.state.activeTab||p},_activeTabForIntent:function u(){var v=this.state.activeThread.get("activeIntent"),w=this.props.thread.get("intents",k()),x=v?w.find(function(y){return y.get("id")===v}):null;if(x)if(c("OzHelpers").isClosedIntent(x))return q;else return p},_handleTabChange:function u(v){var w=v[0],x=v[1];this.setState({activeTab:x})},_handleSaveTask:function u(v){return c("OzAPI").editTask(c("OzHelpers").threadID(this.props.thread),v)},_handleCompleteTask:function u(v){return c("OzAPI").completeTask(c("OzHelpers").threadID(this.props.thread),v)},_handleCancelTask:function u(v){var w=arguments.length<=1||arguments[1]===undefined?false:arguments[1];return c("OzAPI").cancelTask(c("OzHelpers").threadID(this.props.thread),v,w)},_handleOpenTask:function u(v){return c("OzAPI").openTask(c("OzHelpers").threadID(this.props.thread),v)}}),s=c("OzHelpers").pure(function(u){var v=u.onOwnerChange,w=u.humans,x=u.reps,y=u.thread,z=y,A=c("OzHelpers").nameOrId(z.get("last-owner")).split(" ")[0];return c("React").createElement("div",{className:"_5m00"},x&&!x.isEmpty()?c("React").createElement(t,{onChange:v,value:z.getIn(["owner","id"])||o,reps:x,humans:w}):null,c("React").createElement("span",{className:"_5m01"},A?"Last owner: "+A:null))}),t=c("OzHelpers").pure(function(u){__p&&__p();var v=u.reps,w=u.humans,x=u.value,y=u.onChange,z=v.toSeq().filter(function(D){return c("OzHumans").isActive(w.get(D.get("fbid")))}).sortBy(function(D){return D.get("name")}).map(function(D){var E=D.get("fbid"),C=D.get("is-coach",false)?"_5m02":"";return c("React").createElement(i,{key:E,value:E},c("React").createElement("span",{className:C},D.get("name")))}),A=z.get(x);z=z.valueSeq();if(!A){var B=v.get(x,j()),C=B.get("is-coach",false)?"_5m02":"";z=z.toList().unshift(c("React").createElement(i,{key:"current",value:x},c("React").createElement("span",{className:C},B.get("name","None"))))}return c("React").createElement(c("XUISelector.react"),{size:"medium",value:x,onChange:y,maxheight:500},z)});f.exports=c("OzWrapper.react")(r)}),null);
__d("OzTop.react",["cx","OzAPI","OzHelpers","MessengerFlexScrollableArea.react","React","relativeTimeString.atlas","XUITextInput.react","SRTAdvancedDataTable.react","escapeRegex","ObjectSort","ReactRouter"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("ReactRouter").Link,l=[{id:"priority",label:"Priority",sortable:true,comparator:function n(o,p){return c("OzHelpers").compareBools(o.priority,p.priority)},cellRenderer:function n(o){return c("React").createElement("span",{className:o?"_1nnl":""},o?"yes":"no")}},{id:"trainer",label:"Trainer",sortable:true,comparator:c("ObjectSort").getStringSortFunction("trainer")},{id:"trainer-load",label:"Load",sortable:true,comparator:c("ObjectSort").getReverseNumericSortFunction("trainer-load"),isNumeric:true,cellRenderer:function n(o){return c("React").createElement("div",{className:o>3?"_1nnl":""},o?o:"Not present")}},{id:"trainer-team",label:"Team",sortable:true,comparator:c("ObjectSort").getStringSortFunction("trainer-team")},{id:"user-name",label:"User name",sortable:true,comparator:c("ObjectSort").getStringSortFunction("user-name"),cellRenderer:function n(o,p,q){return c("React").createElement(k,{target:"blank",to:c("OzHelpers").threadPath({threadid:q["user-id"]})},o)}},{id:"external",label:"External",sortable:true,comparator:function n(o,p){return c("OzHelpers").compareBools(o.external,p.external)},cellRenderer:function n(o){return c("React").createElement("span",null,o?"external":"internal")}},{id:"vip",label:"Vip",sortable:true,comparator:function n(o,p){return c("OzHelpers").compareBools(o.vip,p.vip)},cellRenderer:function n(o){return c("React").createElement("span",null,o?"yes":"no")}},{id:"name",label:"Type",sortable:true,comparator:c("ObjectSort").getStringSortFunction("name"),cellRenderer:function n(o,p,q){return c("React").createElement(k,{target:"blank",to:c("OzHelpers").threadPath({threadid:q["user-id"],intentid:q.id})},o)}},{id:"blocked",label:"Status",sortable:true,comparator:function n(o,p){return c("OzHelpers").compareBools(o.blocked,p.blocked)},cellRenderer:function n(o){return c("React").createElement("span",null,o?"waiting":"open")}},{id:"created-at",label:"Open",sortable:true,comparator:c("ObjectSort").getReverseNumericSortFunction("created-at"),isNumeric:true,cellRenderer:function n(o){return c("relativeTimeString.atlas")(o,true)}},{id:"ir",label:"IR",sortable:true,comparator:c("ObjectSort").getReverseNumericSortFunction("ir"),isNumeric:true,cellRenderer:function n(o,p,q){return c("React").createElement("div",null,o===0?"**":o)}},{id:"cr",label:"Current CR (s)",sortable:true,comparator:c("ObjectSort").getReverseNumericSortFunction("cr"),isNumeric:true,cellRenderer:function n(o){return c("React").createElement("div",null,o===0?"**":o)}}];i=babelHelpers.inherits(m,c("React").Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.state={items:[],filterText:""},this.$OzTop2=function(s){var t=s.trim().replace(/ +/g," ").split(" "),u=new RegExp(t.map(c("escapeRegex")).join(".* .*"),"i");return function(v){return u.test(v.name)||u.test(v["user-name"])||u.test(v["trainer-team"])||u.test(v.trainer)||u.test(v["user-id"])||u.test(v.id)}},this.$OzTop3=function(event){this.setState({filterText:event.target.value});this.refs.theTable.setFilter(this.$OzTop2(event.target.value))}.bind(this),o}m.prototype.componentWillMount=function(){var n=function(){return c("OzAPI").topIntents().then(function(o){return this.setState({items:o.toJS()})}.bind(this))}.bind(this);n();this.$OzTop1=setInterval(n,30*1e3)};m.prototype.componentWillUnmount=function(){clearInterval(this.$OzTop1)};m.prototype.render=function(){return c("React").createElement("div",null,c("React").createElement("div",null,c("React").createElement("label",null,"Filter:"," ",c("React").createElement(c("XUITextInput.react"),{onChange:this.$OzTop3,value:this.state.filterText})),c("React").createElement("span",null,this.state.items.length," open intents")),c("React").createElement(c("MessengerFlexScrollableArea.react"),null,c("React").createElement(c("SRTAdvancedDataTable.react"),{ref:"theTable",rowKeyField:"id",outerBorder:true,columns:l,rows:this.state.items,enableSelection:false})))};f.exports=m}),null);
__d("OzTrainerDashboard.react",["cx","OzHelpers","relativeTimeString.atlas","immutable","OzButton.react","OzHumans","OzStores","OzImmutablePureRenderMixin","React","Reflux","XUITable.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("immutable").Map,j=c("OzStores").HumanStore,k=c("React").PropTypes,l=c("React").createClass({displayName:"OzTrainerDashboard",mixins:[c("Reflux").connect(j,"humans")],contextTypes:{router:k.object.isRequired},render:function q(){return c("React").createElement(m,{onThreadSelect:this._handleThreadSelect,humans:this.state.humans,reps:this.props.reps})},_handleThreadSelect:function q(r){this.context.router.push("inbox/"+r)}}),m=c("React").createClass({displayName:"Main",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onThreadSelect:k.func.isRequired,humans:k.instanceOf(i).isRequired,reps:k.instanceOf(i).isRequired},render:function q(){return c("React").createElement("div",{className:"_10cd"},c("React").createElement(c("XUITable.react"),null,c("React").createElement("thead",null,c("React").createElement("tr",null,c("React").createElement("th",null,"Trainer"),c("React").createElement("th",null,"Load"),c("React").createElement("th",null,"Status"),c("React").createElement("th",null,"Team"),c("React").createElement("th",null,"Link to Thread"))),c("React").createElement("tbody",null,this._getHumans().map(function(r){return c("React").createElement(n,{key:r.get("id"),onSelect:this._handleThreadSelect,human:r,rep:this.props.reps.get(r.get("id"))})}.bind(this)))))},_getHumans:function q(){var r=this.props,s=r.humans,t=r.reps;return s.sortBy(function(u){return t.getIn([u.get("id"),"name"])}).valueSeq()},_handleThreadSelect:function q(r){this.props.onThreadSelect(r.get("tid"))}}),n=c("React").createClass({displayName:"DashboardRow",mixins:[c("OzImmutablePureRenderMixin")],propTypes:{onSelect:k.func.isRequired,human:k.instanceOf(i).isRequired,rep:k.instanceOf(i)},render:function q(){var r=this.props,s=r.onSelect,t=r.human,u=r.rep;return c("React").createElement("tr",null,c("React").createElement("td",null,o(u,t)),c("React").createElement("td",null,t.get("load")),c("React").createElement("td",null,p(t)),c("React").createElement("td",null,t.get("team")),c("React").createElement("td",null,t.get("tid")?c("React").createElement(c("OzButton.react"),{onClick:function v(){return s(t)}},"See Thread"):null))}});function o(q,r){var s=q&&q.get("name")||"Unknown name";return""+s+(c("OzHumans").isCoach(r)?" (Coach)":"")}function p(q){var r=c("relativeTimeString.atlas")(+c("OzHelpers").serverNow()-q.get("inactive-ms",0),true),s=c("OzHumans").isActive(q)?"Active":"Away ("+r+")";return c("OzHumans").inCoachMode(q)?s+" | In Coach Mode":s}f.exports=l}),null);
__d("OzMount",["invariant","OzAPI","OzHelpers","promiseFinally","immutable","Oz.react","OzActions","OzAll.react","OzConfig","OzFeedbackDashboard.react","OzInbox.react","OzInboxShow.react","OzMerchants.react","OzStores","OzThreadPanel.react","OzTop.react","OzTrainerDashboard.react","React","ReactDOM","ReactRouter","URI","OzTwilio","OzServerTime","OzPerformance"],(function a(b,c,d,e,f,g,h){__p&&__p();c("OzTwilio");var i=c("ReactRouter").Route,j=c("ReactRouter").IndexRoute,k=c("ReactRouter").browserHistory,l=c("ReactRouter").match,m=c("ReactRouter").Router,n=c("ReactRouter").Redirect,o=c("OzStores").CalendarEventStore,p={mount:function x(y,z){__p&&__p();z=babelHelpers["extends"]({},z,u());c("OzPerformance").init();c("OzConfig").setConfig(c("immutable").fromJS(z));c("OzHelpers").info("[config]",z);var A=void 0,B=v(c("Oz.react"),{rev:z.rev,uid:z.uid,version:z.API_VERSION,skipToto:z.skipToto==="true",onUnmount:function K(){A&&A()}}),C=function C(K){var L=K.threadid,M=K.intentid,N=K.taskid,O=K.eventid;c("OzHelpers").info("[mount] storeParams",L,M,N,O);var P=M?parseInt(M,10):null;c("OzActions").activateThread({threadID:L,intentID:P,taskID:N?parseInt(N,10):null,eventID:O?parseInt(O,10):null});L&&c("OzAPI").threadFocus(L,P);if(!o.data.get(L))c("OzAPI").fetchCalendar(L)},D=w(c("OzAPI").thread,500),E={},F=function F(K,L,M){__p&&__p();c("OzHelpers").info("[mount] onThreadEnter",K);C(K.params);var N=K.params,O=N.threadid,P=N.intentid;if(O)D(O);if(P)M();else{c("OzHelpers").info("[mount] no intent id; computing");if(O&&E[O]){c("OzHelpers").info("[mount] loading intent from history",O,E[O]);L(c("OzHelpers").threadPath({threadid:O,intentid:E[O]}));M()}else if(O)c("promiseFinally")(D(O).then(function(Q){c("OzHelpers").info("[mount] missing intent; looking for last created");var R=c("OzHelpers").openIntents(Q).maxBy(function(S){return S.get("created-at")});if(R){c("OzHelpers").info("[mount] missing intent; using last created",O,R.get("id"));L(c("OzHelpers").threadPath({threadid:O,intentid:R.get("id")}))}else c("OzHelpers").info("[mount] no intent to pick",O)}),function(Q){return M()}).done();else{c("OzHelpers").warn("[mount] somehow missing threadid",K);M()}}},G=function G(K){c("OzHelpers").info("[mount] onIntentEnter",K);C(K.params);var L=K.params,M=L.threadid,N=L.intentid,O=N?parseInt(N,10):null;M&&O&&(E[M]=O);O&&c("OzAPI").handledEvents(O);c("OzConfig").ConfigStore.data.getIn(["GK","timeline"])&&M&&O&&c("OzAPI").tasksForIntent(O,M)},H=function H(K){c("OzHelpers").info("[mount] onThreadLeave",K);c("OzActions").activateThread({threadID:null,intentID:null,taskID:null})},I=c("React").createElement(i,{component:B},c("React").createElement(i,{path:"/",component:c("OzInbox.react")},c("React").createElement(i,{path:"/inbox/:threadid",component:c("OzInboxShow.react"),onEnter:F,onLeave:H},c("React").createElement(j,{onEnter:function K(L){var M=L.params;return C(M)},component:c("OzThreadPanel.react")}),c("React").createElement(i,{path:"intent/:intentid",component:c("OzThreadPanel.react"),onEnter:G}),c("React").createElement(i,{path:"intent/:intentid/task/:taskid",component:c("OzThreadPanel.react"),onEnter:G}),c("React").createElement(i,{path:"intent/:intentid/event/:eventid",component:c("OzThreadPanel.react"),onEnter:G}))),c("React").createElement(i,{path:"/all",component:c("OzAll.react")}),c("React").createElement(i,{path:"/merchants",component:c("OzMerchants.react")}),c("React").createElement(i,{path:"/top",component:c("OzTop.react")}),c("React").createElement(i,{path:"/feedback",component:c("OzFeedbackDashboard.react")}),c("React").createElement(i,{path:"/trainers",component:c("OzTrainerDashboard.react")}),c("React").createElement(n,{from:"/inbox",to:"/"})),J=function J(){c("ReactDOM").render(c("React").createElement(m,{history:k,routes:I}),y)};J();q(function(){__p&&__p();var K=c("OzConfig").getStaticConfig("skipSky")==="true",L=c("OzConfig").getStaticConfig("skipAPIInit")==="true";c("OzHelpers").info("[sky] connecting to "+z.skyTopic);if(K)c("OzActions").updateLoadingState({component:"skywalker",state:"loading",skip:true});var M=function M(O){__p&&__p();if(typeof A==="function")A();A=c("OzAPI").realTime(z.skyTopic,function(P,Q,R){__p&&__p();if(P){c("OzHelpers").warn("[sky] could not connect: "+P);if(O>0)return M(O-1);else c("OzActions").updateLoadingState({component:"skywalker",state:"failed",error:P,skip:K})}else{c("OzHelpers").info("[sky] connected to "+z.skyTopic+": "+Q.t,Q);c("OzAPI").repsSync();c("OzActions").updateLoadingState({component:"skywalker",state:"loaded",result:{data:Q,token:R},skip:K})}})};M(3);var N=function N(O,P,Q){Q().then(function(R){c("OzActions").updateLoadingState({component:P,state:"loaded",result:R,skip:L})})["catch"](function(R){if(O>0)N(O-1,P,Q);else c("OzActions").updateLoadingState({component:P,state:"failed",error:R,skip:L})}).done()};N(3,"init",c("OzAPI").init);N(3,"wit-intents",c("OzAPI").witIntents);N(3,"merchants",c("OzAPI").merchants);N(3,"humans",c("OzAPI").humans);N(3,"requirements",c("OzAPI").requirements);c("OzServerTime").setup()})}},q=function q(x){__p&&__p();var y;if(window.loaded)x();else(function(){var z=window.onload;if(typeof z=="function")window.onload=function(){try{z.apply(undefined,arguments)}catch(A){c("OzHelpers").log("Exception on window,inload",A)}x.apply(undefined,arguments)};else window.onload=x})()},r=/^ozcfg(.+)/;function s(){var x=new(c("URI"))(window.location.href).getQueryData();Object.keys(x).forEach(function(y){if(r.test(y))localStorage.setItem(y,x[y])})}function t(){var x,y,z,A={};for(x=0;x<localStorage.length;x++){y=localStorage.key(x);z=y.match(r);if(z&&z.length)A[z[1]]=localStorage.getItem(y)}return A}function u(){__p&&__p();s();var x=t(),y,z=document.location.hostname;if(z==="www.oz.wit.ai")y={skyTopic:"oz/all",env:"prod",scubaCategory:"oz_console",PAGE_ID:"881263441913087",API_PATH:"https://www.oz.wit.ai/api"};else if(z==="intern.oz.wit.ai"||!x.API_PATH)y={skyTopic:"oz-staging/all",env:"staging",scubaCategory:"oz_console_dev",PAGE_ID:"506060876211905",API_PATH:"https://intern.oz.wit.ai/api"};else{var A=z.split(".")[1];y={skyTopic:"oz-dev/"+A,env:"dev",scubaCategory:"oz_console_dev",PAGE_ID:"1579802578966277"}}y=babelHelpers["extends"]({},y,x,{API_VERSION:"20151027"});y.API_PATH||h(0);return y}function v(x,y){__p&&__p();var z,A;return A=z=function(){__p&&__p();var B,C;B=babelHelpers.inherits(D,c("React").Component);C=B&&B.prototype;D.prototype.render=function(){"use strict";return c("React").createElement(x,babelHelpers["extends"]({},y,this.props))};function D(){"use strict";B.apply(this,arguments)}return D}(),z.displayName="Curried"+x.displayName,A}var w=function w(x,y){__p&&__p();var z={},A={};return function(B){if(Date.now()-(z[B]||0)<=y&&A[B]){c("OzHelpers").info("[mount/throttle] using result",B,A[B]);return A[B]}else{z[B]=Date.now();c("OzHelpers").info("[mount/throttle] running!",B);return A[B]=x(B)}}};f.exports=p}),null);