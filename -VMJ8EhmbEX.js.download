if (self.CavalryLogger) { CavalryLogger.start_js(["IEuJO"]); }

__d("FBRTCStatsHelpers",["FBRTCLogger"],(function a(b,c,d,e,f,g){__p&&__p();var h=function h(j){if(j==="host"||j==="local")return"local";if(j==="serverreflexive")return"srflx";if(j==="peerreflexive")return"prflx";if(j==="relayed"||j==="relay")return"relay";return"unknown"},i={connectionType:function j(k,l,m,n){return["l:",h(k),"-",l,";","r:",h(m),"-",n].join("")},logReport:function j(k){var l=c("FBRTCLogger").getInstance(),m=["connectionType","audioCodec","videoCodec","audioRtt","videoRtt","audioPacketsLost","videoPacketsLost","audioBytesSent","videoBytesSent","audioPacketsSent","videoPacketsSent"];for(var n=0;n<m.length;n++){var o=k[m[n]].call(k);l.logToConsole(m[n]+" => "+o)}}};f.exports=i}),null);
__d("FBRTCChromeStatsReport",["FBRTCStatsHelpers"],(function a(b,c,d,e,f,g){__p&&__p();var h=function h(j,k){return parseInt(j.stat(k),10)};function i(){"use strict";this.$FBRTCChromeStatsReport1=[];this.$FBRTCChromeStatsReport2=null;this.$FBRTCChromeStatsReport3=null;this.$FBRTCChromeStatsReport4=null;this.$FBRTCChromeStatsReport5=null;this.$FBRTCChromeStatsReport6=null}i.prototype.parseReport=function(j){"use strict";__p&&__p();j.result().forEach(function(k){__p&&__p();if(k.type==="googCandidatePair"&&k.stat("googActiveConnection")==="true")this.$FBRTCChromeStatsReport1.push(k);if(this.$FBRTCChromeStatsReport7(k))this.$FBRTCChromeStatsReport2=k;if(this.$FBRTCChromeStatsReport8(k))this.$FBRTCChromeStatsReport3=k;if(this.$FBRTCChromeStatsReport9(k))this.$FBRTCChromeStatsReport4=k;if(this.$FBRTCChromeStatsReport10(k))this.$FBRTCChromeStatsReport5=k;if(k.type==="VideoBwe")this.$FBRTCChromeStatsReport6=k}.bind(this))};i.prototype.isConnected=function(){"use strict";return true};i.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,"googRtt")};i.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"googRtt")};i.prototype.audioCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return"unknown";return this.$FBRTCChromeStatsReport2.stat("googCodecName")};i.prototype.videoCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return"unknown";return this.$FBRTCChromeStatsReport3.stat("googCodecName")};i.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,"packetsLost")};i.prototype.setVideoPacketsLost=function(j){"use strict";this.$FBRTCChromeStatsReport11=j};i.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;if(this.$FBRTCChromeStatsReport11)return this.$FBRTCChromeStatsReport11;return h(this.$FBRTCChromeStatsReport3,"packetsLost")};i.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,"bytesSent")};i.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"bytesSent")};i.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,"packetsSent")};i.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"packetsSent")};i.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"googFrameRateSent")};i.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCChromeStatsReport3)return 0;return h(this.$FBRTCChromeStatsReport3,"googFrameRateInput")};i.prototype.connectionType=function(){"use strict";var j="unknown",k="unknown",l="unknown";for(var m=0;m<this.$FBRTCChromeStatsReport1.length;m++){var n=this.$FBRTCChromeStatsReport1[m];k=n.stat("googLocalCandidateType");l=n.stat("googRemoteCandidateType");j=n.stat("googTransportType")}return c("FBRTCStatsHelpers").connectionType(k,j,l,j)};i.prototype.$FBRTCChromeStatsReport7=function(j){"use strict";return j.type==="ssrc"&&j.names().indexOf("audioInputLevel")>-1};i.prototype.$FBRTCChromeStatsReport8=function(j){"use strict";return j.type==="ssrc"&&j.names().indexOf("googFrameHeightInput")>-1};i.prototype.$FBRTCChromeStatsReport9=function(j){"use strict";return j.type==="ssrc"&&j.names().indexOf("audioOutputLevel")>-1};i.prototype.$FBRTCChromeStatsReport10=function(j){"use strict";return j.type==="ssrc"&&j.names().indexOf("googFrameHeightReceived")>-1};f.exports=i}),null);
__d("FBRTCMozStatsReport",["Map","FBRTCLogger","FBRTCStatsHelpers"],(function a(b,c,d,e,f,g){__p&&__p();function h(){"use strict";this.$FBRTCMozStatsReport1=null;this.$FBRTCMozStatsReport2=null;this.$FBRTCMozStatsReport3=null;this.$FBRTCMozStatsReport4=null;this.candidates=new(c("Map"))();this.candidatePairs=new(c("Map"))();this.$FBRTCMozStatsReport5=c("FBRTCLogger").getInstance()}h.prototype.parseReport=function(i){"use strict";__p&&__p();i.forEach(function(j){__p&&__p();switch(j.type){case"inboundrtp":if(!j.remoteId)break;var k={inbound:j,outbound:i[j.remoteId]};if(j.isRemote)if(Object.prototype.hasOwnProperty.call(k.outbound,"framerateMean"))this.$FBRTCMozStatsReport2=k;else this.$FBRTCMozStatsReport1=k;else if(Object.prototype.hasOwnProperty.call(k.outbound,"framerateMean"))this.$FBRTCMozStatsReport4=k;else this.$FBRTCMozStatsReport3=k;break;case"outboundrtp":break;case"candidatepair":if(j.state==="succeeded")this.candidatePairs.set(j.id,j);break;case"localcandidate":this.candidates.set(j.id,j);break;case"remotecandidate":this.candidates.set(j.id,j);break;default:this.$FBRTCMozStatsReport5.logToConsole("unrecognized webrtc stats type "+j.type);break}}.bind(this))};h.prototype.isConnected=function(){"use strict";return!!this.$FBRTCMozStatsReport1};h.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.mozRtt};h.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.mozRtt};h.prototype.audioCodec=function(){"use strict";return"opus"};h.prototype.videoCodec=function(){"use strict";return"VP8"};h.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.packetsLost};h.prototype.setVideoPacketsLost=function(i){"use strict"};h.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.packetsLost};h.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.bytesSent};h.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.bytesSent};h.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.packetsSent};h.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.packetsSent};h.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.framerateMean};h.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCMozStatsReport2)return 0;return 30};h.prototype.connectionType=function(){"use strict";var i="unknown",j="unknown",k="unknown",l="unknown";this.candidatePairs.forEach(function(m){var n=this.candidates.get(m.localCandidateId),o=this.candidates.get(m.remoteCandidateId);i=n.transport;k=o.transport;j=n.candidateType;l=o.candidateType}.bind(this));return c("FBRTCStatsHelpers").connectionType(j,i,l,k)};f.exports=h}),null);
__d("FBRTCStatsReportFactory",["FBRTCMozStatsReport","FBRTCChromeStatsReport","FBRTCLogger","FBRTCVersionDetection"],(function a(b,c,d,e,f,g){__p&&__p();var h=function h(k,l){k.getStats(null,function(m){var n=new(c("FBRTCMozStatsReport"))();n.parseReport(m);l(n)},function(){c("FBRTCLogger").getInstance().logToConsole("Firefox stats collection failed")})},i=function i(k,l){k.getStats(function(m){var n=new(c("FBRTCChromeStatsReport"))();n.parseReport(m);l(n)})},j={getStats:function k(l,m){if(c("FBRTCVersionDetection").isFirefox())h(l,m);if(c("FBRTCVersionDetection").isChrome())i(l,m)}};f.exports=j}),null);
__d("FBRTCCallConnection",["invariant","Promise","Base64","FBRTCConfig","FBRTCConstants","FBRTCExperiment","FBRTCLogger","FBRTCPCConfig","FBRTCSdpUtils","FBRTCStatsReportFactory","Queue","RTCConfig","UserAgent","mixInEventEmitter"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=3e5,j=12e3,k=1e4,l="data",m=1e3,n=100;function o(){"use strict";__p&&__p();this.$FBRTCCallConnection1=c("FBRTCLogger").getInstance();this.$FBRTCCallConnection2();this.$FBRTCCallConnection3=null;this.$FBRTCCallConnection4=null;this.$FBRTCCallConnection5=new(c("Queue"))({interval:1,processor:this.$FBRTCCallConnection6.bind(this)});this.$FBRTCCallConnection7=null;this.$FBRTCCallConnection8=null;this.$FBRTCCallConnection9=false;this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection11=[];this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection13="passive";this.$FBRTCCallConnection14=true;this.$FBRTCCallConnection15=0;this.$FBRTCCallConnection16={};this.$FBRTCCallConnection17=null}o.prototype.init=function(p){"use strict";this.$FBRTCCallConnection1.logToConsole("Creating a new peer connection with: "+JSON.stringify(c("FBRTCPCConfig").getConfig())+", "+JSON.stringify(c("FBRTCPCConfig").getConstraints()));this.$FBRTCCallConnection18=p};o.prototype.setStream=function(p){"use strict";this.$FBRTCCallConnection18=p};o.prototype.addScreenStream=function(p){"use strict";if(p&&p.getStream()){this.$FBRTCCallConnection1.logToConsole("Screen stream added");this.$FBRTCCallConnection19=p}else this.$FBRTCCallConnection1.logToConsole("Trying to add invalid stream")};o.prototype.removeScreenStream=function(p){"use strict";if(p&&p.getStream()){this.$FBRTCCallConnection1.logToConsole("Screen stream removed");try{this.$FBRTCCallConnection3.removeStream(p.getStream())}catch(q){this.$FBRTCCallConnection1.logToConsole("Missing connection to remove stream from")}}else this.$FBRTCCallConnection1.logToConsole("Trying to remove an invalid stream");this.$FBRTCCallConnection19=null};o.prototype.setPeerSupportsVideo=function(p){"use strict";this.$FBRTCCallConnection14=p};o.prototype.$FBRTCCallConnection20=function(){"use strict";var p={};if(this.$FBRTCCallConnection18&&this.$FBRTCCallConnection18.hasStream()){var q=this.$FBRTCCallConnection18.hasVideoTracks()?c("FBRTCConstants").StreamType.AUDIO_VIDEO:c("FBRTCConstants").StreamType.AUDIO_ONLY;p[this.$FBRTCCallConnection18.getStreamId()]={type:q}}if(this.$FBRTCCallConnection19&&this.$FBRTCCallConnection19.hasStream())p[this.$FBRTCCallConnection19.getStreamId()]={type:c("FBRTCConstants").StreamType.SCREEN_CONTENT};return{streams:p}};o.prototype.$FBRTCCallConnection21=function(p){"use strict";this.$FBRTCCallConnection1.logToConsole("Setting new remote attributes: "+JSON.stringify(p));this.$FBRTCCallConnection17=p};o.prototype.getRemoteAttributesForStream=function(p){"use strict";var q=p&&this.$FBRTCCallConnection17&&this.$FBRTCCallConnection17.streams;return q&&q[p.id]};o.prototype.isScreenStream=function(p){"use strict";var q=this.getRemoteAttributesForStream(p);if(q){this.$FBRTCCallConnection1.logToConsole("Stream "+p.id+" type attribute is: "+q.type);return q.type===c("FBRTCConstants").StreamType.SCREEN_CONTENT}else{this.$FBRTCCallConnection1.logToConsole("No attributes found for stream "+p.id);return false}};o.prototype.getRemoteStreamsCount=function(){"use strict";return this.$FBRTCCallConnection3.getRemoteStreams().length};o.prototype.$FBRTCCallConnection22=function(p,q){"use strict";__p&&__p();this.$FBRTCCallConnection23(null);p.onaddstream=null;p.onremovestream=null;p.onicecandidate=null;p.oniceconnectionstatechange=null;this.$FBRTCCallConnection11=[];var r=q?5e3:1;setTimeout(function(){if(p.iceConnectionState!=="closed")p.close()},r)};o.prototype.$FBRTCCallConnection24=function(){"use strict";__p&&__p();if(this.$FBRTCCallConnection3)this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,true);var p=new this.nativePeerConnection(c("FBRTCPCConfig").getConfig(),c("FBRTCPCConfig").getConstraints());this.$FBRTCCallConnection13="passive";p.onaddstream=this.$FBRTCCallConnection25.bind(this);p.onremovestream=this.$FBRTCCallConnection26.bind(this);p.onicecandidate=this.$FBRTCCallConnection27.bind(this);p.oniceconnectionstatechange=this.$FBRTCCallConnection28.bind(this);p.addStream(this.$FBRTCCallConnection29());return p};o.prototype.$FBRTCCallConnection23=function(p){"use strict";__p&&__p();this.$FBRTCCallConnection5.stop(true);if(this.isDataChannelOpen())this.$FBRTCCallConnection4.close();this.$FBRTCCallConnection4=p;if(!p)return;this.$FBRTCCallConnection4.onopen=this.$FBRTCCallConnection30.bind(this);this.$FBRTCCallConnection4.onclose=this.$FBRTCCallConnection31.bind(this);this.$FBRTCCallConnection4.onerror=this.$FBRTCCallConnection32.bind(this);this.$FBRTCCallConnection4.onmessage=this.$FBRTCCallConnection33.bind(this)};o.prototype.$FBRTCCallConnection30=function(event){"use strict";this.$FBRTCCallConnection5.start();this.emit("data_opened",event)};o.prototype.$FBRTCCallConnection31=function(event){"use strict";this.$FBRTCCallConnection23(null);this.emit("data_closed",event)};o.prototype.$FBRTCCallConnection32=function(event){"use strict";this.$FBRTCCallConnection23(null);this.emit("data_error",event)};o.prototype.$FBRTCCallConnection33=function(event){"use strict";__p&&__p();var p=JSON.parse(event.data);if(p.batchID===undefined){this.emit("data_message",p.data);return}if(this.$FBRTCCallConnection16[p.batchID]===undefined)this.$FBRTCCallConnection16[p.batchID]=[];var q=this.$FBRTCCallConnection16[p.batchID];q.push(p.data);if(!p.isLast)return;var r=c("Base64").decodeObject(q.join(""));delete this.$FBRTCCallConnection16[p.batchID];this.emit("data_message",r.data)};o.prototype.isDataChannelOpen=function(){"use strict";return!!this.$FBRTCCallConnection4&&this.$FBRTCCallConnection4.readyState==="open"};o.prototype.sendData=function(p){"use strict";this.$FBRTCCallConnection5.enqueue({data:p})};o.prototype.$FBRTCCallConnection6=function(p){"use strict";__p&&__p();if(!this.isDataChannelOpen()){h(0);return}if(p.batchID!==undefined){this.$FBRTCCallConnection34(p);return}var q=JSON.stringify(p);try{this.$FBRTCCallConnection4.send(q);return}catch(r){}if(q.length<m){setTimeout(function(){this.$FBRTCCallConnection5.enqueue(p)}.bind(this),n);return}var s={batchID:this.$FBRTCCallConnection15.toString(),dataStr:c("Base64").encode(q)};this.$FBRTCCallConnection15++;this.$FBRTCCallConnection34(s)};o.prototype.$FBRTCCallConnection34=function(p){"use strict";__p&&__p();while(this.isDataChannelOpen()&&p.dataStr.length>0){var q={batchID:p.batchID,data:p.dataStr.slice(0,m)},r=p.dataStr.slice(m);if(r.length<=0)q.isLast=true;try{this.$FBRTCCallConnection4.send(JSON.stringify(q))}catch(s){setTimeout(function(){this.$FBRTCCallConnection5.enqueue(p)}.bind(this),n);return}p.dataStr=r}};o.prototype.createOffer=function(){"use strict";this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();this.$FBRTCCallConnection35();if(c("FBRTCConfig").shouldCreateDataChannel())this.$FBRTCCallConnection23(this.$FBRTCCallConnection3.createDataChannel(l));this.$FBRTCCallConnection36("offer");this.$FBRTCCallConnection13="active"};o.prototype.createSdpUpdate=function(p){"use strict";__p&&__p();if(p){var q=this.$FBRTCCallConnection3.getLocalStreams();for(var r=0;r<q.length;r++)this.$FBRTCCallConnection3.removeStream(q[r]);this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection18.getStream());if(this.$FBRTCCallConnection19)this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection19.getStream())}else this.$FBRTCCallConnection29();this.$FBRTCCallConnection36("sdp_update")};o.prototype.$FBRTCCallConnection29=function(){"use strict";__p&&__p();var p=this.$FBRTCCallConnection18.getStream();if(!this.$FBRTCCallConnection19){if(this.$FBRTCCallConnection37){this.$FBRTCCallConnection38(this.$FBRTCCallConnection37);this.$FBRTCCallConnection37=null}}else{this.$FBRTCCallConnection37=p.getVideoTracks()[0];var q=this.$FBRTCCallConnection19.getStream().getVideoTracks(),r=q[0];this.$FBRTCCallConnection38(r)}return p};o.prototype.$FBRTCCallConnection38=function(p){"use strict";var q=this.$FBRTCCallConnection18.getStream(),r=q.getVideoTracks(),s=r.length;while(s--)q.removeTrack(r[s]);q.addTrack(p)};o.prototype.$FBRTCCallConnection36=function(p){"use strict";this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection3.createOffer(this.$FBRTCCallConnection39.bind(this,p),this.$FBRTCCallConnection40.bind(this,"CreateOfferFailed"),this.$FBRTCCallConnection41())};o.prototype.$FBRTCCallConnection41=function(){"use strict";if(c("UserAgent").isBrowser("Chrome <= 37")||c("UserAgent").isBrowser("Opera <= 25"))return{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:this.$FBRTCCallConnection14}};return{offerToReceiveAudio:true,offerToReceiveVideo:this.$FBRTCCallConnection14}};o.prototype.end=function(){"use strict";this.$FBRTCCallConnection1.logToConsole("Ending connection...");if(this.$FBRTCCallConnection3){this.emit("isEnding");this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,false);this.$FBRTCCallConnection3=null}};o.prototype.onReceivedOfferSDP=function(p,q){"use strict";__p&&__p();this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();if(c("FBRTCConfig").shouldCreateDataChannel())this.$FBRTCCallConnection3.ondatachannel=function(event){this.$FBRTCCallConnection23(event.channel)}.bind(this);p=c("FBRTCSdpUtils").useDTLSOverCrypto(p);var r=new this.nativeSessionDescription({type:"offer",sdp:p});this.$FBRTCCallConnection21(q);r.sdp=c("FBRTCSdpUtils").addSetup(r.sdp);this.$FBRTCCallConnection3.setRemoteDescription(r,this.$FBRTCCallConnection42.bind(this,r),this.$FBRTCCallConnection40.bind(this,"SetRemoteOfferFailed"))};o.prototype.onReceivedAnswerSDP=function(p,q){"use strict";p=c("FBRTCSdpUtils").useDTLSOverCrypto(p);var r=new this.nativeSessionDescription({type:"answer",sdp:p});this.$FBRTCCallConnection21(q);this.$FBRTCCallConnection3.setRemoteDescription(r,this.$FBRTCCallConnection42.bind(this,r),this.$FBRTCCallConnection40.bind(this,"SetRemoteAnswerFailed"))};o.prototype.onReceivedSdpUpdate=function(p,q){"use strict";__p&&__p();if(this.$FBRTCCallConnection12)setTimeout(function(){this.onReceivedSdpUpdate(p,q)}.bind(this),200);switch(this.$FBRTCCallConnection3.signalingState){case"stable":this.$FBRTCCallConnection43(p,"offer",q);break;case"have-local-offer":p=c("FBRTCSdpUtils").setDtlsRole(p,this.$FBRTCCallConnection13);this.$FBRTCCallConnection43(p,"answer",q);break;case"have-remote-offer":setTimeout(function(){this.onReceivedSdpUpdate(p,q)}.bind(this),1e3);break;case"have-local-pranswer":case"have-remote-pranswer":break;case"closed":break}};o.prototype.$FBRTCCallConnection43=function(p,q,r){"use strict";var s=new this.nativeSessionDescription({type:q,sdp:p});this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection21(r);this.$FBRTCCallConnection3.setRemoteDescription(s,function(){this.$FBRTCCallConnection1.logToConsole("sdp update "+s.type+" set");if(this.$FBRTCCallConnection3&&s.type==="offer")this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection39.bind(this,"sdp_update"),this.$FBRTCCallConnection40.bind(this,"CreateSdpUpdateFailed"));else this.$FBRTCCallConnection12=false}.bind(this),this.$FBRTCCallConnection40.bind(this,"SetRemoteSdpUpdateFailed"))};o.prototype.onReceivedRemoteIceCandidate=function(p){"use strict";p.sdp=c("FBRTCSdpUtils").fixMobileIceSdp(p.sdp);var q=new this.nativeIceCandidate({sdpMLineIndex:p.label,candidate:p.sdp,sdpMid:p.sdp_mid});this.$FBRTCCallConnection3.addIceCandidate(q)};o.prototype.getStats=function(p){"use strict";c("FBRTCStatsReportFactory").getStats(this.$FBRTCCallConnection3,p)};o.prototype.getStatsNative=function(p){"use strict";__p&&__p();if(c("UserAgent").isBrowser("Firefox"))return new(c("Promise"))(function(q){return q(this.$FBRTCCallConnection3.getStats(p))}.bind(this));if(c("UserAgent").isBrowser("Chrome"))return new(c("Promise"))(function(q,r){this.$FBRTCCallConnection3.getStats(function(s){var t={};s.result().forEach(function(u){var v={id:u.id,type:u.type};u.names().forEach(function(w){return v[w]=u.stat(w)});t[v.id]=v});q(t)},p,r)}.bind(this));return c("Promise").reject(new Error("browser not supported"))};o.prototype.getCreatedIceCandidates=function(){"use strict";return this.$FBRTCCallConnection11};o.prototype.$FBRTCCallConnection39=function(p,q){"use strict";__p&&__p();this.$FBRTCCallConnection1.logToConsole("Created "+p+" sdp");if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole("_onSDPCreated: pc has been deallocated");return}if(!this.$FBRTCCallConnection14&&p==="sdp_update")q.sdp=c("FBRTCSdpUtils").disableVideo(q.sdp);q.sdp=c("FBRTCSdpUtils").addIceOptionToSdp(q.sdp,"fb-force-5245");q.sdp=c("FBRTCSdpUtils").replaceRTPSAVPFProfile(q.sdp);q.sdp=c("FBRTCSdpUtils").preferIsac(q.sdp);q.sdp=c("FBRTCSdpUtils").removeSdparta(q.sdp);q.sdp=c("FBRTCSdpUtils").removeUnknownRtpHeaderExtensions(q.sdp);var r=c("FBRTCExperiment").gen("rtc_browser_use_h264"),s=r.getParam("allow_h264","no");if(s!=="yes")q.sdp=c("FBRTCSdpUtils").removeH264(q.sdp);if(c("FBRTCConfig").isVCEndpointCall()&&c("RTCConfig").DeclareAudioNackCapabilityInSDPOffer&&c("UserAgent").isBrowser("Chrome >= 29"))q.sdp=c("FBRTCSdpUtils").addAudioNack(q.sdp);this.$FBRTCCallConnection3.setLocalDescription(q,function(){this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection1.logToConsole("Local "+p+" set");this.emit("sdpCreated",{type:p,sdp:q.sdp,attributes:this.$FBRTCCallConnection20()})}.bind(this),this.$FBRTCCallConnection40.bind(this,"SetLocalDescriptionFailed:"+p))};o.prototype.$FBRTCCallConnection42=function(p){"use strict";this.$FBRTCCallConnection1.logToConsole("Remote "+p.type+" set");if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole("_onRemoteDescriptionSet: pc has been deallocated");return}if(p.type==="offer")this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection39.bind(this,"answer"),this.$FBRTCCallConnection40.bind(this,"CreateAnswerFailed"));this.emit("remoteDescriptionSet")};o.prototype.$FBRTCCallConnection25=function(event){"use strict";this.$FBRTCCallConnection1.logToConsole("Remote stream added");this.emit("remoteStreamAdded",{stream:event.stream})};o.prototype.$FBRTCCallConnection26=function(event){"use strict";this.$FBRTCCallConnection1.logToConsole("Remote stream removed");this.emit("remoteStreamRemoved",{stream:event.stream})};o.prototype.$FBRTCCallConnection27=function(event){"use strict";if(event.candidate){this.$FBRTCCallConnection11.push(event.candidate);this.emit("localIceCandidateCreated",event.candidate)}};o.prototype.$FBRTCCallConnection28=function(event){"use strict";__p&&__p();var p=event.target.iceConnectionState;this.$FBRTCCallConnection1.logToConsole("Ice candidate state changed from "+this.$FBRTCCallConnection7+" to "+p);if(p===this.$FBRTCCallConnection7)return;this.$FBRTCCallConnection35();if(this.$FBRTCCallConnection44(p)){if(!this.$FBRTCCallConnection9){this.emit("connected");this.$FBRTCCallConnection9=true}}else if(p==="disconnected")this.$FBRTCCallConnection45();else if(p==="failed")this.$FBRTCCallConnection46();this.$FBRTCCallConnection7=p};o.prototype.$FBRTCCallConnection44=function(p){"use strict";return p==="completed"||p==="connected"};o.prototype.$FBRTCCallConnection45=function(){"use strict";__p&&__p();if(this.$FBRTCCallConnection44(this.$FBRTCCallConnection7)){var p=Date.now();if(this.$FBRTCCallConnection47-p>=i)this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection10=this.$FBRTCCallConnection10+1;this.$FBRTCCallConnection47=p;if(this.$FBRTCCallConnection10>=2)this.emit("connectionUnstable")}var q=this;this.$FBRTCCallConnection8=setTimeout(function(){q.emit("disconnected")},j)};o.prototype.$FBRTCCallConnection46=function(){"use strict";var p=this;this.$FBRTCCallConnection8=setTimeout(function(){var q={details:"Ice candidate state failed",endCallSubreason:"IceFailed"};p.emit("connectionError",q)},k)};o.prototype.$FBRTCCallConnection35=function(){"use strict";if(this.$FBRTCCallConnection8)clearTimeout(this.$FBRTCCallConnection8);this.$FBRTCCallConnection8=null};o.prototype.$FBRTCCallConnection40=function(p,q){"use strict";var r={details:q,endCallSubreason:p};this.emit("connectionError",r)};o.prototype.$FBRTCCallConnection2=function(){"use strict";__p&&__p();if(window.webkitRTCPeerConnection){this.$FBRTCCallConnection1.logToConsole("Using Chrome WebRTC APIs...");this.nativePeerConnection=window.webkitRTCPeerConnection;this.nativeIceCandidate=window.RTCIceCandidate;this.nativeSessionDescription=window.RTCSessionDescription}else{this.$FBRTCCallConnection1.logToConsole("Using Firefox WebRTC APIs...");this.nativePeerConnection=window.mozRTCPeerConnection;this.nativeIceCandidate=window.mozRTCIceCandidate;this.nativeSessionDescription=window.mozRTCSessionDescription}};c("mixInEventEmitter")(o,{remoteStreamAdded:true,remoteStreamRemoved:true,sdpCreated:true,localIceCandidateCreated:true,remoteDescriptionSet:true,connected:true,disconnected:true,connectionUnstable:true,connectionError:true,isEnding:true,data_opened:true,data_closed:true,data_error:true,data_message:true});f.exports=o}),null);
__d("FBRTCRttAggregator",[],(function a(b,c,d,e,f,g){__p&&__p();function h(){"use strict";this.$FBRTCRttAggregator1=[{count:0,ave:0},{count:0,ave:0},{count:0,ave:0},{count:0,ave:0}]}h.prototype.addRtt=function(i){"use strict";var j=this.$FBRTCRttAggregator1[this.$FBRTCRttAggregator2(i)];j.ave=this.$FBRTCRttAggregator3(j.ave,j.count,i);j.count+=1};h.prototype.toString=function(){"use strict";return[this.$FBRTCRttAggregator4("50",this.$FBRTCRttAggregator1[0]),this.$FBRTCRttAggregator4("100",this.$FBRTCRttAggregator1[1]),this.$FBRTCRttAggregator4("200",this.$FBRTCRttAggregator1[2]),this.$FBRTCRttAggregator4("0",this.$FBRTCRttAggregator1[3])].join("|")};h.prototype.$FBRTCRttAggregator4=function(i,j){"use strict";return i+"="+j.count+","+Math.round(j.ave)};h.prototype.$FBRTCRttAggregator2=function(i){"use strict";if(i<50)return 0;if(i<100)return 1;if(i<200)return 2;return 3};h.prototype.$FBRTCRttAggregator3=function(i,j,k){"use strict";return(i*j+k)/(j+1)};f.exports=h}),null);
__d("FBRTCStatsInterpreter",["FBRTCLogger"],(function a(b,c,d,e,f,g){__p&&__p();var h={rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1e3,bad_score_count:3};function i(j){"use strict";this.$FBRTCStatsInterpreter1=babelHelpers["extends"]({},h,j);this.$FBRTCStatsInterpreter2=c("FBRTCLogger").getInstance();this.$FBRTCStatsInterpreter3=0}i.prototype.interpretStats=function(j,k){"use strict";var l=j.videoRtt(),m=this.$FBRTCStatsInterpreter4(j),n=this.$FBRTCStatsInterpreter5(j,k),o=this.$FBRTCStatsInterpreter6(l,m,n);if(o>=this.$FBRTCStatsInterpreter1.score_threshold&&!this.isNetworkPoor())this.$FBRTCStatsInterpreter3+=1;if(o<this.$FBRTCStatsInterpreter1.score_threshold&&this.$FBRTCStatsInterpreter3>0)this.$FBRTCStatsInterpreter3-=1};i.prototype.isNetworkPoor=function(){"use strict";return this.$FBRTCStatsInterpreter3>=this.$FBRTCStatsInterpreter1.bad_score_count};i.prototype.$FBRTCStatsInterpreter6=function(j,k,l){"use strict";return j*this.$FBRTCStatsInterpreter1.rtt_weight+k*this.$FBRTCStatsInterpreter1.frr_weight+l*this.$FBRTCStatsInterpreter1.plr_weight};i.prototype.$FBRTCStatsInterpreter5=function(j,k){"use strict";__p&&__p();var l=void 0,m=void 0;if(k){l=j.videoPacketsLost()-k.videoPacketsLost();m=j.videoPacketsSent()-k.videoPacketsSent()}else{l=j.videoPacketsLost();m=j.videoPacketsSent()}if(l<0||m===0)return 0;return l/m};i.prototype.$FBRTCStatsInterpreter4=function(j){"use strict";if(j.videoFrameRateCaptured()===0)return 0;return 1-j.videoFrameRateSent()/j.videoFrameRateCaptured()};f.exports=i}),null);
__d("RingBuffer",[],(function a(b,c,d,e,f,g){__p&&__p();function h(i){"use strict";this.$RingBuffer1=i;this.$RingBuffer2=-1;this.$RingBuffer3=[]}h.prototype.add=function(i){"use strict";this.$RingBuffer2=(this.$RingBuffer2+1)%this.$RingBuffer1;this.$RingBuffer3[this.$RingBuffer2]=i};h.prototype.size=function(){"use strict";return this.$RingBuffer3.length};h.prototype.head=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer2]};h.prototype.tail=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer4()]};h.prototype.forEach=function(i){"use strict";for(var j=0;j<this.$RingBuffer3.length;j++){var k=(this.$RingBuffer2+1+j)%this.$RingBuffer3.length;i(this.$RingBuffer3[k])}};h.prototype.$RingBuffer4=function(){"use strict";return(this.$RingBuffer2+1)%this.$RingBuffer3.length};f.exports=h}),null);
__d("FBRTCCallConnectionMonitor",["RingBuffer","FBRTCRttAggregator","FBRTCStatsInterpreter","FBRTCConfig","mixInEventEmitter"],(function a(b,c,d,e,f,g){__p&&__p();var h=3e3,i=1,j=0,k=3;function l(m,n){"use strict";__p&&__p();this.$FBRTCCallConnectionMonitor1=new(c("FBRTCStatsInterpreter"))(c("FBRTCConfig").statsInterpreterConfig());this.$FBRTCCallConnectionMonitor2=new(c("FBRTCRttAggregator"))();this.$FBRTCCallConnectionMonitor3=new(c("FBRTCRttAggregator"))();this.$FBRTCCallConnectionMonitor4=m;this.$FBRTCCallConnectionMonitor5=n;this.$FBRTCCallConnectionMonitor6=null;this.$FBRTCCallConnectionMonitor7=[];this.$FBRTCCallConnectionMonitor8=new(c("RingBuffer"))(i);this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor4.addListener("connected",this.$FBRTCCallConnectionMonitor10,this);this.$FBRTCCallConnectionMonitor4.addListener("isEnding",this.$FBRTCCallConnectionMonitor11,this)}l.prototype.$FBRTCCallConnectionMonitor10=function(){"use strict";var m=this.$FBRTCCallConnectionMonitor12.bind(this);this.$FBRTCCallConnectionMonitor6=setInterval(m,h);this.$FBRTCCallConnectionMonitor12()};l.prototype.$FBRTCCallConnectionMonitor11=function(){"use strict";if(this.$FBRTCCallConnectionMonitor6!==null){this.$FBRTCCallConnectionMonitor12();clearInterval(this.$FBRTCCallConnectionMonitor6);this.$FBRTCCallConnectionMonitor6=null}};l.prototype.$FBRTCCallConnectionMonitor12=function(){"use strict";__p&&__p();this.$FBRTCCallConnectionMonitor4.getStats(function(m){__p&&__p();var n=void 0;if(this.$FBRTCCallConnectionMonitor8.size()>0){n=this.$FBRTCCallConnectionMonitor8.head();this.$FBRTCCallConnectionMonitor13(m,n)}if(this.$FBRTCCallConnectionMonitor7.length<j)this.$FBRTCCallConnectionMonitor7.push(m);if(n&&n.isConnected()&&!m.isConnected())this.$FBRTCCallConnectionMonitor9+=1;this.$FBRTCCallConnectionMonitor9>=k;if(m.isConnected()){this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor8.add(m);this.$FBRTCCallConnectionMonitor2.addRtt(m.audioRtt());this.$FBRTCCallConnectionMonitor3.addRtt(m.videoRtt());this.$FBRTCCallConnectionMonitor5.setPcStats(this.$FBRTCCallConnectionMonitor14());this.$FBRTCCallConnectionMonitor15(m,n)}}.bind(this))};l.prototype.$FBRTCCallConnectionMonitor14=function(){"use strict";var m=this.$FBRTCCallConnectionMonitor8.head();return{end:{conn_type:m.connectionType()},sender:{bytes:m.audioBytesSent(),codec:{0:m.audioCodec()},plost:m.audioPacketsLost(),psent:m.audioPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor2.toString()},video:{sender:{bytes:m.videoBytesSent(),codec:{0:m.videoCodec()},plost:m.videoPacketsLost(),psent:m.videoPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor3.toString()}}}};l.prototype.$FBRTCCallConnectionMonitor13=function(m,n){"use strict";if(n.videoPacketsLost()>m.videoPacketsLost())m.setVideoPacketsLost(n.videoPacketsLost())};l.prototype.$FBRTCCallConnectionMonitor15=function(m,n){"use strict";this.$FBRTCCallConnectionMonitor1.interpretStats(m,n);if(this.$FBRTCCallConnectionMonitor1.isNetworkPoor())this.emit("connectionPoor")};c("mixInEventEmitter")(l,{connectionPoor:true});f.exports=l}),null);
__d("FBRTCFullScreenController",["FBRTCCallControlActions","FBRTCStore"],(function a(b,c,d,e,f,g){__p&&__p();var h,i,j=void 0,k=void 0,l=document.documentElement;if(l.requestFullscreen){j=l.requestFullscreen.bind(l);k="fullscreenchange"}else if(l.msRequestFullscreen){j=l.msRequestFullscreen.bind(l);k="msfullscreenchange"}else if(l.mozRequestFullScreen){j=l.mozRequestFullScreen.bind(l);k="mozfullscreenchange"}else if(l.webkitRequestFullscreen){j=l.webkitRequestFullscreen.bind(l,Element.ALLOW_KEYBOARD_INPUT);k="webkitfullscreenchange"}var m=void 0;if(document.exitFullscreen)m=document.exitFullscreen.bind(document);else if(document.msExitFullscreen)m=document.msExitFullscreen.bind(document);else if(document.mozCancelFullScreen)m=document.mozCancelFullScreen.bind(document);else if(document.webkitExitFullscreen)m=document.webkitExitFullscreen.bind(document);h=babelHelpers.inherits(n,c("FBRTCStore"));i=h&&h.prototype;function n(){"use strict";i.constructor.call(this);this.$FBRTCFullScreenController1=this.$FBRTCFullScreenController2.bind(this);document.addEventListener(k,this.$FBRTCFullScreenController1)}n.prototype.destroy=function(){"use strict";document.removeEventListener(k,this.$FBRTCFullScreenController1);i.destroy.call(this)};n.prototype.$FBRTCFullScreenController2=function(){"use strict";this.__emitChange()};n.prototype.supportsFullScreen=function(){"use strict";return j&&m};n.prototype.isFullScreen=function(){"use strict";return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)};n.prototype.$FBRTCFullScreenController3=function(){"use strict";if(this.isFullScreen())m();else j()};n.prototype.__onDispatch=function(o){"use strict";switch(o.type){case c("FBRTCCallControlActions").Types.TOGGLE_FULL_SCREEN:this.$FBRTCFullScreenController3();break}};f.exports=new n()}),null);
__d("XVideoCallUserInfoController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/userinfo/",{user_id:{type:"Int",required:true}})}),null);
__d("FBRTCPeerInfo",["ix","XVideoCallUserInfoController","FBRTCUtils"],(function a(b,c,d,e,f,g,h){__p&&__p();function i(j){"use strict";this.peerID=j;this.peerPicUrl=null;this.selfPicUrl=h("28192");this.backgroundUrl=null;this.peerName="";this.peerShortName=null}i.prototype.fetch=function(j,k){"use strict";__p&&__p();var l=c("XVideoCallUserInfoController").getURIBuilder().setInt("user_id",this.peerID).getURI(),m=this;c("FBRTCUtils").sendServerRequest(l,function(n){m.peerPicUrl=n.payload.profile_pic_url;m.backgroundUrl=n.payload.cover_pic_url;m.peerName=n.payload.name;m.peerShortName=n.payload.peer_short_name;if(n.payload.self_profile_pic_url)m.selfPicUrl=n.payload.self_profile_pic_url;if(j)j()},k)};f.exports=i}),null);
__d("FBRTCScreenSharingUI",["FBRTCCallControlActions","FBRTCDispatcher","XScreenSharingController"],(function a(b,c,d,e,f,g){__p&&__p();var h=void 0,i={open:function j(k,l){window.getRemoteMediaStream=function(){return k};window.closeScreenSharingWindow=this._onUnload.bind(this);h=window.open(this._getUnsignedUri(l),"Screen Sharing",this._getWindowFeatures());if(window.focus&&this.isOpen())h.focus()},close:function j(){if(h){var k=null;if(h.opener&&!h.opener.closed)k=h.opener;h.close();h=null;if(k)k.postMessage({recipient:"SC_CONTENT_SCRIPT",type:"SC_RESET_PORT",text:"reset comm port"},"*")}},isOpen:function j(){return!!(h&&!h.closed)},_onUnload:function j(){i.close();c("FBRTCDispatcher").dispatch({type:c("FBRTCCallControlActions").Types.CLOSE_STANDALONE_SCREEN})},_getWindowFeatures:function j(){var k=screen.availLeft,l=screen.availTop,m=Math.min(960,screen.width-k),n=Math.min(540,screen.height-l),o={height:"height="+n.toString(),width:"width="+m.toString(),top:"top="+l.toString(),left:"left="+k.toString()};return["menubar=no","location=no","scrollbars=no","status=no","personalbar=no",o.height,o.width,o.top,o.left].join(",")},_getUnsignedUri:function j(k){return c("XScreenSharingController").getURIBuilder().setFBID("peer_id",k).getURI()}};f.exports=i}),null);
__d("FBRTCVideoDurationTracker",["performanceNow"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=0;function i(j){this.$FBRTCVideoDurationTracker2=j;this.$FBRTCVideoDurationTracker1=0;this.$FBRTCVideoDurationTracker4=h}i.prototype.startTracking=function(){if(this.$FBRTCVideoDurationTracker2.hasVideo())this.$FBRTCVideoDurationTracker4=this.$FBRTCVideoDurationTracker5();this.$FBRTCVideoDurationTracker3=this.$FBRTCVideoDurationTracker2.addListener("tracksChanged",function(){if(this.$FBRTCVideoDurationTracker2.hasVideo()&&!this.$FBRTCVideoDurationTracker4)this.$FBRTCVideoDurationTracker4=this.$FBRTCVideoDurationTracker5();else if(!this.$FBRTCVideoDurationTracker2.hasVideo()){this.$FBRTCVideoDurationTracker1=this.getDuration();this.$FBRTCVideoDurationTracker4=h}}.bind(this))};i.prototype.stopTracking=function(){this.$FBRTCVideoDurationTracker1=this.getDuration();this.$FBRTCVideoDurationTracker4=h;if(this.$FBRTCVideoDurationTracker3){this.$FBRTCVideoDurationTracker3.remove();this.$FBRTCVideoDurationTracker3=null}};i.prototype.getDuration=function(){if(this.$FBRTCVideoDurationTracker4!==h){var j=this.$FBRTCVideoDurationTracker5()-this.$FBRTCVideoDurationTracker4;return this.$FBRTCVideoDurationTracker1+j}return this.$FBRTCVideoDurationTracker1};i.prototype.$FBRTCVideoDurationTracker5=function(){return c("performanceNow")()};f.exports=i}),null);
__d("FBRTCCallModel",["Bootloader","CollabCallMessengerBrowserEventEnum","FBRTCAdminMessage","FBRTCCallConstants","FBRTCCallControlActions","FBRTCConfig","FBRTCFullScreenController","FBRTCLogger","FBRTCPCConfig","FBRTCPeerInfo","FBRTCScreenSharingUI","FBRTCStore","FBRTCStreamWrapper","FBRTCStruct","FBRTCVideoDurationTracker"],(function a(b,c,d,e,f,g){__p&&__p();var h,i;h=babelHelpers.inherits(j,c("FBRTCStore"));i=h&&h.prototype;function j(k){"use strict";__p&&__p();i.constructor.call(this);this.$FBRTCCallModel1=c("FBRTCLogger").getInstance();this.isCaller=k.isCaller;this.peerID=k.peerID;this.$FBRTCCallModel2=k.isAudioOnly;this.$FBRTCCallModel3=new(c("FBRTCPeerInfo"))(k.peerID);this.$FBRTCCallModel4=false;this.resetCallInfo(k.callID);this.$FBRTCCallModel5();this.$FBRTCCallModel6(true)}j.prototype.resetForReconnect=function(k){"use strict";this.isCaller=false;this.resetCallInfo(k);this.$FBRTCCallModel6(false)};j.prototype.fetchPeerInfo=function(){"use strict";var k=this,l=function l(){k.__emitChange()},m=function m(){k.$FBRTCCallModel1.logError(k.peerID,k.callID,"Failed to get remote photos")};this.$FBRTCCallModel3.fetch(l,m)};j.prototype.setSignalingExperiments=function(k){"use strict";if(k||k===[])this.$FBRTCCallModel7=k};j.prototype.supportsSdpUpdate=function(){"use strict";var k="sdp_update";return this.$FBRTCCallModel7.indexOf(k)!==-1&&c("FBRTCConfig").supportedSignalingExperiments().indexOf(k)!==-1};j.prototype.supportsMultipleStreamsPlanB=function(){"use strict";var k="multiple_streams_plan_b";return this.$FBRTCCallModel7.indexOf(k)!==-1&&c("FBRTCConfig").supportedSignalingExperiments().indexOf(k)!==-1};j.prototype.canPeerReceiveScreenSharing=function(){"use strict";return this.$FBRTCCallModel7.indexOf("screen_sharing")!==-1||c("FBRTCConfig").isVCEndpointCall()};j.prototype.onSDPMessageFromPeer=function(k){"use strict";this.isRemoteVideoSupported=k.isRemoteVideoSupported();this.isPeerOnMobile=k.isFromMobile();if(!this.isRemoteVideoSupported)this.localStream.setVideoEnabled(false)};j.prototype.$FBRTCCallModel5=function(){"use strict";__p&&__p();this.remoteStream=new(c("FBRTCStreamWrapper"))();this.localStream=new(c("FBRTCStreamWrapper"))();this.localStream.addListener("tracksChanged",function(){if(!this.$FBRTCCallModel8&&this.localStream.hasVideo())this.$FBRTCCallModel9=true;this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").LOCAL_STREAM_TRACKS_CHANGED,this.localStream.getStream());this.__emitChange()}.bind(this));this.$FBRTCCallModel11=new(c("FBRTCVideoDurationTracker"))(this.remoteStream);this.$FBRTCCallModel12=new(c("FBRTCVideoDurationTracker"))(this.localStream)};j.prototype.resetCallInfo=function(k){"use strict";__p&&__p();this.callID=k;this.$FBRTCCallModel13=new(c("FBRTCAdminMessage"))(this.peerID,k);this.startTime=new Date();this.endCallReason=null;this.endCallSubreason=null;this.isRemoteEnded=null;this.wasConnected=false;this.receivedNack=false;this.isRemoteVideoSupported=true;this.isPeerOnMobile=false;this.$FBRTCCallModel14=null;this.$FBRTCCallModel8=true;this.$FBRTCCallModel9=false;this.$FBRTCCallModel7=[];this.$FBRTCCallModel15=null};j.prototype.$FBRTCCallModel6=function(k){"use strict";this.selfViewOpen=true;this.uiState=j.UIState.INIT;this.__emitChange()};j.prototype.getLocalVideoDuration=function(){"use strict";return this.$FBRTCCallModel12.getDuration()};j.prototype.getRemoteVideoDuration=function(){"use strict";return this.$FBRTCCallModel11.getDuration()};j.prototype.setLocalStream=function(k){"use strict";this.localStream.setStream(k);this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").LOCAL_STREAM_SET,k)};j.prototype.setLocalScreenStream=function(k){"use strict";this.$FBRTCCallModel4=k!==null;this.selfViewOpen=true;this.$FBRTCCallModel14=k;this.__emitChange()};j.prototype.getLocalScreenStream=function(){"use strict";return this.$FBRTCCallModel14};j.prototype.setRemoteStream=function(k){"use strict";__p&&__p();this.remoteStream.setStream(k);this.remoteStream.once("streamStarted",function(){this.setStateFrom(j.UIState.CALL_CONNECTING,j.UIState.CALL_CONNECTED);this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_STARTED,this.remoteStream.getStream())}.bind(this));this.remoteStream.addListener("tracksChanged",function(){this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_TRACKS_CHANGED,this.remoteStream.getStream());this.__emitChange()}.bind(this));this.$FBRTCCallModel10(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_SET,k);this.__emitChange()};j.prototype.setRemoteScreenStream=function(k){"use strict";this.$FBRTCCallModel15=k;this.__emitChange()};j.prototype.getRemoteScreenStream=function(){"use strict";return this.$FBRTCCallModel15};j.prototype.canStartCall=function(k){"use strict";return this.localStream.hasStream()&&c("FBRTCPCConfig").turnIP};j.prototype.isAwaitingUserStart=function(){"use strict";return this.uiState===j.UIState.AWAITING_USER_START};j.prototype.canBeStartedByParentWindow=function(){"use strict";return this.uiState===j.UIState.INIT};j.prototype.isInProgress=function(){"use strict";return this.uiState>=j.UIState.CONTACTING&&this.uiState<j.UIState.CALL_ENDED};j.prototype.isUserMediaPending=function(){"use strict";return this.uiState===j.UIState.PENDING_LOCAL_MEDIA};j.prototype.isUserMediaDenied=function(){"use strict";return this.uiState===j.UIState.USER_MEDIA_DENIED};j.prototype.isConnected=function(){"use strict";return this.uiState===j.UIState.CALL_CONNECTED};j.prototype.isRemoteVideoActive=function(){"use strict";return this.uiState===j.UIState.CALL_CONNECTED&&this.remoteStream.hasVideo()};j.prototype.isEnded=function(){"use strict";return this.uiState>=j.UIState.CALL_ENDED};j.prototype.isAwaitingAnswer=function(){"use strict";return this.uiState==j.UIState.CONTACTING||this.uiState==j.UIState.RINGING};j.prototype.isFullScreen=function(){"use strict";return c("FBRTCFullScreenController").isFullScreen()};j.prototype.isScreenSharingEnabled=function(){"use strict";return this.$FBRTCCallModel4};j.prototype.peerPicUrl=function(){"use strict";return this.$FBRTCCallModel3.peerPicUrl};j.prototype.selfPicUrl=function(){"use strict";return this.$FBRTCCallModel3.selfPicUrl};j.prototype.backgroundUrl=function(){"use strict";return this.$FBRTCCallModel3.backgroundUrl};j.prototype.peerName=function(){"use strict";return this.$FBRTCCallModel3.peerName};j.prototype.peerShortName=function(){"use strict";if(this.$FBRTCCallModel3.peerShortName)return this.$FBRTCCallModel3.peerShortName;return this.$FBRTCCallModel3.peerName};j.prototype.autoDisableVideo=function(){"use strict";if(this.$FBRTCCallModel8){this.$FBRTCCallModel8=false;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c("FBRTCLogger").CallAction.AUTO_DISABLE_VIDEO);this.localStream.setVideoEnabled(false)}};j.prototype.videoIsAutoDisabled=function(){"use strict";return!this.$FBRTCCallModel8&&!this.$FBRTCCallModel9&&!this.localStream.hasVideo()};j.prototype.$FBRTCCallModel16=function(){"use strict";this.localStream.toggleMuteAudio();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c("FBRTCLogger").CallAction.SET_MUTE,!this.localStream.hasAudio()?"true":"false");this.__emitChange()};j.prototype.$FBRTCCallModel17=function(k){"use strict";this.localStream.toggleMuteVideo();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c("FBRTCLogger").CallAction.SET_VIDEO_ON,this.localStream.hasVideo());this.__emitChange()};j.prototype.toggleSelfView=function(){"use strict";this.selfViewOpen=!this.selfViewOpen;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,c("FBRTCLogger").CallAction.SET_SELF_VIEW_ON,!this.selfViewOpen?"true":"false");this.__emitChange()};j.prototype.setState=function(k){"use strict";__p&&__p();if(k===this.uiState)return;var l=this.uiState;this.uiState=k;switch(k){case j.UIState.CALL_CONNECTED:this.wasConnected=true;this.$FBRTCCallModel13.onCallConnected();this.$FBRTCCallModel11.startTracking();this.$FBRTCCallModel12.startTracking();break;case j.UIState.CALL_ENDED:this.$FBRTCCallModel13.onCallEnded();this.$FBRTCCallModel11.stopTracking();this.$FBRTCCallModel12.stopTracking();if(this.isCaller&&l>j.UIState.MORE_INIT)this.$FBRTCCallModel13.submit(this.$FBRTCCallModel18(),this.endCallReason);break}this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: state change - "'+j.UIState.strNames[l]+'" to "'+j.UIState.strNames[k]+'"');this.__emitChange()};j.prototype.$FBRTCCallModel18=function(){"use strict";return!this.$FBRTCCallModel2||this.getLocalVideoDuration()>0&&this.getRemoteVideoDuration()>0?c("FBRTCCallConstants").FBRTCCallType.VIDEO_CALL:c("FBRTCCallConstants").FBRTCCallType.VOICE_CALL};j.prototype.setStateFrom=function(k,l){"use strict";if(this.uiState===k)this.setState(l);else this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: Not at "'+j.UIState.strNames[k]+'", not moving to "'+j.UIState.strNames[l]+'"')};j.prototype.$FBRTCCallModel10=function(event,k){"use strict";if(!c("FBRTCConfig").isVCEndpointCall())return;c("Bootloader").loadModules(["CollabMessengerLogger"],function(l){return l.log(event,{peerID:this.peerID,callID:this.callID,eventDetails:k})}.bind(this),"FBRTCCallModel")};j.prototype.__onDispatch=function(k){"use strict";__p&&__p();switch(k.type){case c("FBRTCCallControlActions").Types.TOGGLE_MUTE_AUDIO:this.$FBRTCCallModel16();break;case c("FBRTCCallControlActions").Types.TOGGLE_MUTE_VIDEO:this.$FBRTCCallModel17();break;case c("FBRTCCallControlActions").Types.CLOSE_STANDALONE_SCREEN:this.__emitChange();break;case c("FBRTCCallControlActions").Types.TOGGLE_SELF_VIEW:this.toggleSelfView();break;case c("FBRTCCallControlActions").Types.OPEN_SCREEN_IN_NEW:c("FBRTCScreenSharingUI").open(this.$FBRTCCallModel15,this.peerID);this.__emitChange();break}};j.UIState=new(c("FBRTCStruct"))(["INIT","AWAITING_USER_START","PENDING_LOCAL_MEDIA","USER_MEDIA_DENIED","MORE_INIT","CONTACTING","RINGING","CALL_CONNECTING","CALL_CONNECTED","CALL_ENDED","COLLECT_RATING"]);f.exports=j}),null);
__d("FBRTCDialog.react",["MessengerDialog.react","XUIDialog.react","FBRTCConfig"],(function a(b,c,d,e,f,g){f.exports=c("FBRTCConfig").isMessengerDotCom()?c("MessengerDialog.react"):c("XUIDialog.react")}),null);
__d("FBRTCDialogBody.react",["MessengerDialogBody.react","XUIDialogBody.react","FBRTCConfig"],(function a(b,c,d,e,f,g){f.exports=c("FBRTCConfig").isMessengerDotCom()?c("MessengerDialogBody.react"):c("XUIDialogBody.react")}),null);
__d("FBRTCDialogFooter.react",["MessengerDialogFooter.react","XUIDialogFooter.react","FBRTCConfig"],(function a(b,c,d,e,f,g){f.exports=c("FBRTCConfig").isMessengerDotCom()?c("MessengerDialogFooter.react"):c("XUIDialogFooter.react")}),null);
__d("FBRTCDialogTitle.react",["FBRTCConfig","MessengerDialogTitle.react","MessengerDialogHeader.react","React","XUIDialogTitle.react"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("React").PropTypes;h=babelHelpers.inherits(k,c("React").PureComponent);i=h&&h.prototype;k.prototype.render=function(){var l=this.props,m=l.className,n=l.showCloseButton,o=babelHelpers.objectWithoutProperties(l,["className","showCloseButton"]);if(c("FBRTCConfig").isMessengerDotCom())return c("React").createElement(c("MessengerDialogHeader.react"),null,c("React").createElement(c("MessengerDialogTitle.react"),babelHelpers["extends"]({className:m,showCloseButton:n},o),this.props.children));return c("React").createElement(c("XUIDialogTitle.react"),babelHelpers["extends"]({className:m,showCloseButton:n},o),this.props.children)};function k(){h.apply(this,arguments)}k.propTypes={className:j.string,showCloseButton:j.bool.isRequired};f.exports=k}),null);
__d("FBRTCMediaAccessErrorDialog.react",["fbt","FBRTCConfig","FBRTCDialog.react","FBRTCDialogBody.react","FBRTCDialogFooter.react","FBRTCDialogTitle.react","Link.react","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=440;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;l.prototype.render=function(){return c("React").createElement(c("FBRTCDialog.react"),{shown:true,width:k,layerHideOnBlur:false},c("React").createElement(c("FBRTCDialogTitle.react"),{showCloseButton:false},c("React").createElement("span",null,h._("Can't Make Call"))),c("React").createElement(c("FBRTCDialogBody.react"),null,this.$FBRTCMediaAccessErrorDialog1()),c("React").createElement(c("FBRTCDialogFooter.react"),{leftContent:this.$FBRTCMediaAccessErrorDialog2()}))};l.prototype.$FBRTCMediaAccessErrorDialog1=function(){return c("React").createElement("p",null,h._("Connect a camera and a microphone to make a call. If they're already connected, try restarting your browser and closing any other applications that use a camera or microphone."))};l.prototype.$FBRTCMediaAccessErrorDialog2=function(){return c("React").createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",c("React").createElement(c("Link.react"),{href:c("FBRTCConfig").userMediaErrorUrl(),target:"_blank"},h._("Troubleshooting Guide")))]))};function l(){i.apply(this,arguments)}f.exports=l}),null);
__d("FBRTCPeerBrowserUnsupportedDialog.react",["fbt","FBRTCConfig","Link.react","React","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=440;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;l.prototype.render=function(){return c("React").createElement(c("XUIDialog.react"),{shown:true,width:k},c("React").createElement(c("XUIDialogTitle.react"),{showCloseButton:false},c("React").createElement("span",null,h._("Can't Connect Call"))),c("React").createElement(c("XUIDialogBody.react"),null,this.$FBRTCPeerBrowserUnsupportedDialog1()),c("React").createElement(c("XUIDialogFooter.react"),{leftContent:this.$FBRTCPeerBrowserUnsupportedDialog2()}))};l.prototype.$FBRTCPeerBrowserUnsupportedDialog1=function(){var m=this.props.peerName;return c("React").createElement("p",null,h._("{name} isn't using a browser that supports video calling yet.",[h.param("name",m)]))};l.prototype.$FBRTCPeerBrowserUnsupportedDialog2=function(){return c("React").createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",c("React").createElement(c("Link.react"),{href:c("FBRTCConfig").unsupportedBrowserUrl(),target:"_blank"},h._("Troubleshooting Guide")))]))};function l(){i.apply(this,arguments)}f.exports=l}),null);
__d("FBRTCScreenSharingInstallExtensionDialog.react",["fbt","React","FBRTCCallControlActions","FBRTCLogger","FBRTCScreenSharingLogger","LinkshimCallsites","ScreenSharingWebDriverIDs","URI","FBRTCDialogFooter.react","LinkshimLink.react","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogCancelButton.react","XUIDialogTitle.react"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes,l="https://chrome.google.com/webstore/detail/degmgkchmbgaognjjlhggmhbcpicdifm";i=babelHelpers.inherits(m,c("React").Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.$FBRTCScreenSharingInstallExtensionDialog3=function(){c("FBRTCScreenSharingLogger").getInstance().logAction(this.props.peerID,this.props.sessionID,c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_EXT_LINK)}.bind(this),o}m.prototype.componentDidMount=function(){c("FBRTCScreenSharingLogger").getInstance().logAction(this.props.peerID,this.props.sessionID,c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_EXT_DIALOG)};m.prototype.render=function(){return c("React").createElement(c("XUIDialog.react"),{shown:true,width:440,layerHideOnBlur:false},c("React").createElement(c("XUIDialogTitle.react"),{showCloseButton:true},c("React").createElement("span",null,h._("Please Install Screen Sharing Extension"))),c("React").createElement(c("XUIDialogBody.react"),{"data-testid":c("ScreenSharingWebDriverIDs").INSTALL_EXT_DIALOG},this.$FBRTCScreenSharingInstallExtensionDialog1()),c("React").createElement(c("FBRTCDialogFooter.react"),null,c("React").createElement(c("XUIDialogCancelButton.react"),null),c("React").createElement(c("XUIDialogButton.react"),{label:h._("Call Again"),use:"confirm",onClick:this.$FBRTCScreenSharingInstallExtensionDialog2})))};m.prototype.$FBRTCScreenSharingInstallExtensionDialog1=function(){return c("React").createElement("div",null,c("React").createElement("p",null,h._("To share your screen, you'll need to install an extension. Then you can return here to start your call again.")),c("React").createElement(c("LinkshimLink.react"),{uri:new(c("URI"))(l),callsite:c("LinkshimCallsites").THIRD_PARTY_URL,target:"_blank",onClick:this.$FBRTCScreenSharingInstallExtensionDialog3},h._("Install Screen Sharing Extension")))};m.prototype.$FBRTCScreenSharingInstallExtensionDialog2=function(){c("FBRTCCallControlActions").resetCall(c("FBRTCLogger").Trigger.RESET_CALL)};m.propTypes={peerID:k.any.isRequired,sessionID:k.number.isRequired};f.exports=m}),null);
__d("FBRTCScreenStreamWrapper",["FBRTCStreamWrapper"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("FBRTCStreamWrapper"));i=h&&h.prototype;j.prototype.toggleMuteAudio=function(){return};j.prototype.toggleMuteVideo=function(){return};function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("FBRTCScreenSharingModel",["Event","FBRTCScreenSharingLogger","FBRTCScreenStreamWrapper","FBRTCStore"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("FBRTCStore"));i=h&&h.prototype;function j(k,l){i.constructor.call(this);this.$FBRTCScreenSharingModel3=null;this.$FBRTCScreenSharingModel4=new(c("FBRTCScreenStreamWrapper"))();this.$FBRTCScreenSharingModel5=c("FBRTCScreenSharingLogger").getInstance();this.$FBRTCScreenSharingModel1=k;this.$FBRTCScreenSharingModel2=l}j.prototype.isEnabled=function(){return!!this.$FBRTCScreenSharingModel3};j.prototype.setStream=function(k){var l=arguments.length<=1||arguments[1]===undefined?false:arguments[1],m=arguments.length<=2||arguments[2]===undefined?false:arguments[2];if(k&&(!l||m))c("Event").listen(k.getVideoTracks()[0],"ended",this.__emitChange.bind(this));if(this.$FBRTCScreenSharingModel4===null)this.$FBRTCScreenSharingModel4=new(c("FBRTCScreenStreamWrapper"))();this.$FBRTCScreenSharingModel4.setStream(k,!l)};j.prototype.getStream=function(){return this.$FBRTCScreenSharingModel4};j.prototype.getPeerID=function(){return this.$FBRTCScreenSharingModel1};j.prototype.getSessionID=function(){return this.$FBRTCScreenSharingModel2};j.prototype.onStart=function(k){if(!k){this.$FBRTCScreenSharingModel5.logToConsole(null,null,"Invalid stream id");return}this.$FBRTCScreenSharingModel5.logToConsole(null,null,"Enabling screen sharing");this.$FBRTCScreenSharingModel3=k};j.prototype.onStop=function(){this.$FBRTCScreenSharingModel3=null;if(this.$FBRTCScreenSharingModel4)this.$FBRTCScreenSharingModel4.stop()};j.prototype.__onDispatch=function(k){};f.exports=j}),null);
__d("FBRTCScreenSharingUnsupportedBrowserDialog.react",["cx","fbt","ix","React","Image.react","Link.react","Layout.react","XUIDialog.react","XUIDialogBody.react","XUIDialogTitle.react","XUIText.react","FBRTCVersionDetection"],(function a(b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k,l,m=c("Layout.react").Column;k=babelHelpers.inherits(n,c("React").Component);l=k&&k.prototype;n.prototype.render=function(){return c("React").createElement(c("XUIDialog.react"),{shown:true,width:440,layerHideOnBlur:false},c("React").createElement(c("XUIDialogTitle.react"),{showCloseButton:true},this.$FBRTCScreenSharingUnsupportedBrowserDialog1()),c("React").createElement(c("XUIDialogBody.react"),null,this.$FBRTCScreenSharingUnsupportedBrowserDialog2(),this.$FBRTCScreenSharingUnsupportedBrowserDialog3()))};n.prototype.$FBRTCScreenSharingUnsupportedBrowserDialog1=function(){var o=null;if(c("FBRTCVersionDetection").isChrome())o=i._("Update Browser to Share Your Screen");else o=i._("Switch Browsers to Share Your Screen");return c("React").createElement("span",null,o)};n.prototype.$FBRTCScreenSharingUnsupportedBrowserDialog2=function(){var o=null;if(c("FBRTCVersionDetection").isChrome())o=this.$FBRTCScreenSharingUnsupportedBrowserDialog4();else o=this.$FBRTCScreenSharingUnsupportedBrowserDialog5();return c("React").createElement("p",null,o)};n.prototype.$FBRTCScreenSharingUnsupportedBrowserDialog4=function(){return i._("Screen sharing doesn't work in the older version of Google Chrome you're using. To share your screen, please update Google Chrome.")};n.prototype.$FBRTCScreenSharingUnsupportedBrowserDialog5=function(){if(c("FBRTCVersionDetection").isFirefox())return i._("Screen sharing doesn't work in Mozilla Firefox yet. To share your screen, please open Facebook in Google Chrome.");else return i._("Screen sharing doesn't work in your browser yet. To share your screen, please open Facebook in Google Chrome.")};n.prototype.$FBRTCScreenSharingUnsupportedBrowserDialog3=function(){return c("React").createElement(c("Layout.react"),null,c("React").createElement(m,{style:{width:"100%",textAlign:"center"}},c("React").createElement(c("Link.react"),{href:"https://www.google.com/chrome/index.html",target:"_blank"},c("React").createElement(c("Image.react"),{className:"_4_if",src:j("28180"),alt:"Chrome",width:"64"}),c("React").createElement(c("XUIText.react"),{display:"block"},"Google Chrome"))))};function n(){k.apply(this,arguments)}f.exports=n}),null);
__d("FBRTCAudioSpectrumAnalyser.react",["React","ReactDOM","cancelAnimationFrame","requestAnimationFrame"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=7,k=3,l=9,m="#3B5998",n="#CCCCCC",o=80,p=106;h=babelHelpers.inherits(q,c("React").Component);i=h&&h.prototype;function q(){var t,u;for(var v=arguments.length,w=Array(v),x=0;x<v;x++)w[x]=arguments[x];return u=(t=i.constructor).call.apply(t,[this].concat(w)),this.$FBRTCAudioSpectrumAnalyser1=false,this.$FBRTCAudioSpectrumAnalyser2=null,u}q.prototype.componentDidMount=function(){this.$FBRTCAudioSpectrumAnalyser3()};q.prototype.componentWillUnmount=function(){this.$FBRTCAudioSpectrumAnalyser4()};q.prototype.shouldComponentUpdate=function(t){return this.$FBRTCAudioSpectrumAnalyser5(t.stream)};q.prototype.componentDidUpdate=function(){this.$FBRTCAudioSpectrumAnalyser4();this.$FBRTCAudioSpectrumAnalyser3()};q.prototype.$FBRTCAudioSpectrumAnalyser5=function(t){var u=t?t.getStream():null,v=this.props.stream?this.props.stream.getStream():null;return v!==u};q.prototype.$FBRTCAudioSpectrumAnalyser4=function(){this.$FBRTCAudioSpectrumAnalyser1=false;c("cancelAnimationFrame")(this.$FBRTCAudioSpectrumAnalyser2)};q.prototype.$FBRTCAudioSpectrumAnalyser3=function(){var t=this.props.stream.getAudioAnalyser();if(!this.$FBRTCAudioSpectrumAnalyser1&&t){this.$FBRTCAudioSpectrumAnalyser1=true;var u=c("ReactDOM").findDOMNode(this),v=u.getContext("2d");this.$FBRTCAudioSpectrumAnalyser6(t,u,v)}};q.prototype.render=function(){return c("React").createElement("canvas",{width:p,height:o})};q.prototype.$FBRTCAudioSpectrumAnalyser6=function(t,u,v){this.$FBRTCAudioSpectrumAnalyser2=c("requestAnimationFrame")(function(){if(!this.$FBRTCAudioSpectrumAnalyser1)return;s(t,u,v);this.$FBRTCAudioSpectrumAnalyser6(t,u,v)}.bind(this))};var r=function r(t,u,v,w){var x=w?n:m;u+=k;v-=k;t.beginPath();t.arc(u,v,k,0,2*Math.PI,false);t.fillStyle=x;t.strokeStyle=x;t.fill()},s=function s(t,u,v){__p&&__p();var w=void 0,x=void 0,y=u.width/l,z=Math.floor(u.height/j),A=new Uint8Array(2048);t.getByteFrequencyData(A);v.clearRect(0,0,u.width,u.height);var B=Math.floor(A.length/(l*3));for(var C=0;C<l;C+=1){w=0;for(var D=0;D<B;D+=1)w+=A[C*B+D];x=w*j/(B*256);if(x<1)x=.6;var E=0;for(E;E<Math.floor(x);E++)r(v,C*y,u.height-E*z,false);if(x-Math.floor(x)>=.5)r(v,C*y,u.height-E*z,true)}};f.exports=q}),null);
__d("FBRTCAudioConstraints",["FBRTCConstants","FBRTCVersionDetection"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){var j=arguments.length<=1||arguments[1]===undefined?null:arguments[1];this.streamType=i;this.audioSource=j}h.prototype.getConstraints=function(){if(this.streamType===c("FBRTCConstants").StreamType.SCREEN_CONTENT&&c("FBRTCVersionDetection").isChrome())return false;if(!this.audioSource)return true;return{optional:[{sourceId:this.audioSource}]}};f.exports=h}),null);
__d("FBRTCVideoConstraints",["FBRTCConstants","RTCConfig","UserAgent"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCConstants").RTCConstraints,i=h.FHD_HEIGHT,j=h.HD_HEIGHT,k=h.LQ_HEIGHT,l=h.SD_HEIGHT,m=h.FHD_WIDTH,n=h.HD_WIDTH,o=h.LQ_WIDTH,p=h.SD_WIDTH,q=h.VLQ_FRAME_RATE,r=h.LQ_FRAME_RATE,s=h.FRAME_RATE;function t(u,v){var w=arguments.length<=2||arguments[2]===undefined?null:arguments[2];this.streamType=u;this.videoQuality=v;this.videoSource=w}t.prototype.getConstraints=function(){__p&&__p();if(this.streamType===c("FBRTCConstants").StreamType.AUDIO_ONLY)return false;if(this.streamType===c("FBRTCConstants").StreamType.SCREEN_CONTENT){if(this.videoSource){if(c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO_STREAM_SIZE)return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.videoSource},optional:[{minHeight:l},{maxHeight:i},{minFrameRate:q},{maxFrameRate:s}]};var u={width:m,height:i,frameRate:s},v=this.$FBRTCVideoConstraints1(u),w=v.width,x=v.height,y=v.frameRate;return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.videoSource,minHeight:x,maxHeight:x,minWidth:w,maxWidth:w,minFrameRate:q,maxFrameRate:y}}}return false}var z=this.$FBRTCVideoConstraints1(c("RTCConfig").CollaborationCallQuality.videoToRoom),A=z.width,B=z.height,C=z.frameRate;if(this.shouldUseNewMozAPI())return{height:{min:k,max:j,ideal:B},width:{min:320,max:1280,ideal:B*16/9},frameRate:{min:10,max:30,ideal:C}};var D={mandatory:{},optional:[{minHeight:B},{maxHeight:B},{minFrameRate:C},{maxFrameRate:C},{googLeakyBucket:true}]};if(this.videoSource)D.optional=D.optional.concat({sourceId:this.videoSource});if(this.videoQuality===c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO)D.optional=D.optional.concat({minWidth:A},{maxWidth:A});return D};t.prototype.$FBRTCVideoConstraints1=function(u){var v=arguments.length<=1||arguments[1]===undefined?{width:p,height:l,frameRate:s}:arguments[1];switch(this.videoQuality){case c("FBRTCConstants").VideoQuality.HD_VIDEO:return{width:n,height:j,frameRate:s};case c("FBRTCConstants").VideoQuality.LQ_VIDEO:return{width:o,height:k,frameRate:r};case c("FBRTCConstants").VideoQuality.SD_VIDEO:return{width:p,height:l,frameRate:s};case c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO:return u;default:return v}};t.prototype.shouldUseNewMozAPI=function(){return!!navigator.mediaDevices&&c("UserAgent").isBrowser("Firefox >= 38")};f.exports=t}),null);
__d("FBRTCUserMediaRequest",["Promise","FBRTCAudioConstraints","FBRTCConstants","FBRTCVideoConstraints","RTCMediaDevices"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){var j=arguments.length<=1||arguments[1]===undefined?c("FBRTCConstants").VideoQuality.SD_VIDEO:arguments[1],k=arguments[2];this.streamType=i;this.videoQuality=j;this.isAudioOnly=k;this.audioSource=null;this.videoSource=null}h.prototype.$FBRTCUserMediaRequest1=function(){__p&&__p();var i=new(c("FBRTCAudioConstraints"))(this.streamType,this.audioSource),j=new(c("FBRTCVideoConstraints"))(this.streamType,this.videoQuality,this.videoSource),k={audio:i.getConstraints(),video:j.getConstraints()};if(!this.isAudioOnly)return c("Promise").resolve(k);return c("RTCMediaDevices").enumerateDevices().then(function(l){if(l.every(function(m){var n=m.kind;return n!=="videoinput"}))k.video=false;return k})["catch"](function(){return c("Promise").resolve(k)})};h.prototype.request=function(){__p&&__p();return this.$FBRTCUserMediaRequest1().then(function(i){__p&&__p();if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia(i);return new(c("Promise"))(function(j,k){if(navigator.getUserMedia)navigator.getUserMedia(i,j,k);else if(navigator.webkitGetUserMedia)navigator.webkitGetUserMedia(i,j,k);else if(navigator.mozGetUserMedia)navigator.mozGetUserMedia(i,j,k);else k("getUserMedia not supported")})})};f.exports=h}),null);
__d("FBRTCSettingsDialog.react",["cx","fbt","Promise","FBRTCAudioSpectrumAnalyser.react","FBRTCConfig","FBRTCConstants","FBRTCDialog.react","FBRTCDialogBody.react","FBRTCDialogFooter.react","FBRTCDialogTitle.react","FBRTCStreamWrapper","FBRTCUserMediaRequest","FBRTCUserSettings","FBRTCUtils","FBRTCVideo.react","Link.react","React","ReactDOM","RTCMediaDevices","RTCSettingsMediaDeviceSelector.react","XUIDialogCancelButton.react","XUIDialogSaveButton.react","XUIGrayText.react"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k;j=babelHelpers.inherits(l,c("React").Component);k=j&&j.prototype;function l(q,r){__p&&__p();k.constructor.call(this,q,r);this.$FBRTCSettingsDialog11=function(s){var t=s.value;this.$FBRTCSettingsDialog12({videoInput:t});this.$FBRTCSettingsDialog4()}.bind(this);this.$FBRTCSettingsDialog13=function(s){var t=s.value;this.$FBRTCSettingsDialog12({audioInput:t});this.$FBRTCSettingsDialog4()}.bind(this);this.$FBRTCSettingsDialog14=function(s){var t=s.value;this.$FBRTCSettingsDialog12({audioOutput:t,dirty:true});this.$FBRTCSettingsDialog15()}.bind(this);this.$FBRTCSettingsDialog7=function(){c("FBRTCUserSettings").save({audioInput:this.state.audioInput,audioOutput:this.state.audioOutput,videoInput:this.state.videoInput})}.bind(this);this.$FBRTCSettingsDialog2=function(){var s=c("ReactDOM").findDOMNode(this.refs.audioPreview),t=c("FBRTCUserSettings").remoteStream;if(t&&s)c("FBRTCUtils").attachMediaStream(s,t);this.$FBRTCSettingsDialog15()}.bind(this);this.$FBRTCSettingsDialog4=function(){return new(c("Promise"))(function(s,t){var u=this.state,v=u.audioInput,w=u.stream,x=u.videoInput;if(v&&x)p(v,x).then(function(y){w.setStream(y);return this.$FBRTCSettingsDialog3()}.bind(this)).done(s,t);else t()}.bind(this))}.bind(this);this.state={dirty:false,stream:new(c("FBRTCStreamWrapper"))(),loading:true,audioInput:c("FBRTCUserSettings").audioInput,audioInputs:[],audioOutput:c("FBRTCUserSettings").audioOutput,audioOutputs:[],videoInput:c("FBRTCUserSettings").videoInput,videoInputs:[]};this.$FBRTCSettingsDialog1=c("FBRTCUserSettings").addListener("remoteStreamChanged",this.$FBRTCSettingsDialog2)}l.prototype.componentDidMount=function(){this.$FBRTCSettingsDialog3().then(function(q){var r=q.audioInputs,s=q.audioOutputs,t=q.videoInputs;this.setState({audioInput:c("FBRTCUserSettings").selectAudioInputByLabel(r),videoInput:c("FBRTCUserSettings").selectVideoInputByLabel(t)})}.bind(this)).then(this.$FBRTCSettingsDialog4).done(function(){if(c("FBRTCUtils").supportsSetSink()){c("FBRTCUserSettings").previewStart();this.$FBRTCSettingsDialog2()}}.bind(this))};l.prototype.render=function(){return c("React").createElement(c("FBRTCDialog.react"),{width:365,shown:true,onToggle:this.props.onToggle},c("React").createElement(c("FBRTCDialogTitle.react"),{showCloseButton:true},c("React").createElement("span",null,i._("Settings"))),c("React").createElement(c("FBRTCDialogBody.react"),null,this.$FBRTCSettingsDialog5()),c("React").createElement(c("FBRTCDialogFooter.react"),{leftContent:this.$FBRTCSettingsDialog6()},c("React").createElement(c("XUIDialogCancelButton.react"),null),c("React").createElement(c("XUIDialogSaveButton.react"),{use:"confirm",disabled:!this.state.dirty,onClick:this.$FBRTCSettingsDialog7})))};l.prototype.componentWillUnmount=function(){this.$FBRTCSettingsDialog1.remove();c("FBRTCUserSettings").previewEnd()};l.prototype.$FBRTCSettingsDialog5=function(){if(this.state.loading)return c("React").createElement("div",{className:"_48fc loading"});return c("React").createElement("div",{className:"_48fc"},this.$FBRTCSettingsDialog8(),this.$FBRTCSettingsDialog9(),this.$FBRTCSettingsDialog10(),c("React").createElement(c("XUIGrayText.react"),{shade:"light"},i._("Tip: Try restarting your browser if you're having trouble with your camera or microphone.")))};l.prototype.$FBRTCSettingsDialog8=function(){var q=this.state,r=q.stream,s=q.videoInput,t=q.videoInputs;if(t.length<1)return null;var u=!this.props.callModel.supportsSdpUpdate();return c("React").createElement("div",{className:"_48fd"},c("React").createElement(m,null,i._("Camera")),c("React").createElement(c("RTCSettingsMediaDeviceSelector.react"),{devices:t,name:"camera_selection",onChange:this.$FBRTCSettingsDialog11,defaultValue:s,disabled:u,width:"200px"}),c("React").createElement("div",{className:"_48ff"},c("React").createElement(c("FBRTCVideo.react"),{ref:"videoPreview",stream:r,muted:true,className:"_48fg"})))};l.prototype.$FBRTCSettingsDialog12=function(q){this.setState(babelHelpers["extends"]({},q,{dirty:this.state.dirty||Object.keys(q).some(function(r){return this.state[r]!==q[r]}.bind(this))}))};l.prototype.$FBRTCSettingsDialog9=function(){var q=this.state,r=q.audioInput,s=q.audioInputs,t=q.stream;if(s.length<1)return null;var u=!this.props.callModel.supportsSdpUpdate();return c("React").createElement("div",{className:"_48fd"},c("React").createElement(m,null,i._("Microphone")),c("React").createElement(c("RTCSettingsMediaDeviceSelector.react"),{devices:s,name:"microphone_selection",onChange:this.$FBRTCSettingsDialog13,defaultValue:r,disabled:u,width:"200px"}),c("React").createElement("div",{className:"_48fh"},c("React").createElement(c("FBRTCAudioSpectrumAnalyser.react"),{stream:t})))};l.prototype.$FBRTCSettingsDialog10=function(){var q=this.state,r=q.audioOutput,s=q.audioOutputs;if(s.length<1)return null;return c("React").createElement("div",{className:"_48fd"},c("React").createElement(m,null,i._("Audio Output")),c("React").createElement(c("RTCSettingsMediaDeviceSelector.react"),{devices:s,name:"audio_output_selection",onChange:this.$FBRTCSettingsDialog14,defaultValue:r,disabled:!c("FBRTCUtils").supportsSetSink(),width:"200px"}),c("React").createElement("div",{className:"_48fh"},c("React").createElement("audio",{autoPlay:true,ref:"audioPreview"})))};l.prototype.$FBRTCSettingsDialog6=function(){return c("React").createElement("div",null,c("React").createElement(c("XUIGrayText.react"),{shade:"light"},c("React").createElement(c("Link.react"),{href:c("FBRTCConfig").userMediaErrorUrl(),target:"_blank"},i._("Get help"))))};l.prototype.$FBRTCSettingsDialog15=function(){var q=c("ReactDOM").findDOMNode(this.refs.audioPreview),r=this.state.audioOutput;if(r&&q&&typeof q.setSinkId==="function")q.setSinkId(r)};l.prototype.$FBRTCSettingsDialog3=function(){this.setState({loading:true});return c("RTCMediaDevices").enumerateDevices().then(o).then(function(q){var r=q.audioInputs,s=q.audioOutputs,t=q.videoInputs,u=this.state,v=u.audioInput,w=u.audioOutput,x=u.videoInput;this.setState({loading:false,audioInputs:r,audioInput:v||n(r[0]),audioOutputs:s,audioOutput:w||n(s[0]),videoInputs:t,videoInput:x||n(t[0])});return{audioInputs:r,audioOutputs:s,videoInputs:t}}.bind(this))["catch"](function(q){this.setState({loading:false});throw q}.bind(this))};var m=function m(q){var r=q.children;return c("React").createElement(c("XUIGrayText.react"),{display:"block",size:"header4",shade:"medium",className:"_48fe"},r)};function n(q){if(!q)return null;return q.deviceId}function o(q){__p&&__p();var r=[],s=[],t=[];for(var u=q,v=Array.isArray(u),w=0,u=v?u:u[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var x;if(v){if(w>=u.length)break;x=u[w++]}else{w=u.next();if(w.done)break;x=w.value}var y=x;switch(y.kind){case"audioinput":r.push(y);break;case"audiooutput":s.push(y);break;case"videoinput":t.push(y);break;default:}}return{audioInputs:r,audioOutputs:s,videoInputs:t}}function p(q,r){var s=new(c("FBRTCUserMediaRequest"))(c("FBRTCConstants").StreamType.AUDIO_VIDEO);s.audioSource=q;s.videoSource=r;return s.request()}f.exports=l}),null);
__d("FBRTCVideoEscalationDialog.react",["fbt","FBRTCCallControlActions","React","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogFooter.react"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes,l=440;i=babelHelpers.inherits(m,c("React").Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.$FBRTCVideoEscalationDialog2=function(s){this.props.hideDialog();c("FBRTCCallControlActions").acceptEscalation()}.bind(this),o}m.prototype.render=function(){return c("React").createElement(c("XUIDialog.react"),{label:h._("Accept or Decline escalating to a video call"),layerHideOnBlur:false,shown:true,width:l},c("React").createElement(c("XUIDialogBody.react"),null,c("React").createElement("p",null,h._("{name} would like to video chat. Click \"Accept\" to enable your camera.",[h.param("name",this.props.peerName)]))),c("React").createElement(c("XUIDialogFooter.react"),null,c("React").createElement(c("XUIDialogButton.react"),{action:"cancel",label:h._("Decline"),onClick:this.$FBRTCVideoEscalationDialog1}),c("React").createElement(c("XUIDialogButton.react"),{action:"confirm",label:h._("Accept"),onClick:this.$FBRTCVideoEscalationDialog2,use:"confirm"})))};m.prototype.$FBRTCVideoEscalationDialog1=function(n){c("FBRTCCallControlActions").declineEscalation()};m.propTypes={peerName:k.string.isRequired,hideDialog:k.func.isRequired};f.exports=m}),null);
__d("FBRTCCallDialogController",["FBRTCCallModel","FBRTCScreenSharingModel","FBRTCSettingsDialog.react","FBRTCStruct","FBRTCMediaAccessErrorDialog.react","FBRTCPeerBrowserUnsupportedDialog.react","FBRTCScreenSharingUnsupportedBrowserDialog.react","FBRTCScreenSharingInstallExtensionDialog.react","FBRTCUserSettings","FBRTCVideoEscalationDialog.react","React","ReactDOM"],(function a(b,c,d,e,f,g){__p&&__p();var h,i,j=new(c("FBRTCStruct"))(["ERROR_ACCESSING_MEDIA","PEER_BROWSER_UNSUPPORTED","SETTINGS","SCREEN_SHARING_UNSUPPORTED","INSTALL_SCREEN_SHARING_EXT","VIDEO_ESCALATION"]);h=babelHelpers.inherits(k,c("React").Component);i=h&&h.prototype;k.prototype.$DialogOwner1=function(m){"use strict";setTimeout(function(){if(!m)l.hideDialog()},0)};k.prototype.render=function(){"use strict";__p&&__p();if(this.props.dialogType===j.ERROR_ACCESSING_MEDIA)return c("React").createElement(c("FBRTCMediaAccessErrorDialog.react"),{key:"dialog"});if(this.props.dialogType===j.PEER_BROWSER_UNSUPPORTED)if(this.props.peerName)return c("React").createElement(c("FBRTCPeerBrowserUnsupportedDialog.react"),{peerName:this.props.peerName,key:"dialog"});if(this.props.dialogType===j.SETTINGS)return c("React").createElement(c("FBRTCSettingsDialog.react"),{onToggle:this.$DialogOwner1,callModel:this.props.callModel,key:"dialog"});if(this.props.dialogType===j.SCREEN_SHARING_UNSUPPORTED)return c("React").createElement(c("FBRTCScreenSharingUnsupportedBrowserDialog.react"),{onToggle:this.$DialogOwner1,key:"dialog"});if(this.props.dialogType===j.INSTALL_SCREEN_SHARING_EXT)return c("React").createElement(c("FBRTCScreenSharingInstallExtensionDialog.react"),{onToggle:this.$DialogOwner1,peerID:this.props.peerID,sessionID:this.props.sessionID,key:"dialog"});if(this.props.dialogType===j.VIDEO_ESCALATION)if(this.props.peerName)return c("React").createElement(c("FBRTCVideoEscalationDialog.react"),{hideDialog:function m(){l.hideDialog()},onToggle:this.$DialogOwner1,peerName:this.props.peerName,key:"dialog"});return null};function k(){"use strict";h.apply(this,arguments)}var l={dialogTypes:j,container:null,setDialogContainer:function m(n){this.container=n;this.currentDialogType=null;this.callModel=null;this._render()},showDialog:function m(n,o){this.currentDialogType=n;this._setCallModel(o);this._render()},hideDialog:function m(){this.currentDialogType=null;this._render()},hideDialogType:function m(n){if(n===this.currentDialogType)this.hideDialog()},_render:function m(){__p&&__p();var n=void 0,o=void 0,p=void 0;if(this.callModel instanceof c("FBRTCCallModel")){n=this.callModel.peerID;o=this.callModel.callID;p=this.callModel.peerName()}else if(this.callModel instanceof c("FBRTCScreenSharingModel")){n=this.callModel.getPeerID();o=this.callModel.getSessionID()}c("ReactDOM").render(c("React").createElement(k,{dialogType:this.currentDialogType,peerID:n,sessionID:o,peerName:p,callModel:this.callModel}),this.container)},_setCallModel:function m(n){if(n!==this.callModel){this.callModel=n;if(this.callModel)this.callModel.addListener(this._onCallModelChanged.bind(this))}},_onCallModelChanged:function m(){var n=[j.SETTINGS,j.SCREEN_SHARING_UNSUPPORTED,j.INSTALL_SCREEN_SHARING_EXT,j.VIDEO_ESCALATION];if(this.callModel.isEnded()&&n.indexOf(this.currentDialogType)>-1)this.hideDialog()}};c("FBRTCUserSettings").addListener("saved",l.hideDialog,l);f.exports=l}),null);
__d("FBRTCStarRatingActions",["FBRTCDispatcher","keyMirror"],(function a(b,c,d,e,f,g){"use strict";var h=c("keyMirror")({SUBMIT_RATING:null,SUBMIT_FEEDBACK:null,RATING_SHOWN:null,FEEDBACK_SHOWN:null}),i={Types:h,submitRating:function j(k){c("FBRTCDispatcher").dispatch({type:h.SUBMIT_RATING,rating:k})},submitFeedback:function j(k){c("FBRTCDispatcher").dispatch({type:h.SUBMIT_FEEDBACK,feedback:k})},ratingShown:function j(){c("FBRTCDispatcher").dispatch({type:h.RATING_SHOWN})},feedbackShown:function j(){c("FBRTCDispatcher").dispatch({type:h.FEEDBACK_SHOWN})}};f.exports=i}),null);
__d("FBRTCCallModelStatePusher",["FBRTCCallControlActions","FBRTCCallModel","FBRTCConfig","FBRTCConstants","FBRTCDispatcher","FBRTCStarRatingActions"],(function a(b,c,d,e,f,g){__p&&__p();var h=3e4,i=1e4;function j(k){"use strict";this.$FBRTCCallModelStatePusher1=null;this.$FBRTCCallModelStatePusher2=k;this.$FBRTCCallModelStatePusher2.addListener(this.$FBRTCCallModelStatePusher3.bind(this));c("FBRTCDispatcher").register(this.$FBRTCCallModelStatePusher4.bind(this))}j.prototype.$FBRTCCallModelStatePusher5=function(){"use strict";return this.$FBRTCCallModelStatePusher2.uiState===c("FBRTCCallModel").UIState.CALL_ENDED&&this.$FBRTCCallModelStatePusher2.wasConnected&&this.$FBRTCCallModelStatePusher2.endCallReason===c("FBRTCConstants").CallEndReason.HANGUP_CALL&&!c("FBRTCConfig").isVCEndpointCall()};j.prototype.$FBRTCCallModelStatePusher3=function(){"use strict";if(this.$FBRTCCallModelStatePusher2.uiState===c("FBRTCCallModel").UIState.CALL_ENDED)if(this.$FBRTCCallModelStatePusher5())this.$FBRTCCallModelStatePusher6(3e3,c("FBRTCCallModel").UIState.CALL_ENDED,c("FBRTCCallModel").UIState.COLLECT_RATING);else this.$FBRTCCallModelStatePusher7(i);else if(this.$FBRTCCallModelStatePusher2.uiState===c("FBRTCCallModel").UIState.COLLECT_RATING)this.$FBRTCCallModelStatePusher7(h)};j.prototype.$FBRTCCallModelStatePusher4=function(k){"use strict";if(k.type===c("FBRTCStarRatingActions").Types.FEEDBACK_SHOWN||k.type===c("FBRTCCallControlActions").Types.REDIAL_CALL)this.$FBRTCCallModelStatePusher8()};j.prototype.$FBRTCCallModelStatePusher7=function(k){"use strict";this.$FBRTCCallModelStatePusher1=setTimeout(function(){window.close()},k)};j.prototype.$FBRTCCallModelStatePusher8=function(){"use strict";clearTimeout(this.$FBRTCCallModelStatePusher1);this.$FBRTCCallModelStatePusher1=null};j.prototype.$FBRTCCallModelStatePusher6=function(k,l,m){"use strict";var n=this.$FBRTCCallModelStatePusher2;setTimeout(function(){n.setStateFrom(l,m)},k)};f.exports=j}),null);
__d("FBRTCCallMonitor",["FBRTCCallSummaryStore"],(function a(b,c,d,e,f,g){__p&&__p();var h=1e4,i=3e3;function j(k){"use strict";this.$FBRTCCallMonitor1=k;this.$FBRTCCallMonitor2=null;this.$FBRTCCallMonitor3=c("FBRTCCallSummaryStore").getInstance()}j.prototype.startHeartbeat=function(k){"use strict";if(this.$FBRTCCallMonitor1.isEnded())return;var l=k();if(l)this.onCallHeartbeat(l);var m=this;setTimeout(function(){m.startHeartbeat(k)},h)};j.prototype.onCallHeartbeat=function(k){"use strict";var l=new Date().valueOf();if(!this.$FBRTCCallMonitor2||l-this.$FBRTCCallMonitor2>i)k.save(this.$FBRTCCallMonitor3)};f.exports=j}),null);
__d("FBRTCScreenMedia",["FBRTCConstants","FBRTCDispatcher","FBRTCUserMediaRequest","keyMirror"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("keyMirror")({STREAM_READY:null,STREAM_FAILED:null}),i={STREAM_TYPE:c("FBRTCConstants").StreamType.SCREEN_CONTENT,Types:h,requestScreenMedia:function j(k){var l=arguments.length<=1||arguments[1]===undefined?c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO:arguments[1],m=new(c("FBRTCUserMediaRequest"))(this.STREAM_TYPE,l);m.videoSource=k;m.audioSource=null;m.request().then(function(n){return this._onRequestSuccess(n)}.bind(this))["catch"](function(n){return this._onRequestFailure(n)}.bind(this))},_onRequestSuccess:function j(k){c("FBRTCDispatcher").dispatch({type:h.STREAM_READY,stream:k})},_onRequestFailure:function j(k){var l=k.name?k.name:k;c("FBRTCDispatcher").dispatch({type:h.STREAM_FAILED,error:l})}};f.exports=i}),null);
__d("FBRTCScreenSharingController",["invariant","Promise","FBRTCCallDialogController","FBRTCScreenMedia","FBRTCScreenSharingLogger","FBRTCScreenSharingModel","FBRTCScreenSharingUI","FBRTCScreenSharingUtils","FBRTCStore","Random"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j;i=babelHelpers.inherits(k,c("FBRTCStore"));j=i&&i.prototype;function k(l,m){__p&&__p();j.constructor.call(this);this.$FBRTCScreenSharingController5=function(n){__p&&__p();var o=n.origin,p=n.data;if(o!==window.location.origin||!(p.recipient&&p.recipient==="SC_DOM")||!p.type)return;window.removeEventListener("message",this.$FBRTCScreenSharingController5);var q=c("FBRTCScreenSharingLogger").Action;switch(p.type){case"SC_EXT_INSTALLED":break;case"SC_DIALOG_SUCCESS":this.$FBRTCScreenSharingController9(q.SCREEN_SHARING_DIALOG_SUCCESS);this.$FBRTCScreenSharingController10(p.streamId);break;case"SC_DIALOG_CANCEL":this.$FBRTCScreenSharingController9(q.SCREEN_SHARING_DIALOG_CANCEL);this.$FBRTCScreenSharingController7();break;case"SC_CANCELLED":this.$FBRTCScreenSharingController9(q.SCREEN_SHARING_CANCELLED);this.$FBRTCScreenSharingController7();break;default:this.$FBRTCScreenSharingController11("UNEXPECTED MESSAGE TYPE: "+p.type)}}.bind(this);this.$FBRTCScreenSharingController1=false;this.$FBRTCScreenSharingController2=c("FBRTCScreenSharingLogger").getInstance();this.$FBRTCScreenSharingController3=l;this.$FBRTCScreenSharingController4=m!=null?m:c("Random").uint32();this.__model=new(c("FBRTCScreenSharingModel"))(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4);this.$FBRTCScreenSharingController4!==null&&this.$FBRTCScreenSharingController4!==undefined||h(0);this.initPromise=this.$FBRTCScreenSharingController6()}k.prototype.$FBRTCScreenSharingController6=function(){if(!c("FBRTCScreenSharingUtils").isScreenSharingSupported())return c("Promise").reject("screen sharing not supported");this.__model.addListener(this.$FBRTCScreenSharingController7.bind(this));return c("FBRTCScreenSharingUtils").checkExtensionInstalled()};k.prototype.isEnabled=function(){return this.$FBRTCScreenSharingController1&&this.__model.isEnabled()};k.prototype.getStream=function(){return this.__model.getStream()};k.prototype.onStop=function(){this.__model.onStop()};k.prototype.onEndCall=function(){c("FBRTCScreenSharingUI").close();this.onStop()};k.prototype.setRemoteStream=function(l){if(!l)c("FBRTCScreenSharingUI").close();this.__model.setStream(l,true)};k.prototype.toggleScreenSharing=function(){var l=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(this.$FBRTCScreenSharingController8(l)){var m=this.__model.isEnabled()?"SC_CANCEL":"SC_REQUEST";this.__sendRequestToExtension(m);this.$FBRTCScreenSharingController9(c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_TOGGLED,"status: "+(this.isEnabled()?"enabled":"disabled"))}};k.prototype.$FBRTCScreenSharingController8=function(l){__p&&__p();var m=l?l:this.__model;if(!c("FBRTCCallDialogController").container)c("FBRTCCallDialogController").setDialogContainer(document.body.appendChild(document.createElement("div")));if(!c("FBRTCScreenSharingUtils").isSupportedBrowser()){c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.SCREEN_SHARING_UNSUPPORTED,m);return false}else if(!c("FBRTCScreenSharingUtils").isExtensionInstalled()){c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.INSTALL_SCREEN_SHARING_EXT,m);return false}return true};k.prototype.__sendRequestToExtension=function(l){l==="SC_REQUEST"||l==="SC_CANCEL"||l==="SC_RESET_PORT"||h(0);window.postMessage({recipient:c("FBRTCScreenSharingUtils").RECIPIENT,type:l,text:"communicate with screen sharing extension"},"*");if(l==="SC_REQUEST"||l==="SC_CANCEL")window.addEventListener("message",this.$FBRTCScreenSharingController5)};k.prototype.$FBRTCScreenSharingController10=function(l){if(this.$FBRTCScreenSharingController1){this.$FBRTCScreenSharingController2.logToConsole(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,"Screen sharing already enabled, do nothing");return}this.__model.onStart(l);if(this.__model.isEnabled())c("FBRTCScreenMedia").requestScreenMedia(l)};k.prototype.$FBRTCScreenSharingController7=function(){if(!this.$FBRTCScreenSharingController1){this.$FBRTCScreenSharingController2.logToConsole(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,"Screen sharing already disabled, do nothing");return}this.$FBRTCScreenSharingController9(c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_DISABLED);this.$FBRTCScreenSharingController1=false;this.__emitChange()};k.prototype.$FBRTCScreenSharingController12=function(l){this.$FBRTCScreenSharingController1=!!l.stream;this.__model.setStream(l.stream,false);this.$FBRTCScreenSharingController9(c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_ENABLED);this.__emitChange()};k.prototype.$FBRTCScreenSharingController13=function(l){this.$FBRTCScreenSharingController2.logError(this.$FBRTCScreenSharingController3,this.$FBRTCScreenSharingController4,"Failed retrieving the screen stream with error: "+l.error)};k.prototype.$FBRTCScreenSharingController9=function(l){var m,n=this.$FBRTCScreenSharingController3,o=this.$FBRTCScreenSharingController4;for(var p=arguments.length,q=Array(p>1?p-1:0),r=1;r<p;r++)q[r-1]=arguments[r];(m=this.$FBRTCScreenSharingController2).logAction.apply(m,[n,o,l].concat(q))};k.prototype.$FBRTCScreenSharingController11=function(){var l,m=this.$FBRTCScreenSharingController3,n=this.$FBRTCScreenSharingController4;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];(l=this.$FBRTCScreenSharingController2).logError.apply(l,[m,n].concat(p))};k.prototype.__onDispatch=function(l){switch(l.type){case c("FBRTCScreenMedia").Types.STREAM_READY:this.$FBRTCScreenSharingController12(l);break;case c("FBRTCScreenMedia").Types.STREAM_FAILED:this.$FBRTCScreenSharingController13(l);break;default:break}};f.exports=k}),null);
__d("FBRTCStreamTester",["mixInEventEmitter","FBRTCUtils"],(function a(b,c,d,e,f,g){__p&&__p();var h=100,i=30;function j(k){"use strict";if(!k)k={};this.$FBRTCStreamTester1=k.retries||i;this.$FBRTCStreamTester2=k.testInterval||h;this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester5=false}j.prototype.testStream=function(k,l){"use strict";__p&&__p();this.$FBRTCStreamTester3=k;if(!l){this.$FBRTCStreamTester5=true;this.$FBRTCStreamTester4=document.createElement("video");this.$FBRTCStreamTester4.muted=true;c("FBRTCUtils").attachMediaStream(this.$FBRTCStreamTester4,this.$FBRTCStreamTester3);this.$FBRTCStreamTester4.play()}else{this.$FBRTCStreamTester5=false;this.$FBRTCStreamTester4=l}this.$FBRTCStreamTester6(this.$FBRTCStreamTester1)};j.prototype.$FBRTCStreamTester6=function(k){"use strict";__p&&__p();if(this.$FBRTCStreamTester3.getVideoTracks().length===0||this.$FBRTCStreamTester4.currentTime>0){this.$FBRTCStreamTester7();this.emit("streamWorking")}else if(k<1){this.$FBRTCStreamTester7();this.emit("streamBroken")}else setTimeout(this.$FBRTCStreamTester6.bind(this,k-1),this.$FBRTCStreamTester2)};j.prototype.$FBRTCStreamTester7=function(){"use strict";if(this.$FBRTCStreamTester5)this.$FBRTCStreamTester4.pause();this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester3=null};c("mixInEventEmitter")(j,{streamWorking:true,streamBroken:true});f.exports=j}),null);
__d("FBRTCUserMedia",["FBRTCConstants","FBRTCLogger","FBRTCStreamTester","FBRTCStreamWrapper","FBRTCUserMediaRequest","MessengerRTCFunnelLogger","UserMediaRequestError","mixInEventEmitter"],(function a(b,c,d,e,f,g){__p&&__p();var h={_localStream:null,_accessGranted:false,_pendingRequest:null,_failedVideoSources:[],_failedAudioSources:[],requestUserMedia:function i(j,k,l,m,n){if(this._localStream&&!l&&!m)this.emit("streamReady",this._localStream);else{this._startRequestListeners();this._pendingRequest=new(c("FBRTCUserMediaRequest"))(j,k,n);this._pendingRequest.audioSource=l;this._pendingRequest.videoSource=m;this._request()}},_request:function i(){if(this._pendingRequest){this._pendingRequest.request().then(function(j){return this._onRequestSuccess(j)}.bind(this),function(j){return this._onRequestFailure(c("UserMediaRequestError").createFromNative(j))}.bind(this));c("MessengerRTCFunnelLogger").appendAction("user_media_requested")}},end:function i(){this._stopEventListeners();if(this._localStream){c("FBRTCStreamWrapper").stopStream(this._localStream);this._localStream=null}},_startRequestListeners:function i(){if(navigator.mozGetUserMedia){this._evListener=this._onMediaPromptHidden.bind(this);document.addEventListener("mousedown",this._evListener);document.addEventListener("focus",this._evListener)}},_stopEventListeners:function i(){if(navigator.mozGetUserMedia){if(this._promptTimeout)clearTimeout(this._promptTimeout);document.removeEventListener("mousedown",this._evListener);document.removeEventListener("focus",this._evListener)}},_onMediaPromptHidden:function i(){this._promptTimeout=setTimeout(function(){if(!this._accessGranted&&this._pendingRequest)this._request()}.bind(this),1500)},_onRequestSuccess:function i(j){__p&&__p();this._stopEventListeners();c("MessengerRTCFunnelLogger").appendAction("user_media_succeeded");if(!this._accessGranted){this._accessGranted=true;this.emit("accessGranted")}j.videoMediaSourceId=this._pendingRequest.videoSource;j.audioMediaSourceId=this._pendingRequest.audioSource;var k=new(c("FBRTCStreamTester"))();k.addListener("streamWorking",function(){this._pendingRequest=null;if(this._localStream&&this._localStream!==j)c("FBRTCStreamWrapper").stopStream(this._localStream);this._localStream=j;this.emit("streamReady",this._localStream)}.bind(this));k.addListener("streamBroken",function(){c("FBRTCStreamWrapper").stopStream(j);this._onRequestFailure(new(c("UserMediaRequestError"))("StreamFailedToStart","",""))}.bind(this));k.testStream(j)},_onRequestFailure:function i(j){__p&&__p();this._stopEventListeners();var k=j.getName();c("MessengerRTCFunnelLogger").appendAction("user_media_rejected",k);if(this._shouldRetryRequest(j,this._pendingRequest)){this._configureRequestForRetry(this._pendingRequest,j);return}if(j.isRecoverableError()){c("FBRTCLogger").getInstance().logErrorWithoutID("Invalid state while requesting user media");return}this._pendingRequest=null;if(k==="NotAllowedError")this.emit("accessDenied");else{c("FBRTCLogger").getInstance().logErrorWithoutID("getUserMedia error: "+k);this.emit("accessFailed",j.getEndCallSubReason())}},_shouldRetryRequest:function i(j,k){return k.streamType!==c("FBRTCConstants").StreamType.AUDIO_ONLY&&(j.getNativeErrorName()==="DevicesNotFoundError"||j.getNativeErrorName()==="StreamFailedToStart")},_configureRequestForRetry:function i(j,k){__p&&__p();if(k.getNativeErrorName()==="StreamFailedToStart"&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources){if(j.videoSource)this._failedVideoSources.push(j.videoSource);window.MediaStreamTrack.getSources(function(l){__p&&__p();for(var m=0;m<l.length;m++){var n=l[m];if(n.kind==="video"&&this._failedVideoSources.indexOf(n.id)===-1){j.videoSource=n.id;this._request();return}}j.streamType=c("FBRTCConstants").StreamType.AUDIO_ONLY;this._request()}.bind(this))}else{j.streamType=c("FBRTCConstants").StreamType.AUDIO_ONLY;this._request()}}};c("mixInEventEmitter")(h,{streamReady:true,accessGranted:true,accessDenied:true,accessFailed:true});f.exports=h}),null);
__d("FBRTCRingback",["RTCConfig","Sound","FBRTCCallModel"],(function a(b,c,d,e,f,g){__p&&__p();var h=[c("RTCConfig").ringback_mp3_url,c("RTCConfig").ringback_ogg_url],i={monitorCallModel:function j(k){if(this._subscription)this._subscription.remove();this._callModel=k;this._subscription=k.addListener(this._onChange.bind(this))},_soundIsPlaying:false,_onChange:function j(){if(this._callModel.uiState===c("FBRTCCallModel").UIState.RINGING)this._startSound();else this._stopSound()},_startSound:function j(){if(!this._soundIsPlaying){c("Sound").play(h,this._syncToken(),true);this._soundIsPlaying=true}},_syncToken:function j(){return"ring_back_"+this._callModel.callID.toString()},_stopSound:function j(){if(this._soundIsPlaying){c("Sound").stop(h);this._soundIsPlaying=false}}};f.exports=i}),null);
__d("FBRTCStarRatingStore",["FBRTCLogger","FBRTCStore","FBRTCStarRatingActions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("FBRTCStore"));i=h&&h.prototype;function j(k,l){i.constructor.call(this);this.$FBRTCStarRatingStore1=k;this.$FBRTCStarRatingStore2=l}j.prototype.setCallSummary=function(k){this.$FBRTCStarRatingStore1=k};j.prototype.__onDispatch=function(k){switch(k.type){case c("FBRTCStarRatingActions").Types.SUBMIT_RATING:this.$FBRTCStarRatingStore3(k.rating);break;case c("FBRTCStarRatingActions").Types.SUBMIT_FEEDBACK:this.$FBRTCStarRatingStore4(k.feedback);break;case c("FBRTCStarRatingActions").Types.RATING_SHOWN:this.$FBRTCStarRatingStore5();break}};j.prototype.$FBRTCStarRatingStore3=function(k){this.$FBRTCStarRatingStore1.addExtraInfo(c("FBRTCLogger").Key.RATING,k);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2)};j.prototype.$FBRTCStarRatingStore4=function(k){this.$FBRTCStarRatingStore1.addExtraInfo(c("FBRTCLogger").Key.SURVEY_DETAILS,k);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2)};j.prototype.$FBRTCStarRatingStore5=function(){this.$FBRTCStarRatingStore1.addExtraInfo(c("FBRTCLogger").Key.RATING_SHOWN,"1");this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2)};f.exports=j}),null);
__d("FBRTCViewController",["FBRTCCallModel","FBRTCConstants","FBRTCLogger","FBRTCRingback","FBRTCStarRatingStore"],(function a(b,c,d,e,f,g){__p&&__p();var h=500;function i(j,k,l){"use strict";this.$FBRTCViewController1=j;this.$FBRTCViewController2=new(c("FBRTCStarRatingStore"))(k,l);this.$FBRTCViewController3=false;this.$FBRTCViewController4=c("FBRTCLogger").getInstance()}i.prototype.init=function(){"use strict";c("FBRTCRingback").monitorCallModel(this.$FBRTCViewController1);this.$FBRTCViewController1.fetchPeerInfo()};i.prototype.onLocalStreamReady=function(j){"use strict";this.$FBRTCViewController1.setLocalStream(j);if(this.$FBRTCViewController1.uiState>c("FBRTCCallModel").UIState.MORE_INIT)this.$FBRTCViewController4.logInfo(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,"UI: Already @ MORE_INIT, no update");else if(this.$FBRTCViewController1.canStartCall()&&!this.$FBRTCViewController1.isCaller)this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CALL_CONNECTING);else this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.MORE_INIT)};i.prototype.waitForUserInput=function(){"use strict";this.$FBRTCViewController1.setStateFrom(c("FBRTCCallModel").UIState.INIT,c("FBRTCCallModel").UIState.AWAITING_USER_START)};i.prototype.userMediaRequested=function(){"use strict";setTimeout(function(){var j=this.$FBRTCViewController1.uiState;if(j===c("FBRTCCallModel").UIState.INIT||j>=c("FBRTCCallModel").UIState.CALL_ENDED)this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.PENDING_LOCAL_MEDIA)}.bind(this),h)};i.prototype.userMediaGranted=function(){"use strict";this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.MORE_INIT)};i.prototype.userMediaDenied=function(){"use strict";this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.USER_MEDIA_DENIED)};i.prototype.onTurnCredentialsReady=function(j){"use strict";if(!this.$FBRTCViewController1.isCaller)this.$FBRTCViewController1.setStateFrom(c("FBRTCCallModel").UIState.MORE_INIT,c("FBRTCCallModel").UIState.CALL_CONNECTING)};i.prototype.onMessageTypeSent=function(j){"use strict";if(j!==c("FBRTCConstants").PayloadType.OFFER&&j!==c("FBRTCConstants").PayloadType.PCRESTART_OFFER)return;if(j===c("FBRTCConstants").PayloadType.PCRESTART_OFFER)this.$FBRTCViewController3=true;if(j===c("FBRTCConstants").PayloadType.OFFER)this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CONTACTING)};i.prototype.onMessageTypeReceived=function(j){"use strict";__p&&__p();if(this.$FBRTCViewController3){if(j===c("FBRTCConstants").PayloadType.ANSWER)this.$FBRTCViewController1.setStateFrom(c("FBRTCCallModel").UIState.CONTACTING,c("FBRTCCallModel").UIState.CALL_CONNECTING)}else if(j===c("FBRTCConstants").PayloadType.OFFER_ACK)this.$FBRTCViewController1.setStateFrom(c("FBRTCCallModel").UIState.CONTACTING,c("FBRTCCallModel").UIState.RINGING);else if(j===c("FBRTCConstants").PayloadType.ANSWER)if(this.$FBRTCViewController1.uiState===c("FBRTCCallModel").UIState.CONTACTING||this.$FBRTCViewController1.uiState===c("FBRTCCallModel").UIState.RINGING)this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CALL_CONNECTING)};i.prototype.onRemoteStreamAdded=function(event){"use strict";this.$FBRTCViewController1.setRemoteStream(event.stream)};i.prototype.end=function(j,k,l){"use strict";this.$FBRTCViewController1.endCallReason=j;this.$FBRTCViewController1.endCallSubreason=l;this.$FBRTCViewController1.isRemoteEnded=k;this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CALL_ENDED)};i.prototype.reset=function(j,k){"use strict";this.$FBRTCViewController1.resetForReconnect(j);this.$FBRTCViewController2.setCallSummary(k);this.$FBRTCViewController1.setState(c("FBRTCCallModel").UIState.CALL_CONNECTING)};i.prototype.$FBRTCViewController5=function(j,k){"use strict";this.$FBRTCViewController4.logCallAction(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,j,k?"true":"false")};f.exports=i}),null);
__d("FBRTCWindowManager",[],(function a(b,c,d,e,f,g){__p&&__p();var h={height:0,width:0,top:0,left:0},i={height:447,width:675,bottomRightOffset:50},j={init:function k(l,m){this._window=l;this._callModel=m;m.addListener(this._setProgressIndicator.bind(this));this._setProgressIndicator();this._monitorOpenerForChanges();this._storePosition()},updatePosition:function k(l){__p&&__p();if(!this._window)return;if(l&&h.height>0&&h.width>0){this._window.moveTo(h.left,h.top);this._window.resizeTo(h.width,h.height);return}this._storePosition();this._window.resizeTo(i.width,i.height);var m=screen.width-i.width-i.bottomRightOffset,n=screen.height-i.height-i.bottomRightOffset;this._window.moveTo(m,n)},reload:function k(){if(this._window&&!this._window.closed)this._window.location.reload()},close:function k(){if(this._window&&!this._window.closed)this._window.close()},_setProgressIndicator:function k(){if(this._callModel.isEnded())this._window.rtcCallInProgessWith=null;else this._window.rtcCallInProgessWith=this._callModel.peerID.toString()},_monitorOpenerForChanges:function k(){if(this._window.opener)try{this._window.opener.addEventListener("unload",function(event){this._passWindowToOpener(10)}.bind(this))}catch(l){}},_passWindowToOpener:function k(l){setTimeout(function(){setTimeout(function(){if(this._window.opener&&!this._window.opener.closed)this._window.opener.rtcCallChildWindow=this._window}.bind(this),1);if(l>1)this._passWindowToOpener(l-1)}.bind(this),1e3)},_storePosition:function k(){__p&&__p();if(this._window){if(this._window.innerWidth!==undefined){h.height=this._window.outerHeight;h.width=this._window.outerWidth}else{h.height=this._window.screen.height;h.width=this._window.screen.width}if(this._window.screenLeft!==undefined){h.left=this._window.screenLeft;h.top=this._window.screenTop}else{h.left=this._window.screenX;h.top=this._window.screenY}}}};f.exports=j}),null);
__d("FBRTCCallController",["fbt","Bootloader","ChannelManager","CollabCallMessengerBrowserEventEnum","ErrorUtils","FBRTCCallConnection","FBRTCCallConnectionMonitor","FBRTCCallControlActions","FBRTCCallDialogController","FBRTCCallModel","FBRTCCallModelStatePusher","FBRTCCallMonitor","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConfig","FBRTCConstants","FBRTCDispatcher","FBRTCExperiment","FBRTCIceCache","FBRTCLocalMessageQueue","FBRTCLogger","FBRTCMessage","FBRTCMessageDedup","FBRTCMessageListener","FBRTCMessageSender","FBRTCPCConfig","FBRTCRetriableMessage","FBRTCScreenSharingController","FBRTCScreenSharingUtils","FBRTCSdpUtils","FBRTCTurnDiscovery","FBRTCUrlManager","FBRTCUserMedia","FBRTCUserSettings","FBRTCUtils","FBRTCVideoEscalationStore","FBRTCViewController","FBRTCWindowManager","MessengerRTCFunnelLogger","RTCConfig","Run","randomInt"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=6e4,j=3e3;function k(){return c("randomInt")(0,4294967295)}c("ChannelManager").startChannelManager();function l(o,p,q,r,s){"use strict";__p&&__p();m.call(this);this.$FBRTCCallController1=r;this.$FBRTCCallController2=s;this.$FBRTCCallController3=c("FBRTCLogger").getInstance();this.$FBRTCCallController4=new(c("FBRTCLocalMessageQueue"))();this.$FBRTCCallController5=c("FBRTCCallSummaryStore").getInstance();this.$FBRTCCallController6=null;this.$FBRTCCallController7=false;this.$FBRTCCallController8=null;this.$FBRTCCallController9=false;if(!q){var t=this.$FBRTCCallController4.getOffer(o);if(t){this.$FBRTCCallController6=new(c("FBRTCMessage"))(t);var u=this.$FBRTCCallController6.msg,v=u.escalation_conference_name,w=u.offer_escalation_support;if(w){this.$FBRTCCallController9=w&&c("RTCConfig").RtcReceiveMultiwayEscalationGK;this.$FBRTCCallController8=v}c("FBRTCMessageDedup").check(o,this.$FBRTCCallController6.callID,this.$FBRTCCallController6.msgID)}else q=true}if(!p)p=this.$FBRTCCallController6?this.$FBRTCCallController6.callID:k();this.$FBRTCCallController3.logCallAction(o,p,c("FBRTCLogger").CallAction.POPUP_OPENED);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").CALL_CONTROLLER_INIT);c("MessengerRTCFunnelLogger").addFunnelTags([r?"audio_only":"video"]);this.$FBRTCCallController11=new(c("FBRTCCallModel"))({peerID:o,callID:p,isCaller:q,isAudioOnly:r});if(this.$FBRTCCallController6)this.$FBRTCCallController11.onSDPMessageFromPeer(this.$FBRTCCallController6);this.$FBRTCCallController11.localStream.setVideoEnabled(!r);this.$FBRTCCallController12=new(c("FBRTCCallModelStatePusher"))(this.$FBRTCCallController11);this.$FBRTCCallController13=c("FBRTCCallSummary").restoreOrInitialize(this.$FBRTCCallController5,o,p,q,this.$FBRTCCallController6&&this.$FBRTCCallController6.msg);this.$FBRTCCallController13.setClientVersion("1.0");this.$FBRTCCallController13.setIsUsingMultiway(this.$FBRTCCallController2);this.$FBRTCCallController13.setActiveConnection("p2p");this.$FBRTCCallController13.onPopupOpened();c("FBRTCUrlManager").init(this.$FBRTCCallController11.peerID);c("FBRTCWindowManager").init(window,this.$FBRTCCallController11);this.$FBRTCCallController14=new(c("FBRTCScreenSharingController"))(o,p);if(c("FBRTCScreenSharingUtils").isScreenSharingSupported())this.$FBRTCCallController14.addListener(this.$FBRTCCallController15.bind(this));this.$FBRTCCallController16=new(c("FBRTCViewController"))(this.$FBRTCCallController11,this.$FBRTCCallController13,this.$FBRTCCallController5);this.$FBRTCCallController16.init();this.$FBRTCCallController17=new(c("FBRTCCallConnection"))();this.$FBRTCCallController17.addListener("remoteStreamAdded",this.$FBRTCCallController18,this);this.$FBRTCCallController17.addListener("remoteStreamRemoved",this.$FBRTCCallController19,this);this.$FBRTCCallController17.addListener("sdpCreated",this.$FBRTCCallController20,this);this.$FBRTCCallController17.addListener("localIceCandidateCreated",this.$FBRTCCallController21,this);this.$FBRTCCallController17.addListener("remoteDescriptionSet",this.$FBRTCCallController22,this);this.$FBRTCCallController17.addListener("connected",this.$FBRTCCallController23,this);this.$FBRTCCallController17.addListener("disconnected",this.$FBRTCCallController24,this);this.$FBRTCCallController17.addListener("connectionUnstable",this.$FBRTCCallController25,this);this.$FBRTCCallController17.addListener("connectionError",this.$FBRTCCallController26,this);this.$FBRTCCallController27=false;this.$FBRTCCallController28=new(c("FBRTCCallConnectionMonitor"))(this.$FBRTCCallController17,this.$FBRTCCallController13);this.$FBRTCCallController28.addListener("connectionPoor",this.$FBRTCCallController29,this);this.$FBRTCCallController30=new(c("FBRTCMessageSender"))();this.$FBRTCCallController30.onMessageSent=this.$FBRTCCallController31.bind(this);this.$FBRTCCallController30.onSendFailure=this.$FBRTCCallController32.bind(this);this.$FBRTCCallController33=null;this.$FBRTCCallController34=null;this.$FBRTCCallController35=new(c("FBRTCVideoEscalationStore"))(this.$FBRTCCallController30,this.$FBRTCCallController11,!r);this.$FBRTCCallController13.setCallType(this.$FBRTCCallController35.getCallType());this.$FBRTCCallController35.addListener(this.$FBRTCCallController36.bind(this));this.$FBRTCCallController37=new(c("FBRTCIceCache"))();this.$FBRTCCallController38=false;c("Run").onBeforeUnload(this.$FBRTCCallController39.bind(this),false);c("Run").onUnload(this.$FBRTCCallController40.bind(this));c("ErrorUtils").addListener(this.$FBRTCCallController41.bind(this),true);c("FBRTCMessageListener").init(true,this.$FBRTCCallController11.peerID);c("FBRTCMessageListener").setMessageHandler(this.$FBRTCCallController42,this);var x=this;this.$FBRTCCallController43=new(c("FBRTCCallMonitor"))(this.$FBRTCCallController11);this.$FBRTCCallController43.startHeartbeat(function(){return x.$FBRTCCallController13});this.$FBRTCCallController44=null;c("FBRTCUserSettings").addListener("saved",this.$FBRTCCallController45,this);c("FBRTCTurnDiscovery").requestTurnCreds(this.$FBRTCCallController11.callID,this.$FBRTCCallController11.peerID).done(function(y){return this.$FBRTCCallController46(y)}.bind(this),function(){return this.$FBRTCCallController47()}.bind(this));c("FBRTCDispatcher").register(this.__onDispatch.bind(this));this.$FBRTCCallController48=setTimeout(function(){this.waitForUserInput()}.bind(this),1500);n(function(y){var z=y.logConnectionStats(function(){return this.$FBRTCCallController17.getStatsNative()}.bind(this),o,p),A=z.start,B=z.stop;this.$FBRTCCallController17.addListener("connected",function(){A();this.$FBRTCCallController17.addListener("isEnding",B)}.bind(this))}.bind(this))}l.prototype.__onDispatch=function(o){"use strict";__p&&__p();c("MessengerRTCFunnelLogger").logRTCP2PV1Action(o.type);switch(o.type){case c("FBRTCCallControlActions").Types.HANG_UP:this.$FBRTCCallController49(c("FBRTCConstants").CallEndReason.HANGUP_CALL,false,true,false);break;case c("FBRTCCallControlActions").Types.TOGGLE_SCREEN_SHARING:if(this.$FBRTCCallController14)this.$FBRTCCallController14.toggleScreenSharing(this.$FBRTCCallController11);break;case c("FBRTCCallControlActions").Types.SHOW_SETTINGS:c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.SETTINGS,this.$FBRTCCallController11);break;case c("FBRTCCallControlActions").Types.ACCEPT_ESCALATION:this.$FBRTCCallController11.localStream.setVideoEnabled(true);this.$FBRTCCallController50(true);break;case c("FBRTCCallControlActions").Types.RESET_CALL:this.$FBRTCCallController51(o);break;case c("FBRTCCallControlActions").Types.PARENT_WINDOW_START_CALL:if(this.$FBRTCCallController11.canBeStartedByParentWindow())this.startCallProcess();break;case c("FBRTCCallControlActions").Types.REDIAL_CALL:this.$FBRTCCallController11.resetCallInfo(k());this.$FBRTCCallController13=new(c("FBRTCCallSummary"))({peerID:this.$FBRTCCallController11.peerID,callID:this.$FBRTCCallController11.callID,isCaller:true});this.$FBRTCCallController13.setClientVersion("1.0");this.$FBRTCCallController13.setIsUsingMultiway(this.$FBRTCCallController2);this.$FBRTCCallController13.setActiveConnection("p2p");this.$FBRTCCallController52(c("FBRTCLogger").Trigger.REDIAL_BUTTON);break;case c("FBRTCCallControlActions").Types.START_CALL:this.$FBRTCCallController52(c("FBRTCLogger").Trigger.POPUP_CALL_START_BUTTON);break}};l.prototype.getCallModel=function(){"use strict";return this.$FBRTCCallController11};l.prototype.getConnection=function(){"use strict";return this.$FBRTCCallController17};l.prototype.sendData=function(o,p){"use strict";this.$FBRTCCallController17.sendData({topic:o,data:p})};l.prototype.addDataChannelListener=function(o,p){"use strict";return this.$FBRTCCallController17.addListener("data_message",o,p)};l.prototype.$FBRTCCallController52=function(o){"use strict";this.$FBRTCCallController13.onCallStarted(o);this.startCallProcess()};l.prototype.startCallProcess=function(){"use strict";this.$FBRTCCallController53();this.$FBRTCCallController16.userMediaRequested();this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").CALL_PROCESS_STARTED)};l.prototype.waitForUserInput=function(){"use strict";this.$FBRTCCallController16.waitForUserInput()};l.prototype.$FBRTCCallController53=function(){"use strict";__p&&__p();var o=this.$FBRTCCallController11.localStream;c("FBRTCUserMedia").once("streamReady",this.$FBRTCCallController54,this);c("FBRTCUserMedia").addListener("accessDenied",this.$FBRTCCallController55,this);c("FBRTCUserMedia").addListener("accessFailed",this.$FBRTCCallController56,this);c("FBRTCUserMedia").addListener("accessGranted",this.$FBRTCCallController57,this);o.addListener("streamStarted",function(){this.$FBRTCCallController13.setVideoCaptureStats(o.videoWidth,o.videoHeight);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").LOCAL_STREAM_STARTED,o.getStream())}.bind(this));this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,"init");this.$FBRTCCallController58()};l.prototype.$FBRTCCallController58=function(){"use strict";__p&&__p();var o=void 0;if(!this.$FBRTCCallController11.isRemoteVideoSupported)o=c("FBRTCConstants").VideoQuality.NO_VIDEO;else if(this.$FBRTCCallController11.isPeerOnMobile)o=c("FBRTCConstants").VideoQuality.LQ_VIDEO;else if(c("FBRTCConfig").isVCEndpointCall())o=c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO;else if(this.$FBRTCCallController11.isCaller&&this.$FBRTCCallController11.uiState>=c("FBRTCCallModel").UIState.CALL_CONNECTING){var p=c("FBRTCExperiment").gen("rtc_web_video_quality_3"),q=p.getParam("renegotiate_to_hd","no");if(q==="yes")o=c("FBRTCConstants").VideoQuality.HD_VIDEO;else o=c("FBRTCConstants").VideoQuality.SD_VIDEO}else o=c("FBRTCConstants").VideoQuality.SD_VIDEO;var r=c("FBRTCConstants").StreamType.AUDIO_ONLY;if(this.$FBRTCCallController11.localStream&&this.$FBRTCCallController11.localStream.hasVideoTracks())r=c("FBRTCConstants").StreamType.AUDIO_VIDEO;var s=c("FBRTCUserSettings").audioInput,t=c("FBRTCUserSettings").videoInput;this.$FBRTCCallController59=o;this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,{streamType:r,videoQuality:o,audioInput:s,videoInput:t});c("FBRTCUserMedia").requestUserMedia(r,o,s,t,this.$FBRTCCallController1)};l.prototype.$FBRTCCallController15=function(){"use strict";__p&&__p();var o=this.$FBRTCCallController14.isEnabled(),p=this.$FBRTCCallController14.getStream();if(o)this.$FBRTCCallController17.addScreenStream(p);else{this.$FBRTCCallController17.removeScreenStream(p);this.$FBRTCCallController14.onStop()}this.$FBRTCCallController60();c("FBRTCWindowManager").updatePosition(!o);if(o)this.$FBRTCCallController11.setLocalScreenStream(p);else this.$FBRTCCallController11.setLocalScreenStream(null);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").SCREEN_SHARING_TOGGLED,o)};l.prototype.$FBRTCCallController62=function(){"use strict";if(!this.$FBRTCCallController11.isRemoteVideoSupported&&this.$FBRTCCallController59===c("FBRTCConstants").VideoQuality.NO_VIDEO)return;else if(this.$FBRTCCallController11.isPeerOnMobile&&this.$FBRTCCallController59===c("FBRTCConstants").VideoQuality.LQ_VIDEO)return;this.$FBRTCCallController60()};l.prototype.$FBRTCCallController41=function(o){"use strict";var p=o.message+"; "+o.stackFrames[0].identifier;this.$FBRTCCallController3.logError(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"JSError: "+p)};l.prototype.$FBRTCCallController39=function(){"use strict";if(this.$FBRTCCallController11.isInProgress())return h._("Leaving this page will end your call.")};l.prototype.$FBRTCCallController40=function(){"use strict";__p&&__p();if(this.$FBRTCCallController11.isEnded())return;var o=this.$FBRTCCallController11.isUserMediaPending(),p=this.$FBRTCCallController11.isUserMediaDenied(),q=c("FBRTCConstants").CallEndReason.HANGUP_CALL,r="BrowserClosed";if(o||p){q=c("FBRTCConstants").CallEndReason.CLIENT_ERROR;r=o?"MediaPending":"MediaDenied"}else if(this.$FBRTCCallController11.isAwaitingUserStart())r="AwaitingUserStart";this.$FBRTCCallController49(q,false,true,true,r)};l.prototype.$FBRTCCallController46=function(o){"use strict";this.$FBRTCCallController3.logInfo(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Received Turn Creds");this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").TURN_CREDENTIALS_RECEIVED,o);c("FBRTCPCConfig").setTurnCredentials(o);this.$FBRTCCallController16.onTurnCredentialsReady(o);this.$FBRTCCallController63()};l.prototype.$FBRTCCallController47=function(){"use strict";this.$FBRTCCallController3.logError(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Failed to get turn creds");this.$FBRTCCallController49(c("FBRTCConstants").CallEndReason.CLIENT_ERROR,false,!this.$FBRTCCallController11.isCaller,false,"NoTurnCreds")};l.prototype.$FBRTCCallController63=function(){"use strict";__p&&__p();if(this.$FBRTCCallController11.canStartCall()){c("FBRTCUrlManager").onCallStarted();var o=this.$FBRTCCallController11.localStream;this.$FBRTCCallController17.init(o);if(!this.$FBRTCCallController6)this.$FBRTCCallController17.createOffer();else{if(this.$FBRTCCallController6.isFromMobile()&&!o.hasVideoTracks())this.$FBRTCCallController6.disableVideo();if(Object.prototype.hasOwnProperty.call(this.$FBRTCCallController6.msg,"videoon"))this.$FBRTCCallController50(this.$FBRTCCallController6.msg.videoon);this.$FBRTCCallController11.setSignalingExperiments(this.$FBRTCCallController6.getSignalingExperiments());this.$FBRTCCallController64(this.$FBRTCCallController6.msg.sdp,true,this.$FBRTCCallController6.msg.attributes);this.$FBRTCCallController4.removeOffer(this.$FBRTCCallController11.peerID);this.$FBRTCCallController6=null}this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").CALL_START_TRY)}else this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").CALL_START_TRY,"not ready")};l.prototype.$FBRTCCallController60=function(){"use strict";__p&&__p();if(this.$FBRTCCallController11.isAwaitingAnswer())this.$FBRTCCallController27=true;else{this.$FBRTCCallController27=false;this.$FBRTCCallController58();var o=[];if(this.$FBRTCCallController11.supportsSdpUpdate()){var p=this.$FBRTCCallController11.supportsMultipleStreamsPlanB();this.$FBRTCCallController17.createSdpUpdate(p);o.push("SDP update",p?"plan B":null)}else{this.$FBRTCCallController7=true;this.$FBRTCCallController37.reset(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID);this.$FBRTCCallController38=false;this.$FBRTCCallController17.createOffer();o.push("new offer")}this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").RENEGOTIATION,o)}};l.prototype.$FBRTCCallController67=function(o,p){"use strict";this.$FBRTCCallController30.sendSdpUpdate(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,o,this.$FBRTCCallController11.localStream.hasVideo(),p)};l.prototype.$FBRTCCallController65=function(o,p){"use strict";__p&&__p();var q=void 0;if(!this.$FBRTCCallController7)q=c("FBRTCConstants").PayloadType.OFFER;else{q=c("FBRTCConstants").PayloadType.PCRESTART_OFFER;this.$FBRTCCallController7=false}this.$FBRTCCallController33=new(c("FBRTCRetriableMessage"))(this.$FBRTCCallController30);this.$FBRTCCallController33.addListener("sendingRetry",this.$FBRTCCallController68.bind(this));this.$FBRTCCallController33.addListener("timeoutFailure",this.$FBRTCCallController69.bind(this));this.$FBRTCCallController33.sendMessage(q,this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,o,this.$FBRTCCallController11.localStream.hasVideo(),p);this.$FBRTCCallController44=setTimeout(function(){this.$FBRTCCallController49(c("FBRTCConstants").CallEndReason.NO_ANSWER_TIMEOUT,false,true,false)}.bind(this),i)};l.prototype.$FBRTCCallController69=function(){"use strict";var o=void 0;if(this.$FBRTCCallController11.receivedNack){o=c("FBRTCConstants").CallEndReason.UNSUPPORTED_VERSION;c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.PEER_BROWSER_UNSUPPORTED,this.$FBRTCCallController11)}else o=c("FBRTCConstants").CallEndReason.OTHER_NOT_CAPABLE;this.$FBRTCCallController49(o,false,true,false,"TimedOut")};l.prototype.$FBRTCCallController50=function(o){"use strict";var p=this.$FBRTCCallController11.remoteStream;p.setVideoEnabled(o);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_MUTE_TOGGLED,p.getStream())};l.prototype.$FBRTCCallController66=function(o,p){"use strict";var q=this.$FBRTCCallController11.localStream.hasVideo()&&this.$FBRTCCallController11.isRemoteVideoSupported;this.$FBRTCCallController34=new(c("FBRTCRetriableMessage"))(this.$FBRTCCallController30);this.$FBRTCCallController34.addListener("sendingRetry",this.$FBRTCCallController68.bind(this));var r={escalationConferenceName:this.$FBRTCCallController8,negotiatedEscalationSupport:this.$FBRTCCallController9};this.$FBRTCCallController34.sendMessage(c("FBRTCConstants").PayloadType.ANSWER,this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,o,q,p,r)};l.prototype.$FBRTCCallController68=function(){"use strict";var o=this.$FBRTCCallController17.getCreatedIceCandidates();for(var p=0;p<o.length;p++)this.$FBRTCCallController70(o[p])};l.prototype.$FBRTCCallController70=function(o){"use strict";this.$FBRTCCallController30.sendIceCandidate(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,o)};l.prototype.$FBRTCCallController64=function(o,p,q){"use strict";this.$FBRTCCallController17.setPeerSupportsVideo(this.$FBRTCCallController11.isRemoteVideoSupported);if(this.$FBRTCCallController11.isPeerOnMobile)o=c("FBRTCSdpUtils").setVideoBitrateConstraint(o);if(p)this.$FBRTCCallController17.onReceivedOfferSDP(o,q);else this.$FBRTCCallController17.onReceivedAnswerSDP(o,q)};l.prototype.$FBRTCCallController32=function(o,p){"use strict";this.$FBRTCCallController49(o,false,false,false,p)};l.prototype.$FBRTCCallController31=function(o,p){"use strict";__p&&__p();var q=p.call_id,r=p.type;if(this.$FBRTCCallController11.isEnded()){this.$FBRTCCallController3.logError(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Message sent after call ended: "+r);return}if(this.$FBRTCCallController11.peerID!==o||this.$FBRTCCallController11.callID!==q)return;this.$FBRTCCallController16.onMessageTypeSent(r);this.$FBRTCCallController13.onMessageSent(p);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").MESSAGE_SENT,p.msg_id)};l.prototype.$FBRTCCallController72=function(o){"use strict";__p&&__p();var p=o.peerID,q=o.callID,r=o.msg,s=new(c("FBRTCCallSummary"))({peerID:p,callID:q,isCaller:false});s.setClientVersion("1.0");s.setIsUsingMultiway(this.$FBRTCCallController2);s.setActiveConnection("p2p");s.onFullMessageReceived(o);this.$FBRTCCallController30.sendOfferAck(p,q,r);s.onOfferAckSent(r);var t=c("FBRTCConstants").CallEndReason.IN_ANOTHER_CALL;this.$FBRTCCallController81(p,q,t);s.onCallEnded(t,false);s.save(this.$FBRTCCallController5)};l.prototype.$FBRTCCallController73=function(o){"use strict";__p&&__p();var p=o.msg;if(p.calltype){this.$FBRTCCallController30.sendOfferNack(this.$FBRTCCallController11.peerID,p.call_id,p);return}this.$FBRTCCallController30.sendOfferAck(this.$FBRTCCallController11.peerID,p.call_id,p);this.$FBRTCCallController30.sendOtherDismiss(p.call_id);if(this.$FBRTCCallController82(p))this.$FBRTCCallController83(o);else this.$FBRTCCallController84(o)};l.prototype.$FBRTCCallController75=function(o){var p=o.msg;"use strict";var q=p.attributes,r=p.sdp;if(Object.prototype.hasOwnProperty.call(p,"videoon"))this.$FBRTCCallController50(p.videoon);if(this.$FBRTCCallController11.isPeerOnMobile)r=c("FBRTCSdpUtils").setVideoBitrateConstraint(r);this.$FBRTCCallController17.onReceivedSdpUpdate(r,q);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").SDP_UPDATE,{sdp:r,attributes:q})};l.prototype.$FBRTCCallController82=function(o){"use strict";if(o.call_id===this.$FBRTCCallController11.callID)return true;return(this.$FBRTCCallController44||!this.$FBRTCCallController6)&&(!this.$FBRTCCallController11.callID||o.call_id!==this.$FBRTCCallController11.callID)&&this.$FBRTCCallController11.isCaller&&(!o.handlescollision||o.call_id<this.$FBRTCCallController11.callID)};l.prototype.$FBRTCCallController83=function(o){"use strict";__p&&__p();var p=o.msg;if(Object.prototype.hasOwnProperty.call(p,"videoon"))this.$FBRTCCallController50(p.videoon);this.$FBRTCCallController85();this.$FBRTCCallController86();this.$FBRTCCallController71();if(this.$FBRTCCallController11.callID!==p.call_id){var q=c("FBRTCConstants").CallEndReason.OTHER_INSTANCE_HANDLED;this.$FBRTCCallController81(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,q);this.$FBRTCCallController13.onCallEnded(q,false);this.$FBRTCCallController13.save(this.$FBRTCCallController5);this.$FBRTCCallController13=new(c("FBRTCCallSummary"))({peerID:this.$FBRTCCallController11.peerID,callID:p.call_id,isCaller:false});this.$FBRTCCallController13.setClientVersion("1.0");this.$FBRTCCallController13.setActiveConnection("p2p");this.$FBRTCCallController13.setIsUsingMultiway(this.$FBRTCCallController2);this.$FBRTCCallController13.onFullMessageReceived(o);this.$FBRTCCallController13.onOfferAckSent(p);this.$FBRTCCallController3.logEvent(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Handling offer collision")}else this.$FBRTCCallController3.logEvent(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Handling offer refresh");this.$FBRTCCallController17.end();this.$FBRTCCallController38=false;this.$FBRTCCallController16.reset(p.call_id,this.$FBRTCCallController13);this.$FBRTCCallController11.onSDPMessageFromPeer(o);this.$FBRTCCallController6=o;this.$FBRTCCallController63();this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").OFFER_ACCEPTED,o.msgID)};l.prototype.$FBRTCCallController84=function(o){"use strict";this.$FBRTCCallController3.logEvent(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Ignoring offer");this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").OFFER_IGNORED,o.msgID)};l.prototype.$FBRTCCallController74=function(o){"use strict";__p&&__p();var p=o.msg;this.$FBRTCCallController85();this.$FBRTCCallController86();this.$FBRTCCallController30.sendAnswerAck(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,p);this.$FBRTCCallController11.onSDPMessageFromPeer(o);if(this.$FBRTCCallController27)this.$FBRTCCallController60();else{this.$FBRTCCallController64(p.sdp,false,p.attributes);if(Object.prototype.hasOwnProperty.call(p,"videoon"))this.$FBRTCCallController50(p.videoon)}};l.prototype.$FBRTCCallController80=function(o){"use strict";__p&&__p();var p=o.msg;if(this.$FBRTCCallController33&&this.$FBRTCCallController33.isAckMsg(p)){this.$FBRTCCallController13.onMsgAckReceived(o,true);this.$FBRTCCallController16.onMessageTypeReceived(c("FBRTCConstants").PayloadType.OFFER_ACK);this.$FBRTCCallController78(o)}else if(this.$FBRTCCallController34&&this.$FBRTCCallController34.isAckMsg(p)){this.$FBRTCCallController13.onMsgAckReceived(o,false);this.$FBRTCCallController79()}};l.prototype.$FBRTCCallController78=function(o){"use strict";this.$FBRTCCallController13.setUploadLogLevel(c("FBRTCUtils").getUploadLogLevel(c("FBRTCConstants").convertToUploadLogLevel(o.msg.ull)));this.$FBRTCCallController13.save(this.$FBRTCCallController5);this.$FBRTCCallController85();this.$FBRTCCallController43.onCallHeartbeat(this.$FBRTCCallController13)};l.prototype.$FBRTCCallController79=function(){"use strict";this.$FBRTCCallController71()};l.prototype.$FBRTCCallController76=function(o){"use strict";var p=o.msg;if(p.call_id===this.$FBRTCCallController11.callID&&this.$FBRTCCallController38)this.$FBRTCCallController17.onReceivedRemoteIceCandidate(p);else this.$FBRTCCallController37.cacheCandidate(this.$FBRTCCallController11.peerID,p.call_id,p)};l.prototype.$FBRTCCallController77=function(o){"use strict";__p&&__p();var p=o.msg;if(p.call_id===this.$FBRTCCallController11.callID){var q=c("FBRTCConstants").CallEndReason.CLIENT_ERROR;if(p.reason===c("FBRTCConstants").CallEndReason.NO_ANSWER_TIMEOUT)if(this.$FBRTCCallController11.isUserMediaPending()){this.$FBRTCCallController49(q,false,false,false,"MediaPending");return}else if(this.$FBRTCCallController11.isUserMediaDenied()){this.$FBRTCCallController49(q,false,false,false,"MediaDenied");return}this.$FBRTCCallController49(p.reason,true,false,false,p.subreason)}else{var r=p.call_id.toString();this.$FBRTCCallController3.logError(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Receiving hangup for a different call: "+r);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").HANGUP_CALL_ID_MISSMATCH,r)}};l.prototype.$FBRTCCallController51=function(o){"use strict";var p=o.trigger;if(!p||p!==c("FBRTCLogger").Trigger.RESET_CALL)return;var q=c("FBRTCConstants").CallEndReason.HANGUP_CALL;this.$FBRTCCallController49(q,false,true,false,"CallReset");c("FBRTCWindowManager").reload()};l.prototype.$FBRTCCallController49=function(o,p,q,r,s){"use strict";__p&&__p();if(typeof o=="string"||o instanceof String)o=c("FBRTCConstants").endCallReasonFromString(o);var t=c("FBRTCConstants").fullCallEndReasonString(o,p);this.$FBRTCCallController3.logCallAction(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,c("FBRTCLogger").CallAction.END_CALL,t);c("MessengerRTCFunnelLogger").logRTCP2PV1Action("END_CALL",t);this.$FBRTCCallController85();this.$FBRTCCallController86();this.$FBRTCCallController71();if(this.$FBRTCCallController11.isEnded()){this.$FBRTCCallController3.logError(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Ending an already-ended call");return}if(q)this.$FBRTCCallController81(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,o,r,s);this.$FBRTCCallController14.onEndCall();this.$FBRTCCallController17.end();c("FBRTCUserMedia").end();this.$FBRTCCallController16.end(o,p,s);this.$FBRTCCallController13.setCallType(this.$FBRTCCallController35.getCallType());this.$FBRTCCallController13.setVideoDurations(this.$FBRTCCallController11.getLocalVideoDuration(),this.$FBRTCCallController11.getRemoteVideoDuration());this.$FBRTCCallController13.onCallEnded(o,p,null,s);this.$FBRTCCallController13.save(this.$FBRTCCallController5);clearTimeout(this.$FBRTCCallController61);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").CALL_ENDED,{reason:t,reasonID:o,subReason:s,isRemoteEnded:p});if(o===c("FBRTCConstants").CallEndReason.HANGUP_CALL&&s==="CallReset"&&p)c("FBRTCWindowManager").close()};l.prototype.$FBRTCCallController81=function(o,p,q,r,s){"use strict";this.$FBRTCCallController30.sendHangup(o,p,q,r,s);this.$FBRTCCallController30.sendOtherDismiss(p)};l.prototype.$FBRTCCallController85=function(){"use strict";if(this.$FBRTCCallController33)this.$FBRTCCallController33.stopRetrying()};l.prototype.$FBRTCCallController71=function(){"use strict";if(this.$FBRTCCallController34)this.$FBRTCCallController34.stopRetrying()};l.prototype.$FBRTCCallController86=function(){"use strict";if(this.$FBRTCCallController44)clearTimeout(this.$FBRTCCallController44);this.$FBRTCCallController44=null};l.prototype.$FBRTCCallController36=function(){"use strict";if(this.$FBRTCCallController35.isPending())c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.VIDEO_ESCALATION,this.$FBRTCCallController11);else c("FBRTCCallDialogController").hideDialogType(c("FBRTCCallDialogController").dialogTypes.VIDEO_ESCALATION);this.$FBRTCCallController13.setCallType(this.$FBRTCCallController35.getCallType());this.$FBRTCCallController13.save(this.$FBRTCCallController5)};l.prototype.$FBRTCCallController10=function(event,o){"use strict";if(!c("FBRTCConfig").isVCEndpointCall())return;n(function(p){return p.log(event,{peerID:this.$FBRTCCallController11.peerID,callID:this.$FBRTCCallController11.callID,eventDetails:o})}.bind(this))};var m=function m(){__p&&__p();this.$FBRTCCallController45=function(o){this.$FBRTCCallController3.logCallAction(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,c("FBRTCLogger").CallAction.USER_SETTINGS_CHANGED);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").USER_SETTINGS_CHANGED,{updateStream:o});if(o){c("FBRTCUserMedia").once("streamReady",function(p){c("FBRTCUserSettings").updateForLocalStream(p);this.$FBRTCCallController11.setLocalStream(p);this.$FBRTCCallController60()}.bind(this));this.$FBRTCCallController58()}}.bind(this);this.$FBRTCCallController18=function(event){__p&&__p();var o=event.stream;this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_ADDED,o);if(this.$FBRTCCallController17.isScreenStream(o)&&this.$FBRTCCallController17.getRemoteStreamsCount()>1){this.$FBRTCCallController14.setRemoteStream(o);this.$FBRTCCallController11.setRemoteScreenStream(this.$FBRTCCallController14.getStream())}else{this.$FBRTCCallController16.onRemoteStreamAdded(event);c("FBRTCUserSettings").updateForRemoteStream(o);if(this.$FBRTCCallController11.isCaller&&this.$FBRTCCallController11.supportsSdpUpdate())this.$FBRTCCallController61=setTimeout(function(){this.$FBRTCCallController62()}.bind(this),j)}}.bind(this);this.$FBRTCCallController19=function(o){var p=o.stream;this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").REMOTE_STREAM_REMOVED,p);var q=this.$FBRTCCallController11.getRemoteScreenStream();if(q&&p&&q.getStreamId()==p.id){this.$FBRTCCallController11.setRemoteScreenStream(null);this.$FBRTCCallController14.setRemoteStream(null)}clearTimeout(this.$FBRTCCallController61)}.bind(this);this.$FBRTCCallController25=function(){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Network unstable");this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").CONNECTION_INFO,"unstable")}.bind(this);this.$FBRTCCallController29=function(){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Network poor");this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").CONNECTION_INFO,"poor");if(c("FBRTCConfig").shouldAutoDisableVideo())this.$FBRTCCallController11.autoDisableVideo()}.bind(this);this.$FBRTCCallController54=function(o){c("FBRTCUserSettings").updateForLocalStream(o);this.$FBRTCCallController16.onLocalStreamReady(o);this.$FBRTCCallController63();this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").LOCAL_STREAM_READY,o)}.bind(this);this.$FBRTCCallController55=function(){this.$FBRTCCallController3.logCallAction(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,c("FBRTCLogger").CallAction.DENIED_PERMISSION);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,"denied");this.$FBRTCCallController16.userMediaDenied()}.bind(this);this.$FBRTCCallController56=function(o){this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,"failed");this.$FBRTCCallController49(c("FBRTCConstants").CallEndReason.CLIENT_ERROR,false,true,false,o);c("FBRTCCallDialogController").showDialog(c("FBRTCCallDialogController").dialogTypes.ERROR_ACCESSING_MEDIA,this.$FBRTCCallController11)}.bind(this);this.$FBRTCCallController57=function(){this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").REQUEST_USER_MEDIA,"granted");this.$FBRTCCallController16.userMediaGranted()}.bind(this);this.$FBRTCCallController20=function(o){switch(o.type){case"offer":this.$FBRTCCallController65(o.sdp,o.attributes);break;case"answer":this.$FBRTCCallController66(o.sdp,o.attributes);break;case"sdp_update":this.$FBRTCCallController67(o.sdp,o.attributes);break;default:break}}.bind(this);this.$FBRTCCallController21=function(o){this.$FBRTCCallController70(o)}.bind(this);this.$FBRTCCallController22=function(){this.$FBRTCCallController38=true;var o=this;this.$FBRTCCallController37.drainCandidates(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,function(p){o.$FBRTCCallController17.onReceivedRemoteIceCandidate(p)})}.bind(this);this.$FBRTCCallController23=function(){this.$FBRTCCallController71();this.$FBRTCCallController13.onCallConnected();this.$FBRTCCallController13.onNetworkReady();this.$FBRTCCallController43.onCallHeartbeat(this.$FBRTCCallController13);this.$FBRTCCallController3.logInfo(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Call Connected");this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").CALL_CONNECTED);c("MessengerRTCFunnelLogger").logRTCP2PV1Action("call_connected")}.bind(this);this.$FBRTCCallController24=function(){this.$FBRTCCallController49(c("FBRTCConstants").CallEndReason.CONNECTION_DROPPED,false,true,false)}.bind(this);this.$FBRTCCallController26=function(o){this.$FBRTCCallController49(c("FBRTCConstants").CallEndReason.WEBRTC_ERROR,false,true,false,o.endCallSubreason);this.$FBRTCCallController3.logError(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"webrtc error: "+JSON.stringify(o.details));this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").RTC_ERROR,o.details)}.bind(this);this.$FBRTCCallController42=function(o){__p&&__p();var p=void 0;try{p=new(c("FBRTCMessage"))(o)}catch(q){this.$FBRTCCallController3.logError(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Unknown data: "+JSON.stringify(o));return}this.$FBRTCCallController3.logReceivedMessage(p.peerID,p.callID,p.msg);this.$FBRTCCallController10(c("CollabCallMessengerBrowserEventEnum").MESSAGE_RECEIVED,p.msgID);if(this.$FBRTCCallController11.isEnded()){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Ignoring message (call ended): "+p.msgID);return}if(!c("FBRTCMessageDedup").check(p.peerID,p.callID,p.msgID)){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Ignoring message (duplicate): "+p.msgID);return}if(this.$FBRTCCallController11.isAwaitingUserStart())return;if(this.$FBRTCCallController11.peerID&&this.$FBRTCCallController11.peerID!==p.peerID){if(p.isOffer())this.$FBRTCCallController72(p);this.$FBRTCCallController3.logInfo(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Ignoring message (different peer): "+p.msgID);return}if(!p.isForCall(this.$FBRTCCallController11.callID)){this.$FBRTCCallController3.logInfo(this.$FBRTCCallController11.peerID,this.$FBRTCCallController11.callID,"Ignoring message (different call): "+p.msgID);return}this.$FBRTCCallController16.onMessageTypeReceived(p.msgType);if(this.$FBRTCCallController11.callID&&this.$FBRTCCallController11.callID===p.callID)this.$FBRTCCallController13.onFullMessageReceived(p);this.$FBRTCCallController11.setSignalingExperiments(p.getSignalingExperiments());switch(p.msgType){case c("FBRTCConstants").PayloadType.OFFER:case c("FBRTCConstants").PayloadType.ICERESTART_OFFER:case c("FBRTCConstants").PayloadType.PCRESTART_OFFER:this.$FBRTCCallController73(p);break;case c("FBRTCConstants").PayloadType.ANSWER:case c("FBRTCConstants").PayloadType.ICERESTART_ANSWER:case c("FBRTCConstants").PayloadType.PCRESTART_ANSWER:this.$FBRTCCallController74(p);this.$FBRTCCallController43.onCallHeartbeat(this.$FBRTCCallController13);break;case c("FBRTCConstants").PayloadType.SDP_UPDATE:this.$FBRTCCallController75(p);break;case c("FBRTCConstants").PayloadType.ICE_CANDIDATE:this.$FBRTCCallController76(p);break;case c("FBRTCConstants").PayloadType.HANGUP:this.$FBRTCCallController77(p);break;case c("FBRTCConstants").PayloadType.OFFER_ACK:this.$FBRTCCallController78(p);break;case c("FBRTCConstants").PayloadType.OFFER_NACK:this.$FBRTCCallController11.receivedNack=true;break;case c("FBRTCConstants").PayloadType.ANSWER_ACK:this.$FBRTCCallController79();break;case c("FBRTCConstants").PayloadType.MSG_ACK:this.$FBRTCCallController80(p);break;case c("FBRTCConstants").PayloadType.SET_VIDEO:if(this.$FBRTCCallController11.isRemoteVideoSupported&&!this.$FBRTCCallController11.$FBRTCCallController1)this.$FBRTCCallController50(p.msg.videoon);break;case c("FBRTCConstants").PayloadType.VIDEO_REQUEST:case c("FBRTCConstants").PayloadType.ACK:case c("FBRTCConstants").PayloadType.OK:case c("FBRTCConstants").PayloadType.PING:case c("FBRTCConstants").PayloadType.PING_ACK:case c("FBRTCConstants").PayloadType.OTHER_DISMISS:case c("FBRTCConstants").PayloadType.PRANSWER:break;default:break}c("FBRTCCallControlActions").receivedSignalingMessage(p)}.bind(this)};function n(o){if(!c("FBRTCConfig").isVCEndpointCall())return;c("Bootloader").loadModules(["CollabMessengerLogger"],o,"FBRTCCallController")}f.exports=l}),null);
__d("FBRTCBackground.react",["cx","MessengerFaviconUrls","Image.react","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").PureComponent);j=i&&i.prototype;function l(m,n){j.constructor.call(this,m,n);this.$FBRTCBackground2=function(){this.setState({showCoverPhoto:false})}.bind(this);this.$FBRTCBackground1();this.state={showCoverPhoto:true}}l.prototype.render=function(){if(this.props.messengerUI)return null;var m=this.props.src;if(this.state.showCoverPhoto&&m)return c("React").createElement("div",{className:"_1_5p"},c("React").createElement("div",{className:"_1_5q"}),c("React").createElement(c("Image.react"),{src:m,className:"_1_5r",alt:"",onError:this.$FBRTCBackground2}));else return c("React").createElement("div",{className:"_1_5p"})};l.prototype.$FBRTCBackground1=function(){var m=document.querySelector('link[rel*=icon][href*=".ico"]');if(m instanceof HTMLLinkElement)m.href=c("MessengerFaviconUrls")["default"]};l.propTypes={messengerUI:k.bool.isRequired,src:k.string};f.exports=l}),null);
__d("FBRTCCallControlButton.react",["cx","React","emptyFunction"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes,l=Object.freeze({END:0,FULL_SCREEN:1,MUTE:2,SETTINGS:3,SHARE_SCREEN:4,VIDEO:5});i=babelHelpers.inherits(m,c("React").PureComponent);j=i&&i.prototype;m.prototype.defaultProps=function(){return{active:false,disabled:false,endButton:false,highlighted:false}};m.prototype.render=function(){var n="_5lms"+(this.props.highlighted?" _5lmy":"")+(this.props.endButton?" _5lmz":""),o=this.props,p=o.iconType,q=o.active,r=o.disabled;return c("React").createElement("button",{onClick:this.props.disabled?c("emptyFunction"):this.props.onClick,className:n,ref:this.props.ref,"data-testid":this.props["data-testid"],tabIndex:"0",role:"button","aria-label":this.props.title,"data-hover":r?undefined:"tooltip","data-tooltip-alignh":"center","data-tooltip-content":this.props.title},this.$FBRTCCallControlButton1(p,!!q,!!r))};m.prototype.$FBRTCCallControlButton1=function(n,o,p){if(o)return c("React").createElement("i",{className:"_5ln2"+(n===l.END?" _5ln3":"")+(n===l.FULL_SCREEN?" _5lng":"")+(n===l.MUTE?" _5lnh":"")+(n===l.SETTINGS?" _5lni":"")+(n===l.SHARE_SCREEN?" _5lnj":"")+(n===l.VIDEO?" _5lnk":"")});return c("React").createElement("i",{className:"_5ln2"+(p?" _5h3-":"")+(n===l.END?" _5ln3":"")+(n===l.FULL_SCREEN?" _5lnl":"")+(n===l.MUTE?" _5lnm":"")+(n===l.SETTINGS?" _5lni":"")+(n===l.SHARE_SCREEN?" _5lnn":"")+(n===l.VIDEO?" _5lnp":"")})};function m(){i.apply(this,arguments)}m.IconTypes=l;m.propTypes={active:k.bool,disabled:k.bool,endButton:k.bool,highlighted:k.bool,iconType:k.number.isRequired,onClick:k.func.isRequired,ref:k.string,title:k.node};f.exports=m}),null);
__d("FBRTCCallEndButton.react",["fbt","FBRTCCallControlActions","FBRTCCallControlButton.react","FBRTCHangupReason","React","RTCCallActions","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h){"use strict";var i=function i(j){var k=h._("End call"),l=function l(){if(j.onClick)j.onClick();c("FBRTCCallControlActions").hangUp();c("RTCCallActions").hangup(c("FBRTCHangupReason").HANGUP_CALL,"")};return c("React").createElement(c("FBRTCCallControlButton.react"),{"data-testid":c("VideoCallWebDriverIDs").END_CALL_BUTTON,endButton:true,iconType:c("FBRTCCallControlButton.react").IconTypes.END,onClick:l,title:k})};f.exports=i}),null);
__d("FBRTCCallControls.react",["cx","fbt","React","FBRTCCallControlActions","FBRTCCallControlButton.react","FBRTCCallEndButton.react","FBRTCCallControlPopover.react","FBRTCConfig","FBRTCFullScreenController","FBRTCScreenSharingUtils","FBRTCUserSettings","ScreenSharingWebDriverIDs","keyMirror"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("React").Component,m=c("React").PropTypes,n=1e4,o=c("keyMirror")({READY:null,SHOWN:null,COMPLETE:null});j=babelHelpers.inherits(p,l);k=j&&j.prototype;function p(){__p&&__p();var q,r;for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=k.constructor).call.apply(q,[this].concat(t)),this.state={forceVisible:o.READY,hasFocus:false},this.$FBRTCCallControls2=function(){this.forceUpdate()}.bind(this),this.$FBRTCCallControls12=function(){c("FBRTCCallControlActions").toggleMuteVideo()},this.$FBRTCCallControls13=function(){c("FBRTCCallControlActions").toggleMuteAudio()},this.$FBRTCCallControls15=function(){if(c("FBRTCScreenSharingUtils").isScreenSharingSupported())if(this.props.canPeerReceiveScreenSharing&&!this.props.hasRemoteScreenStream)c("FBRTCCallControlActions").toggleScreenSharing();else c("FBRTCScreenSharingUtils").logFailedAttempt(this.props.peerID,Number(this.props.callID))}.bind(this),this.onFocus=function(){this.setState({hasFocus:true})}.bind(this),this.onBlur=function(){this.setState({hasFocus:false})}.bind(this),r}p.prototype.componentDidMount=function(){this.$FBRTCCallControls1=c("FBRTCFullScreenController").addListener(this.$FBRTCCallControls2)};p.prototype.componentWillUnmount=function(){if(this.$FBRTCCallControls1){this.$FBRTCCallControls1.remove();this.$FBRTCCallControls1=null}};p.prototype.componentWillReceiveProps=function(q){__p&&__p();var r=this.state.forceVisible;if(q.videoIsAutoDisabled||q.hasStream&&!q.hasVideo){if(r===o.READY){this.setState({forceVisible:o.SHOWN});setTimeout(function(){this.setState({forceVisible:o.COMPLETE})}.bind(this),n)}}else if(r===o.SHOWN)this.setState({forceVisible:o.COMPLETE})};p.prototype.$FBRTCCallControls3=function(q){var r=65;return c("FBRTCUserSettings").isEnabled()?q:q-r};p.prototype.$FBRTCCallControls4=function(){__p&&__p();var q=null,r=null,s={};if(!this.props.isRemoteVideoSupported)q=c("FBRTCCallControlPopover.react").Types.REMOTE_VIDEO_UNSUPPORTED;else if(!this.props.hasVideo)q=c("FBRTCCallControlPopover.react").Types.NO_VIDEO_TRACKS;else if(this.props.videoIsAutoDisabled)q=c("FBRTCCallControlPopover.react").Types.VIDEO_AUTO_DISABLED;if(q)s.videoPopover=c("React").createElement(c("FBRTCCallControlPopover.react"),{reason:q,peerName:this.props.peerShortName,reference:this.refs.videoButton,width:this.$FBRTCCallControls3(320)});if(c("FBRTCScreenSharingUtils").isScreenSharingSupported()){if(this.props.isConnected&&!this.props.canPeerReceiveScreenSharing)r=c("FBRTCCallControlPopover.react").Types.SCREENSHARING_UNAVAILABLE;else if(this.props.hasRemoteScreenStream)r=c("FBRTCCallControlPopover.react").Types.PEER_IS_SHARING_SCREEN;if(r)s.screenSharingPopover=c("React").createElement(c("FBRTCCallControlPopover.react"),{reason:r,peerName:this.props.peerShortName,isVCEndpointCall:c("FBRTCConfig").isVCEndpointCall(),reference:this.refs.shareScreenButton,width:this.$FBRTCCallControls3(255)})}return s};p.prototype.render=function(){var q=this.props,r=q.isVideoMuted,s=q.isAudioMuted,t=q.showSettings,u=c("FBRTCUserSettings").isEnabled()&&t,v=c("FBRTCFullScreenController").isFullScreen(),w=this.$FBRTCCallControls5(),x=!w&&r,y=c("FBRTCScreenSharingUtils").isScreenSharingSupported(),z=s,A=this.$FBRTCCallControls4();return c("React").createElement("div",{className:"_4bbt"},c("React").createElement("div",{className:this.$FBRTCCallControls6(),onFocus:this.onFocus,onBlur:this.onBlur},this.$FBRTCCallControls7(x,w),this.$FBRTCCallControls8(z),this.$FBRTCCallControls9(y),c("React").createElement(c("FBRTCCallEndButton.react"),null),this.$FBRTCCallControls10(u),this.$FBRTCCallControls11(v),A.videoPopover,A.screenSharingPopover))};p.prototype.$FBRTCCallControls5=function(){var q=this.props,r=q.isConnected,s=q.isRemoteVideoSupported,t=q.hasVideo;return!s||!t||!r};p.prototype.$FBRTCCallControls7=function(q,r){var s=q?i._("Enable your video"):i._("Disable your video");return c("React").createElement(c("FBRTCCallControlButton.react"),{active:q,disabled:r,highlighted:q,title:s,iconType:c("FBRTCCallControlButton.react").IconTypes.VIDEO,onClick:this.$FBRTCCallControls12,ref:"videoButton"})};p.prototype.$FBRTCCallControls8=function(q){var r=q?i._("Unmute your microphone"):i._("Mute your microphone");return c("React").createElement(c("FBRTCCallControlButton.react"),{active:q,iconType:c("FBRTCCallControlButton.react").IconTypes.MUTE,highlighted:q,title:r,onClick:this.$FBRTCCallControls13})};p.prototype.$FBRTCCallControls14=function(){if(c("FBRTCUserSettings").isEnabled())c("FBRTCCallControlActions").showSettings()};p.prototype.$FBRTCCallControls10=function(q){if(q){var r=i._("Settings");return c("React").createElement(c("FBRTCCallControlButton.react"),{iconType:c("FBRTCCallControlButton.react").IconTypes.SETTINGS,title:r,onClick:this.$FBRTCCallControls14})}return null};p.prototype.$FBRTCCallControls9=function(q){if(!q)return null;var r=this.props,s=r.canPeerReceiveScreenSharing,t=r.isScreenSharingEnabled,u=s&&t,v=!s||!this.props.isConnected||this.props.hasRemoteScreenStream,w=i._("Share your screen");return c("React").createElement(c("FBRTCCallControlButton.react"),{active:u,disabled:v,highlighted:u,iconType:c("FBRTCCallControlButton.react").IconTypes.SHARE_SCREEN,title:w,onClick:this.$FBRTCCallControls15,ref:"shareScreenButton","data-testid":c("ScreenSharingWebDriverIDs").SHARE_SCREEN_BUTTON})};p.prototype.$FBRTCCallControls16=function(){c("FBRTCCallControlActions").toggleFullScreen()};p.prototype.$FBRTCCallControls11=function(q){var r=q?i._("Exit full screen"):i._("Enter full screen");return c("React").createElement(c("FBRTCCallControlButton.react"),{active:q,title:r,iconType:c("FBRTCCallControlButton.react").IconTypes.FULL_SCREEN,onClick:this.$FBRTCCallControls16})};p.prototype.$FBRTCCallControls6=function(){var q=!this.props.hasStream||this.props.isEnded,r=this.props.isMouseActive||this.state.hasFocus||this.state.forceVisible===o.SHOWN;return"_4bbx"+(q?" _4bby":"")+(r?" _4bbz":"")};p.defaultProps={hasRemoteScreenStream:false,isMouseActive:true,isRemoteVideoSupported:true,isScreenSharingEnabled:false,showSettings:false,videoIsAutoDisabled:false};p.propTypes={canPeerReceiveScreenSharing:m.bool,hasAudio:m.bool.isRequired,hasRemoteScreenStream:m.bool,hasStream:m.bool.isRequired,hasVideo:m.bool.isRequired,isAudioMuted:m.bool.isRequired,isConnected:m.bool.isRequired,isEnded:m.bool.isRequired,isMouseActive:m.bool,isRemoteVideoSupported:m.bool,isScreenSharingEnabled:m.bool,isVideoMuted:m.bool.isRequired,peerShortName:m.string.isRequired,showSettings:m.bool,videoIsAutoDisabled:m.bool,callID:m.string.isRequired,peerID:m.oneOfType([m.number,m.string]).isRequired};f.exports=p}),null);
__d("FBRTCButton.react",["cx","MessengerButtonReact.bs","React","XUIOverlayButton.react","joinClasses"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("MessengerButtonReact.bs").jsComponent,l=c("React").PropTypes;i=babelHelpers.inherits(m,c("React").PureComponent);j=i&&i.prototype;m.prototype.render=function(){var n=this.props,o=n.className,p=n.messengerUI,q=n.type,r=babelHelpers.objectWithoutProperties(n,["className","messengerUI","type"]);if(p)return c("React").createElement(k,babelHelpers["extends"]({className:o,type:q},r));return c("React").createElement(c("XUIOverlayButton.react"),babelHelpers["extends"]({className:c("joinClasses")("_1-7l",o)},r))};function m(){i.apply(this,arguments)}m.propTypes={label:l.node.isRequired,messengerUI:l.bool.isRequired,type:l.oneOf(["primary","secondary"]).isRequired};f.exports=m}),null);
__d("FBRTCCallEndMessage.react",["cx","fbt","FBRTCConstants","ReactComponentWithPureRenderMixin","React"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=c("FBRTCConstants").CallEndReason,k=c("FBRTCConstants").CollabCallEndSubreason,l=c("React").PropTypes,m=c("React").createClass({displayName:"FBRTCCallEndMessage",mixins:[c("ReactComponentWithPureRenderMixin")],propTypes:{endCallReason:l.number,endCallSubreason:l.any,isCollabCall:l.bool},defaultProps:{isCollabCall:false},render:function n(){return c("React").createElement("div",{className:"_2ze8"},this._getCallEndReason(),this._getCallEndSubreason())},_getCallEndSubreason:function n(){__p&&__p();var o=this.props,p=o.isCollabCall,q=o.endCallReason,r=o.endCallSubreason;if(!p)return null;if(q!==j.OTHER_NOT_CAPABLE&&q!==j.SIGNALING_MESSAGE_FAILED)return null;switch(r){case k.REMOTE_PEER_HANGUP:case k.REMOTE_PEER_REJECT:return null;case k.CLOSED_BY_MCU:return" - Call expired";case k.CLOSED_AS_STALE:return" - Server failed, call is stale";case k.CALL_INITIALIZATION_FAILED:return" - Call initialization to room failed";case k.SIP_CONNECTION_INITIALIZATION_FAILED:return" or No Answer";case k.LOST_MCU_CONNECTION:return" - MCU Media connection failed";case k.LOST_MCU_THRIFT_CONNECTION:return" - MCU infrastructure dropped connection";case k.LOST_SIP_ADAPTER_CONNECTION:return" - SIP infrastructure dropped connection";case k.MCU_NO_AUDIO_STREAM:return" - Invalid audio stream";case k.MCU_INVALID_STREAM_CONFIGURATION:return" - Invalid stream configuration";case k.UNKNOWN:default:return" - Unexpected call failure: "+r}},_getCallEndReason:function n(){__p&&__p();var o=this.props,p=o.endCallReason,q=o.endCallSubreason,r=i._("Not Reachable");switch(p){case j.NO_ANSWER_TIMEOUT:case j.IGNORE_CALL:return i._("No Answer");case j.INCOMING_TIMEOUT:case j.NO_PERMISSION:case j.OTHER_CARRIER_BLOCKED:return r;case j.OTHER_NOT_CAPABLE:return q!==k.MCU_INVALID_STREAM_CONFIGURATION?r:i._("Too many clients connected to the room");case j.SIGNALING_MESSAGE_FAILED:case j.WEBRTC_ERROR:case j.NO_UI_ERROR:case j.CALLER_NOT_VISIBLE:case j.CLIENT_ERROR:return i._("Call Failed");case j.UNSUPPORTED_VERSION:return i._("Can't Connect Call");case j.IN_ANOTHER_CALL:return i._("In Another Call");case j.CARRIER_BLOCKED:return i._("Switch to Wi-Fi to complete your call");case j.CLIENT_INTERRUPTED:return i._("Call Interrupted");case j.HANGUP_CALL:case j.ACCEPT_AFTER_HANGUP:return i._("Call Ended");case j.CONNECTION_DROPPED:return i._("Connection Lost");case j.OTHER_INSTANCE_HANDLED:return"";default:return""}}});f.exports=m}),null);
__d("FBRTCSpinner.react",["MessengerSpinner.react","React","XUISpinner.react"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("React").PropTypes;h=babelHelpers.inherits(k,c("React").PureComponent);i=h&&h.prototype;k.prototype.render=function(){if(this.props.messengerUI)return c("React").createElement(c("MessengerSpinner.react"),{color:"blue"});return c("React").createElement(c("XUISpinner.react"),{background:"dark",size:"large"})};function k(){h.apply(this,arguments)}k.propTypes={messengerUI:j.bool.isRequired};f.exports=k}),null);
__d("FBRTCCallStateInfo.react",["cx","fbt","FBRTCButton.react","FBRTCCallControlActions","FBRTCCallEndMessage.react","FBRTCCallModel","FBRTCCallTimer.react","FBRTCConstants","FBRTCSpinner.react","Image.react","MessengerContactImage.react","React"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j,k,l=function l(n,o){__p&&__p();switch(n.uiState){case c("FBRTCCallModel").UIState.INIT:case c("FBRTCCallModel").UIState.PENDING_LOCAL_MEDIA:case c("FBRTCCallModel").UIState.MORE_INIT:case c("FBRTCCallModel").UIState.USER_MEDIA_DENIED:return c("React").createElement(c("FBRTCSpinner.react"),{messengerUI:o});case c("FBRTCCallModel").UIState.CONTACTING:return c("React").createElement("p",{className:"_2ze8"},i._("Contacting..."));case c("FBRTCCallModel").UIState.RINGING:return c("React").createElement("p",{className:"_2ze8"},i._("Ringing..."));case c("FBRTCCallModel").UIState.CALL_CONNECTING:return c("React").createElement("p",{className:"_2ze8"},i._("Connecting..."));case c("FBRTCCallModel").UIState.CALL_CONNECTED:if(!this._start)this._start=Math.floor(Date.now()/1e3);return c("React").createElement("p",{className:"_2ze8"},c("React").createElement(c("FBRTCCallTimer.react"),{start:this._start}));case c("FBRTCCallModel").UIState.CALL_ENDED:return c("React").createElement(c("FBRTCCallEndMessage.react"),{endCallReason:n.endCallReason});default:return""}};j=babelHelpers.inherits(m,c("React").Component);k=j&&j.prototype;function m(){var n,o;"use strict";for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.revealContainer=function(){var s="_4j_h",t=document.getElementsByClassName(s)[0];if(t)t.className=s},this.renderSubMessage=function(){return l(this.props.callModel,this.props.messengerUI)}.bind(this),o}m.prototype.onCloseButtonClicked=function(n){"use strict";window.close();return};m.prototype.componentDidMount=function(){"use strict";setTimeout(function(){this.revealContainer()}.bind(this),2e3)};m.prototype.render=function(){"use strict";var n=this.props.callModel;return c("React").createElement("div",{className:"_4j_i"},this.renderPeerImage(n),this.renderMessage(),this.renderSubMessage(),this.renderCloseWindowButton(),this.renderStartCallButton())};m.prototype.renderMessage=function(){"use strict";var n=this.props.callModel;if(n.uiState===c("FBRTCCallModel").UIState.AWAITING_USER_START)return c("React").createElement("p",{className:"_4j_k"},i._("Ready to call {name}?",[i.param("name",n.peerShortName())]));return c("React").createElement("p",{className:"_4j_k"},this.props.callModel.peerName())};m.prototype.renderPeerImage=function(n){"use strict";if(n.peerPicUrl()){if(this.props.messengerUI)return c("React").createElement(c("MessengerContactImage.react"),{className:"_3z3i",isMessengerUser:true,size:75,src:n.peerPicUrl()});return c("React").createElement(c("Image.react"),{className:"_4j_j",src:n.peerPicUrl(),alt:i._("Profile Picture"),onLoad:this.revealContainer,onError:this.revealContainer})}return""};m.prototype.shouldRenderCloseButton=function(){"use strict";var n=this.props.callModel;return n.uiState===c("FBRTCCallModel").UIState.CALL_ENDED&&(!n.wasConnected||n.endCallReason!==c("FBRTCConstants").CallEndReason.HANGUP_CALL)};m.prototype.renderCloseWindowButton=function(){"use strict";if(this.shouldRenderCloseButton())return c("React").createElement(c("FBRTCButton.react"),{label:i._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:"primary"});else return""};m.prototype.renderStartCallButton=function(){"use strict";var n=this.props.callModel;if(n.uiState===c("FBRTCCallModel").UIState.AWAITING_USER_START)return c("React").createElement(c("FBRTCButton.react"),{label:i._("Start Call"),messengerUI:this.props.messengerUI,onClick:c("FBRTCCallControlActions").startCall,type:"primary"});else return""};f.exports=m}),null);
__d("FBRTCFadeInMixin",["cx","ReactDOM","joinClasses"],(function a(b,c,d,e,f,g,h){var i={componentDidMount:function j(){var k=c("ReactDOM").findDOMNode(this);k.style.opacity=0;k.className=c("joinClasses")(k.className,"_2hy");setTimeout(function(){k.style.opacity=1},1)}};f.exports=i}),null);
__d("FBRTCCollabCallFeedbackView.react",["ix","cx","fbt","FBRTCButton.react","FBRTCCallControlActions","FBRTCCallEndMessage.react","FBRTCCallModel","FBRTCFadeInMixin","Image.react","ReactComponentWithPureRenderMixin","React","fbglyph"],(function a(b,c,d,e,f,g,h,i,j){"use strict";var k=c("React").PropTypes,l=241233369258619,m=c("React").createClass({displayName:"FBRTCCollabCallFeedbackView",mixins:[c("FBRTCFadeInMixin"),c("ReactComponentWithPureRenderMixin")],propTypes:{callModel:k.instanceOf(c("FBRTCCallModel")).isRequired,messengerUI:k.bool.isRequired},closeCurrentWindow:function n(){window.close()},messageString:function n(){return j._("Please leave feedback in the VC Feedback group")},render:function n(){var o=this.props.callModel,p=c("React").createElement(c("Image.react"),{src:h("114515")});return c("React").createElement("div",null,c("React").createElement("div",{className:"_1-7k"},c("React").createElement(c("FBRTCCallEndMessage.react"),{endCallReason:o.endCallReason,endCallSubreason:o.endCallSubreason,isCollabCall:true}),c("React").createElement("p",{className:"_4j_k"},this.messageString()),c("React").createElement("div",null,c("React").createElement(c("FBRTCButton.react"),{label:j._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.closeCurrentWindow,type:"secondary"}),c("React").createElement(c("FBRTCButton.react"),{label:j._("Leave Feedback"),messengerUI:this.props.messengerUI,href:"/groups/"+l,onClick:this.closeCurrentWindow,target:"_blank",type:"primary"}))),c("React").createElement("div",{className:"_15wx"},c("React").createElement(c("FBRTCButton.react"),{className:"_15wy",label:j._("Redial"),image:p,messengerUI:this.props.messengerUI,use:"special",onClick:c("FBRTCCallControlActions").redialCall,type:"secondary"})))}});f.exports=m}),null);
__d("FBRTCScreenSharingView.react",["cx","CSS","FBRTCCallControlActions","FBRTCVideo.react","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j;i=babelHelpers.inherits(k,c("React").Component);j=i&&i.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=j.constructor).call.apply(l,[this].concat(o)),this.state={screenStream:null},m}k.prototype.componentDidMount=function(){__p&&__p();if(!this.props.isStandalone||this.state.screenStream){if(this.state.screenStream===null)this.setState({screenStream:this.props.screenStream});return}if(document.documentElement)c("CSS").addClass(document.documentElement,"_2ujx");if(window.opener.getRemoteMediaStream){var l=window.opener.getRemoteMediaStream();if(l)this.setState({screenStream:l})}window.onunload=window.opener.closeScreenSharingWindow};k.prototype.componentWillUnmount=function(){if(this.props.isStandalone)if(document.documentElement)c("CSS").removeClass(document.documentElement,"_2ujx")};k.prototype.render=function(){var l=this.state.screenStream;if(l&&l.hasStream())return c("React").createElement("div",{className:"_2uqm"+(this.props.isStandalone?" _2uqn":"")},this.$FBRTCScreenSharingView1(),c("React").createElement("div",{className:"_2uqq"},c("React").createElement(c("FBRTCVideo.react"),{className:"_3pb5 _1yvx",mediaStream:l.getStream()})));else return c("React").createElement("div",{className:"_2uql"})};k.prototype.$FBRTCScreenSharingView1=function(){if(!this.props.isStandalone)return c("React").createElement("button",{className:"_2uqo",onClick:c("FBRTCCallControlActions").openScreenInNewWindow},c("React").createElement("i",{className:"_2uqp"}));return null};k.defaultProps={isStandalone:false};f.exports=k}),null);
__d("FBRTCInCallView.react",["cx","FBRTCScreenSharingUI","FBRTCScreenSharingView.react","FBRTCStreamWrapper","FBRTCUserSettings","FBRTCVideo.react","React","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes,l=c("React").Component;i=babelHelpers.inherits(m,l);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.state={audioSinkID:null,settingsActivateListener:null,settingsDeactivateListener:null,settingsSaveListener:null,muted:false},this.$FBRTCInCallView3=function(s){var t=this.props.isRemoteVideoMuted;return"_og2"+(t?" _og3":"")+(s?" _og4":"")}.bind(this),o}m.prototype.$FBRTCInCallView1=function(n){return!!n&&!c("FBRTCScreenSharingUI").isOpen()};m.prototype.$FBRTCInCallView2=function(){var n=this.props,o=n.isCallConnected,p=n.hasCallEnded;return"_of-"+(o||p?" _of_":"")+(o?" _og0":"")+(p?" _og1":"")};m.prototype.render=function(){var n=this.props,o=n.hasRemoteMediaStream,p=n.remoteMediaStream,q=n.remoteScreenStreamWrapper,r=n.remoteStreamWrapper,s=this.state,t=s.audioSinkID,u=s.muted,v=this.$FBRTCInCallView1(q);if(!o&&!v)return c("React").createElement("div",{className:"_hgl"});return c("React").createElement("div",{className:this.$FBRTCInCallView2()},c("React").createElement("div",{className:this.$FBRTCInCallView3(v),"data-testid":c("VideoCallWebDriverIDs").INCALL_VIDEO_CONTAINER},c("React").createElement(c("FBRTCVideo.react"),{audioSinkID:t,"data-testid":c("VideoCallWebDriverIDs").RTC_INCALL_VIDEO,muted:u,stream:r,mediaStream:p})),this.$FBRTCInCallView4(q,v))};m.prototype.$FBRTCInCallView4=function(n,o){if(!n||!o)return null;return c("React").createElement(c("FBRTCScreenSharingView.react"),{canSwitchScreens:false,screenStream:n})};m.prototype.componentDidMount=function(){var n=c("FBRTCUserSettings").addListener("previewStarted",function(){return this.setState({muted:true})}.bind(this)),o=c("FBRTCUserSettings").addListener("previewEnded",function(){return this.setState({muted:false})}.bind(this)),p=c("FBRTCUserSettings").addListener("saved",function(){return this.setState({audioSinkID:c("FBRTCUserSettings").audioOutput})}.bind(this));this.setState({settingsActivateListener:n,settingsDeactivateListener:o,settingsSaveListener:p})};m.prototype.componentWillUnmount=function(){var n=this.state,o=n.settingsActivateListener,p=n.settingsDeactivateListener,q=n.settingsSaveListener;o&&o.remove();p&&p.remove();q&&q.remove()};m.propTypes={hasCallEnded:k.bool,hasRemoteMediaStream:k.bool,isCallConnected:k.bool,isRemoteVideoMuted:k.bool,remoteScreenStreamWrapper:k.instanceOf(c("FBRTCStreamWrapper")),remoteStreamWrapper:k.instanceOf(c("FBRTCStreamWrapper")),remoteMediaStream:k.any};f.exports=m}),null);
__d("FBRTCMediaAccessPrompt.react",["cx","fbt","React","ReactDOM","UserAgent","Link.react","XUIText.react","CurrentUser","FBRTCCallModel","FBRTCConfig"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j,k;j=babelHelpers.inherits(l,c("React").Component);k=j&&j.prototype;l.prototype.isVisible=function(m){"use strict";return(c("UserAgent").isBrowser("Chrome")||c("UserAgent").isBrowser("Firefox"))&&m===c("FBRTCCallModel").UIState.PENDING_LOCAL_MEDIA};l.prototype.componentWillUpdate=function(m,n){"use strict";var o=m.callModel.uiState;if(this.isVisible(o)){clearTimeout(this.timeout);c("ReactDOM").findDOMNode(this).style.display="block"}};l.prototype.componentDidUpdate=function(m,n){"use strict";var o=this.props.callModel.uiState;if(!this.isVisible(o))this.timeout=setTimeout(function(){var p=c("ReactDOM").findDOMNode(this);if(p)p.style.display="none"}.bind(this),500)};l.prototype.componentWillUnmount=function(){"use strict";clearTimeout(this.timeout)};l.prototype.dialogTitle=function(){"use strict";if(c("UserAgent").isBrowser("Chrome"))return i._("Click \"Allow\" to Make a Call");else return i._("Click the camera and choose \"Share Selected Devices\"")};l.prototype.dialogBody=function(){"use strict";if(!c("CurrentUser").isWorkUser())return i._("To make a video call on Facebook, you need to turn on your camera and microphone. This will let your friend see and hear you during the call.");else return i._("To make a video call on Workplace, you need to turn on your camera and microphone. This will let your coworker see and hear you during the call.")};l.prototype.dialogLowerBody=function(){"use strict";return i._("You can always turn these off later.")};l.prototype.learnMoreLink=function(){"use strict";return c("React").createElement(c("Link.react"),{href:c("FBRTCConfig").userMediaPermissionErrorUrl(),target:"_blank"},i._("Learn more"))};l.prototype.render=function(){"use strict";var m=this.props.callModel.uiState;return c("React").createElement("div",{className:"_3jne"+(!this.isVisible(m)?" _3jnf":"")},c("React").createElement("div",{className:"_3jnu"},c("React").createElement("h1",{className:"_3jnv"},this.dialogTitle()),c("React").createElement(c("XUIText.react"),{className:"_3jnw",display:"block",size:"meta1"},this.dialogBody()),c("React").createElement(c("XUIText.react"),{className:"_3jnw",display:"block",size:"meta1"},this.dialogLowerBody()," ",this.learnMoreLink())))};function l(){"use strict";j.apply(this,arguments)}f.exports=l}),null);
__d("FBRTCMediaDeniedPrompt.react",["cx","fbt","React","UserAgent","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react","FBRTCCallModel"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j,k;j=babelHelpers.inherits(l,c("React").Component);k=j&&j.prototype;l.prototype.showDialog=function(){"use strict";var m=this.props.callModel;return m.uiState===c("FBRTCCallModel").UIState.USER_MEDIA_DENIED};l.prototype.arrowAlignment=function(){"use strict";return c("UserAgent").isBrowser("Chrome")?"right":"left"};l.prototype.dialogTitle=function(){"use strict";return i._("Click to Turn on Camera\/Microphone")};l.prototype.dialogBody=function(){"use strict";return i._("To use video calling, you need to turn on your camera and microphone during the call.")};l.prototype.renderLayers=function(){"use strict";return c("React").createElement(c("XUIContextualDialog.react"),{contextRef:function(){return this.refs.mpTarget}.bind(this),shown:this.showDialog(),position:"below",alignment:this.arrowAlignment(),width:c("XUIContextualDialog.react").WIDTH.NORMAL,key:"popover"},c("React").createElement(c("XUIContextualDialogTitle.react"),null,this.dialogTitle()),c("React").createElement(c("XUIContextualDialogBody.react"),null,this.dialogBody()))};l.prototype.render=function(){"use strict";return c("React").createElement("span",null,c("React").createElement("div",{className:"_3wrz",ref:"mpTarget"}),this.renderLayers())};function l(){"use strict";j.apply(this,arguments)}f.exports=l}),null);
__d("FBRTCActiveMouseMixin",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=3e3,i=[],j=null,k=false;function l(o){m(true);if(j!==null)clearTimeout(j);j=setTimeout(function(){j=null;m(false)},h)}function m(o){if(o===k)return;k=o;i.map(function(p){p(k)})}var n={componentWillMount:function o(){if(this.activeMouseCallback){if(i.length==0)window.addEventListener("mousemove",l);i.push(this.activeMouseCallback)}},componentWillUnmount:function o(){__p&&__p();if(this.activeMouseCallback){var p=i.indexOf(this.activeMouseCallback);if(p>-1)i.splice(p,1);if(i.length==0){if(j!==null)clearTimeout(j);window.removeEventListener("mousemove",l)}}}};f.exports=n}),null);
__d("FBRTCVideoMuteOverlay.react",["cx","Image.react","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").PureComponent);j=i&&i.prototype;l.prototype.render=function(){var m="_30ve"+(this.props.videoMuted?" _30vf":"");return c("React").createElement("div",{className:m},c("React").createElement(c("Image.react"),{src:this.props.imageSrc,alt:"video muted"}))};function l(){i.apply(this,arguments)}l.propTypes={videoMuted:k.bool.isRequired,imageSrc:k.oneOfType([k.string,k.object]).isRequired};f.exports=l}),null);
__d("FBRTCSelfView.react",["cx","FBRTCActiveMouseMixin","FBRTCCallControlActions","FBRTCCallModel","FBRTCVideo.react","FBRTCVideoMuteOverlay.react","React","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("React").PropTypes,j=c("React").createClass({displayName:"FBRTCSelfView",mixins:[c("FBRTCActiveMouseMixin")],propTypes:{callModel:i.instanceOf(c("FBRTCCallModel")).isRequired},getInitialState:function k(){return{}},activeMouseCallback:function k(l){if(this.isMounted())this.setState({mouseActive:l})},toggleIconClass:function k(l,m){return"_2q_n"+(l?" _2q_o":"")+(!l?" _2q_p":"")+(!m?" _2q_q":"")},wrapperClasses:function k(l){return"_2q_r"+(!l.selfViewOpen?" _2q_s":"")},overlayClasses:function k(l){var m=l.localStream.hasAudio();return"_2q_t"+(m?" _2q_u":"")},buttonClasses:function k(){return"_2q_w"+(this.state.mouseActive?" _sxz":"")},render:function k(){var l=this.props.callModel,m=l.selfViewOpen,n=l.isScreenSharingEnabled()?"_nxg":"_2q_y",o=l.isScreenSharingEnabled()?l.getLocalScreenStream():l.localStream;return c("React").createElement("div",{className:"_2q_v"},c("React").createElement("button",{className:this.buttonClasses(),onClick:c("FBRTCCallControlActions").toggleSelfView},c("React").createElement("i",{className:this.toggleIconClass(true,!m)}),c("React").createElement("i",{className:this.toggleIconClass(false,m)})),c("React").createElement("div",{className:this.wrapperClasses(l)},c("React").createElement("div",{className:"_5aq5"},c("React").createElement(c("FBRTCVideoMuteOverlay.react"),{imageSrc:l.selfPicUrl(),videoMuted:!o.hasVideo()}),c("React").createElement("div",{className:this.overlayClasses(l)},c("React").createElement("i",{className:"_2q_x"})),c("React").createElement(c("FBRTCVideo.react"),{className:n,"data-testid":c("VideoCallWebDriverIDs").RTC_SELF_VIEW,muted:true,stream:o}))))}});f.exports=j}),null);
__d("FBRTCFeedbackCompleteView.react",["cx","fbt","FBRTCButton.react","FBRTCCallControlActions","FBRTCFadeInMixin","React"],(function a(b,c,d,e,f,g,h,i){var j=c("React").createClass({displayName:"FBRTCFeedbackCompleteView",mixins:[c("FBRTCFadeInMixin")],onCallBackButtonClicked:function k(){return},onCloseButtonClicked:function k(){window.close();return},messageString:function k(){if(this.props.skipped)return i._("Your call has ended");return i._("Thank you for your feedback!")},render:function k(){return c("React").createElement("div",{className:"_1-7k"},c("React").createElement("p",{className:"_4j_k"},this.messageString()),c("React").createElement("div",null,this.props.isGroupCall?null:c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:"primary"}),this.props.isGroupCall?null:c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Call Back"),messengerUI:this.props.messengerUI,onClick:c("FBRTCCallControlActions").redialCall,type:"primary"})))}});f.exports=j}),null);
__d("FBRTCFeedbackView.react",["cx","fbt","FBRTCButton.react","FBRTCFadeInMixin","FBRTCFeedbackCompleteView.react","FBRTCStarRatingActions","React"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j=c("React").createClass({displayName:"FBRTCFeedbackView",mixins:[c("FBRTCFadeInMixin")],getInitialState:function k(){return{submitted:false,skipped:false,feedbackText:""}},componentDidMount:function k(){c("FBRTCStarRatingActions").feedbackShown()},onSubmitButtonClicked:function k(){if(this.canSubmitFeedback()){this.setState({submitted:true});c("FBRTCStarRatingActions").submitFeedback(this.state.feedbackText)}},onNotNowClicked:function k(){this.setState({skipped:true,submitted:true});return},canSubmitFeedback:function k(){return this.state.feedbackText!==""},feedbackChanged:function k(l){this.setState({feedbackText:l.target.value});l.preventDefault()},render:function k(){if(this.state.submitted)return c("React").createElement(c("FBRTCFeedbackCompleteView.react"),{messengerUI:this.props.messengerUI,skipped:this.state.skipped});return c("React").createElement("div",{className:"_1-7k"},c("React").createElement("p",{className:"_4j_k"},i._("Give Feedback")),c("React").createElement("div",{className:"_4ru1"},c("React").createElement("label",{htmlFor:"fbwebrtcfeedback",className:"_4j_k _4ru2"},i._("What was the worst problem you experienced?")),c("React").createElement("textarea",{className:"_4ru3",id:"fbwebrtcfeedback",rows:"4",onChange:this.feedbackChanged,placeholder:i._("Enter your feedback")}),c("React").createElement("div",{className:"_s97"},c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:"secondary"}),c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",disabled:!this.canSubmitFeedback(),label:i._("Submit"),messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:"primary"}))))}});f.exports=j}),null);
__d("FBRTCStarRatingView.react",["cx","fbt","FBRTCButton.react","FBRTCFadeInMixin","FBRTCFeedbackCompleteView.react","FBRTCFeedbackView.react","FBRTCStarRatingActions","React","StarsInput.react","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j=c("React").createClass({displayName:"FBRTCStarRatingView",mixins:[c("FBRTCFadeInMixin")],getInitialState:function k(){return{rating:0,submitted:false,skipped:false,feedbackText:""}},componentDidMount:function k(){c("FBRTCStarRatingActions").ratingShown()},onCallBackButtonClicked:function k(){return},onCloseButtonClicked:function k(){window.close();return},onStarClicked:function k(l){this.setState({rating:l})},onSubmitButtonClicked:function k(){if(this.state.rating>0){this.setState({submitted:true});c("FBRTCStarRatingActions").submitRating(this.state.rating)}},onNotNowClicked:function k(){this.setState({skipped:true,submitted:true});return},getRatingString:function k(){switch(this.state.rating){case 1:return i._("Poor");case 2:return i._("Fair");case 3:return i._("Good");case 4:return i._("Very Good");case 5:return i._("Excellent");default:return"---"}},shouldAskForFeedback:function k(){return this.state.rating===1&&this.state.submitted&&!this.state.skipped},render:function k(){if(this.shouldAskForFeedback())return c("React").createElement(c("FBRTCFeedbackView.react"),{messengerUI:this.props.messengerUI});else if(this.state.submitted)return c("React").createElement(c("FBRTCFeedbackCompleteView.react"),{skipped:this.state.skipped,messengerUI:this.props.messengerUI});var l=this.getRatingString();return c("React").createElement("div",{className:"_1-7k","data-testid":c("VideoCallWebDriverIDs").STAR_RATING_VIEW},c("React").createElement("p",{className:"_4j_k"},this.props.hasVideo?i._("Please rate the quality of your video call."):i._("Please rate the quality of your audio call.")),c("React").createElement("p",{className:"_4j_k _a16"},l),c("React").createElement(c("StarsInput.react"),{allowMultipleSubmissions:true,onClick:this.onStarClicked}),c("React").createElement("div",{className:"_s97"},c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:"secondary"}),c("React").createElement(c("FBRTCButton.react"),{className:"_g6b",label:i._("Submit"),disabled:this.state.rating===0,messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:"primary"})))}});f.exports=j}),null);
__d("FBRTCView.react",["cx","FBRTCBackground.react","FBRTCCallControls.react","FBRTCCallModel","FBRTCCallStateInfo.react","FBRTCCollabCallFeedbackView.react","FBRTCConfig","FBRTCInCallView.react","FBRTCMediaAccessPrompt.react","FBRTCMediaDeniedPrompt.react","FBRTCSelfView.react","FBRTCStarRatingView.react","FBRTCUtils","React","RTCLogo.react","VideoCallWebDriverIDs"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes,l=c("React").Component;i=babelHelpers.inherits(m,l);j=i&&i.prototype;m.prototype.render=function(){var n=this.props,o=n.callModel,p=n.messengerUI,q=o.backgroundUrl(),r=o.getLocalVideoDuration()>0&&o.getRemoteVideoDuration()>0;if(c("FBRTCConfig").isVCEndpointCall()&&o.uiState===c("FBRTCCallModel").UIState.CALL_ENDED)return c("React").createElement("div",{className:this.$FBRTCView2()},c("React").createElement(c("FBRTCBackground.react"),{src:q,messengerUI:p}),this.$FBRTCView3(),c("React").createElement(c("FBRTCCollabCallFeedbackView.react"),{callModel:o,messengerUI:p}));if(o.uiState===c("FBRTCCallModel").UIState.COLLECT_RATING)return c("React").createElement("div",{className:this.$FBRTCView2()},c("React").createElement(c("FBRTCBackground.react"),babelHelpers["extends"]({messengerUI:p},{src:q})),this.$FBRTCView3(),c("React").createElement(c("FBRTCStarRatingView.react"),{hasVideo:r,messengerUI:p}));else{var s=o.localStream,t=o.remoteStream;return c("React").createElement("div",{className:this.$FBRTCView2()},c("React").createElement(c("FBRTCMediaAccessPrompt.react"),{callModel:o}),c("React").createElement(c("FBRTCMediaDeniedPrompt.react"),{callModel:o}),c("React").createElement(c("FBRTCCallStateInfo.react"),{callModel:o,messengerUI:p}),c("React").createElement(c("FBRTCBackground.react"),{src:q,messengerUI:p}),this.$FBRTCView3(),c("React").createElement(c("FBRTCInCallView.react"),{hasCallEnded:o.isEnded(),hasRemoteMediaStream:t.hasStream(),isCallConnected:o.isConnected(),isRemoteVideoMuted:!t.hasVideo(),remoteScreenStreamWrapper:o.getRemoteScreenStream(),remoteStreamWrapper:t}),this.$FBRTCView4(o),c("React").createElement(c("FBRTCCallControls.react"),{callID:o.callID.toString(),canPeerReceiveScreenSharing:o.canPeerReceiveScreenSharing(),hasAudio:s.hasAudioTracks(),hasRemoteScreenStream:o.getRemoteScreenStream()!==null,hasStream:s.hasStream(),hasVideo:s.hasVideoTracks(),isAudioMuted:!s.hasAudio(),isConnected:o.isConnected(),isEnded:o.isEnded(),isRemoteVideoSupported:o.isRemoteVideoSupported,isScreenSharingEnabled:o.isScreenSharingEnabled(),isVideoMuted:!s.hasVideo(),peerID:o.peerID,peerShortName:o.peerShortName(),showSettings:o.supportsSdpUpdate()||c("FBRTCUtils").supportsSetSink(),videoIsAutoDisabled:o.videoIsAutoDisabled()}))}};m.prototype.$FBRTCView2=function(){return"_3ref"+(this.props.messengerUI?" _17cj":"")};m.prototype.$FBRTCView3=function(){if(!this.props.messengerUI)return c("React").createElement(c("RTCLogo.react"),{className:"_263g",mode:"mono"});return null};m.prototype.$FBRTCView4=function(n){if(!this.props.excludeSelfView&&n.isRemoteVideoSupported&&!n.isEnded())return c("React").createElement(c("FBRTCSelfView.react"),{callModel:n});return null};m.prototype.componentDidMount=function(){var n=this.props.callModel;if(n)this.$FBRTCView1=n.addListener(function(){return this.forceUpdate()}.bind(this))};m.prototype.componentWillUnmount=function(){if(this.$FBRTCView1)this.$FBRTCView1.remove()};function m(){i.apply(this,arguments)}m.propTypes={callModel:k.instanceOf(c("FBRTCCallModel")).isRequired,messengerUI:k.bool.isRequired,excludeSelfView:k.bool};f.exports=m}),null);
__d("FBRTCApplication",["PageHooks","Bootloader","FBRTCCallController","FBRTCConfig","FBRTCLogger","FBRTCSupport","FBRTCView.react","MessengerRTCFunnelLogger","React","ReactDOM"],(function a(b,c,d,e,f,g){__p&&__p();if(!window.PageHooks)c("PageHooks");var h={init:function i(j,k,l,m,n,o,p,q){__p&&__p();p=p||document.getElementById("fbRTC/container");var r=c("FBRTCLogger").getInstance();r.logInfo(j,k,"Starting Call Controller");c("MessengerRTCFunnelLogger").setWindowNonce(q);c("MessengerRTCFunnelLogger").addFunnelTags([o>0?"is_multi_way":"not_multi_way",l?"caller":"callee","v1"]);document.documentElement.style.overflow="hidden";if(!c("FBRTCSupport").isWebrtcSupported()){r.logError(j,k,"Webrtc not supported");c("MessengerRTCFunnelLogger").endFunnel("unsupported_browser")}else if(c("FBRTCConfig").isVCEndpointCall()&&!c("FBRTCSupport").isCollabSupported()){r.logError(j,k,"browser not supported by collab");c("MessengerRTCFunnelLogger").endFunnel("unsupported_browser");c("Bootloader").loadModules(["FBRTCUnsupportedBrowserMessage"],function(t){t.showForUnsupportedCollabCall()},"FBRTCApplication");document.getElementById("fbRTC/scrollBox").style.display="none"}else{var s=new(c("FBRTCCallController"))(j,k,l,n,o);c("ReactDOM").render(c("React").createElement(c("FBRTCView.react"),{callModel:s.getCallModel(),messengerUI:c("FBRTCConfig").useMessengerCallUI()}),p)}}};f.exports=h}),null);